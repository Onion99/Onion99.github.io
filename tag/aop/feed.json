{
    "version": "https://jsonfeed.org/version/1",
    "title": "Stay hungry , Stay foolish â€¢ All posts by \"aop\" tag",
    "description": "å·´æ‹‰å·´æ‹‰",
    "home_page_url": "https://onion99.github.io",
    "items": [
        {
            "id": "https://onion99.github.io/2022/03/12/Kt2Wobik8Fv12ZRY/",
            "url": "https://onion99.github.io/2022/03/12/Kt2Wobik8Fv12ZRY/",
            "title": "Android AOP - ASM+Transform",
            "date_published": "2022-03-12T09:45:36.000Z",
            "content_html": "<span id=\"more\"></span>\n<p><img src=\"https://s1.ax1x.com/2022/03/10/bhoW8O.png\" alt=\"bhoW8O.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h3 id=\"transform\">Transform<a title=\"#transform\" href=\"#transform\"></a></h3>\n<blockquote>\n<p>Android Gradle Plugin ä» 1.5.0 å¼€å§‹æ”¯æŒ Transform APIï¼Œä»¥å…è®¸ç¬¬ä¸‰æ–¹æ’ä»¶åœ¨ç»è¿‡ç¼–è¯‘çš„ .class æ–‡ä»¶è½¬æ¢ä¸º .dex æ–‡ä»¶ä¹‹å‰å¯¹å…¶è¿›è¡Œæ“çºµã€‚</p>\n</blockquote>\n<p>æ™®é€šç¼–è¯‘è¿‡ç¨‹ï¼š<br>\n<img src=\"https://s1.ax1x.com/2022/03/11/bINI8f.png\" alt=\"bINI8f.png\" loading=\"lazy\"><br>\nå¯ä»¥çœ‹åˆ°Android æ„å»ºæµç¨‹æ˜¯ä¸€å¥—æµæ°´çº¿çš„å·¥ä½œæœºåˆ¶ï¼Œæ¯ä¸€ä¸ªçš„æ„å»ºå•å…ƒæ¥æ”¶ä¸Šä¸€ä¸ªæ„å»ºå•å…ƒçš„è¾“å‡ºï¼Œä½œä¸ºè¾“å…¥ï¼Œå†å°†äº§å“è¿›è¡Œè¾“å‡ºï¼Œ<code>com.android.build</code>åº“æä¾›äº†<code>Transform</code>çš„æœºåˆ¶ï¼Œè€Œè¿™ä¸ªæœºåˆ¶æ˜¯Android æ„å»ºç³»ç»Ÿä¸ºäº†ç»™å¤–éƒ¨æä¾›ä¸€ä¸ªå¯ä»¥åŠ å…¥è‡ªå®šä¹‰æ„å»ºå•å…ƒï¼Œå¦‚æ‹¦æˆªæŸä¸ªæ„å»ºå•å…ƒçš„è¾“å‡ºï¼Œæˆ–è€…åŠ å…¥ä¸€äº›è¾“å‡ºç­‰ã€‚è€Œè¿™äº›Transformæ˜¯åœ¨javaæºç ç¼–è¯‘å®Œæˆä¹‹åï¼Œpackageä¹‹å‰è¿›è¡Œçš„ã€‚<br>\n<img src=\"https://s1.ax1x.com/2022/03/11/bIZBy8.md.png\" alt=\"bIZBy8.md.png\" loading=\"lazy\"></p>\n<p>åœ¨Android Gradleæ„å»ºç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡<code>AppExtension </code>å°†<code>transform</code>æ³¨å†Œåˆ°æ„å»ºç³»ç»Ÿä¸­:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CustomPlugin</span> <span class=\"keyword\">implements</span> <span class=\"title\">Plugin</span>&lt;<span class=\"title\">Project</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">apply</span><span class=\"params\">(Project project)</span> </span>&#123;</span><br><span class=\"line\">        AppExtension appExtension = (AppExtension)project.getProperties().get(<span class=\"string\">&quot;android&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// ç»™Appç¼–è¯‘è¿‡ç¨‹æ³¨å†Œtransform</span></span><br><span class=\"line\">        appExtension.registerTransform(<span class=\"keyword\">new</span> CustomTransform(), Collections.EMPTY_LIST);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"asm\">ASM<a title=\"#asm\" href=\"#asm\"></a></h3>\n<blockquote>\n<p><a href=\"https://asm.ow2.io/\" target=\"_blank\">ASM</a>æ˜¯ä¸€ç§é€šç”¨<strong>Javaå­—èŠ‚ç </strong>æ“ä½œå’Œåˆ†ææ¡†æ¶ã€‚å®ƒå¯ä»¥ç”¨æ¥ä¿®æ”¹ç°æœ‰çš„ç±»ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä»¥äºŒè¿›åˆ¶å½¢å¼åŠ¨æ€ç”Ÿæˆç±»ã€‚</p>\n</blockquote>\n<p><img src=\"https://s1.ax1x.com/2022/03/11/bI0iSx.png\" alt=\"bI0iSx.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>ASMè®¾è®¡äº†ä¸¤ç§APIç±»å‹è§£ææ–‡ä»¶ç»“æ„ï¼š</p>\n<ul>\n<li>Tree API</li>\n<li>åŸºäºVisitor API(visitor pattern)ï¼Œ</li>\n</ul>\n<p>è®©æˆ‘ä»¬ä»¥ä¸åŒçš„æ–¹å¼å¤„ç†ä¸‹å§ğŸ¤¤ğŸ¤¤ğŸ¤¤</p>\n<h4 id=\"tree-api\">Tree API<a title=\"#tree-api\" href=\"#tree-api\"></a></h4>\n<p>Tree APIå°†classçš„ç»“æ„è¯»å–åˆ°å†…å­˜ï¼Œæ„å»ºä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œç„¶åéœ€è¦å¤„ç†Methodã€Fieldç­‰å…ƒç´ æ—¶ï¼Œåˆ°æ ‘å½¢ç»“æ„ä¸­å®šä½åˆ°æŸä¸ªå…ƒç´ ï¼Œè¿›è¡Œæ“ä½œï¼Œç„¶åæŠŠæ“ä½œå†å†™å…¥æ–°çš„classæ–‡ä»¶ã€‚</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestPlugin</span> : <span class=\"type\">Plugin</span>&lt;<span class=\"type\">Project</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">apply</span><span class=\"params\">(target: <span class=\"type\">Project</span>)</span></span> &#123;</span><br><span class=\"line\">        println(<span class=\"string\">&quot;Test Plugin : target = [<span class=\"subst\">$&#123;target&#125;</span>]&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> appExtension: AppExtension = target.extensions.getByType()</span><br><span class=\"line\">        appExtension.registerTransform(TestTransform())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestTransform</span> : <span class=\"type\">BaseTransform</span></span>()&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">companion</span> <span class=\"keyword\">object</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">var</span> isPrint = <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">var</span> isChange = <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">modifyClass</span><span class=\"params\">(byteArray: <span class=\"type\">ByteArray</span>)</span></span>: ByteArray &#123;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> classReader = ClassReader(byteArray)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> classNode = ClassNode()</span><br><span class=\"line\">        <span class=\"comment\">// é€šè¿‡ä¼ é€’ ClassReader è§£æå¯¹åº” ClassFile ç”Ÿæˆ ClassNode</span></span><br><span class=\"line\">        classReader.accept(classNode, ClassReader.EXPAND_FRAMES)</span><br><span class=\"line\">        <span class=\"comment\">// æ‰“å°æµ‹è¯•</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(isPrint)&#123;</span><br><span class=\"line\">            isPrint = <span class=\"literal\">false</span></span><br><span class=\"line\">            Log.log(classNode.toString())</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (methodNode <span class=\"keyword\">in</span> classNode.methods) &#123;</span><br><span class=\"line\">                Log.log(<span class=\"string\">&quot;<span class=\"subst\">$&#123;classNode.name&#125;</span> ------&gt;&gt;&gt; <span class=\"variable\">$methodNode</span>&quot;</span>)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœæ–‡ä»¶å¯¹classNodeæœ‰ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œéœ€è¦è¿™æ ·å¤„ç†</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(isChange)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">val</span> classWriter = ClassWriter(ClassWriter.COMPUTE_MAXS)</span><br><span class=\"line\">            classNode.accept(classWriter)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> classWriter.toByteArray()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// è¿”å›ä¿®æ”¹å†…å®¹</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> byteArray</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getInputTypes</span><span class=\"params\">()</span></span>: MutableSet&lt;QualifiedContent.ContentType&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> TransformManager.CONTENT_CLASS</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getScopes</span><span class=\"params\">()</span></span>: MutableSet&lt;<span class=\"keyword\">in</span> QualifiedContent.Scope&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mutableSetOf(</span><br><span class=\"line\">            QualifiedContent.Scope.PROJECT</span><br><span class=\"line\">        )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¯ä»¥çœ‹åˆ°ç¼–è¯‘çš„ç±»æ­£è¢«æˆ‘ä»¬æ‰“å°å‡ºæ¥ï¼š<br>\n<img src=\"https://s1.ax1x.com/2022/03/11/bIq3id.png\" alt=\"bIq3id.png\" loading=\"lazy\"></p>\n<h4 id=\"visitor-api\">Visitor API<a title=\"#visitor-api\" href=\"#visitor-api\"></a></h4>\n<p>Visitor APIåˆ™å°†é€šè¿‡æ¥å£çš„æ–¹å¼ï¼Œåˆ†ç¦»è¯»classå’Œå†™classçš„é€»è¾‘ï¼Œä¸€èˆ¬é€šè¿‡ä¸€ä¸ªClassReaderè´Ÿè´£è¯»å–classå­—èŠ‚ç ï¼Œç„¶åClassReaderé€šè¿‡ä¸€ä¸ªClassVisitoræ¥å£ï¼Œå°†å­—èŠ‚ç çš„æ¯ä¸ªç»†èŠ‚æŒ‰é¡ºåºé€šè¿‡æ¥å£çš„æ–¹å¼ï¼Œä¼ é€’ç»™ClassVisitorï¼ˆä½ ä¼šå‘ç°ClassVisitorä¸­æœ‰å¤šä¸ªvisitXXXXæ¥å£ï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±åƒClassReaderå¸¦ç€ClassVisitoræ¸¸è§ˆäº†classå­—èŠ‚ç çš„æ¯ä¸€ä¸ªæŒ‡ä»¤ã€‚</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestPlugin</span> : <span class=\"type\">Plugin</span>&lt;<span class=\"type\">Project</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">apply</span><span class=\"params\">(target: <span class=\"type\">Project</span>)</span></span> &#123;</span><br><span class=\"line\">        println(<span class=\"string\">&quot;Test Plugin : target = [<span class=\"subst\">$&#123;target&#125;</span>]&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> appExtension: AppExtension = target.extensions.getByType()</span><br><span class=\"line\">        appExtension.registerTransform(TestVisitorTransform())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestClassVisitor</span></span>(visitor: ClassVisitor):ClassVisitor(Opcodes.ASM4,visitor)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestVisitorTransform</span> : <span class=\"type\">BaseTransform</span></span>()&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">companion</span> <span class=\"keyword\">object</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">var</span> isPrint = <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">var</span> isChange = <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">modifyClass</span><span class=\"params\">(byteArray: <span class=\"type\">ByteArray</span>)</span></span>: ByteArray &#123;</span><br><span class=\"line\">        <span class=\"comment\">// è§£æclassæ–‡ä»¶</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> classReader = ClassReader(byteArray)</span><br><span class=\"line\">        <span class=\"comment\">// å°†classæ–‡ä»¶å†…å®¹å†™å…¥åˆ°ClassWriterä¸­</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> classWriter = ClassWriter(classReader,ClassWriter.COMPUTE_MAXS)</span><br><span class=\"line\">        <span class=\"comment\">// èµ‹äºˆå¯¹åº”çš„ClassVisitorè¯»å†™èƒ½åŠ›</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> classVisitor = TestClassVisitor(classWriter)</span><br><span class=\"line\">        classReader.accept(classVisitor, ClassReader.EXPAND_FRAMES)</span><br><span class=\"line\">        <span class=\"comment\">// æ‰“å°æµ‹è¯•</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(isPrint)&#123;</span><br><span class=\"line\">            isPrint = <span class=\"literal\">false</span></span><br><span class=\"line\">            Log.log(classVisitor.toString())</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœæ–‡ä»¶å¯¹classNodeæœ‰ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œéœ€è¦è¿™æ ·å¤„ç†</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(isChange)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> classWriter.toByteArray()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// è¿”å›ä¿®æ”¹å†…å®¹</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> byteArray</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getInputTypes</span><span class=\"params\">()</span></span>: MutableSet&lt;QualifiedContent.ContentType&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> TransformManager.CONTENT_CLASS</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getScopes</span><span class=\"params\">()</span></span>: MutableSet&lt;<span class=\"keyword\">in</span> QualifiedContent.Scope&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mutableSetOf(</span><br><span class=\"line\">            QualifiedContent.Scope.PROJECT</span><br><span class=\"line\">        )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>åŒæ ·å¯ä»¥çœ‹åˆ°ç¼–è¯‘çš„ç±»æ­£è¢«æˆ‘ä»¬æ‰“å°å‡ºæ¥ï¼š<br>\n<img src=\"https://s1.ax1x.com/2022/03/11/bIvebV.png\" alt=\"bIvebV.png\" loading=\"lazy\"></p>\n<ul>\n<li>ClassReaderï¼šè´Ÿè´£å¯¹ .class æ–‡ä»¶è¿›è¡Œè¯»å–</li>\n<li>ClassVisitorï¼š è´Ÿè´£è®¿é—® .class æ–‡ä»¶ä¸­å„ä¸ªå…ƒç´ </li>\n<li>ClassWriterï¼š è´Ÿè´£å¯¹ .class æ–‡ä»¶è¿›è¡Œå†™å…¥ï¼Œå°†å­—èŠ‚ç è¾“å‡ºä¸º byte æ•°ç»„ã€‚</li>\n</ul>\n<h3 id=\"å­—èŠ‚ç äº†è§£\">å­—èŠ‚ç äº†è§£<a title=\"#å­—èŠ‚ç äº†è§£\" href=\"#å­—èŠ‚ç äº†è§£\"></a></h3>\n<p><a href=\"https://plugins.jetbrains.com/plugin/14860-asm-bytecode-viewer-support-kotlin\" target=\"_blank\">Android Studio è¾…åŠ©ç±»è½¬å­—èŠ‚ç æ’ä»¶ï¼šASM Bytecode Viewer Support Kotlin</a><br>\n<img src=\"https://pic1.zhimg.com/v2-fdd5caeb51dbfb819539611fa9ccbcd4_r.jpg\" alt=\"preview\" loading=\"lazy\"></p>\n<p><a href=\"https://juejin.cn/post/6944517233674551304#heading-5\" target=\"_blank\">å­—èŠ‚ç ç»“æ„åˆ†æ - æ˜é‡‘ (juejin.cn)</a><br>\n<a href=\"https://www.jianshu.com/p/92a75a18cbc1\" target=\"_blank\">Java ByteCode - ç®€ä¹¦ (jianshu.com)</a><br>\n<a href=\"https://zhuanlan.zhihu.com/p/94498015\" target=\"_blank\">å²ä¸Šæœ€é€šä¿—æ˜“æ‡‚çš„ASMæ•™ç¨‹ - çŸ¥ä¹ (zhihu.com)</a></p>\n<h3 id=\"è‡ªå®šä¹‰gradleæ’ä»¶\">è‡ªå®šä¹‰gradleæ’ä»¶<a title=\"#è‡ªå®šä¹‰gradleæ’ä»¶\" href=\"#è‡ªå®šä¹‰gradleæ’ä»¶\"></a></h3>\n<blockquote>\n<p>Transformå’ŒAsmçš„ç»“åˆä½¿ç”¨éœ€è¦ç”¨åˆ°Gradleæ’ä»¶</p>\n</blockquote>\n<p>è‡ªå®šä¹‰æ’ä»¶æ–¹å¼ï¼šè¯¦çœ‹<a href=\"https://docs.gradle.org/current/userguide/custom_plugins.html#example_a_build_for_a_custom_plugin\" target=\"_blank\">Developing Custom Gradle Plugins</a></p>\n<ul>\n<li>Build script</li>\n<li><code>buildSrc</code> é¡¹ç›®</li>\n<li>ç‹¬ç«‹é¡¹ç›®ï¼ˆStandalone projectï¼‰</li>\n</ul>\n<h4 id=\"build-script\">Build script<a title=\"#build-script\" href=\"#build-script\"></a></h4>\n<blockquote>\n<p>ç›´æ¥åœ¨é¡¹ç›®çš„build.gradleä¸­æ·»åŠ groovyè„šæœ¬ä»£ç å¹¶å¼•ç”¨ã€‚è¿™æ ·æ’ä»¶åœ¨æ„å»ºè„šæœ¬ä¹‹å¤–ä¸å¯è§ï¼Œåªèƒ½åœ¨æ­¤æ¨¡å—ä¸­ä½¿ç”¨è„šæœ¬æ’ä»¶ã€‚</p>\n</blockquote>\n<ol>\n<li>ç®€å•ç¼–å†™è„šæœ¬<br>\nbuild.gradle:</li>\n</ol>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">GreetingPlugin</span> <span class=\"keyword\">implements</span> <span class=\"title\">Plugin</span>&lt;<span class=\"title\">Project</span>&gt; &#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> apply(Project project) &#123;</span><br><span class=\"line\">        project.task(<span class=\"string\">&#x27;hello&#x27;</span>) &#123;</span><br><span class=\"line\">            doLast &#123;</span><br><span class=\"line\">                println <span class=\"string\">&#x27;Hello from the GreetingPlugin&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Apply the plugin</span></span><br><span class=\"line\">apply <span class=\"attr\">plugin:</span> GreetingPlugin</span><br></pre></td></tr></table></figure>\n<p>è·Ÿä¸Šé¢ä¸€æ ·ï¼Œåªä¸è¿‡é‡‡ç”¨æ–°ç‰ˆktsé£æ ¼<br>\nbuild.gradle.kts</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">GreetingPlugin</span> : <span class=\"type\">Plugin</span>&lt;<span class=\"type\">Project</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">apply</span><span class=\"params\">(project: <span class=\"type\">Project</span>)</span></span> &#123;</span><br><span class=\"line\">        project.task(<span class=\"string\">&quot;hello&quot;</span>) &#123;</span><br><span class=\"line\">            doLast &#123;</span><br><span class=\"line\">                println(<span class=\"string\">&quot;Hello from the GreetingPlugin&quot;</span>)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Apply the plugin</span></span><br><span class=\"line\">apply&lt;GreetingPlugin&gt;()</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>è¿è¡Œ</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; gradle -q hello</span><br><span class=\"line\">Hello from the GreetingPlugin</span><br></pre></td></tr></table></figure>\n<h4 id=\"buildsrc-é¡¹ç›®\">buildSrc é¡¹ç›®<a title=\"#buildsrc-é¡¹ç›®\" href=\"#buildsrc-é¡¹ç›®\"></a></h4>\n<blockquote>\n<p>å°†æ’ä»¶çš„æºä»£ç æ”¾åœ¨rootProjectDir/buildSrc/src/main/groovyç›®å½•ä¸­ï¼ŒGradleå°†è´Ÿè´£ç¼–è¯‘å’Œæµ‹è¯•æ’ä»¶ï¼Œå¹¶ä½¿å…¶åœ¨æ„å»ºè„šæœ¬çš„ç±»è·¯å¾„ä¸­å¯ç”¨ã€‚è¯¥æ’ä»¶æ¯ä¸ªæ„å»ºè„šæœ¬éƒ½æ˜¯å¯è§çš„ã€‚ä½†æ˜¯å®ƒåœ¨æ„å»ºå¤–éƒ¨ä¸å¯è§å³åœ¨å½“å‰å·¥ç¨‹çš„å„ä¸ªæ¨¡å—éƒ½å¯è§ï¼Œä½†æ˜¯é¡¹ç›®ä¹‹å¤–ä¸å¯è§</p>\n</blockquote>\n<p>buildSrcæ˜¯androidä¸­ä¸€ä¸ªä¿ç•™åï¼Œæ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥åšgradleæ’ä»¶çš„moduleï¼Œæ‰€ä»¥è¿™ä¸ªmoduleçš„åå­—å¿…é¡»æ˜¯buildSrcï¼Œæ­¤æ¨¡å—ä¸‹é¢æœ‰ä¸€ä¸ªå›ºå®šçš„ç›®å½•ç»“æ„src/main/groovyï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥å­˜æ”¾çœŸæ­£çš„è„šæœ¬æ–‡ä»¶çš„ã€‚å…¶ä»–çš„è‡ªå®šä¹‰ç±»å¯ä»¥æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨è‡ªå»ºçš„å…¶ä»–ç›®å½•ä¸‹ã€‚</p>\n<ol>\n<li>åˆ›å»º<code>buildSrc</code>Module,å¯ä»¥ç›´æ¥åˆ›å»ºç›®å½•\n<ul>\n<li>åœ¨å·¥ç¨‹æ ¹ç›®å½•ä¸‹åˆ›å»ºç›®å½•<code>buildSrc</code></li>\n<li>åœ¨buildSrcä¸‹åˆ›å»ºç›®å½•ç»“æ„ <code>src/main/groovy</code>æˆ–è€…<code>src/main/java</code></li>\n<li>åœ¨buildSrcæ ¹ç›®å½•ä¸‹åˆ›å»º<code> build.gradle</code>æˆ–è€…<code> build.gradle.kts</code></li>\n</ul>\n</li>\n</ol>\n<p>build.gradle.kts:</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.jetbrains.kotlin.gradle.tasks.KotlinCompile</span><br><span class=\"line\"></span><br><span class=\"line\">plugins &#123;</span><br><span class=\"line\">    `kotlin-dsl`</span><br><span class=\"line\">    kotlin(<span class=\"string\">&quot;jvm&quot;</span>) version <span class=\"string\">&quot;1.4.32&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">val</span> compileKotlin: KotlinCompile <span class=\"keyword\">by</span> tasks</span><br><span class=\"line\"><span class=\"keyword\">val</span> compileTestKotlin: KotlinCompile <span class=\"keyword\">by</span> tasks</span><br><span class=\"line\">compileKotlin.kotlinOptions &#123;</span><br><span class=\"line\">    jvmTarget = <span class=\"string\">&quot;1.8&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">compileTestKotlin.kotlinOptions &#123;</span><br><span class=\"line\">    jvmTarget = <span class=\"string\">&quot;1.8&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">repositories &#123;</span><br><span class=\"line\">    google()</span><br><span class=\"line\">    mavenCentral()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">dependencies &#123;</span><br><span class=\"line\">    implementation(<span class=\"string\">&quot;com.android.tools.build:gradle:4.1.1&quot;</span>)</span><br><span class=\"line\">    compileOnly(<span class=\"string\">&quot;commons-io:commons-io:2.6&quot;</span>)</span><br><span class=\"line\">    compileOnly(<span class=\"string\">&quot;commons-codec:commons-codec:1.15&quot;</span>)</span><br><span class=\"line\">    compileOnly(<span class=\"string\">&quot;org.ow2.asm:asm-commons:9.2&quot;</span>)</span><br><span class=\"line\">    compileOnly(<span class=\"string\">&quot;org.ow2.asm:asm-tree:9.2&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>build.gradle</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply <span class=\"attr\">plugin:</span> <span class=\"string\">&#x27;groovy&#x27;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">dependencies &#123;</span><br><span class=\"line\">    <span class=\"comment\">// gradleæ’ä»¶å¿…é¡»çš„å¼•ç”¨</span></span><br><span class=\"line\">    implementation gradleApi()</span><br><span class=\"line\">    implementation localGroovy()</span><br><span class=\"line\">    </span><br><span class=\"line\">    implementation <span class=\"string\">&#x27;com.android.tools.build:gradle:4.1.1&#x27;</span></span><br><span class=\"line\">    <span class=\"comment\">// asmä¾èµ–</span></span><br><span class=\"line\">    implementation <span class=\"string\">&#x27;org.ow2.asm:asm:9.2&#x27;</span></span><br><span class=\"line\">    implementation <span class=\"string\">&#x27;org.ow2.asm:asm-util:9.2&#x27;</span></span><br><span class=\"line\">    implementation <span class=\"string\">&#x27;org.ow2.asm:asm-commons:9.2&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">repositories &#123;</span><br><span class=\"line\">    mavenCentral()</span><br><span class=\"line\">    jcenter()</span><br><span class=\"line\">    google()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">// æŒ‡å®šç¼–è¯‘çš„ç¼–ç  ä¸ç„¶æœ‰ä¸­æ–‡çš„è¯ä¼šå‡ºç°  â€™ç¼–ç GBKçš„ä¸å¯æ˜ å°„å­—ç¬¦â€˜</span></span><br><span class=\"line\">tasks.withType(JavaCompile) &#123;</span><br><span class=\"line\">    options.encoding = <span class=\"string\">&quot;UTF-8&quot;</span></span><br><span class=\"line\">    println(<span class=\"string\">&#x27;ä½¿ç”¨utf8ç¼–è¯‘&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>åˆ›å»ºæ’ä»¶å…¥å£TestPlugin</li>\n</ol>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.onion.plugin.plugin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestPlugin</span>: <span class=\"type\">Plugin</span>&lt;<span class=\"type\">Project</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">apply</span><span class=\"params\">(target: <span class=\"type\">Project</span>)</span></span> &#123;</span><br><span class=\"line\">        println(<span class=\"string\">&quot;Test Plugin : target = [<span class=\"subst\">$&#123;target&#125;</span>]&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>åœ¨App Module ä¸­å¼•å…¥,ç„¶åProject Build</li>\n</ol>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.onion.plugin.plugin.TestPlugin</span><br><span class=\"line\">apply <span class=\"attr\">plugin:</span> TestPlugin <span class=\"comment\">// æ’æ¡©æµ‹è¯•</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"æ’ä»¶å‘å¸ƒé¢å¤–å­¦ä¹ \">æ’ä»¶å‘å¸ƒé¢å¤–å­¦ä¹ <a title=\"#æ’ä»¶å‘å¸ƒé¢å¤–å­¦ä¹ \" href=\"#æ’ä»¶å‘å¸ƒé¢å¤–å­¦ä¹ \"></a></h4>\n<ul>\n<li><a href=\"https://juejin.cn/post/6887581345384497165\" title=\"https://juejin.cn/post/6887581345384497165\" target=\"_blank\">Android Gradle æ’ä»¶å¼€å‘å…¥é—¨æŒ‡å—ï¼ˆä¸€ï¼‰</a>ï¼Œè®²è§£Gradle Pluginå¼€å‘çš„å®Œæ•´æµç¨‹</li>\n<li><a href=\"https://juejin.cn/post/6887583351348133895\" title=\"https://juejin.cn/post/6887583351348133895\" target=\"_blank\">Android Gradle æ’ä»¶å¼€å‘å…¥é—¨æŒ‡å—ï¼ˆäºŒï¼‰</a>ï¼Œé’ˆå¯¹Androidçš„Gradle Pluginå¼€å‘å®è·µ</li>\n<li><a href=\"https://juejin.cn/post/6890544619856068616\" title=\"https://juejin.cn/post/6890544619856068616\" target=\"_blank\">Android Gradle æ’ä»¶å¼€å‘å…¥é—¨æŒ‡å—ï¼ˆä¸‰ï¼‰</a>ï¼Œå¦‚ä½•å°†æ’ä»¶å‘å¸ƒåˆ°jcenter</li>\n</ul>\n<h3 id=\"refer\">Refer<a title=\"#refer\" href=\"#refer\"></a></h3>\n<p><a href=\"http://quinnchen.cn/2018/09/13/2018-09-13-asm-transform/\" target=\"_blank\">ä¸€èµ·ç©è½¬Androidé¡¹ç›®ä¸­çš„å­—èŠ‚ç  | Quinn Note (quinnchen.cn)</a><br>\n<a href=\"https://www.jianshu.com/p/92a75a18cbc1\" target=\"_blank\">Java ByteCode</a><br>\n<a href=\"https://blog.csdn.net/qq_23992393/article/details/103696976\" target=\"_blank\">ASM + Transform åœ¨androidä¸­çš„ä½¿ç”¨</a><br>\n<a href=\"https://www.jianshu.com/p/a1e6b3abd789\" target=\"_blank\">ASM</a><br>\n<a href=\"https://juejin.cn/post/6893917892061413389#heading-3\" target=\"_blank\">ç™½è¯ Android AOP (ä¸€) </a><br>\n<a href=\"https://mp.weixin.qq.com/s/YFi6-DrV22X_VVfFbKHNEg\" target=\"_blank\">Android gradle Transform åˆ†æ</a></p>\n",
            "tags": [
                "AOP"
            ]
        },
        {
            "id": "https://onion99.github.io/2022/03/11/3Bhw0wOwpYCE6F8V/",
            "url": "https://onion99.github.io/2022/03/11/3Bhw0wOwpYCE6F8V/",
            "title": "Android AOP - AspectJ",
            "date_published": "2022-03-11T09:40:38.000Z",
            "content_html": "<blockquote>\n<p>AspectJé€šè¿‡æ³¨è§£çš„å½¢å¼æ¥æ ‡æ³¨åˆ‡å…¥ç‚¹ã€åˆ‡å…¥å¯¹è±¡ç­‰ï¼Œç„¶ååœ¨ä»£ç ç¼–è¯‘æœŸé—´å°†ä»£ç ç»‡å…¥åˆ°javaçš„å­—èŠ‚ç ä¸­</p>\n</blockquote>\n<span id=\"more\"></span>\n<p>Androidå¼€æºæ–¹æ¡ˆï¼š<a href=\"https://github.com/HujiangTechnology/gradle_plugin_android_aspectjx\" target=\"_blank\">AspectJX</a></p>\n<h3 id=\"å¼•å…¥ä¾èµ–\">å¼•å…¥ä¾èµ–<a title=\"#å¼•å…¥ä¾èµ–\" href=\"#å¼•å…¥ä¾èµ–\"></a></h3>\n<p>gradleå¼•å…¥ï¼š</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">buildscript &#123;</span><br><span class=\"line\">    dependencies &#123;</span><br><span class=\"line\">        classpath <span class=\"string\">&#x27;com.hujiang.aspectjx:gradle-android-plugin-aspectjx:2.0.4&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>åº”ç”¨pluginï¼š</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply <span class=\"attr\">plugin:</span> <span class=\"string\">&#x27;android-aspectjx&#x27;</span></span><br></pre></td></tr></table></figure>\n<p>AspectJXé…ç½®ï¼š</p>\n<p>AspectJXé»˜è®¤ä¼šå¤„ç†æ‰€æœ‰çš„äºŒè¿›åˆ¶ä»£ç æ–‡ä»¶å’Œåº“ï¼Œä¸ºäº†æå‡ç¼–è¯‘æ•ˆç‡åŠè§„é¿éƒ¨åˆ†ç¬¬ä¸‰æ–¹åº“å‡ºç°çš„ç¼–è¯‘å…¼å®¹æ€§é—®é¢˜ï¼ŒAspectJXæä¾›<code>include</code>,<code>exclude</code>å‘½ä»¤æ¥è¿‡æ»¤éœ€è¦å¤„ç†çš„æ–‡ä»¶åŠæ’é™¤æŸäº›æ–‡ä»¶(åŒ…æ‹¬classæ–‡ä»¶åŠjaræ–‡ä»¶)ã€‚</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">aspectjx &#123;</span><br><span class=\"line\">    <span class=\"comment\">//æ’é™¤æ‰€æœ‰packageè·¯å¾„ä¸­åŒ…å«`android.support`çš„classæ–‡ä»¶åŠåº“ï¼ˆjaræ–‡ä»¶ï¼‰</span></span><br><span class=\"line\">\texclude <span class=\"string\">&#x27;android.support&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¼€å…³é…ç½®ï¼š</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">aspectjx &#123;</span><br><span class=\"line\">    <span class=\"comment\">//å…³é—­AspectJXåŠŸèƒ½</span></span><br><span class=\"line\">\tenabled <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç®€å•ä½¿ç”¨\">ç®€å•ä½¿ç”¨<a title=\"#ç®€å•ä½¿ç”¨\" href=\"#ç®€å•ä½¿ç”¨\"></a></h3>\n<ol>\n<li>å‡†å¤‡åˆ‡å…¥çš„ç±»</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Animal</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">fly</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        Log.e(TAG, <span class=\"string\">&quot;animal fly method:&quot;</span> + <span class=\"keyword\">this</span>.toString() + <span class=\"string\">&quot;#fly&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>ç¼–å†™å¯¹åº”çš„åˆ‡é¢ç±»ï¼Œç”¨@Aspectæ³¨è§£</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Aspect</span>  <span class=\"comment\">//â‘ </span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MethodAspect</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// æ ‡æ³¨åˆ‡å…¥çš„æ–¹æ³•ï¼Œçœ‹åˆ°æ²¡æœ‰è¿™é‡Œç”¨çš„Poincutçš„ call</span></span><br><span class=\"line\">    <span class=\"meta\">@Pointcut(&quot;call(* com.wandering.sample.aspectj.Animal.fly(..))&quot;)</span><span class=\"comment\">//â‘¡</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">callMethod</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// æ ‡æ³¨å‡½æ•°æ‰§è¡Œå‰å¤„ç†</span></span><br><span class=\"line\">    <span class=\"meta\">@Before(&quot;callMethod()&quot;)</span><span class=\"comment\">//â‘¢</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">beforeMethodCall</span><span class=\"params\">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class=\"line\">        Log.e(TAG, <span class=\"string\">&quot;before-&gt;&quot;</span> + joinPoint.getTarget().toString()); <span class=\"comment\">//â‘£</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>ç¼–è¯‘åå°±å¯ä»¥çœ‹åˆ°ç±»çš„æ–¹æ³•åœ¨æ‰§è¡Œå‰æœ‰ä»£ç æ’å…¥äº†<br>\n<img src=\"https://s1.ax1x.com/2022/03/10/bhAMh8.png\" alt=\"bhAMh8.png\" loading=\"lazy\"></li>\n</ol>\n<h3 id=\"è¯­æ³•\">è¯­æ³•<a title=\"#è¯­æ³•\" href=\"#è¯­æ³•\"></a></h3>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th style=\"text-align:left\">JPoint</th>\n<th style=\"text-align:left\">è¯´æ˜</th>\n<th style=\"text-align:left\">Pointcutè¯­æ³•</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">method call</td>\n<td style=\"text-align:left\">å‡½æ•°è°ƒç”¨</td>\n<td style=\"text-align:left\">call(MethodSignature)</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">method execution</td>\n<td style=\"text-align:left\">å‡½æ•°å†…éƒ¨æ‰§è¡Œ</td>\n<td style=\"text-align:left\">execution(MethodSignatureï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">method execution</td>\n<td style=\"text-align:left\">æ„é€ å‡½æ•°è°ƒç”¨</td>\n<td style=\"text-align:left\">call(ConstructorSignatureï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">constructor execution</td>\n<td style=\"text-align:left\">æ„é€ å‡½æ•°å†…éƒ¨æ‰§è¡Œ</td>\n<td style=\"text-align:left\">execution(ConstructorSignatureï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">field get</td>\n<td style=\"text-align:left\">è¯»å˜é‡</td>\n<td style=\"text-align:left\">get(FieldSignatureï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">field set</td>\n<td style=\"text-align:left\">å†™å˜é‡</td>\n<td style=\"text-align:left\">set(FieldSignatureï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">static initialization</td>\n<td style=\"text-align:left\">é™æ€ä»£ç å—åˆå§‹åŒ–</td>\n<td style=\"text-align:left\">staticinitialization(TypeSignatureï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">handler</td>\n<td style=\"text-align:left\">å¼‚å¸¸å¤„ç†</td>\n<td style=\"text-align:left\">handler(TypeSignature),åªèƒ½ä¸@Before()é…ç½®ä½¿ç”¨</td>\n</tr>\n</tbody>\n</table></div></div><br/>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th style=\"text-align:left\">Advice</th>\n<th style=\"text-align:left\">è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">@Before(Pointcut)</td>\n<td style=\"text-align:left\">æ‰§è¡ŒJpointä¹‹å‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">@After(Pointcut)</td>\n<td style=\"text-align:left\">æ‰§è¡ŒJpointä¹‹å</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">@Around(Pointcut)</td>\n<td style=\"text-align:left\">æ›¿æ¢åŸç†çš„ä»£ç </td>\n</tr>\n</tbody>\n</table></div></div><p>å®Œæ•´è¯­æ³•çœ‹è¿™<a href=\"https://github.com/hyvenzhu/Android-Demos/blob/master/AspectJDemo/AspectJ.pdf\" target=\"_blank\">AspectJ</a></p>\n<h3 id=\"æ³¨æ„ç‚¹\">æ³¨æ„ç‚¹<a title=\"#æ³¨æ„ç‚¹\" href=\"#æ³¨æ„ç‚¹\"></a></h3>\n<p>æ ‡æ³¨<code>call</code>å’Œ<code>execution</code>æ‰§è¡Œçš„æ—¶å€™ï¼ŒThiså’ŒTargetä¸åŒçš„</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Aspect</span> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MethodAspect</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Pointcut(&quot;call(* com.wandering.sample.aspectj.Animal.fly(..))&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">callMethod</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        Log.e(TAG, <span class=\"string\">&quot;callMethod-&gt;&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Before(&quot;callMethod()&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">beforeMethodCall</span><span class=\"params\">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class=\"line\">        Log.e(TAG, <span class=\"string\">&quot;getTarget-&gt;&quot;</span> + joinPoint.getTarget());</span><br><span class=\"line\">        Log.e(TAG, <span class=\"string\">&quot;getThis-&gt;&quot;</span> + joinPoint.getThis());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>åˆ‡å…¥æ–¹ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected void onCreate(@Nullable Bundle savedInstanceState) &#123;</span><br><span class=\"line\">    super.onCreate(savedInstanceState);</span><br><span class=\"line\">    Animal animal = new Animal();</span><br><span class=\"line\">    animal.fly();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getTarget-&gt;com.wandering.sample.aspectj.Animal@<span class=\"number\">509</span>ddfd</span><br><span class=\"line\">getThis-&gt;com.wandering.sample.aspectj.MainActivity@<span class=\"number\">98</span>c38bf</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>è¯´æ˜targetæŒ‡ä»£çš„æ˜¯åˆ‡å…¥ç‚¹æ–¹æ³•çš„æ‰€æœ‰è€…ï¼Œè€ŒthisæŒ‡ä»£çš„æ˜¯è¢«ç»‡å…¥ä»£ç æ‰€å±ç±»çš„å®ä¾‹å¯¹è±¡ã€‚</p>\n</blockquote>\n<p>å°†åˆ‡ç‚¹çš„<code>call</code>æ”¹ä¸º<code>execution</code>ï¼š</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getTarget-&gt;com.wandering.sample.aspectj.Animal@<span class=\"number\">509</span>ddfd</span><br><span class=\"line\">getThis-&gt;com.wandering.sample.aspectj.Animal@<span class=\"number\">509</span>ddfd</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç¼ºç‚¹\">ç¼ºç‚¹<a title=\"#ç¼ºç‚¹\" href=\"#ç¼ºç‚¹\"></a></h3>\n<ul>\n<li>å¦‚æœç›¸åº”çš„classæ²¡æœ‰å®ç°ç›¸åº”çš„å¯¹ç‚¹æ–¹æ³•å°†æ— æ³•ç»‡å…¥ï¼Œå¦‚Activityæ²¡æœ‰å®ç°onResumeæ–¹æ³•çš„è¯ï¼Œå°†æ— æ³•ç»‡å…¥ä»£ç ã€‚</li>\n<li>æ— æ³•å¤„ç†Lambdaè¯­æ³•</li>\n<li>ä¼šæœ‰ä¸€ç³»åˆ—å…¼å®¹æ€§é—®é¢˜ï¼Œå¦‚R8ã€gradleç‰ˆæœ¬ä¸åŒç­‰</li>\n<li>æ€§èƒ½è¾ƒå·®ï¼ŒAPPé¡¹ç›®æ¯”è¾ƒå¤§æ—¶ç¼–è¯‘æ—¶é—´æ˜æ˜¾åŠ é•¿</li>\n</ul>\n<h3 id=\"refer\">Refer<a title=\"#refer\" href=\"#refer\"></a></h3>\n<p><a href=\"https://github.com/hyvenzhu/Android-Demos/blob/master/AspectJDemo/AspectJ.pdf\" target=\"_blank\">Android-Demos/AspectJ.pdf</a><br>\n<a href=\"https://juejin.cn/post/6888548726424469511\" target=\"_blank\">Android AOPæ–¹æ¡ˆ(ä¸€)â€”â€”AspectJ</a><br>\n<a href=\"https://www.jianshu.com/p/28aa352af7fb\" target=\"_blank\">Android AOP - ç®€ä¹¦</a><br>\n<a href=\"https://www.jianshu.com/p/d07c996ea13c\" target=\"_blank\">Android AspectJ</a></p>\n",
            "tags": [
                "AOP"
            ]
        },
        {
            "id": "https://onion99.github.io/2022/03/11/qyGiQE7cKbQOfEKm/",
            "url": "https://onion99.github.io/2022/03/11/qyGiQE7cKbQOfEKm/",
            "title": "Android AOP - JDKåŠ¨æ€ä»£ç†",
            "date_published": "2022-03-10T21:25:00.000Z",
            "content_html": "<p>JDKçš„åŠ¨æ€ä»£ç†åº•å±‚æ˜¯é€šè¿‡Javaåå°„æœºåˆ¶å®ç°çš„ï¼Œå¹¶ä¸”éœ€è¦ç›®æ ‡å¯¹è±¡ç»§æ‰¿è‡ªä¸€ä¸ªæ¥å£æ‰èƒ½ç”Ÿæˆå®ƒçš„ä»£ç†ç±»</p>\n<span id=\"more\"></span>\n<h4 id=\"javaåŠ¨æ€ä»£ç†\">JavaåŠ¨æ€ä»£ç†<a title=\"#javaåŠ¨æ€ä»£ç†\" href=\"#javaåŠ¨æ€ä»£ç†\"></a></h4>\n<blockquote>\n<p>JDK è¿è¡ŒæœŸé—´ï¼ŒåŠ¨æ€åˆ›å»º class å­—èŠ‚ç å¹¶åŠ è½½åˆ° JVM</p>\n</blockquote>\n<ol>\n<li>JDKçš„åŠ¨æ€ä»£ç†éœ€è¦å®ç°ä¸€ä¸ªå¤„ç†æ–¹æ³•è°ƒç”¨çš„Handlerï¼Œç”¨äºå®ç°ä»£ç†æ–¹æ³•çš„å†…éƒ¨é€»è¾‘ï¼Œå®ç°InvocationHandleræ¥å£</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JdkProxyHandler</span> <span class=\"keyword\">implements</span> <span class=\"title\">InvocationHandler</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Object target;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">JdkProxyHandler</span><span class=\"params\">(Object target)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.target = target;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// proxyï¼šç”Ÿæˆçš„ä»£ç†å¯¹è±¡, objï¼šç›®æ ‡æ–¹æ³•, argsï¼šç›®æ ‡æ–¹æ³•å‚æ•°</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">invoke</span><span class=\"params\">(Object proxy, Method method, Object[] args)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;å¤„ç†å‰&quot;</span>);</span><br><span class=\"line\">        Object result = method.invoke(target,args);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;å¤„ç†å&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>ä»£ç†</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//2-1</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ISender</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">send</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//2-2</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SmsSender</span> <span class=\"keyword\">implements</span> <span class=\"title\">ISender</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">send</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;sending msg&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//2-3</span></span><br><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testJdkProxy</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    ISender sender = (ISender) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> Class[]&#123;ISender.class&#125;,</span><br><span class=\"line\">            <span class=\"keyword\">new</span> JdkProxyHandler(<span class=\"keyword\">new</span> SmsSender()));</span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> result = sender.send();</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;ä»£ç†å¯¹è±¡ï¼š&quot;</span> + sender.getClass().getName());</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;è¾“å‡ºç»“æœï¼š&quot;</span> + result);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>é€š è¿‡ JDK çš„ java.lang.reflect.Proxy ç±»å®ç°åŠ¨æ€ä»£ç† ï¼Œ ä¼šä½¿ç”¨å…¶é™æ€æ–¹æ³•newProxyInstance()ï¼Œä¾æ®ç›®æ ‡å¯¹è±¡ã€ä¸šåŠ¡æ¥å£åŠè°ƒç”¨å¤„ç†å™¨ä¸‰è€…ï¼Œè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡ã€‚</p>\n<p><code>public static newProxyInstance ( ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler handler)</code></p>\n<ul>\n<li>loaderï¼šç›®æ ‡ç±»çš„ç±»åŠ è½½å™¨ï¼Œé€šè¿‡ç›®æ ‡å¯¹è±¡çš„åå°„å¯è·å–</li>\n<li>interfacesï¼šç›®æ ‡ç±»å®ç°çš„æ¥å£æ•°ç»„ï¼Œé€šè¿‡ç›®æ ‡å¯¹è±¡çš„åå°„å¯è·å–</li>\n<li>handlerï¼šè°ƒç”¨å¤„ç†å™¨ã€‚</li>\n</ul>\n<h5 id=\"åŸç†\">åŸç†<a title=\"#åŸç†\" href=\"#åŸç†\"></a></h5>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Object <span class=\"title\">newProxyInstance</span><span class=\"params\">(ClassLoader loader,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                                          Class&lt;?&gt;[] interfaces,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                                          InvocationHandler h)</span> <span class=\"keyword\">throws</span> IllegalArgumentException </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//1.æ£€æŸ¥</span></span><br><span class=\"line\">    Objects.requireNonNull(h);</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Class&lt;?&gt;[] intfs = interfaces.clone();</span><br><span class=\"line\">    <span class=\"keyword\">final</span> SecurityManager sm = System.getSecurityManager();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (sm != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        checkProxyAccess(Reflection.getCallerClass(), loader, intfs);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//æŸ¥æ‰¾æˆ–ç”ŸæˆæŒ‡å®šçš„ä»£ç†ç±»</span></span><br><span class=\"line\">    Class&lt;?&gt; cl = getProxyClass0(loader, intfs);</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (sm != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            checkNewProxyPermission(Reflection.getCallerClass(), cl);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//é€šè¿‡åå°„åˆ›å»ºä»£ç†å¯¹è±¡</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams);</span><br><span class=\"line\">        <span class=\"keyword\">final</span> InvocationHandler ih = h;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!Modifier.isPublic(cl.getModifiers())) &#123;</span><br><span class=\"line\">            AccessController.doPrivileged(<span class=\"keyword\">new</span> PrivilegedAction&lt;Void&gt;() &#123;</span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> Void <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                    cons.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> cons.newInstance(<span class=\"keyword\">new</span> Object[]&#123;h&#125;);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (IllegalAccessException|InstantiationException e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> InternalError(e.toString(), e);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (InvocationTargetException e) &#123;</span><br><span class=\"line\">        Throwable t = e.getCause();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t <span class=\"keyword\">instanceof</span> RuntimeException) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> (RuntimeException) t;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> InternalError(t.toString(), t);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (NoSuchMethodException e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> InternalError(e.toString(), e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å±€é™æ€§\">å±€é™æ€§<a title=\"#å±€é™æ€§\" href=\"#å±€é™æ€§\"></a></h3>\n<p>åªèƒ½ä»£ç†æ¥å£ï¼Œå¹¶ä¸”åªèƒ½ä¿®æ”¹æ¥å£å£°æ˜çš„æ–¹æ³•</p>\n<h3 id=\"refer\">Refer<a title=\"#refer\" href=\"#refer\"></a></h3>\n<p><a href=\"https://www.jb51.net/article/209607.htm\" target=\"_blank\">JavaåŠ¨æ€ä»£ç†å››ç§å®ç°æ–¹å¼è¯¦è§£</a><br>\n<a href=\"https://www.cnblogs.com/wkfvawl/p/15030814.html\" target=\"_blank\">Java åŠ¨æ€ä»£ç† - ç‹é™¸</a></p>\n",
            "tags": [
                "AOP"
            ]
        },
        {
            "id": "https://onion99.github.io/2022/03/10/9rnRdFk7xf4rnvds/",
            "url": "https://onion99.github.io/2022/03/10/9rnRdFk7xf4rnvds/",
            "title": "Android AOP - æ¦‚è®º",
            "date_published": "2022-03-10T09:26:27.000Z",
            "content_html": "<h3 id=\"ç¼–ç¨‹æ¶æ„æ€æƒ³\">ç¼–ç¨‹æ¶æ„æ€æƒ³<a title=\"#ç¼–ç¨‹æ¶æ„æ€æƒ³\" href=\"#ç¼–ç¨‹æ¶æ„æ€æƒ³\"></a></h3>\n<ul>\n<li>\n<p>é¢å‘å¯¹è±¡(Object Oriented Programming)</p>\n</li>\n<li>\n<p>é¢å‘è¿‡ç¨‹(Procedure Oriented Programming)</p>\n</li>\n<li>\n<p>é¢å‘åˆ‡é¢(Aspect Oriented Programming)</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<p>AOP æ„ä¸ºé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œé€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸåŠ¨æ€ä»£ç†å®ç°ç¨‹åºåŠŸèƒ½ç»Ÿä¸€ç»´æŠ¤çš„ä¸€ç§æŠ€æœ¯ï¼Œå’Œ OOP ä»¥å¯¹è±¡ä¸ºæ ¸å¿ƒä¸åŒï¼ŒAOPæ˜¯é’ˆå¯¹ä¸šåŠ¡å¤„ç†è¿‡ç¨‹ä¸­çš„ç±»ä¼¼çš„ä»£ç é€»è¾‘è¿›è¡Œåˆ‡å…¥ï¼Œç„¶åç»Ÿä¸€å¤„ç†ã€‚</p>\n<p>AOPå…¶å®æ˜¯OOPçš„è¡¥å……ï¼ŒOOPä»æ¨ªå‘ä¸ŠåŒºåˆ†å‡ºä¸€ä¸ªä¸ªçš„ç±»æ¥ï¼Œè€ŒAOPåˆ™ä»çºµå‘ä¸Šå‘å¯¹è±¡ä¸­åŠ å…¥ç‰¹å®šçš„ä»£ç ã€‚</p>\n<p><img src=\"https://s1.ax1x.com/2022/03/10/bfRiDK.png\" alt=\"bfRiDK.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h3 id=\"å¸¸è§æ¦‚å¿µ\">å¸¸è§æ¦‚å¿µ<a title=\"#å¸¸è§æ¦‚å¿µ\" href=\"#å¸¸è§æ¦‚å¿µ\"></a></h3>\n<ul>\n<li>è¿æ¥ç‚¹(<em>Joinpoint</em>)\n<ul>\n<li>ç¨‹åºä¸­å¯èƒ½ä½œä¸ºä»£ç æ³¨å…¥ç›®æ ‡çš„ç‰¹å®šçš„ç‚¹ï¼Œä¾‹å¦‚ä¸€ä¸ªæ–¹æ³•è°ƒç”¨æˆ–è€…æ–¹æ³•å…¥å£ã€‚</li>\n</ul>\n</li>\n<li>åˆ‡ç‚¹ï¼ˆ<em>Pointcut</em>ï¼‰\n<ul>\n<li>å‘Šè¯‰ä»£ç æ³¨å…¥å·¥å…·ï¼Œåœ¨ä»»ä½•æ³¨å…¥ä¸€æ®µç‰¹å®šä»£ç çš„è¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨å“ªäº›joint pointsåº”ç”¨ä¸€ä¸ªç‰¹å®šçš„Adviceã€‚</li>\n<li>åˆ‡å…¥ç‚¹å¯ä»¥é€‰æ‹©å”¯ä¸€ä¸€ä¸ªï¼Œæ¯”å¦‚æ‰§è¡ŒæŸä¸€ä¸ªæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æœ‰å¤šä¸ªé€‰æ‹©ï¼Œæ¯”å¦‚ï¼Œæ ‡è®°äº†ä¸€ä¸ªå®šä¹‰æˆ@DebugLogçš„è‡ªå®šä¹‰æ³¨è§£çš„æ‰€æœ‰æ–¹æ³•ã€‚</li>\n</ul>\n</li>\n<li>å¢å¼ºï¼ˆ<em>Advice</em>ï¼‰\n<ul>\n<li>æ³¨å…¥åˆ°classæ–‡ä»¶ä¸­çš„ä»£ç ã€‚</li>\n<li>å…¸å‹çš„Adviceç±»å‹æœ‰beforeã€afterå’Œaroundï¼Œåˆ†åˆ«è¡¨ç¤ºåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰ã€æ‰§è¡Œåå’Œå®Œå…¨ä»£æ›¿ç›®æ ‡æ–¹æ³•æ‰§è¡Œçš„ä»£ç ã€‚</li>\n</ul>\n</li>\n<li>ç›®æ ‡å¯¹è±¡ (<em>Target</em>)</li>\n<li>å¼•ä»‹(<em>Introduction</em>)</li>\n<li>ç»‡å…¥ï¼ˆ<em>Weaving</em>ï¼‰\n<ul>\n<li>æ³¨å…¥ä»£ç ï¼ˆadvicesï¼‰åˆ°ç›®æ ‡ä½ç½®ï¼ˆjoint pointsï¼‰çš„è¿‡ç¨‹</li>\n</ul>\n</li>\n<li>ä»£ç†ï¼ˆ<em>Proxy</em>ï¼‰</li>\n<li>åˆ‡é¢ï¼ˆ<em>Aspect</em>ï¼‰\n<ul>\n<li>Pointcutå’ŒAdviceçš„ç»„åˆçœ‹åšåˆ‡é¢ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨åº”ç”¨ä¸­é€šè¿‡å®šä¹‰ä¸€ä¸ªPointcutå’Œç»™å®šæ°å½“çš„Adviceï¼Œæ·»åŠ ä¸€ä¸ªæ—¥å¿—åˆ‡é¢</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"åˆ†ç±»\">åˆ†ç±»<a title=\"#åˆ†ç±»\" href=\"#åˆ†ç±»\"></a></h3>\n<blockquote>\n<p>ä¸€ç±»æ˜¯ï¼Œä¾‹å¦‚Javaçš„åŠ¨æ€ä»£ç†ï¼›å¦ä¸€ç±»å¯ä»¥å½’ç»“ä¸ºï¼Œä¾‹å¦‚ç»å¸¸å¬è¯´çš„ï¼ŒAspecJç­‰æ¡†æ¶</p>\n</blockquote>\n<ul>\n<li>è¿è¡ŒæœŸçš„AOP\n<ul>\n<li>Javaçš„åŠ¨æ€ä»£ç†</li>\n</ul>\n</li>\n<li>ç¼–è¯‘æœŸçš„AOP\n<ul>\n<li>ASM</li>\n<li>AspecJ</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"åº”ç”¨\">åº”ç”¨<a title=\"#åº”ç”¨\" href=\"#åº”ç”¨\"></a></h3>\n<ul>\n<li>Hot Fix\n<ul>\n<li>åŸºäºAOPæŠ€æœ¯ï¼Œç¼–è¯‘æœŸä¿®æ”¹Javaå­—èŠ‚ç ï¼Œå¯¹æ¯ä¸€ä¸ªæ–¹æ³•è¿›è¡Œæ’æ¡©æ“ä½œï¼Œä»¥ä¾¿äºhookæ¯ä¸€ä¸ªæ–¹æ³•ï¼Œåšåˆ°æ–¹æ³•çº§åˆ«çš„çƒ­ä¿®å¤</li>\n</ul>\n</li>\n<li>ç›‘æµ‹æ–¹æ³•è€—æ—¶</li>\n<li>æ—¥å¿—è®°å½•</li>\n<li>ç»Ÿä¸€å¤„ç†ç‚¹å‡»æŠ–åŠ¨</li>\n<li>å…¶ä»–çš„ç›‘æ§æ–¹é¢</li>\n</ul>\n<h3 id=\"aopä¸aptåŒºåˆ«\">AOPä¸APTåŒºåˆ«<a title=\"#aopä¸aptåŒºåˆ«\" href=\"#aopä¸aptåŒºåˆ«\"></a></h3>\n<p>APT(Annotation Processing Tool)å³æ³¨è§£å¤„ç†å™¨ï¼Œæ˜¯ä¸€ç§å¤„ç†æ³¨è§£çš„å·¥å…·ï¼Œç¡®åˆ‡çš„è¯´å®ƒæ˜¯javacçš„ä¸€ä¸ªå·¥å…·ï¼Œå®ƒç”¨æ¥åœ¨ç¼–è¯‘æ—¶æ‰«æå’Œå¤„ç†æ³¨è§£ã€‚æ³¨è§£å¤„ç†å™¨ä»¥Javaä»£ç (æˆ–è€…ç¼–è¯‘è¿‡çš„å­—èŠ‚ç )ä½œä¸ºè¾“å…¥ï¼Œç”Ÿæˆ<code>.javaæ–‡ä»¶</code>ä½œä¸ºè¾“å‡ºã€‚</p>\n<ul>\n<li>APTæ˜¯åœ¨ç¼–è¯‘æœŸï¼Œé€šè¿‡æ³¨è§£ç”Ÿæˆ<code>java</code>æ–‡ä»¶ï¼Œç„¶å.javaæ–‡ä»¶ä»ç„¶éœ€è¦è¿›ä¸€æ­¥ç¼–è¯‘ç”Ÿæˆ<code>.class</code>æ–‡ä»¶</li>\n<li>AOPæ˜¯åœ¨ç¼–è¯‘å®Œæˆåç›´æ¥é€šè¿‡ä¿®æ”¹<code>.class</code>æ–‡ä»¶ï¼Œæ·»åŠ æˆ–è€…ä¿®æ”¹ä»£ç é€»è¾‘</li>\n</ul>\n<h3 id=\"refer\">Refer<a title=\"#refer\" href=\"#refer\"></a></h3>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzUxODg0MzU2OQ==&amp;mid=2247483887&amp;idx=1&amp;sn=d54e3f210a4f31f477dba06c3dcd352e&amp;scene=21#wechat_redirect\" target=\"_blank\">AOPæŠ€æœ¯åœ¨å®¢æˆ·ç«¯çš„åº”ç”¨ä¸å®è·µ</a></p>\n",
            "tags": [
                "AOP"
            ]
        }
    ]
}