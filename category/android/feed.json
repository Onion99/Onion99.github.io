{
    "version": "https://jsonfeed.org/version/1",
    "title": "Stay hungry , Stay foolish â€¢ All posts by \"android\" category",
    "description": "å·´æ‹‰å·´æ‹‰",
    "home_page_url": "https://onion99.github.io",
    "items": [
        {
            "id": "https://onion99.github.io/2022/03/13/XJTlmsU39F0XEnje/",
            "url": "https://onion99.github.io/2022/03/13/XJTlmsU39F0XEnje/",
            "title": "Android - å¤šæ¸ é“æ‰“åŒ…",
            "date_published": "2022-03-13T09:49:49.000Z",
            "content_html": "<blockquote>\n<p>æœ¬è´¨å°±æ˜¯ç»™APKæ·»åŠ ç‰¹å®šçš„æ ‡ç­¾ä¿¡æ¯</p>\n</blockquote>\n<span id=\"more\"></span>\n<h3 id=\"æ™®é€šå¤šæ¸ é“æ‰“åŒ…æ–¹æ¡ˆ\">æ™®é€šå¤šæ¸ é“æ‰“åŒ…æ–¹æ¡ˆ<a title=\"#æ™®é€šå¤šæ¸ é“æ‰“åŒ…æ–¹æ¡ˆ\" href=\"#æ™®é€šå¤šæ¸ é“æ‰“åŒ…æ–¹æ¡ˆ\"></a></h3>\n<h4 id=\"android-gradle-plugin\">Android Gradle Plugin<a title=\"#android-gradle-plugin\" href=\"#android-gradle-plugin\"></a></h4>\n<ol>\n<li>é¦–å…ˆï¼Œåœ¨AndroidManifest.xmlä¸­æ·»åŠ æ¸ é“ä¿¡æ¯å ä½ç¬¦ï¼š</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta-data</span> </span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"attr\">android:name</span>=<span class=\"string\">&quot;InstallChannel&quot;</span> <span class=\"attr\">android:value</span>=<span class=\"string\">&quot;$&#123;InstallChannel&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>é€šè¿‡Gradle Pluginæä¾›çš„<code>productFlavors</code>æ ‡ç­¾ï¼Œæ·»åŠ æ¸ é“ä¿¡æ¯ï¼š</li>\n</ol>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">productFlavors&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;YingYongBao&quot;</span>&#123;</span><br><span class=\"line\">        manifestPlaceholders = [<span class=\"attr\">InstallChannel :</span> <span class=\"string\">&quot;YingYongBao&quot;</span>]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"string\">&quot;360&quot;</span>&#123;</span><br><span class=\"line\">        manifestPlaceholders = [<span class=\"attr\">InstallChannel :</span> <span class=\"string\">&quot;360&quot;</span>]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"apktool\">ApkTool<a title=\"#apktool\" href=\"#apktool\"></a></h4>\n<blockquote>\n<p>ApkToolæ˜¯ä¸€ä¸ªé€†å‘åˆ†æå·¥å…·ï¼Œå¯ä»¥æŠŠAPKè§£å¼€ï¼Œæ·»åŠ ä»£ç åï¼Œé‡æ–°æ‰“åŒ…æˆAPK</p>\n</blockquote>\n<ul>\n<li>å¤åˆ¶ä¸€ä»½æ–°çš„APK</li>\n<li>é€šè¿‡ApkToolå·¥å…·ï¼Œè§£å‹APKï¼ˆapktool d origin.apkï¼‰</li>\n<li>åˆ é™¤å·²æœ‰ç­¾åä¿¡æ¯</li>\n<li>æ·»åŠ æ¸ é“ä¿¡æ¯ï¼ˆå¯ä»¥åœ¨APKçš„ä»»ä½•æ–‡ä»¶æ·»åŠ æ¸ é“ä¿¡æ¯ï¼‰</li>\n<li>é€šè¿‡ApkToolå·¥å…·ï¼Œé‡æ–°æ‰“åŒ…ç”Ÿæˆæ–°APKï¼ˆapktool b newApkDirï¼‰</li>\n<li>é‡æ–°ç­¾å</li>\n</ul>\n<p><a href=\"https://ibotpeaches.github.io/Apktool/\" target=\"_blank\">Apktool - A tool for reverse engineering 3rd party, closed, binary Android apps</a></p>\n<h3 id=\"æ·»åŠ commentså¤šæ¸ é“æ‰“åŒ…\">æ·»åŠ commentså¤šæ¸ é“æ‰“åŒ…<a title=\"#æ·»åŠ commentså¤šæ¸ é“æ‰“åŒ…\" href=\"#æ·»åŠ commentså¤šæ¸ é“æ‰“åŒ…\"></a></h3>\n<blockquote>\n<p>åˆ©ç”¨çš„æ˜¯Zipæ–‡ä»¶â€œå¯ä»¥æ·»åŠ commentï¼ˆæ‘˜è¦ï¼‰â€çš„æ•°æ®ç»“æ„ç‰¹ç‚¹ï¼Œåœ¨æ–‡ä»¶çš„æœ«å°¾å†™å…¥ä»»æ„æ•°æ®ï¼Œè€Œä¸ç”¨é‡æ–°è§£å‹zipæ–‡ä»¶ï¼ˆapkæ–‡ä»¶å°±æ˜¯zipæ–‡ä»¶æ ¼å¼ï¼‰</p>\n</blockquote>\n<p>å¼€æºå®ç°:<a href=\"https://github.com/seven456/MultiChannelPackageTool\" target=\"_blank\">seven456/MultiChannelPackageTool: Android Multi channel package tool ï¼ˆå®‰å“å¤šæ¸ é“æ‰“åŒ…å·¥å…·ï¼‰</a></p>\n<p>ä½†ç”±äºAndroid7.0ä¹‹åæ–°å¢äº†V2ç­¾åï¼Œè¯¥ç­¾åä¼šæ ¡éªŒæ•´ä¸ªAPKçš„æ•°æ®æ‘˜è¦ï¼Œå¯¼è‡´ä¸Šè¿°æ¸ é“æ‰“åŒ…æ–¹æ¡ˆå¤±æ•ˆã€‚æ‰€ä»¥å¦‚æœæƒ³ç»§ç»­ä½¿ç”¨ä¸Šè¿°æ–¹æ¡ˆï¼Œéœ€è¦å…³é—­Gradle Pluginä¸­çš„V2ç­¾åé€‰é¡¹ï¼Œç¦ç”¨V2ç­¾åã€‚</p>\n<h3 id=\"ç¾å›¢çš„androidå¤šæ¸ é“æ‰“åŒ…\">ç¾å›¢çš„Androidå¤šæ¸ é“æ‰“åŒ…<a title=\"#ç¾å›¢çš„androidå¤šæ¸ é“æ‰“åŒ…\" href=\"#ç¾å›¢çš„androidå¤šæ¸ é“æ‰“åŒ…\"></a></h3>\n<blockquote>\n<p>é€šè¿‡å¯æ‰©å±•çš„APK Signature Scheme v2 Block,æ·»åŠ æ¸ é“ä¿¡æ¯</p>\n</blockquote>\n<p>å¼€æºå®ç°: <a href=\"https://github.com/Meituan-Dianping/walle\" target=\"_blank\">Meituan-Dianping/walle: Android Signature V2 Schemeç­¾åä¸‹çš„æ–°ä¸€ä»£æ¸ é“åŒ…æ‰“åŒ…ç¥å™¨</a></p>\n<p>åŸç†:<a href=\"https://tech.meituan.com/2017/01/13/android-apk-v2-signature-scheme.html\" target=\"_blank\">æ–°ä¸€ä»£å¼€æºAndroidæ¸ é“åŒ…ç”Ÿæˆå·¥å…·Walle - ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ (meituan.com)</a></p>\n<h3 id=\"è±Œè±†èšandroidå¤šæ¸ é“æ‰“åŒ…\">è±Œè±†èšAndroidå¤šæ¸ é“æ‰“åŒ…<a title=\"#è±Œè±†èšandroidå¤šæ¸ é“æ‰“åŒ…\" href=\"#è±Œè±†èšandroidå¤šæ¸ é“æ‰“åŒ…\"></a></h3>\n<blockquote>\n<p>æŠŠä¸€ä¸ªAndroidåº”ç”¨åŒ…å½“ä½œzipæ–‡ä»¶åŒ…è¿›è¡Œè§£å‹ï¼Œç„¶åå‘ç°åœ¨ç­¾åç”Ÿæˆçš„ç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ªç©ºæ–‡ä»¶ä¸éœ€è¦é‡æ–°ç­¾åã€‚åˆ©ç”¨è¿™ä¸ªæœºåˆ¶ï¼Œè¯¥æ–‡ä»¶çš„æ–‡ä»¶åå°±æ˜¯æ¸ é“åã€‚ä½†ç”±äºv2ç­¾åçš„æ ¡éªŒæœºåˆ¶,æ·»åŠ äº†ä¸€ä¸ªéç©ºæ–‡ä»¶å°±ä¼šç ´åç­¾åæ ¡éªŒï¼Œéœ€è¦é‡æ–°ç­¾åã€‚</p>\n</blockquote>\n<!--more-->\n<p>æå‰æ„å»ºä¸€ä¸ªæ²¡æœ‰æ¸ é“çš„APKï¼Œè¾“å…¥åŸå§‹APKæ–‡ä»¶å’Œæ¸ é“å·ï¼Œäº§å‡ºåŒ…å«æ¸ é“å·æ ‡è®°çš„APK.</p>\n<p>1.ä½¿ç”¨AAPTæ·»åŠ æ¸ é“æ–‡ä»¶ï¼š</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">aapt add base.apk asserts/channel.txt</span><br></pre></td></tr></table></figure>\n<p>2.ä½¿ç”¨zipalignå·¥å…·å°†APKè¿›è¡Œå­—èŠ‚å¯¹é½</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zipalign -f 4 base.apk  app_zipalign.apk&#125;</span><br></pre></td></tr></table></figure>\n<p>3.ä½¿ç”¨apksignerå¯¹apké‡æ–°ç­¾å</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -jar apksigner sign --v1-signer-name CERT -ks $&#123;mStore&#125; --ks-key-alias $&#123;mAlias&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"apkæ‰“åŒ…æµç¨‹\">APKæ‰“åŒ…æµç¨‹<a title=\"#apkæ‰“åŒ…æµç¨‹\" href=\"#apkæ‰“åŒ…æµç¨‹\"></a></h3>\n<p><img src=\"https://s1.ax1x.com/2022/03/09/bWKCWV.png\" alt=\"bWKCWV.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<ul>\n<li>æ‰“åŒ…èµ„æºæ–‡ä»¶ï¼Œç”Ÿæˆ R.java æ–‡ä»¶\n<ul>\n<li>aapt å·¥å…·ï¼ˆaapt.exeï¼‰ -&gt; AndroidManifest.xml å’Œ å¸ƒå±€æ–‡ä»¶ XMl éƒ½ä¼šç¼–è¯‘ -&gt; R.java -&gt; AndroidManifest.xml ä¼šè¢« aapt ç¼–è¯‘æˆäºŒè¿›åˆ¶</li>\n<li>res ç›®å½•ä¸‹èµ„æº -&gt; ç¼–è¯‘ï¼Œå˜æˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç”Ÿæˆ resource id -&gt; æœ€åç”Ÿæˆ resouce.arscï¼ˆæ–‡ä»¶ç´¢å¼•è¡¨ï¼‰</li>\n</ul>\n</li>\n<li>å¤„ç† aidl æ–‡ä»¶ï¼Œç”Ÿæˆç›¸åº”çš„ Java æ–‡ä»¶\n<ul>\n<li>aidl å·¥å…·ï¼ˆaidl.exeï¼‰</li>\n</ul>\n</li>\n<li>ç¼–è¯‘é¡¹ç›®æºä»£ç ï¼Œç”Ÿæˆ class æ–‡ä»¶</li>\n<li>è½¬æ¢æ‰€æœ‰ class æ–‡ä»¶ï¼Œç”Ÿæˆ classes.dex æ–‡ä»¶\n<ul>\n<li>dx.bat</li>\n</ul>\n</li>\n<li>æ‰“åŒ…ç”Ÿæˆ APK æ–‡ä»¶\n<ul>\n<li>apkbuilder å·¥å…·æ‰“åŒ…åˆ°æœ€ç»ˆçš„ .apk æ–‡ä»¶ä¸­</li>\n</ul>\n</li>\n<li>å¯¹APKæ–‡ä»¶è¿›è¡Œç­¾å</li>\n<li>å¯¹ç­¾ååçš„ APK æ–‡ä»¶è¿›è¡Œå¯¹é½å¤„ç†ï¼ˆæ­£å¼åŒ…ï¼‰</li>\n<li>å¯¹ APK è¿›è¡Œå¯¹é½å¤„ç†ï¼Œç”¨åˆ°çš„å·¥å…·æ˜¯ zipalign</li>\n</ul>\n<h3 id=\"apk-ç­¾å\">APK ç­¾å<a title=\"#apk-ç­¾å\" href=\"#apk-ç­¾å\"></a></h3>\n<blockquote>\n<p>äº†è§£ HTTPS é€šä¿¡çš„åŒå­¦éƒ½çŸ¥é“ï¼Œåœ¨æ¶ˆæ¯é€šä¿¡æ—¶ï¼Œå¿…é¡»è‡³å°‘è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼šä¸€æ˜¯ç¡®ä¿æ¶ˆæ¯æ¥æºçš„çœŸå®æ€§ï¼ŒäºŒæ˜¯ç¡®ä¿æ¶ˆæ¯ä¸ä¼šè¢«ç¬¬ä¸‰æ–¹ç¯¡æ”¹ã€‚<br>\nåŒç†ï¼Œåœ¨å®‰è£… apk æ—¶ï¼ŒåŒæ ·ä¹Ÿéœ€è¦ç¡®ä¿ apk æ¥æºçš„çœŸå®æ€§ï¼Œä»¥åŠ apk æ²¡æœ‰è¢«ç¬¬ä¸‰æ–¹ç¯¡æ”¹</p>\n</blockquote>\n<p>ç­¾åæœºåˆ¶ä¸»è¦æœ‰ä¸¤ç§ç”¨é€”ï¼š</p>\n<ul>\n<li>ä½¿ç”¨ç‰¹æ®Šçš„ key ç­¾åå¯ä»¥è·å–åˆ°ä¸€äº›ä¸åŒçš„æƒé™</li>\n<li>éªŒè¯æ•°æ®ä¿è¯ä¸è¢«ç¯¡æ”¹ï¼Œé˜²æ­¢åº”ç”¨è¢«æ¶æ„çš„ç¬¬ä¸‰æ–¹è¦†ç›–</li>\n</ul>\n<p>ç­¾åå·¥å…·</p>\n<ul>\n<li>jarsignerï¼šjdk è‡ªå¸¦çš„ç­¾åå·¥å…·ï¼Œå¯¹ jar è¿›è¡Œç­¾åã€‚ä½¿ç”¨ keystore æ–‡ä»¶è¿›è¡Œç­¾åï¼Œç”Ÿæˆçš„ç­¾åæ–‡ä»¶é»˜è®¤ä½¿ç”¨ keystore çš„åˆ«åå‘½åã€‚</li>\n<li>apksignerï¼šAndroid sdk æä¾›çš„ä¸“é—¨ç”¨äº Android åº”ç”¨çš„ç­¾åå·¥å…·ã€‚ä½¿ç”¨ pk8ã€x509.pem æ–‡ä»¶è¿›è¡Œç­¾åã€‚ pk8 æ˜¯ç§é’¥æ–‡ä»¶ï¼Œx509.pem æ˜¯å«æœ‰å…¬é’¥çš„æ–‡ä»¶ã€‚ç”Ÿæˆçš„ç­¾åæ–‡ä»¶ç»Ÿä¸€ä½¿ç”¨â€œCERTâ€å‘½åã€‚</li>\n</ul>\n<h4 id=\"v1-ç­¾å\">V1 ç­¾å<a title=\"#v1-ç­¾å\" href=\"#v1-ç­¾å\"></a></h4>\n<blockquote>\n<p>åŸºäº JAR ç­¾å</p>\n</blockquote>\n<h5 id=\"ç­¾å\">ç­¾å<a title=\"#ç­¾å\" href=\"#ç­¾å\"></a></h5>\n<p><img src=\"https://s1.ax1x.com/2022/03/09/bWMbDg.png\" alt=\"bWMbDg.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h5 id=\"æ ¡éªŒ\">æ ¡éªŒ<a title=\"#æ ¡éªŒ\" href=\"#æ ¡éªŒ\"></a></h5>\n<p><img src=\"https://s1.ax1x.com/2022/03/09/bWQS2V.png\" alt=\"bWQS2V.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<ul>\n<li>æ£€æŸ¥ APK ä¸­åŒ…å«çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¯¹åº”çš„æ‘˜è¦å€¼ä¸ MANIFEST.MF æ–‡ä»¶ä¸­è®°å½•çš„å€¼ä¸€è‡´ã€‚</li>\n<li>ä½¿ç”¨è¯ä¹¦æ–‡ä»¶ï¼ˆRSA æ–‡ä»¶ï¼‰æ£€éªŒç­¾åæ–‡ä»¶ï¼ˆSF æ–‡ä»¶ï¼‰æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚</li>\n<li>ä½¿ç”¨ç­¾åæ–‡ä»¶ï¼ˆSF æ–‡ä»¶ï¼‰æ£€éªŒ MF æ–‡ä»¶æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚</li>\n</ul>\n<h5 id=\"v1-å¼Šç«¯\">v1 å¼Šç«¯<a title=\"#v1-å¼Šç«¯\" href=\"#v1-å¼Šç«¯\"></a></h5>\n<ul>\n<li>ç­¾åæ£€éªŒé€Ÿåº¦æ…¢ï¼šå¯¹æ‰€æœ‰æ–‡ä»¶è¿›è¡Œæ‘˜è¦ç»©ï¼Œå¦‚æœ Android æœºå™¨å·®ï¼Œå®‰è£…é€Ÿåº¦æ…¢ã€‚</li>\n<li>å®Œæ•´æ€§ä¿éšœä¸å¤Ÿï¼šMETA-INF ç›®å½•ç”¨æ¥å­˜æ”¾ç­¾åï¼Œä½†å¯ä»¥éšæ„æ·»åŠ æ–‡ä»¶ã€‚</li>\n</ul>\n<h4 id=\"v2-ç­¾å\">v2 ç­¾å<a title=\"#v2-ç­¾å\" href=\"#v2-ç­¾å\"></a></h4>\n<blockquote>\n<p>ä¸€ç§å…¨æ–‡ä»¶ç­¾åæ–¹æ¡ˆï¼Œèƒ½å¤Ÿå‘ç°å¯¹ APK çš„å—ä¿æŠ¤éƒ¨åˆ†è¿›è¡Œçš„æ‰€æœ‰æ›´æ”¹ï¼Œä»è€Œæœ‰åŠ©äºåŠ å¿«éªŒè¯é€Ÿåº¦å¹¶å¢å¼ºå®Œæ•´æ€§ä¿è¯ã€‚</p>\n</blockquote>\n<ul>\n<li>\n<p>éªŒè¯å½’æ¡£ä¸­çš„æ‰€æœ‰å­—èŠ‚ï¼Œè€Œä¸æ˜¯å•ä¸ª ZIP æ¡ç›®ï¼Œå› æ­¤ï¼Œåœ¨ç­¾ç½²åæ— æ³•å†è¿è¡Œ ZIPalignï¼ˆå¿…é¡»åœ¨ç­¾åä¹‹å‰æ‰§è¡Œï¼‰</p>\n</li>\n<li>\n<p>v2 ä¼šåœ¨åŸå…ˆ APK å—ä¸­å¢åŠ äº†ä¸€ä¸ªSigning Blockï¼ˆç­¾åå—ï¼‰ï¼Œæ–°çš„å—å­˜å‚¨äº†ç­¾åã€æ‘˜è¦ã€ç­¾åç®—æ³•ã€è¯ä¹¦é“¾å’Œé¢å¤–å±æ€§ç­‰ä¿¡æ¯ã€‚æœ€ç»ˆçš„ç­¾åAPKæœ‰å››å—ï¼šå¤´æ–‡ä»¶åŒºã€V2ç­¾åå—ã€ä¸­å¤®ç›®å½•ã€å°¾éƒ¨ã€‚</p>\n</li>\n</ul>\n<p>å„ç‰ˆæœ¬ç­¾åç»„æˆ:<br>\n<img src=\"https://s1.ax1x.com/2022/03/09/bWl9JI.png\" alt=\"bWl9JI.png\" loading=\"lazy\"></p>\n<h4 id=\"v3-ç­¾å\">v3 ç­¾å<a title=\"#v3-ç­¾å\" href=\"#v3-ç­¾å\"></a></h4>\n<p>åœ¨v2çš„åŸºç¡€ä¸ŠåŠ å…¥äº†è¯ä¹¦çš„æ—‹è½¬æ ¡éªŒï¼Œå³å¯ä»¥åœ¨ä¸€æ¬¡çš„å‡çº§å®‰è£…ä¸­ä½¿ç”¨æ–°çš„è¯ä¹¦ï¼Œæ–°çš„ç§é’¥æ¥ç­¾åAPKã€‚å½“ç„¶è¿™ä¸ªæ–°çš„è¯ä¹¦æ˜¯éœ€è¦è€è¯ä¹¦æ¥ä¿è¯çš„ï¼Œç±»ä¼¼ä¸€ä¸ªè¯ä¹¦é“¾ã€‚</p>\n<h4 id=\"ç­¾åç‰ˆæœ¬åŒºåˆ«\">ç­¾åç‰ˆæœ¬åŒºåˆ«<a title=\"#ç­¾åç‰ˆæœ¬åŒºåˆ«\" href=\"#ç­¾åç‰ˆæœ¬åŒºåˆ«\"></a></h4>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th style=\"text-align:center\">ç‰ˆæœ¬</th>\n<th>ç®€ä»‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">v1</td>\n<td>åŸºäºJAR ç­¾å,ç­¾åä»¥æ–‡ä»¶çš„å½¢å¼å­˜åœ¨äºapkåŒ…ä¸­ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„apkåŒ…å°±æ˜¯ä¸€ä¸ªæ ‡å‡†çš„zipåŒ…</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">v2</td>\n<td>åœ¨ Android 7.0 å¼•å…¥,ç­¾åä¿¡æ¯è¢«å¡åˆ°äº†apkæ–‡ä»¶æœ¬èº«ä¸­ï¼Œè¿™æ—¶apkå·²ç»ä¸ç¬¦åˆä¸€ä¸ªæ ‡å‡†çš„zipå‹ç¼©åŒ…çš„æ–‡ä»¶ç»“æ„</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">v3</td>\n<td>åœ¨ Android 9.0 å¼•å…¥,æ·»åŠ äº†ä¸€ç§æ›´æ–°è¯ä¹¦çš„æ–¹å¼ï¼Œè¿™éƒ¨åˆ†æ›´æ–°è¯ä¹¦çš„æ•°æ®åŒæ ·è¢«æ”¾åœ¨äº†ç­¾åä¿¡æ¯ä¸­</td>\n</tr>\n</tbody>\n</table></div></div><h3 id=\"refer\">Refer<a title=\"#refer\" href=\"#refer\"></a></h3>\n<p><a href=\"https://www.jianshu.com/p/5baea0e1cd1e\" target=\"_blank\">Androidå¤šæ¸ é“æ‰“åŒ…ï¼ˆVasDollyå®ç°åŸç†ï¼‰ - ç®€ä¹¦ (jianshu.com)</a><br>\n<a href=\"https://www.jb51.net/article/174939.htm\" target=\"_blank\">è¯¦è§£Android v1ã€v2ã€v3ç­¾å(å°ç»“ï¼‰_</a><br>\n<a href=\"https://blog.csdn.net/bobby_fu/article/details/103843038\" target=\"_blank\">Android P v3ç­¾åæ–°ç‰¹æ€§</a><br>\n<a href=\"https://github.com/yoyiyi/SoleilNotes/blob/master/Android/v1%E3%80%81v2%E3%80%81v3%E7%AD%BE%E5%90%8D%E5%8C%BA%E5%88%AB.md\" target=\"_blank\">SoleilNotes/v1ã€v2ã€v3ç­¾ååŒºåˆ«</a></p>\n",
            "tags": []
        },
        {
            "id": "https://onion99.github.io/2022/03/12/Kt2Wobik8Fv12ZRY/",
            "url": "https://onion99.github.io/2022/03/12/Kt2Wobik8Fv12ZRY/",
            "title": "Android AOP - ASM+Transform",
            "date_published": "2022-03-12T09:45:36.000Z",
            "content_html": "<span id=\"more\"></span>\n<p><img src=\"https://s1.ax1x.com/2022/03/10/bhoW8O.png\" alt=\"bhoW8O.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h3 id=\"transform\">Transform<a title=\"#transform\" href=\"#transform\"></a></h3>\n<blockquote>\n<p>Android Gradle Plugin ä» 1.5.0 å¼€å§‹æ”¯æŒ Transform APIï¼Œä»¥å…è®¸ç¬¬ä¸‰æ–¹æ’ä»¶åœ¨ç»è¿‡ç¼–è¯‘çš„ .class æ–‡ä»¶è½¬æ¢ä¸º .dex æ–‡ä»¶ä¹‹å‰å¯¹å…¶è¿›è¡Œæ“çºµã€‚</p>\n</blockquote>\n<p>æ™®é€šç¼–è¯‘è¿‡ç¨‹ï¼š<br>\n<img src=\"https://s1.ax1x.com/2022/03/11/bINI8f.png\" alt=\"bINI8f.png\" loading=\"lazy\"><br>\nå¯ä»¥çœ‹åˆ°Android æ„å»ºæµç¨‹æ˜¯ä¸€å¥—æµæ°´çº¿çš„å·¥ä½œæœºåˆ¶ï¼Œæ¯ä¸€ä¸ªçš„æ„å»ºå•å…ƒæ¥æ”¶ä¸Šä¸€ä¸ªæ„å»ºå•å…ƒçš„è¾“å‡ºï¼Œä½œä¸ºè¾“å…¥ï¼Œå†å°†äº§å“è¿›è¡Œè¾“å‡ºï¼Œ<code>com.android.build</code>åº“æä¾›äº†<code>Transform</code>çš„æœºåˆ¶ï¼Œè€Œè¿™ä¸ªæœºåˆ¶æ˜¯Android æ„å»ºç³»ç»Ÿä¸ºäº†ç»™å¤–éƒ¨æä¾›ä¸€ä¸ªå¯ä»¥åŠ å…¥è‡ªå®šä¹‰æ„å»ºå•å…ƒï¼Œå¦‚æ‹¦æˆªæŸä¸ªæ„å»ºå•å…ƒçš„è¾“å‡ºï¼Œæˆ–è€…åŠ å…¥ä¸€äº›è¾“å‡ºç­‰ã€‚è€Œè¿™äº›Transformæ˜¯åœ¨javaæºç ç¼–è¯‘å®Œæˆä¹‹åï¼Œpackageä¹‹å‰è¿›è¡Œçš„ã€‚<br>\n<img src=\"https://s1.ax1x.com/2022/03/11/bIZBy8.md.png\" alt=\"bIZBy8.md.png\" loading=\"lazy\"></p>\n<p>åœ¨Android Gradleæ„å»ºç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡<code>AppExtension </code>å°†<code>transform</code>æ³¨å†Œåˆ°æ„å»ºç³»ç»Ÿä¸­:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CustomPlugin</span> <span class=\"keyword\">implements</span> <span class=\"title\">Plugin</span>&lt;<span class=\"title\">Project</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">apply</span><span class=\"params\">(Project project)</span> </span>&#123;</span><br><span class=\"line\">        AppExtension appExtension = (AppExtension)project.getProperties().get(<span class=\"string\">&quot;android&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// ç»™Appç¼–è¯‘è¿‡ç¨‹æ³¨å†Œtransform</span></span><br><span class=\"line\">        appExtension.registerTransform(<span class=\"keyword\">new</span> CustomTransform(), Collections.EMPTY_LIST);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"asm\">ASM<a title=\"#asm\" href=\"#asm\"></a></h3>\n<blockquote>\n<p><a href=\"https://asm.ow2.io/\" target=\"_blank\">ASM</a>æ˜¯ä¸€ç§é€šç”¨<strong>Javaå­—èŠ‚ç </strong>æ“ä½œå’Œåˆ†ææ¡†æ¶ã€‚å®ƒå¯ä»¥ç”¨æ¥ä¿®æ”¹ç°æœ‰çš„ç±»ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä»¥äºŒè¿›åˆ¶å½¢å¼åŠ¨æ€ç”Ÿæˆç±»ã€‚</p>\n</blockquote>\n<p><img src=\"https://s1.ax1x.com/2022/03/11/bI0iSx.png\" alt=\"bI0iSx.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>ASMè®¾è®¡äº†ä¸¤ç§APIç±»å‹è§£ææ–‡ä»¶ç»“æ„ï¼š</p>\n<ul>\n<li>Tree API</li>\n<li>åŸºäºVisitor API(visitor pattern)ï¼Œ</li>\n</ul>\n<p>è®©æˆ‘ä»¬ä»¥ä¸åŒçš„æ–¹å¼å¤„ç†ä¸‹å§ğŸ¤¤ğŸ¤¤ğŸ¤¤</p>\n<h4 id=\"tree-api\">Tree API<a title=\"#tree-api\" href=\"#tree-api\"></a></h4>\n<p>Tree APIå°†classçš„ç»“æ„è¯»å–åˆ°å†…å­˜ï¼Œæ„å»ºä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œç„¶åéœ€è¦å¤„ç†Methodã€Fieldç­‰å…ƒç´ æ—¶ï¼Œåˆ°æ ‘å½¢ç»“æ„ä¸­å®šä½åˆ°æŸä¸ªå…ƒç´ ï¼Œè¿›è¡Œæ“ä½œï¼Œç„¶åæŠŠæ“ä½œå†å†™å…¥æ–°çš„classæ–‡ä»¶ã€‚</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestPlugin</span> : <span class=\"type\">Plugin</span>&lt;<span class=\"type\">Project</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">apply</span><span class=\"params\">(target: <span class=\"type\">Project</span>)</span></span> &#123;</span><br><span class=\"line\">        println(<span class=\"string\">&quot;Test Plugin : target = [<span class=\"subst\">$&#123;target&#125;</span>]&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> appExtension: AppExtension = target.extensions.getByType()</span><br><span class=\"line\">        appExtension.registerTransform(TestTransform())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestTransform</span> : <span class=\"type\">BaseTransform</span></span>()&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">companion</span> <span class=\"keyword\">object</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">var</span> isPrint = <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">var</span> isChange = <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">modifyClass</span><span class=\"params\">(byteArray: <span class=\"type\">ByteArray</span>)</span></span>: ByteArray &#123;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> classReader = ClassReader(byteArray)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> classNode = ClassNode()</span><br><span class=\"line\">        <span class=\"comment\">// é€šè¿‡ä¼ é€’ ClassReader è§£æå¯¹åº” ClassFile ç”Ÿæˆ ClassNode</span></span><br><span class=\"line\">        classReader.accept(classNode, ClassReader.EXPAND_FRAMES)</span><br><span class=\"line\">        <span class=\"comment\">// æ‰“å°æµ‹è¯•</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(isPrint)&#123;</span><br><span class=\"line\">            isPrint = <span class=\"literal\">false</span></span><br><span class=\"line\">            Log.log(classNode.toString())</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (methodNode <span class=\"keyword\">in</span> classNode.methods) &#123;</span><br><span class=\"line\">                Log.log(<span class=\"string\">&quot;<span class=\"subst\">$&#123;classNode.name&#125;</span> ------&gt;&gt;&gt; <span class=\"variable\">$methodNode</span>&quot;</span>)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœæ–‡ä»¶å¯¹classNodeæœ‰ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œéœ€è¦è¿™æ ·å¤„ç†</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(isChange)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">val</span> classWriter = ClassWriter(ClassWriter.COMPUTE_MAXS)</span><br><span class=\"line\">            classNode.accept(classWriter)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> classWriter.toByteArray()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// è¿”å›ä¿®æ”¹å†…å®¹</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> byteArray</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getInputTypes</span><span class=\"params\">()</span></span>: MutableSet&lt;QualifiedContent.ContentType&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> TransformManager.CONTENT_CLASS</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getScopes</span><span class=\"params\">()</span></span>: MutableSet&lt;<span class=\"keyword\">in</span> QualifiedContent.Scope&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mutableSetOf(</span><br><span class=\"line\">            QualifiedContent.Scope.PROJECT</span><br><span class=\"line\">        )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¯ä»¥çœ‹åˆ°ç¼–è¯‘çš„ç±»æ­£è¢«æˆ‘ä»¬æ‰“å°å‡ºæ¥ï¼š<br>\n<img src=\"https://s1.ax1x.com/2022/03/11/bIq3id.png\" alt=\"bIq3id.png\" loading=\"lazy\"></p>\n<h4 id=\"visitor-api\">Visitor API<a title=\"#visitor-api\" href=\"#visitor-api\"></a></h4>\n<p>Visitor APIåˆ™å°†é€šè¿‡æ¥å£çš„æ–¹å¼ï¼Œåˆ†ç¦»è¯»classå’Œå†™classçš„é€»è¾‘ï¼Œä¸€èˆ¬é€šè¿‡ä¸€ä¸ªClassReaderè´Ÿè´£è¯»å–classå­—èŠ‚ç ï¼Œç„¶åClassReaderé€šè¿‡ä¸€ä¸ªClassVisitoræ¥å£ï¼Œå°†å­—èŠ‚ç çš„æ¯ä¸ªç»†èŠ‚æŒ‰é¡ºåºé€šè¿‡æ¥å£çš„æ–¹å¼ï¼Œä¼ é€’ç»™ClassVisitorï¼ˆä½ ä¼šå‘ç°ClassVisitorä¸­æœ‰å¤šä¸ªvisitXXXXæ¥å£ï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±åƒClassReaderå¸¦ç€ClassVisitoræ¸¸è§ˆäº†classå­—èŠ‚ç çš„æ¯ä¸€ä¸ªæŒ‡ä»¤ã€‚</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestPlugin</span> : <span class=\"type\">Plugin</span>&lt;<span class=\"type\">Project</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">apply</span><span class=\"params\">(target: <span class=\"type\">Project</span>)</span></span> &#123;</span><br><span class=\"line\">        println(<span class=\"string\">&quot;Test Plugin : target = [<span class=\"subst\">$&#123;target&#125;</span>]&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> appExtension: AppExtension = target.extensions.getByType()</span><br><span class=\"line\">        appExtension.registerTransform(TestVisitorTransform())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestClassVisitor</span></span>(visitor: ClassVisitor):ClassVisitor(Opcodes.ASM4,visitor)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestVisitorTransform</span> : <span class=\"type\">BaseTransform</span></span>()&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">companion</span> <span class=\"keyword\">object</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">var</span> isPrint = <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">var</span> isChange = <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">modifyClass</span><span class=\"params\">(byteArray: <span class=\"type\">ByteArray</span>)</span></span>: ByteArray &#123;</span><br><span class=\"line\">        <span class=\"comment\">// è§£æclassæ–‡ä»¶</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> classReader = ClassReader(byteArray)</span><br><span class=\"line\">        <span class=\"comment\">// å°†classæ–‡ä»¶å†…å®¹å†™å…¥åˆ°ClassWriterä¸­</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> classWriter = ClassWriter(classReader,ClassWriter.COMPUTE_MAXS)</span><br><span class=\"line\">        <span class=\"comment\">// èµ‹äºˆå¯¹åº”çš„ClassVisitorè¯»å†™èƒ½åŠ›</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> classVisitor = TestClassVisitor(classWriter)</span><br><span class=\"line\">        classReader.accept(classVisitor, ClassReader.EXPAND_FRAMES)</span><br><span class=\"line\">        <span class=\"comment\">// æ‰“å°æµ‹è¯•</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(isPrint)&#123;</span><br><span class=\"line\">            isPrint = <span class=\"literal\">false</span></span><br><span class=\"line\">            Log.log(classVisitor.toString())</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœæ–‡ä»¶å¯¹classNodeæœ‰ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œéœ€è¦è¿™æ ·å¤„ç†</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(isChange)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> classWriter.toByteArray()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// è¿”å›ä¿®æ”¹å†…å®¹</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> byteArray</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getInputTypes</span><span class=\"params\">()</span></span>: MutableSet&lt;QualifiedContent.ContentType&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> TransformManager.CONTENT_CLASS</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getScopes</span><span class=\"params\">()</span></span>: MutableSet&lt;<span class=\"keyword\">in</span> QualifiedContent.Scope&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mutableSetOf(</span><br><span class=\"line\">            QualifiedContent.Scope.PROJECT</span><br><span class=\"line\">        )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>åŒæ ·å¯ä»¥çœ‹åˆ°ç¼–è¯‘çš„ç±»æ­£è¢«æˆ‘ä»¬æ‰“å°å‡ºæ¥ï¼š<br>\n<img src=\"https://s1.ax1x.com/2022/03/11/bIvebV.png\" alt=\"bIvebV.png\" loading=\"lazy\"></p>\n<ul>\n<li>ClassReaderï¼šè´Ÿè´£å¯¹ .class æ–‡ä»¶è¿›è¡Œè¯»å–</li>\n<li>ClassVisitorï¼š è´Ÿè´£è®¿é—® .class æ–‡ä»¶ä¸­å„ä¸ªå…ƒç´ </li>\n<li>ClassWriterï¼š è´Ÿè´£å¯¹ .class æ–‡ä»¶è¿›è¡Œå†™å…¥ï¼Œå°†å­—èŠ‚ç è¾“å‡ºä¸º byte æ•°ç»„ã€‚</li>\n</ul>\n<h3 id=\"å­—èŠ‚ç äº†è§£\">å­—èŠ‚ç äº†è§£<a title=\"#å­—èŠ‚ç äº†è§£\" href=\"#å­—èŠ‚ç äº†è§£\"></a></h3>\n<p><a href=\"https://plugins.jetbrains.com/plugin/14860-asm-bytecode-viewer-support-kotlin\" target=\"_blank\">Android Studio è¾…åŠ©ç±»è½¬å­—èŠ‚ç æ’ä»¶ï¼šASM Bytecode Viewer Support Kotlin</a><br>\n<img src=\"https://pic1.zhimg.com/v2-fdd5caeb51dbfb819539611fa9ccbcd4_r.jpg\" alt=\"preview\" loading=\"lazy\"></p>\n<p><a href=\"https://juejin.cn/post/6944517233674551304#heading-5\" target=\"_blank\">å­—èŠ‚ç ç»“æ„åˆ†æ - æ˜é‡‘ (juejin.cn)</a><br>\n<a href=\"https://www.jianshu.com/p/92a75a18cbc1\" target=\"_blank\">Java ByteCode - ç®€ä¹¦ (jianshu.com)</a><br>\n<a href=\"https://zhuanlan.zhihu.com/p/94498015\" target=\"_blank\">å²ä¸Šæœ€é€šä¿—æ˜“æ‡‚çš„ASMæ•™ç¨‹ - çŸ¥ä¹ (zhihu.com)</a></p>\n<h3 id=\"è‡ªå®šä¹‰gradleæ’ä»¶\">è‡ªå®šä¹‰gradleæ’ä»¶<a title=\"#è‡ªå®šä¹‰gradleæ’ä»¶\" href=\"#è‡ªå®šä¹‰gradleæ’ä»¶\"></a></h3>\n<blockquote>\n<p>Transformå’ŒAsmçš„ç»“åˆä½¿ç”¨éœ€è¦ç”¨åˆ°Gradleæ’ä»¶</p>\n</blockquote>\n<p>è‡ªå®šä¹‰æ’ä»¶æ–¹å¼ï¼šè¯¦çœ‹<a href=\"https://docs.gradle.org/current/userguide/custom_plugins.html#example_a_build_for_a_custom_plugin\" target=\"_blank\">Developing Custom Gradle Plugins</a></p>\n<ul>\n<li>Build script</li>\n<li><code>buildSrc</code> é¡¹ç›®</li>\n<li>ç‹¬ç«‹é¡¹ç›®ï¼ˆStandalone projectï¼‰</li>\n</ul>\n<h4 id=\"build-script\">Build script<a title=\"#build-script\" href=\"#build-script\"></a></h4>\n<blockquote>\n<p>ç›´æ¥åœ¨é¡¹ç›®çš„build.gradleä¸­æ·»åŠ groovyè„šæœ¬ä»£ç å¹¶å¼•ç”¨ã€‚è¿™æ ·æ’ä»¶åœ¨æ„å»ºè„šæœ¬ä¹‹å¤–ä¸å¯è§ï¼Œåªèƒ½åœ¨æ­¤æ¨¡å—ä¸­ä½¿ç”¨è„šæœ¬æ’ä»¶ã€‚</p>\n</blockquote>\n<ol>\n<li>ç®€å•ç¼–å†™è„šæœ¬<br>\nbuild.gradle:</li>\n</ol>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">GreetingPlugin</span> <span class=\"keyword\">implements</span> <span class=\"title\">Plugin</span>&lt;<span class=\"title\">Project</span>&gt; &#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> apply(Project project) &#123;</span><br><span class=\"line\">        project.task(<span class=\"string\">&#x27;hello&#x27;</span>) &#123;</span><br><span class=\"line\">            doLast &#123;</span><br><span class=\"line\">                println <span class=\"string\">&#x27;Hello from the GreetingPlugin&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Apply the plugin</span></span><br><span class=\"line\">apply <span class=\"attr\">plugin:</span> GreetingPlugin</span><br></pre></td></tr></table></figure>\n<p>è·Ÿä¸Šé¢ä¸€æ ·ï¼Œåªä¸è¿‡é‡‡ç”¨æ–°ç‰ˆktsé£æ ¼<br>\nbuild.gradle.kts</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">GreetingPlugin</span> : <span class=\"type\">Plugin</span>&lt;<span class=\"type\">Project</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">apply</span><span class=\"params\">(project: <span class=\"type\">Project</span>)</span></span> &#123;</span><br><span class=\"line\">        project.task(<span class=\"string\">&quot;hello&quot;</span>) &#123;</span><br><span class=\"line\">            doLast &#123;</span><br><span class=\"line\">                println(<span class=\"string\">&quot;Hello from the GreetingPlugin&quot;</span>)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Apply the plugin</span></span><br><span class=\"line\">apply&lt;GreetingPlugin&gt;()</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>è¿è¡Œ</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; gradle -q hello</span><br><span class=\"line\">Hello from the GreetingPlugin</span><br></pre></td></tr></table></figure>\n<h4 id=\"buildsrc-é¡¹ç›®\">buildSrc é¡¹ç›®<a title=\"#buildsrc-é¡¹ç›®\" href=\"#buildsrc-é¡¹ç›®\"></a></h4>\n<blockquote>\n<p>å°†æ’ä»¶çš„æºä»£ç æ”¾åœ¨rootProjectDir/buildSrc/src/main/groovyç›®å½•ä¸­ï¼ŒGradleå°†è´Ÿè´£ç¼–è¯‘å’Œæµ‹è¯•æ’ä»¶ï¼Œå¹¶ä½¿å…¶åœ¨æ„å»ºè„šæœ¬çš„ç±»è·¯å¾„ä¸­å¯ç”¨ã€‚è¯¥æ’ä»¶æ¯ä¸ªæ„å»ºè„šæœ¬éƒ½æ˜¯å¯è§çš„ã€‚ä½†æ˜¯å®ƒåœ¨æ„å»ºå¤–éƒ¨ä¸å¯è§å³åœ¨å½“å‰å·¥ç¨‹çš„å„ä¸ªæ¨¡å—éƒ½å¯è§ï¼Œä½†æ˜¯é¡¹ç›®ä¹‹å¤–ä¸å¯è§</p>\n</blockquote>\n<p>buildSrcæ˜¯androidä¸­ä¸€ä¸ªä¿ç•™åï¼Œæ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥åšgradleæ’ä»¶çš„moduleï¼Œæ‰€ä»¥è¿™ä¸ªmoduleçš„åå­—å¿…é¡»æ˜¯buildSrcï¼Œæ­¤æ¨¡å—ä¸‹é¢æœ‰ä¸€ä¸ªå›ºå®šçš„ç›®å½•ç»“æ„src/main/groovyï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥å­˜æ”¾çœŸæ­£çš„è„šæœ¬æ–‡ä»¶çš„ã€‚å…¶ä»–çš„è‡ªå®šä¹‰ç±»å¯ä»¥æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨è‡ªå»ºçš„å…¶ä»–ç›®å½•ä¸‹ã€‚</p>\n<ol>\n<li>åˆ›å»º<code>buildSrc</code>Module,å¯ä»¥ç›´æ¥åˆ›å»ºç›®å½•\n<ul>\n<li>åœ¨å·¥ç¨‹æ ¹ç›®å½•ä¸‹åˆ›å»ºç›®å½•<code>buildSrc</code></li>\n<li>åœ¨buildSrcä¸‹åˆ›å»ºç›®å½•ç»“æ„ <code>src/main/groovy</code>æˆ–è€…<code>src/main/java</code></li>\n<li>åœ¨buildSrcæ ¹ç›®å½•ä¸‹åˆ›å»º<code> build.gradle</code>æˆ–è€…<code> build.gradle.kts</code></li>\n</ul>\n</li>\n</ol>\n<p>build.gradle.kts:</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.jetbrains.kotlin.gradle.tasks.KotlinCompile</span><br><span class=\"line\"></span><br><span class=\"line\">plugins &#123;</span><br><span class=\"line\">    `kotlin-dsl`</span><br><span class=\"line\">    kotlin(<span class=\"string\">&quot;jvm&quot;</span>) version <span class=\"string\">&quot;1.4.32&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">val</span> compileKotlin: KotlinCompile <span class=\"keyword\">by</span> tasks</span><br><span class=\"line\"><span class=\"keyword\">val</span> compileTestKotlin: KotlinCompile <span class=\"keyword\">by</span> tasks</span><br><span class=\"line\">compileKotlin.kotlinOptions &#123;</span><br><span class=\"line\">    jvmTarget = <span class=\"string\">&quot;1.8&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">compileTestKotlin.kotlinOptions &#123;</span><br><span class=\"line\">    jvmTarget = <span class=\"string\">&quot;1.8&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">repositories &#123;</span><br><span class=\"line\">    google()</span><br><span class=\"line\">    mavenCentral()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">dependencies &#123;</span><br><span class=\"line\">    implementation(<span class=\"string\">&quot;com.android.tools.build:gradle:4.1.1&quot;</span>)</span><br><span class=\"line\">    compileOnly(<span class=\"string\">&quot;commons-io:commons-io:2.6&quot;</span>)</span><br><span class=\"line\">    compileOnly(<span class=\"string\">&quot;commons-codec:commons-codec:1.15&quot;</span>)</span><br><span class=\"line\">    compileOnly(<span class=\"string\">&quot;org.ow2.asm:asm-commons:9.2&quot;</span>)</span><br><span class=\"line\">    compileOnly(<span class=\"string\">&quot;org.ow2.asm:asm-tree:9.2&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>build.gradle</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply <span class=\"attr\">plugin:</span> <span class=\"string\">&#x27;groovy&#x27;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">dependencies &#123;</span><br><span class=\"line\">    <span class=\"comment\">// gradleæ’ä»¶å¿…é¡»çš„å¼•ç”¨</span></span><br><span class=\"line\">    implementation gradleApi()</span><br><span class=\"line\">    implementation localGroovy()</span><br><span class=\"line\">    </span><br><span class=\"line\">    implementation <span class=\"string\">&#x27;com.android.tools.build:gradle:4.1.1&#x27;</span></span><br><span class=\"line\">    <span class=\"comment\">// asmä¾èµ–</span></span><br><span class=\"line\">    implementation <span class=\"string\">&#x27;org.ow2.asm:asm:9.2&#x27;</span></span><br><span class=\"line\">    implementation <span class=\"string\">&#x27;org.ow2.asm:asm-util:9.2&#x27;</span></span><br><span class=\"line\">    implementation <span class=\"string\">&#x27;org.ow2.asm:asm-commons:9.2&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">repositories &#123;</span><br><span class=\"line\">    mavenCentral()</span><br><span class=\"line\">    jcenter()</span><br><span class=\"line\">    google()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">// æŒ‡å®šç¼–è¯‘çš„ç¼–ç  ä¸ç„¶æœ‰ä¸­æ–‡çš„è¯ä¼šå‡ºç°  â€™ç¼–ç GBKçš„ä¸å¯æ˜ å°„å­—ç¬¦â€˜</span></span><br><span class=\"line\">tasks.withType(JavaCompile) &#123;</span><br><span class=\"line\">    options.encoding = <span class=\"string\">&quot;UTF-8&quot;</span></span><br><span class=\"line\">    println(<span class=\"string\">&#x27;ä½¿ç”¨utf8ç¼–è¯‘&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>åˆ›å»ºæ’ä»¶å…¥å£TestPlugin</li>\n</ol>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.onion.plugin.plugin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestPlugin</span>: <span class=\"type\">Plugin</span>&lt;<span class=\"type\">Project</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">apply</span><span class=\"params\">(target: <span class=\"type\">Project</span>)</span></span> &#123;</span><br><span class=\"line\">        println(<span class=\"string\">&quot;Test Plugin : target = [<span class=\"subst\">$&#123;target&#125;</span>]&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>åœ¨App Module ä¸­å¼•å…¥,ç„¶åProject Build</li>\n</ol>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.onion.plugin.plugin.TestPlugin</span><br><span class=\"line\">apply <span class=\"attr\">plugin:</span> TestPlugin <span class=\"comment\">// æ’æ¡©æµ‹è¯•</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"æ’ä»¶å‘å¸ƒé¢å¤–å­¦ä¹ \">æ’ä»¶å‘å¸ƒé¢å¤–å­¦ä¹ <a title=\"#æ’ä»¶å‘å¸ƒé¢å¤–å­¦ä¹ \" href=\"#æ’ä»¶å‘å¸ƒé¢å¤–å­¦ä¹ \"></a></h4>\n<ul>\n<li><a href=\"https://juejin.cn/post/6887581345384497165\" title=\"https://juejin.cn/post/6887581345384497165\" target=\"_blank\">Android Gradle æ’ä»¶å¼€å‘å…¥é—¨æŒ‡å—ï¼ˆä¸€ï¼‰</a>ï¼Œè®²è§£Gradle Pluginå¼€å‘çš„å®Œæ•´æµç¨‹</li>\n<li><a href=\"https://juejin.cn/post/6887583351348133895\" title=\"https://juejin.cn/post/6887583351348133895\" target=\"_blank\">Android Gradle æ’ä»¶å¼€å‘å…¥é—¨æŒ‡å—ï¼ˆäºŒï¼‰</a>ï¼Œé’ˆå¯¹Androidçš„Gradle Pluginå¼€å‘å®è·µ</li>\n<li><a href=\"https://juejin.cn/post/6890544619856068616\" title=\"https://juejin.cn/post/6890544619856068616\" target=\"_blank\">Android Gradle æ’ä»¶å¼€å‘å…¥é—¨æŒ‡å—ï¼ˆä¸‰ï¼‰</a>ï¼Œå¦‚ä½•å°†æ’ä»¶å‘å¸ƒåˆ°jcenter</li>\n</ul>\n<h3 id=\"refer\">Refer<a title=\"#refer\" href=\"#refer\"></a></h3>\n<p><a href=\"http://quinnchen.cn/2018/09/13/2018-09-13-asm-transform/\" target=\"_blank\">ä¸€èµ·ç©è½¬Androidé¡¹ç›®ä¸­çš„å­—èŠ‚ç  | Quinn Note (quinnchen.cn)</a><br>\n<a href=\"https://www.jianshu.com/p/92a75a18cbc1\" target=\"_blank\">Java ByteCode</a><br>\n<a href=\"https://blog.csdn.net/qq_23992393/article/details/103696976\" target=\"_blank\">ASM + Transform åœ¨androidä¸­çš„ä½¿ç”¨</a><br>\n<a href=\"https://www.jianshu.com/p/a1e6b3abd789\" target=\"_blank\">ASM</a><br>\n<a href=\"https://juejin.cn/post/6893917892061413389#heading-3\" target=\"_blank\">ç™½è¯ Android AOP (ä¸€) </a><br>\n<a href=\"https://mp.weixin.qq.com/s/YFi6-DrV22X_VVfFbKHNEg\" target=\"_blank\">Android gradle Transform åˆ†æ</a></p>\n",
            "tags": [
                "AOP"
            ]
        },
        {
            "id": "https://onion99.github.io/2022/03/11/3Bhw0wOwpYCE6F8V/",
            "url": "https://onion99.github.io/2022/03/11/3Bhw0wOwpYCE6F8V/",
            "title": "Android AOP - AspectJ",
            "date_published": "2022-03-11T09:40:38.000Z",
            "content_html": "<blockquote>\n<p>AspectJé€šè¿‡æ³¨è§£çš„å½¢å¼æ¥æ ‡æ³¨åˆ‡å…¥ç‚¹ã€åˆ‡å…¥å¯¹è±¡ç­‰ï¼Œç„¶ååœ¨ä»£ç ç¼–è¯‘æœŸé—´å°†ä»£ç ç»‡å…¥åˆ°javaçš„å­—èŠ‚ç ä¸­</p>\n</blockquote>\n<span id=\"more\"></span>\n<p>Androidå¼€æºæ–¹æ¡ˆï¼š<a href=\"https://github.com/HujiangTechnology/gradle_plugin_android_aspectjx\" target=\"_blank\">AspectJX</a></p>\n<h3 id=\"å¼•å…¥ä¾èµ–\">å¼•å…¥ä¾èµ–<a title=\"#å¼•å…¥ä¾èµ–\" href=\"#å¼•å…¥ä¾èµ–\"></a></h3>\n<p>gradleå¼•å…¥ï¼š</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">buildscript &#123;</span><br><span class=\"line\">    dependencies &#123;</span><br><span class=\"line\">        classpath <span class=\"string\">&#x27;com.hujiang.aspectjx:gradle-android-plugin-aspectjx:2.0.4&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>åº”ç”¨pluginï¼š</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply <span class=\"attr\">plugin:</span> <span class=\"string\">&#x27;android-aspectjx&#x27;</span></span><br></pre></td></tr></table></figure>\n<p>AspectJXé…ç½®ï¼š</p>\n<p>AspectJXé»˜è®¤ä¼šå¤„ç†æ‰€æœ‰çš„äºŒè¿›åˆ¶ä»£ç æ–‡ä»¶å’Œåº“ï¼Œä¸ºäº†æå‡ç¼–è¯‘æ•ˆç‡åŠè§„é¿éƒ¨åˆ†ç¬¬ä¸‰æ–¹åº“å‡ºç°çš„ç¼–è¯‘å…¼å®¹æ€§é—®é¢˜ï¼ŒAspectJXæä¾›<code>include</code>,<code>exclude</code>å‘½ä»¤æ¥è¿‡æ»¤éœ€è¦å¤„ç†çš„æ–‡ä»¶åŠæ’é™¤æŸäº›æ–‡ä»¶(åŒ…æ‹¬classæ–‡ä»¶åŠjaræ–‡ä»¶)ã€‚</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">aspectjx &#123;</span><br><span class=\"line\">    <span class=\"comment\">//æ’é™¤æ‰€æœ‰packageè·¯å¾„ä¸­åŒ…å«`android.support`çš„classæ–‡ä»¶åŠåº“ï¼ˆjaræ–‡ä»¶ï¼‰</span></span><br><span class=\"line\">\texclude <span class=\"string\">&#x27;android.support&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¼€å…³é…ç½®ï¼š</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">aspectjx &#123;</span><br><span class=\"line\">    <span class=\"comment\">//å…³é—­AspectJXåŠŸèƒ½</span></span><br><span class=\"line\">\tenabled <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç®€å•ä½¿ç”¨\">ç®€å•ä½¿ç”¨<a title=\"#ç®€å•ä½¿ç”¨\" href=\"#ç®€å•ä½¿ç”¨\"></a></h3>\n<ol>\n<li>å‡†å¤‡åˆ‡å…¥çš„ç±»</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Animal</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">fly</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        Log.e(TAG, <span class=\"string\">&quot;animal fly method:&quot;</span> + <span class=\"keyword\">this</span>.toString() + <span class=\"string\">&quot;#fly&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>ç¼–å†™å¯¹åº”çš„åˆ‡é¢ç±»ï¼Œç”¨@Aspectæ³¨è§£</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Aspect</span>  <span class=\"comment\">//â‘ </span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MethodAspect</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// æ ‡æ³¨åˆ‡å…¥çš„æ–¹æ³•ï¼Œçœ‹åˆ°æ²¡æœ‰è¿™é‡Œç”¨çš„Poincutçš„ call</span></span><br><span class=\"line\">    <span class=\"meta\">@Pointcut(&quot;call(* com.wandering.sample.aspectj.Animal.fly(..))&quot;)</span><span class=\"comment\">//â‘¡</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">callMethod</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// æ ‡æ³¨å‡½æ•°æ‰§è¡Œå‰å¤„ç†</span></span><br><span class=\"line\">    <span class=\"meta\">@Before(&quot;callMethod()&quot;)</span><span class=\"comment\">//â‘¢</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">beforeMethodCall</span><span class=\"params\">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class=\"line\">        Log.e(TAG, <span class=\"string\">&quot;before-&gt;&quot;</span> + joinPoint.getTarget().toString()); <span class=\"comment\">//â‘£</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>ç¼–è¯‘åå°±å¯ä»¥çœ‹åˆ°ç±»çš„æ–¹æ³•åœ¨æ‰§è¡Œå‰æœ‰ä»£ç æ’å…¥äº†<br>\n<img src=\"https://s1.ax1x.com/2022/03/10/bhAMh8.png\" alt=\"bhAMh8.png\" loading=\"lazy\"></li>\n</ol>\n<h3 id=\"è¯­æ³•\">è¯­æ³•<a title=\"#è¯­æ³•\" href=\"#è¯­æ³•\"></a></h3>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th style=\"text-align:left\">JPoint</th>\n<th style=\"text-align:left\">è¯´æ˜</th>\n<th style=\"text-align:left\">Pointcutè¯­æ³•</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">method call</td>\n<td style=\"text-align:left\">å‡½æ•°è°ƒç”¨</td>\n<td style=\"text-align:left\">call(MethodSignature)</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">method execution</td>\n<td style=\"text-align:left\">å‡½æ•°å†…éƒ¨æ‰§è¡Œ</td>\n<td style=\"text-align:left\">execution(MethodSignatureï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">method execution</td>\n<td style=\"text-align:left\">æ„é€ å‡½æ•°è°ƒç”¨</td>\n<td style=\"text-align:left\">call(ConstructorSignatureï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">constructor execution</td>\n<td style=\"text-align:left\">æ„é€ å‡½æ•°å†…éƒ¨æ‰§è¡Œ</td>\n<td style=\"text-align:left\">execution(ConstructorSignatureï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">field get</td>\n<td style=\"text-align:left\">è¯»å˜é‡</td>\n<td style=\"text-align:left\">get(FieldSignatureï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">field set</td>\n<td style=\"text-align:left\">å†™å˜é‡</td>\n<td style=\"text-align:left\">set(FieldSignatureï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">static initialization</td>\n<td style=\"text-align:left\">é™æ€ä»£ç å—åˆå§‹åŒ–</td>\n<td style=\"text-align:left\">staticinitialization(TypeSignatureï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">handler</td>\n<td style=\"text-align:left\">å¼‚å¸¸å¤„ç†</td>\n<td style=\"text-align:left\">handler(TypeSignature),åªèƒ½ä¸@Before()é…ç½®ä½¿ç”¨</td>\n</tr>\n</tbody>\n</table></div></div><br/>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th style=\"text-align:left\">Advice</th>\n<th style=\"text-align:left\">è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">@Before(Pointcut)</td>\n<td style=\"text-align:left\">æ‰§è¡ŒJpointä¹‹å‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">@After(Pointcut)</td>\n<td style=\"text-align:left\">æ‰§è¡ŒJpointä¹‹å</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">@Around(Pointcut)</td>\n<td style=\"text-align:left\">æ›¿æ¢åŸç†çš„ä»£ç </td>\n</tr>\n</tbody>\n</table></div></div><p>å®Œæ•´è¯­æ³•çœ‹è¿™<a href=\"https://github.com/hyvenzhu/Android-Demos/blob/master/AspectJDemo/AspectJ.pdf\" target=\"_blank\">AspectJ</a></p>\n<h3 id=\"æ³¨æ„ç‚¹\">æ³¨æ„ç‚¹<a title=\"#æ³¨æ„ç‚¹\" href=\"#æ³¨æ„ç‚¹\"></a></h3>\n<p>æ ‡æ³¨<code>call</code>å’Œ<code>execution</code>æ‰§è¡Œçš„æ—¶å€™ï¼ŒThiså’ŒTargetä¸åŒçš„</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Aspect</span> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MethodAspect</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Pointcut(&quot;call(* com.wandering.sample.aspectj.Animal.fly(..))&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">callMethod</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        Log.e(TAG, <span class=\"string\">&quot;callMethod-&gt;&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Before(&quot;callMethod()&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">beforeMethodCall</span><span class=\"params\">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class=\"line\">        Log.e(TAG, <span class=\"string\">&quot;getTarget-&gt;&quot;</span> + joinPoint.getTarget());</span><br><span class=\"line\">        Log.e(TAG, <span class=\"string\">&quot;getThis-&gt;&quot;</span> + joinPoint.getThis());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>åˆ‡å…¥æ–¹ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected void onCreate(@Nullable Bundle savedInstanceState) &#123;</span><br><span class=\"line\">    super.onCreate(savedInstanceState);</span><br><span class=\"line\">    Animal animal = new Animal();</span><br><span class=\"line\">    animal.fly();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getTarget-&gt;com.wandering.sample.aspectj.Animal@<span class=\"number\">509</span>ddfd</span><br><span class=\"line\">getThis-&gt;com.wandering.sample.aspectj.MainActivity@<span class=\"number\">98</span>c38bf</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>è¯´æ˜targetæŒ‡ä»£çš„æ˜¯åˆ‡å…¥ç‚¹æ–¹æ³•çš„æ‰€æœ‰è€…ï¼Œè€ŒthisæŒ‡ä»£çš„æ˜¯è¢«ç»‡å…¥ä»£ç æ‰€å±ç±»çš„å®ä¾‹å¯¹è±¡ã€‚</p>\n</blockquote>\n<p>å°†åˆ‡ç‚¹çš„<code>call</code>æ”¹ä¸º<code>execution</code>ï¼š</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getTarget-&gt;com.wandering.sample.aspectj.Animal@<span class=\"number\">509</span>ddfd</span><br><span class=\"line\">getThis-&gt;com.wandering.sample.aspectj.Animal@<span class=\"number\">509</span>ddfd</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç¼ºç‚¹\">ç¼ºç‚¹<a title=\"#ç¼ºç‚¹\" href=\"#ç¼ºç‚¹\"></a></h3>\n<ul>\n<li>å¦‚æœç›¸åº”çš„classæ²¡æœ‰å®ç°ç›¸åº”çš„å¯¹ç‚¹æ–¹æ³•å°†æ— æ³•ç»‡å…¥ï¼Œå¦‚Activityæ²¡æœ‰å®ç°onResumeæ–¹æ³•çš„è¯ï¼Œå°†æ— æ³•ç»‡å…¥ä»£ç ã€‚</li>\n<li>æ— æ³•å¤„ç†Lambdaè¯­æ³•</li>\n<li>ä¼šæœ‰ä¸€ç³»åˆ—å…¼å®¹æ€§é—®é¢˜ï¼Œå¦‚R8ã€gradleç‰ˆæœ¬ä¸åŒç­‰</li>\n<li>æ€§èƒ½è¾ƒå·®ï¼ŒAPPé¡¹ç›®æ¯”è¾ƒå¤§æ—¶ç¼–è¯‘æ—¶é—´æ˜æ˜¾åŠ é•¿</li>\n</ul>\n<h3 id=\"refer\">Refer<a title=\"#refer\" href=\"#refer\"></a></h3>\n<p><a href=\"https://github.com/hyvenzhu/Android-Demos/blob/master/AspectJDemo/AspectJ.pdf\" target=\"_blank\">Android-Demos/AspectJ.pdf</a><br>\n<a href=\"https://juejin.cn/post/6888548726424469511\" target=\"_blank\">Android AOPæ–¹æ¡ˆ(ä¸€)â€”â€”AspectJ</a><br>\n<a href=\"https://www.jianshu.com/p/28aa352af7fb\" target=\"_blank\">Android AOP - ç®€ä¹¦</a><br>\n<a href=\"https://www.jianshu.com/p/d07c996ea13c\" target=\"_blank\">Android AspectJ</a></p>\n",
            "tags": [
                "AOP"
            ]
        },
        {
            "id": "https://onion99.github.io/2022/03/11/qyGiQE7cKbQOfEKm/",
            "url": "https://onion99.github.io/2022/03/11/qyGiQE7cKbQOfEKm/",
            "title": "Android AOP - JDKåŠ¨æ€ä»£ç†",
            "date_published": "2022-03-10T21:25:00.000Z",
            "content_html": "<p>JDKçš„åŠ¨æ€ä»£ç†åº•å±‚æ˜¯é€šè¿‡Javaåå°„æœºåˆ¶å®ç°çš„ï¼Œå¹¶ä¸”éœ€è¦ç›®æ ‡å¯¹è±¡ç»§æ‰¿è‡ªä¸€ä¸ªæ¥å£æ‰èƒ½ç”Ÿæˆå®ƒçš„ä»£ç†ç±»</p>\n<span id=\"more\"></span>\n<h4 id=\"javaåŠ¨æ€ä»£ç†\">JavaåŠ¨æ€ä»£ç†<a title=\"#javaåŠ¨æ€ä»£ç†\" href=\"#javaåŠ¨æ€ä»£ç†\"></a></h4>\n<blockquote>\n<p>JDK è¿è¡ŒæœŸé—´ï¼ŒåŠ¨æ€åˆ›å»º class å­—èŠ‚ç å¹¶åŠ è½½åˆ° JVM</p>\n</blockquote>\n<ol>\n<li>JDKçš„åŠ¨æ€ä»£ç†éœ€è¦å®ç°ä¸€ä¸ªå¤„ç†æ–¹æ³•è°ƒç”¨çš„Handlerï¼Œç”¨äºå®ç°ä»£ç†æ–¹æ³•çš„å†…éƒ¨é€»è¾‘ï¼Œå®ç°InvocationHandleræ¥å£</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JdkProxyHandler</span> <span class=\"keyword\">implements</span> <span class=\"title\">InvocationHandler</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Object target;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">JdkProxyHandler</span><span class=\"params\">(Object target)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.target = target;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// proxyï¼šç”Ÿæˆçš„ä»£ç†å¯¹è±¡, objï¼šç›®æ ‡æ–¹æ³•, argsï¼šç›®æ ‡æ–¹æ³•å‚æ•°</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">invoke</span><span class=\"params\">(Object proxy, Method method, Object[] args)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;å¤„ç†å‰&quot;</span>);</span><br><span class=\"line\">        Object result = method.invoke(target,args);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;å¤„ç†å&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>ä»£ç†</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//2-1</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ISender</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">send</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//2-2</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SmsSender</span> <span class=\"keyword\">implements</span> <span class=\"title\">ISender</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">send</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;sending msg&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//2-3</span></span><br><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testJdkProxy</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    ISender sender = (ISender) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> Class[]&#123;ISender.class&#125;,</span><br><span class=\"line\">            <span class=\"keyword\">new</span> JdkProxyHandler(<span class=\"keyword\">new</span> SmsSender()));</span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> result = sender.send();</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;ä»£ç†å¯¹è±¡ï¼š&quot;</span> + sender.getClass().getName());</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;è¾“å‡ºç»“æœï¼š&quot;</span> + result);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>é€š è¿‡ JDK çš„ java.lang.reflect.Proxy ç±»å®ç°åŠ¨æ€ä»£ç† ï¼Œ ä¼šä½¿ç”¨å…¶é™æ€æ–¹æ³•newProxyInstance()ï¼Œä¾æ®ç›®æ ‡å¯¹è±¡ã€ä¸šåŠ¡æ¥å£åŠè°ƒç”¨å¤„ç†å™¨ä¸‰è€…ï¼Œè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡ã€‚</p>\n<p><code>public static newProxyInstance ( ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler handler)</code></p>\n<ul>\n<li>loaderï¼šç›®æ ‡ç±»çš„ç±»åŠ è½½å™¨ï¼Œé€šè¿‡ç›®æ ‡å¯¹è±¡çš„åå°„å¯è·å–</li>\n<li>interfacesï¼šç›®æ ‡ç±»å®ç°çš„æ¥å£æ•°ç»„ï¼Œé€šè¿‡ç›®æ ‡å¯¹è±¡çš„åå°„å¯è·å–</li>\n<li>handlerï¼šè°ƒç”¨å¤„ç†å™¨ã€‚</li>\n</ul>\n<h5 id=\"åŸç†\">åŸç†<a title=\"#åŸç†\" href=\"#åŸç†\"></a></h5>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Object <span class=\"title\">newProxyInstance</span><span class=\"params\">(ClassLoader loader,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                                          Class&lt;?&gt;[] interfaces,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                                          InvocationHandler h)</span> <span class=\"keyword\">throws</span> IllegalArgumentException </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//1.æ£€æŸ¥</span></span><br><span class=\"line\">    Objects.requireNonNull(h);</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Class&lt;?&gt;[] intfs = interfaces.clone();</span><br><span class=\"line\">    <span class=\"keyword\">final</span> SecurityManager sm = System.getSecurityManager();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (sm != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        checkProxyAccess(Reflection.getCallerClass(), loader, intfs);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//æŸ¥æ‰¾æˆ–ç”ŸæˆæŒ‡å®šçš„ä»£ç†ç±»</span></span><br><span class=\"line\">    Class&lt;?&gt; cl = getProxyClass0(loader, intfs);</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (sm != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            checkNewProxyPermission(Reflection.getCallerClass(), cl);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//é€šè¿‡åå°„åˆ›å»ºä»£ç†å¯¹è±¡</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams);</span><br><span class=\"line\">        <span class=\"keyword\">final</span> InvocationHandler ih = h;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!Modifier.isPublic(cl.getModifiers())) &#123;</span><br><span class=\"line\">            AccessController.doPrivileged(<span class=\"keyword\">new</span> PrivilegedAction&lt;Void&gt;() &#123;</span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> Void <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                    cons.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> cons.newInstance(<span class=\"keyword\">new</span> Object[]&#123;h&#125;);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (IllegalAccessException|InstantiationException e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> InternalError(e.toString(), e);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (InvocationTargetException e) &#123;</span><br><span class=\"line\">        Throwable t = e.getCause();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t <span class=\"keyword\">instanceof</span> RuntimeException) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> (RuntimeException) t;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> InternalError(t.toString(), t);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (NoSuchMethodException e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> InternalError(e.toString(), e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å±€é™æ€§\">å±€é™æ€§<a title=\"#å±€é™æ€§\" href=\"#å±€é™æ€§\"></a></h3>\n<p>åªèƒ½ä»£ç†æ¥å£ï¼Œå¹¶ä¸”åªèƒ½ä¿®æ”¹æ¥å£å£°æ˜çš„æ–¹æ³•</p>\n<h3 id=\"refer\">Refer<a title=\"#refer\" href=\"#refer\"></a></h3>\n<p><a href=\"https://www.jb51.net/article/209607.htm\" target=\"_blank\">JavaåŠ¨æ€ä»£ç†å››ç§å®ç°æ–¹å¼è¯¦è§£</a><br>\n<a href=\"https://www.cnblogs.com/wkfvawl/p/15030814.html\" target=\"_blank\">Java åŠ¨æ€ä»£ç† - ç‹é™¸</a></p>\n",
            "tags": [
                "AOP"
            ]
        },
        {
            "id": "https://onion99.github.io/2022/03/10/9rnRdFk7xf4rnvds/",
            "url": "https://onion99.github.io/2022/03/10/9rnRdFk7xf4rnvds/",
            "title": "Android AOP - æ¦‚è®º",
            "date_published": "2022-03-10T09:26:27.000Z",
            "content_html": "<h3 id=\"ç¼–ç¨‹æ¶æ„æ€æƒ³\">ç¼–ç¨‹æ¶æ„æ€æƒ³<a title=\"#ç¼–ç¨‹æ¶æ„æ€æƒ³\" href=\"#ç¼–ç¨‹æ¶æ„æ€æƒ³\"></a></h3>\n<ul>\n<li>\n<p>é¢å‘å¯¹è±¡(Object Oriented Programming)</p>\n</li>\n<li>\n<p>é¢å‘è¿‡ç¨‹(Procedure Oriented Programming)</p>\n</li>\n<li>\n<p>é¢å‘åˆ‡é¢(Aspect Oriented Programming)</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<p>AOP æ„ä¸ºé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œé€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸåŠ¨æ€ä»£ç†å®ç°ç¨‹åºåŠŸèƒ½ç»Ÿä¸€ç»´æŠ¤çš„ä¸€ç§æŠ€æœ¯ï¼Œå’Œ OOP ä»¥å¯¹è±¡ä¸ºæ ¸å¿ƒä¸åŒï¼ŒAOPæ˜¯é’ˆå¯¹ä¸šåŠ¡å¤„ç†è¿‡ç¨‹ä¸­çš„ç±»ä¼¼çš„ä»£ç é€»è¾‘è¿›è¡Œåˆ‡å…¥ï¼Œç„¶åç»Ÿä¸€å¤„ç†ã€‚</p>\n<p>AOPå…¶å®æ˜¯OOPçš„è¡¥å……ï¼ŒOOPä»æ¨ªå‘ä¸ŠåŒºåˆ†å‡ºä¸€ä¸ªä¸ªçš„ç±»æ¥ï¼Œè€ŒAOPåˆ™ä»çºµå‘ä¸Šå‘å¯¹è±¡ä¸­åŠ å…¥ç‰¹å®šçš„ä»£ç ã€‚</p>\n<p><img src=\"https://s1.ax1x.com/2022/03/10/bfRiDK.png\" alt=\"bfRiDK.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h3 id=\"å¸¸è§æ¦‚å¿µ\">å¸¸è§æ¦‚å¿µ<a title=\"#å¸¸è§æ¦‚å¿µ\" href=\"#å¸¸è§æ¦‚å¿µ\"></a></h3>\n<ul>\n<li>è¿æ¥ç‚¹(<em>Joinpoint</em>)\n<ul>\n<li>ç¨‹åºä¸­å¯èƒ½ä½œä¸ºä»£ç æ³¨å…¥ç›®æ ‡çš„ç‰¹å®šçš„ç‚¹ï¼Œä¾‹å¦‚ä¸€ä¸ªæ–¹æ³•è°ƒç”¨æˆ–è€…æ–¹æ³•å…¥å£ã€‚</li>\n</ul>\n</li>\n<li>åˆ‡ç‚¹ï¼ˆ<em>Pointcut</em>ï¼‰\n<ul>\n<li>å‘Šè¯‰ä»£ç æ³¨å…¥å·¥å…·ï¼Œåœ¨ä»»ä½•æ³¨å…¥ä¸€æ®µç‰¹å®šä»£ç çš„è¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨å“ªäº›joint pointsåº”ç”¨ä¸€ä¸ªç‰¹å®šçš„Adviceã€‚</li>\n<li>åˆ‡å…¥ç‚¹å¯ä»¥é€‰æ‹©å”¯ä¸€ä¸€ä¸ªï¼Œæ¯”å¦‚æ‰§è¡ŒæŸä¸€ä¸ªæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æœ‰å¤šä¸ªé€‰æ‹©ï¼Œæ¯”å¦‚ï¼Œæ ‡è®°äº†ä¸€ä¸ªå®šä¹‰æˆ@DebugLogçš„è‡ªå®šä¹‰æ³¨è§£çš„æ‰€æœ‰æ–¹æ³•ã€‚</li>\n</ul>\n</li>\n<li>å¢å¼ºï¼ˆ<em>Advice</em>ï¼‰\n<ul>\n<li>æ³¨å…¥åˆ°classæ–‡ä»¶ä¸­çš„ä»£ç ã€‚</li>\n<li>å…¸å‹çš„Adviceç±»å‹æœ‰beforeã€afterå’Œaroundï¼Œåˆ†åˆ«è¡¨ç¤ºåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰ã€æ‰§è¡Œåå’Œå®Œå…¨ä»£æ›¿ç›®æ ‡æ–¹æ³•æ‰§è¡Œçš„ä»£ç ã€‚</li>\n</ul>\n</li>\n<li>ç›®æ ‡å¯¹è±¡ (<em>Target</em>)</li>\n<li>å¼•ä»‹(<em>Introduction</em>)</li>\n<li>ç»‡å…¥ï¼ˆ<em>Weaving</em>ï¼‰\n<ul>\n<li>æ³¨å…¥ä»£ç ï¼ˆadvicesï¼‰åˆ°ç›®æ ‡ä½ç½®ï¼ˆjoint pointsï¼‰çš„è¿‡ç¨‹</li>\n</ul>\n</li>\n<li>ä»£ç†ï¼ˆ<em>Proxy</em>ï¼‰</li>\n<li>åˆ‡é¢ï¼ˆ<em>Aspect</em>ï¼‰\n<ul>\n<li>Pointcutå’ŒAdviceçš„ç»„åˆçœ‹åšåˆ‡é¢ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨åº”ç”¨ä¸­é€šè¿‡å®šä¹‰ä¸€ä¸ªPointcutå’Œç»™å®šæ°å½“çš„Adviceï¼Œæ·»åŠ ä¸€ä¸ªæ—¥å¿—åˆ‡é¢</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"åˆ†ç±»\">åˆ†ç±»<a title=\"#åˆ†ç±»\" href=\"#åˆ†ç±»\"></a></h3>\n<blockquote>\n<p>ä¸€ç±»æ˜¯ï¼Œä¾‹å¦‚Javaçš„åŠ¨æ€ä»£ç†ï¼›å¦ä¸€ç±»å¯ä»¥å½’ç»“ä¸ºï¼Œä¾‹å¦‚ç»å¸¸å¬è¯´çš„ï¼ŒAspecJç­‰æ¡†æ¶</p>\n</blockquote>\n<ul>\n<li>è¿è¡ŒæœŸçš„AOP\n<ul>\n<li>Javaçš„åŠ¨æ€ä»£ç†</li>\n</ul>\n</li>\n<li>ç¼–è¯‘æœŸçš„AOP\n<ul>\n<li>ASM</li>\n<li>AspecJ</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"åº”ç”¨\">åº”ç”¨<a title=\"#åº”ç”¨\" href=\"#åº”ç”¨\"></a></h3>\n<ul>\n<li>Hot Fix\n<ul>\n<li>åŸºäºAOPæŠ€æœ¯ï¼Œç¼–è¯‘æœŸä¿®æ”¹Javaå­—èŠ‚ç ï¼Œå¯¹æ¯ä¸€ä¸ªæ–¹æ³•è¿›è¡Œæ’æ¡©æ“ä½œï¼Œä»¥ä¾¿äºhookæ¯ä¸€ä¸ªæ–¹æ³•ï¼Œåšåˆ°æ–¹æ³•çº§åˆ«çš„çƒ­ä¿®å¤</li>\n</ul>\n</li>\n<li>ç›‘æµ‹æ–¹æ³•è€—æ—¶</li>\n<li>æ—¥å¿—è®°å½•</li>\n<li>ç»Ÿä¸€å¤„ç†ç‚¹å‡»æŠ–åŠ¨</li>\n<li>å…¶ä»–çš„ç›‘æ§æ–¹é¢</li>\n</ul>\n<h3 id=\"aopä¸aptåŒºåˆ«\">AOPä¸APTåŒºåˆ«<a title=\"#aopä¸aptåŒºåˆ«\" href=\"#aopä¸aptåŒºåˆ«\"></a></h3>\n<p>APT(Annotation Processing Tool)å³æ³¨è§£å¤„ç†å™¨ï¼Œæ˜¯ä¸€ç§å¤„ç†æ³¨è§£çš„å·¥å…·ï¼Œç¡®åˆ‡çš„è¯´å®ƒæ˜¯javacçš„ä¸€ä¸ªå·¥å…·ï¼Œå®ƒç”¨æ¥åœ¨ç¼–è¯‘æ—¶æ‰«æå’Œå¤„ç†æ³¨è§£ã€‚æ³¨è§£å¤„ç†å™¨ä»¥Javaä»£ç (æˆ–è€…ç¼–è¯‘è¿‡çš„å­—èŠ‚ç )ä½œä¸ºè¾“å…¥ï¼Œç”Ÿæˆ<code>.javaæ–‡ä»¶</code>ä½œä¸ºè¾“å‡ºã€‚</p>\n<ul>\n<li>APTæ˜¯åœ¨ç¼–è¯‘æœŸï¼Œé€šè¿‡æ³¨è§£ç”Ÿæˆ<code>java</code>æ–‡ä»¶ï¼Œç„¶å.javaæ–‡ä»¶ä»ç„¶éœ€è¦è¿›ä¸€æ­¥ç¼–è¯‘ç”Ÿæˆ<code>.class</code>æ–‡ä»¶</li>\n<li>AOPæ˜¯åœ¨ç¼–è¯‘å®Œæˆåç›´æ¥é€šè¿‡ä¿®æ”¹<code>.class</code>æ–‡ä»¶ï¼Œæ·»åŠ æˆ–è€…ä¿®æ”¹ä»£ç é€»è¾‘</li>\n</ul>\n<h3 id=\"refer\">Refer<a title=\"#refer\" href=\"#refer\"></a></h3>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzUxODg0MzU2OQ==&amp;mid=2247483887&amp;idx=1&amp;sn=d54e3f210a4f31f477dba06c3dcd352e&amp;scene=21#wechat_redirect\" target=\"_blank\">AOPæŠ€æœ¯åœ¨å®¢æˆ·ç«¯çš„åº”ç”¨ä¸å®è·µ</a></p>\n",
            "tags": [
                "AOP"
            ]
        },
        {
            "id": "https://onion99.github.io/2022/03/09/wkROkqAosRBXidma/",
            "url": "https://onion99.github.io/2022/03/09/wkROkqAosRBXidma/",
            "title": "Android-åŠ¨æ€åŒ–æ–¹æ¡ˆæ¢ç´¢",
            "date_published": "2022-03-09T09:21:31.000Z",
            "content_html": "<p><img src=\"https://pic3.zhimg.com/80/v2-7179de6b1bfe62fa7aa3c93d5948509a_720w.jpg\" alt=\"\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>å¼€æºæ–¹æ¡ˆï¼š<br>\n<a href=\"https://github.com/alibaba/vlayout\" target=\"_blank\">alibaba/vlayout: Project vlayout is a powerfull LayoutManager extension for RecyclerView, it provides a group of layouts for RecyclerView. Make it able to handle a complicate situation when grid, list and other layouts in the same recyclerview</a></p>\n<p><a href=\"https://github.com/alibaba/tangram-android\" target=\"_blank\">alibaba/Tangram-Android: Tangram is a modular UI solution for building native page dynamically including Tangram for Android, Tangram for iOS and even backend CMS. This project provides the sdk on Android</a></p>\n",
            "tags": []
        },
        {
            "id": "https://onion99.github.io/2022/03/08/r2WB7zoGFwDaiwmB/",
            "url": "https://onion99.github.io/2022/03/08/r2WB7zoGFwDaiwmB/",
            "title": "Android - ç»„ä»¶åŒ–",
            "date_published": "2022-03-08T09:17:11.000Z",
            "content_html": "<blockquote>\n<p>ç»„ä»¶æ˜¯å¯æ‹†é™¤çš„å°±è¡¨ç¤ºç»„ä»¶ä¸ç»„ä»¶ä¹‹é—´æ˜¯ä¸ä¼šè€¦åˆçš„ã€‚ ç»„ä»¶åŒ–å°±æ˜¯éœ€è¦å»æ‹†åˆ†å‡ºç»„ä»¶å’Œå®ç°ç»„ä»¶ä¹‹é—´é€šä¿¡çš„è¿‡ç¨‹</p>\n</blockquote>\n<p>é¡¹ç›®å‘å±•åˆ°ä¸€å®šç¨‹åº¦ï¼Œéšç€äººå‘˜çš„å¢å¤šï¼Œä»£ç è¶Šæ¥è¶Šè‡ƒè‚¿ï¼Œè¿™æ—¶å€™å°±å¿…é¡»è¿›è¡Œæ¨¡å—åŒ–çš„æ‹†åˆ†ã€‚æ¨¡å—åŒ–æ˜¯ä¸€ç§æŒ‡å¯¼ç†å¿µï¼Œå…¶æ ¸å¿ƒæ€æƒ³å°±æ˜¯åˆ†è€Œæ²»ä¹‹ã€é™ä½è€¦åˆæœ€ç»ˆç›®çš„æ–¹ä¾¿é¡¹ç›®å¼€å‘æ›´åŠ æµç•…ï¼Œåˆ†å·¥æ›´åŠ æ˜ç¡®ã€‚åŒæ—¶ä¸šåŠ¡çº¿åªéœ€è¦ä¾èµ–è‡ªå·±çš„æ¨¡å—æ— éœ€å¼•å…¥å…¶ä»–ä¸šåŠ¡æ¨¡å—ä»è€Œå¯ä»¥åŠ å¿«ç¼–è¯‘é€Ÿåº¦</p>\n<span id=\"more\"></span>\n<h3 id=\"ç»„ä»¶æ‹†åˆ†\">ç»„ä»¶æ‹†åˆ†<a title=\"#ç»„ä»¶æ‹†åˆ†\" href=\"#ç»„ä»¶æ‹†åˆ†\"></a></h3>\n<p><img src=\"https://s1.ax1x.com/2022/03/09/bWG2b8.png\" alt=\"bWG2b8.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h3 id=\"å®ç°ç»„ä»¶åŒ–\">å®ç°ç»„ä»¶åŒ–<a title=\"#å®ç°ç»„ä»¶åŒ–\" href=\"#å®ç°ç»„ä»¶åŒ–\"></a></h3>\n<blockquote>\n<p>æ ¸å¿ƒå³æ˜¯<strong>è·¯ç”±</strong>ï¼Œ<strong>åå°„</strong>ï¼Œ<strong>é€šä¿¡åè®®</strong></p>\n</blockquote>\n<p>ç»„ä»¶ä¹‹é—´æ²¡æœ‰ä¾èµ–å…³ç³»æ‰€ä»¥ç»„ä»¶å‘å¤–æš´éœ²çš„æ–¹æ³•è¦è¿›è¡Œæ³¨å†Œï¼Œæˆ‘ä»¬é€šè¿‡æˆ‘ä»¬èµ·çš„åˆ«åå»å¯»æ‰¾ä»–ï¼Œè¿™å°±æ˜¯è·¯ç”±çš„è¿‡ ç¨‹ï¼Œç„¶åé€šè¿‡åå°„å»å®ä¾‹åŒ–ï¼Œé€šè¿‡é€šä¿¡åè®®ä¸ç»„ä»¶äº¤äº’ã€‚</p>\n<p>ç»„ä»¶åŒ–é€šä¿¡ä¸€å®šè¦æœ‰ç»Ÿä¸€çš„åè®®å»çº¦æŸï¼Œä¸ç„¶å³ä½¿æ‰¾åˆ°äº†ç›®æ ‡å¯¹è±¡ä½†æ˜¯ä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨ä¹Ÿæ˜¯æ— æµäºäº‹çš„ã€‚ æˆ‘ä»¬éœ€è¦æ˜ç¡®ä¸€ç‚¹ç»„ä»¶éœ€è¦å‘å¤–æš´éœ²ä»€ä¹ˆä¸œè¥¿å‘¢?</p>\n<ul>\n<li>ä¸€ä¸ªæ˜¯ç»„ä»¶æä¾›çš„Activity/Fragmentè·¯ç”±</li>\n<li>ä¸€ä¸ªæ˜¯ç»„ä»¶æä¾›çš„ä¸€äº›æœåŠ¡æ–¹æ³•ï¼Œå¦‚å®šä½åº“æä¾›å®šä½ä¿¡æ¯è·å–</li>\n</ul>\n<p>å¼€æºæ–¹æ¡ˆï¼š<a href=\"https://github.com/alibaba/ARouter\" target=\"_blank\">alibaba/ARouter: ğŸ’ª A framework for assisting in the renovation of Android componentization (å¸®åŠ© Android App è¿›è¡Œç»„ä»¶åŒ–æ”¹é€ çš„è·¯ç”±æ¡†æ¶)</a></p>\n<h3 id=\"æ–‡ç« æ¥æº\">æ–‡ç« æ¥æº<a title=\"#æ–‡ç« æ¥æº\" href=\"#æ–‡ç« æ¥æº\"></a></h3>\n<p><a href=\"https://zhuanlan.zhihu.com/p/365501317\" target=\"_blank\">è€ç”Ÿå¸¸è°ˆï¼šç»„ä»¶åŒ– - çŸ¥ä¹ (zhihu.com)</a></p>\n",
            "tags": []
        },
        {
            "id": "https://onion99.github.io/2022/03/08/yriIudTcpjYyMHli/",
            "url": "https://onion99.github.io/2022/03/08/yriIudTcpjYyMHli/",
            "title": "Androidé»‘ç§‘æŠ€ - æ’ä»¶åŒ–",
            "date_published": "2022-03-07T22:46:11.000Z",
            "content_html": "<p>æ’ä»¶åŒ–æŠ€æœ¯æœ€åˆæºäºå…å®‰è£…è¿è¡Œapkçš„æƒ³æ³•ï¼Œè¿™ä¸ªå…å®‰è£…çš„apkå¯ä»¥ç†è§£ä¸ºæ’ä»¶ã€‚æ”¯æŒæ’ä»¶åŒ–çš„appå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ è½½å’Œè¿è¡Œæ’ä»¶ï¼Œè¿™æ ·ä¾¿å¯ä»¥å°†appä¸­ä¸€äº›ä¸å¸¸ç”¨çš„åŠŸèƒ½æ¨¡å—åšæˆæ’ä»¶ï¼Œä¸€æ–¹é¢å‡å°äº†å®‰è£…åŒ…çš„å¤§å°ï¼Œå¦ä¸€æ–¹é¢å¯ä»¥å®ç°appåŠŸèƒ½çš„åŠ¨æ€æ‰©å±•ã€‚</p>\n<p>æƒ³è¦å®ç°æ’ä»¶åŒ–ï¼Œä¸»è¦æ˜¯è§£å†³ä¸‹é¢ä¸‰ä¸ªé—®é¢˜ï¼š</p>\n<ul>\n<li>æ’ä»¶ä¸­ä»£ç çš„åŠ è½½å’Œä¸ä¸»å·¥ç¨‹çš„äº’ç›¸è°ƒç”¨</li>\n<li>æ’ä»¶ä¸­èµ„æºçš„åŠ è½½å’Œä¸ä¸»å·¥ç¨‹çš„äº’ç›¸è®¿é—®</li>\n<li>å››å¤§ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†</li>\n</ul>\n<span id=\"more\"></span>\n<h3 id=\"æ’ä»¶åŒ–å‘å±•\">æ’ä»¶åŒ–å‘å±•<a title=\"#æ’ä»¶åŒ–å‘å±•\" href=\"#æ’ä»¶åŒ–å‘å±•\"></a></h3>\n<p><img src=\"https://s1.ax1x.com/2022/03/07/byn21s.png\" alt=\"byn21s.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p><strong>ç¬¬ä¸€ä»£</strong>ï¼šdynamic-load-apkæœ€æ—©ä½¿ç”¨ProxyActivityè¿™ç§é™æ€ä»£ç†æŠ€æœ¯ï¼Œç”±ProxyActivityå»æ§åˆ¶æ’ä»¶ä¸­PluginActivityçš„ç”Ÿå‘½å‘¨æœŸã€‚è¯¥ç§æ–¹å¼ç¼ºç‚¹æ˜æ˜¾ï¼Œæ’ä»¶ä¸­çš„activityå¿…é¡»ç»§æ‰¿PluginActivityï¼Œå¼€å‘æ—¶è¦å°å¿ƒå¤„ç†contextã€‚è€ŒDroidPluginé€šè¿‡Hookç³»ç»ŸæœåŠ¡çš„æ–¹å¼å¯åŠ¨æ’ä»¶ä¸­çš„Activityï¼Œä½¿å¾—å¼€å‘æ’ä»¶çš„è¿‡ç¨‹å’Œå¼€å‘æ™®é€šçš„appæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä½†æ˜¯ç”±äºhookè¿‡å¤šç³»ç»ŸæœåŠ¡ï¼Œå¼‚å¸¸å¤æ‚ä¸”ä¸å¤Ÿç¨³å®šã€‚</p>\n<p><strong>ç¬¬äºŒä»£</strong>ï¼šä¸ºäº†åŒæ—¶è¾¾åˆ°æ’ä»¶å¼€å‘çš„ä½ä¾µå…¥æ€§ï¼ˆåƒå¼€å‘æ™®é€šappä¸€æ ·å¼€å‘æ’ä»¶ï¼‰å’Œæ¡†æ¶çš„ç¨³å®šæ€§ï¼Œåœ¨å®ç°åŸç†ä¸Šéƒ½æ˜¯è¶‹è¿‘äºé€‰æ‹©å°½é‡å°‘çš„hookï¼Œå¹¶é€šè¿‡åœ¨manifestä¸­é¢„åŸ‹ä¸€äº›ç»„ä»¶å®ç°å¯¹å››å¤§ç»„ä»¶çš„æ’ä»¶åŒ–ã€‚å¦å¤–å„ä¸ªæ¡†æ¶æ ¹æ®å…¶è®¾è®¡æ€æƒ³éƒ½åšäº†ä¸åŒç¨‹åº¦çš„æ‰©å±•ï¼Œå…¶ä¸­Smallæ›´æ˜¯åšæˆäº†ä¸€ä¸ªè·¨å¹³å°ï¼Œç»„ä»¶åŒ–çš„å¼€å‘æ¡†æ¶ã€‚</p>\n<p><strong>ç¬¬ä¸‰ä»£</strong>ï¼šVirtualAppæ¯”è¾ƒå‰å®³ï¼Œèƒ½å¤Ÿå®Œå…¨æ¨¡æ‹Ÿappçš„è¿è¡Œç¯å¢ƒï¼Œèƒ½å¤Ÿå®ç°appçš„å…å®‰è£…è¿è¡Œå’ŒåŒå¼€æŠ€æœ¯ã€‚Atlasæ˜¯é˜¿é‡Œä»Šå¹´å¼€æºå‡ºæ¥çš„ä¸€ä¸ªç»“åˆç»„ä»¶åŒ–å’Œçƒ­ä¿®å¤æŠ€æœ¯çš„ä¸€ä¸ªappåŸºç¡€æ¡†æ¶ï¼Œå…¶å¹¿æ³›çš„åº”ç”¨ä¸é˜¿é‡Œç³»çš„å„ä¸ªappï¼Œå…¶å·ç§°æ˜¯ä¸€ä¸ªå®¹å™¨åŒ–æ¡†æ¶</p>\n<h3 id=\"æ’ä»¶åŒ–æ–¹æ¡ˆ\">æ’ä»¶åŒ–æ–¹æ¡ˆ<a title=\"#æ’ä»¶åŒ–æ–¹æ¡ˆ\" href=\"#æ’ä»¶åŒ–æ–¹æ¡ˆ\"></a></h3>\n<h4 id=\"é™æ€æ–¹æ¡ˆ-é€šè¿‡proxyactivityç»Ÿä¸€åŠ è½½æ’ä»¶ä¸­çš„æ‰€æœ‰activityï¼Œä»¥thatæ¡†æ¶ä¸ºä»£è¡¨\">é™æ€æ–¹æ¡ˆ-é€šè¿‡ProxyActivityç»Ÿä¸€åŠ è½½æ’ä»¶ä¸­çš„æ‰€æœ‰Activityï¼Œä»¥thatæ¡†æ¶ä¸ºä»£è¡¨<a title=\"#é™æ€æ–¹æ¡ˆ-é€šè¿‡proxyactivityç»Ÿä¸€åŠ è½½æ’ä»¶ä¸­çš„æ‰€æœ‰activityï¼Œä»¥thatæ¡†æ¶ä¸ºä»£è¡¨\" href=\"#é™æ€æ–¹æ¡ˆ-é€šè¿‡proxyactivityç»Ÿä¸€åŠ è½½æ’ä»¶ä¸­çš„æ‰€æœ‰activityï¼Œä»¥thatæ¡†æ¶ä¸ºä»£è¡¨\"></a></h4>\n<blockquote>\n<p>ProxyActivityä»£ç†çš„æ–¹å¼æœ€æ—©æ˜¯ç”±dynamic-load-apkæå‡ºçš„ï¼Œå…¶æ€æƒ³å¾ˆç®€å•ï¼Œåœ¨ä¸»å·¥ç¨‹ä¸­æ”¾ä¸€ä¸ªProxyActivyï¼Œå¯åŠ¨æ’ä»¶ä¸­çš„Activityæ—¶ä¼šå…ˆå¯åŠ¨ProxyActivityï¼Œåœ¨ProxyActivityä¸­åˆ›å»ºæ’ä»¶Activityï¼Œå¹¶åŒæ­¥ç”Ÿå‘½å‘¨æœŸ</p>\n</blockquote>\n<p><img src=\"https://s1.ax1x.com/2022/03/07/byKLex.png\" alt=\"byKLex.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h5 id=\"æµç¨‹:\">æµç¨‹:<a title=\"#æµç¨‹:\" href=\"#æµç¨‹:\"></a></h5>\n<ol>\n<li>é¦–å…ˆéœ€è¦é€šè¿‡ç»Ÿä¸€çš„å…¥å£ï¼ˆå¦‚å›¾ä¸­çš„PluginManagerï¼‰å¯åŠ¨æ’ä»¶Activityï¼Œå…¶å†…éƒ¨ä¼šå°†å¯åŠ¨çš„æ’ä»¶Activityä¿¡æ¯ä¿å­˜ä¸‹æ¥ï¼Œå¹¶å°†intentæ›¿æ¢ä¸ºå¯åŠ¨ProxyActivityçš„intentã€‚</li>\n<li>ProxyActivityæ ¹æ®æ’ä»¶çš„ä¿¡æ¯æ‹¿åˆ°è¯¥æ’ä»¶çš„ClassLoaderå’ŒResourceï¼Œé€šè¿‡åå°„åˆ›å»ºPluginActivityå¹¶è°ƒç”¨å…¶onCreateæ–¹æ³•ã€‚</li>\n<li>PluginActivtyè°ƒç”¨çš„setContentViewè¢«é‡å†™äº†ï¼Œä¼šå»è°ƒç”¨ProxyActivtyçš„setContentViewã€‚ç”±äºProxyActivityé‡å†™äº†getResourceè¿”å›çš„æ˜¯æ’ä»¶çš„Resourceï¼Œæ‰€ä»¥setContentViewèƒ½å¤Ÿè®¿é—®åˆ°æ’ä»¶ä¸­çš„èµ„æºã€‚åŒæ ·findViewByIdä¹Ÿæ˜¯è°ƒç”¨ProxyActivityçš„ã€‚</li>\n<li>ProxyActivityä¸­çš„å…¶ä»–ç”Ÿå‘½å‘¨æœŸå›è°ƒå‡½æ•°ä¸­è°ƒç”¨ç›¸åº”PluginActivityçš„ç”Ÿå‘½å‘¨æœŸ</li>\n</ol>\n<h5 id=\"å®ç°\">å®ç°<a title=\"#å®ç°\" href=\"#å®ç°\"></a></h5>\n<p>æ¨¡æ‹ŸActivtyåŸºæœ¬å®ç°:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ProxyActivityInterface</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//ç”Ÿå‘½å‘¨æœŸçš„activity</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">attach</span><span class=\"params\">(Activity proxyActivity)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(Bundle savedInstanceState)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onStart</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onResume</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onPause</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onStop</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onDestroy</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onSaveInstanceState</span><span class=\"params\">(Bundle outState)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onTouchEvent</span><span class=\"params\">(MotionEvent event)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onBackPressed</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ’ä»¶BaseActivtyç±»:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// è¿™æ˜¯æ’ä»¶çš„åŸºç±»ï¼Œæ‰€æœ‰çš„activityéƒ½è¦ç»§æ‰¿è¿™ä¸ªç±»ï¼Œ</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BaseActivity</span> <span class=\"keyword\">extends</span> <span class=\"title\">Activity</span> <span class=\"keyword\">implements</span> <span class=\"title\">ProxyActivityInterface</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> Activity that;<span class=\"comment\">//è¿™é‡Œçš„that æŒ‡çš„æ˜¯æˆ‘ä»¬çš„å®¿ä¸»appï¼Œå› ä¸ºæ’ä»¶æ˜¯æ²¡æœ‰å®‰è£…çš„ æ˜¯æ²¡æœ‰ä¸Šä¸‹æ–‡çš„</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">attach</span><span class=\"params\">(Activity proxyActivity)</span> </span>&#123;</span><br><span class=\"line\">        that = proxyActivity;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setContentView</span><span class=\"params\">(View view)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//å¯ä»¥çœ‹åˆ°,æœ€ç»ˆè°ƒç”¨ä¸»App(å®¿ä¸»)çš„activity å‡½æ•°</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (that != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            that.setContentView(view);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">super</span>.setContentView(view);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setContentView</span><span class=\"params\">(<span class=\"keyword\">int</span> layoutResID)</span> </span>&#123;</span><br><span class=\"line\">        that.setContentView(layoutResID);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> View <span class=\"title\">findViewById</span><span class=\"params\">(<span class=\"keyword\">int</span> id)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> that.findViewById(id);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Intent <span class=\"title\">getIntent</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (that != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> that.getIntent();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">super</span>.getIntent();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ClassLoader <span class=\"title\">getClassLoader</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> that.getClassLoader();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@NonNull</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> LayoutInflater <span class=\"title\">getLayoutInflater</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> that.getLayoutInflater();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ApplicationInfo <span class=\"title\">getApplicationInfo</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> that.getApplicationInfo();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Window <span class=\"title\">getWindow</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> that.getWindow();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> WindowManager <span class=\"title\">getWindowManager</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> that.getWindowManager();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">startActivity</span><span class=\"params\">(Intent intent)</span> </span>&#123;</span><br><span class=\"line\"><span class=\"comment\">//        ProxyActivity ---&gt;className</span></span><br><span class=\"line\">        Intent m = <span class=\"keyword\">new</span> Intent();</span><br><span class=\"line\">        m.putExtra(<span class=\"string\">&quot;ClassName&quot;</span>, intent.getComponent().getClassName());</span><br><span class=\"line\">        that.startActivity(m);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(Bundle savedInstanceState)</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onStart</span><span class=\"params\">()</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onResume</span><span class=\"params\">()</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onPause</span><span class=\"params\">()</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onStop</span><span class=\"params\">()</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onDestroy</span><span class=\"params\">()</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onSaveInstanceState</span><span class=\"params\">(Bundle outState)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>\n<p>æ’ä»¶ProxyActivity(): ä¸»è¦é€šè¿‡è¿™ä¸ªå» New ä¸€ä¸ªActivity æ¥æ¨¡æ‹ŸåŸç”ŸActivityç®¡ç†</p>\n<blockquote>\n<p>æ’ä»¶å†…éƒ¨çš„è·³è½¬å…¶å®ä¹Ÿå°±æ˜¯åœ¨å¼€åŒä¸€ä¸ªactivity</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProxyActivity</span> <span class=\"keyword\">extends</span> <span class=\"title\">AppCompatActivity</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ProxyActivityInterface pluginObj;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState);</span><br><span class=\"line\">        <span class=\"comment\">//åœ¨è¿™é‡Œæ‹¿åˆ°äº†çœŸå®è·³è½¬çš„activity æ‹¿å‡ºæ¥ å†å»å¯åŠ¨çœŸå®çš„activity</span></span><br><span class=\"line\"></span><br><span class=\"line\">        String className = getIntent().getStringExtra(<span class=\"string\">&quot;ClassName&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//é€šè¿‡åå°„åœ¨å»å¯åŠ¨ä¸€ä¸ªçœŸå®çš„activity æ‹¿åˆ°Classå¯¹è±¡</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Class&lt;?&gt; plugClass = getClassLoader().loadClass(className);</span><br><span class=\"line\">            Constructor&lt;?&gt; pluginConstructor = plugClass.getConstructor(<span class=\"keyword\">new</span> Class[]&#123;&#125;);</span><br><span class=\"line\">            <span class=\"comment\">//å› ä¸ºæ’ä»¶çš„activityå®ç°äº†æˆ‘ä»¬çš„æ ‡å‡†</span></span><br><span class=\"line\">            pluginObj = (ProxyActivityInterface) pluginConstructor.newInstance(<span class=\"keyword\">new</span> Object[]&#123;&#125;);</span><br><span class=\"line\">            pluginObj.attach(<span class=\"keyword\">this</span>);<span class=\"comment\">//æ³¨å…¥ä¸Šä¸‹æ–‡</span></span><br><span class=\"line\">            pluginObj.onCreate(<span class=\"keyword\">new</span> Bundle());<span class=\"comment\">//ä¸€å®šè¦è°ƒç”¨onCreate </span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (e.getClass().getSimpleName() .equals(<span class=\"string\">&quot;ClassCastException&quot;</span>))&#123;</span><br><span class=\"line\">                <span class=\"comment\">//æˆ‘è¿™é‡Œæ˜¯ç›´æ¥æ‹¿åˆ°å¼‚å¸¸åˆ¤æ–­çš„ ï¼Œä¹Ÿå¯çš„ æ‹¿åˆ°ä¸Šé¢çš„plugClasså¯¹è±¡åˆ¤æ–­æœ‰æ²¡æœ‰å®ç°æˆ‘ä»¬çš„æ¥å£</span></span><br><span class=\"line\">                finish();</span><br><span class=\"line\">                Toast.makeText(<span class=\"keyword\">this</span>,<span class=\"string\">&quot;éæ³•é¡µé¢&quot;</span>,Toast.LENGTH_LONG).show();</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\">    <span class=\"comment\">//ä¸ºä»€ä¹ˆè¦é‡å†™è¿™ä¸ªå‘¢ å› ä¸ºè¿™ä¸ªæ˜¯æ’ä»¶å†…éƒ¨startactivityè°ƒç”¨çš„ å°†çœŸæ­£è¦å¼€å¯çš„activityçš„ç±»åç©¿è¿‡æ¥</span></span><br><span class=\"line\">    <span class=\"comment\">//ç„¶åå–å‡ºæ¥ï¼Œå¯åŠ¨æˆ‘ä»¬çš„å å‘çš„activity åœ¨æˆ‘ä»¬çœŸæ­£è¦å¯åŠ¨çš„èµ›è¿›å»</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">startActivity</span><span class=\"params\">(Intent intent)</span> </span>&#123;</span><br><span class=\"line\">        String className1=intent.getStringExtra(<span class=\"string\">&quot;ClassName&quot;</span>);</span><br><span class=\"line\">        Intent intent1 = <span class=\"keyword\">new</span> Intent(<span class=\"keyword\">this</span>, ProxyActivity.class);</span><br><span class=\"line\">        intent1.putExtra(<span class=\"string\">&quot;ClassName&quot;</span>, className1);</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.startActivity(intent1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//é‡å†™classLoader</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ClassLoader <span class=\"title\">getClassLoader</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> HookManager.getInstance().getClassLoader();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//é‡å†™Resource</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Resources <span class=\"title\">getResources</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> HookManager.getInstance().getResource();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onStart</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onStart();</span><br><span class=\"line\">        pluginObj.onStart();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onDestroy</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onDestroy();</span><br><span class=\"line\">        pluginObj.onDestroy();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onPause</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onPause();</span><br><span class=\"line\">        pluginObj.onPause();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ’ä»¶apkå’Œèµ„æºåŠ è½½å¤„ç†-Hookmanager:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HookManager</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> HookManager ourInstance = <span class=\"keyword\">new</span> HookManager();</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Resources resources;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> DexClassLoader loader;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> PackageInfo packageInfo;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> HookManager <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ourInstance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">HookManager</span><span class=\"params\">()</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¤åˆ¶æ’ä»¶åˆ°ç¼“å­˜ç›®å½•,æ–¹ä¾¿åŠ è½½</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">loadPlugin</span><span class=\"params\">(Activity activity)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// å‡å¦‚è¿™é‡Œæ˜¯ä»ç½‘ç»œè·å–çš„æ’ä»¶ æˆ‘ä»¬ç›´æ¥ä»sdå¡è·å– ç„¶åè¯»å–åˆ°æˆ‘ä»¬çš„cacheç›®å½•</span></span><br><span class=\"line\">        String pluginName = <span class=\"string\">&quot;plugin.apk&quot;</span>;</span><br><span class=\"line\">        File filesDir = activity.getDir(<span class=\"string\">&quot;plugin&quot;</span>, activity.MODE_PRIVATE);</span><br><span class=\"line\">        String filePath = <span class=\"keyword\">new</span> File(filesDir, pluginName).getAbsolutePath();</span><br><span class=\"line\">        File file = <span class=\"keyword\">new</span> File(filePath);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (file.exists()) &#123;</span><br><span class=\"line\">            file.delete();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        FileInputStream is = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        FileOutputStream os = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"comment\">//è¯»å–çš„ç›®å½•</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            is = <span class=\"keyword\">new</span> FileInputStream(<span class=\"keyword\">new</span> File(Environment.getExternalStorageDirectory(), pluginName));</span><br><span class=\"line\">            <span class=\"comment\">//è¦è¾“å…¥çš„ç›®å½•</span></span><br><span class=\"line\">            os = <span class=\"keyword\">new</span> FileOutputStream(filePath);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (FileNotFoundException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> len = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">byte</span>[] buffer = <span class=\"keyword\">new</span> <span class=\"keyword\">byte</span>[<span class=\"number\">1024</span>];</span><br><span class=\"line\">            <span class=\"keyword\">while</span> ((len = is.read(buffer)) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                os.write(buffer, <span class=\"number\">0</span>, len);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            File f = <span class=\"keyword\">new</span> File(filePath);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (f.exists()) &#123;</span><br><span class=\"line\">                Toast.makeText(activity, <span class=\"string\">&quot;dex overwrite&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            loadPathToPlugin(activity);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// TODO Auto-generated catch block</span></span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                os.close();</span><br><span class=\"line\">                is.close();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// TODO Auto-generated catch block</span></span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">loadPathToPlugin</span><span class=\"params\">(Activity activity)</span> </span>&#123;</span><br><span class=\"line\">        File filesDir = activity.getDir(<span class=\"string\">&quot;plugin&quot;</span>, activity.MODE_PRIVATE);</span><br><span class=\"line\">        String name = <span class=\"string\">&quot;plugin.apk&quot;</span>;</span><br><span class=\"line\">        String path = <span class=\"keyword\">new</span> File(filesDir, name).getAbsolutePath();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//ç„¶åæˆ‘ä»¬å¼€å§‹åŠ è½½æˆ‘ä»¬çš„apk ä½¿ç”¨DexClassLoader</span></span><br><span class=\"line\">        File dexOutDir = activity.getDir(<span class=\"string\">&quot;dex&quot;</span>, activity.MODE_PRIVATE);</span><br><span class=\"line\">        loader = <span class=\"keyword\">new</span> DexClassLoader(path, dexOutDir.getAbsolutePath(), <span class=\"keyword\">null</span>, activity.getClassLoader());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//é€šè¿‡PackAgemanager æ¥è·å–æ’ä»¶çš„ç¬¬ä¸€ä¸ªactivityæ˜¯å“ªä¸€ä¸ª</span></span><br><span class=\"line\">        PackageManager packageManager = activity.getPackageManager();</span><br><span class=\"line\">        packageInfo = packageManager.getPackageArchiveInfo(path, PackageManager.GET_ACTIVITIES);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//ç„¶åå¼€å§‹åŠ è½½æˆ‘ä»¬çš„èµ„æº è‚¯å®šè¦ä½¿ç”¨Resource ä½†æ˜¯å®ƒæ˜¯AssetManageråˆ›å»ºå‡ºæ¥çš„ å°±æ˜¯AssertManager æœ‰ä¸€ä¸ªaddAssertPath è¿™ä¸ªæ–¹æ³• ä½†æ˜¯ç§æœ‰çš„ æ‰€æœ‰ä½¿ç”¨åå°„</span></span><br><span class=\"line\">        Class&lt;?&gt; assetManagerClass = AssetManager.class;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            AssetManager assertManagerObj = (AssetManager) assetManagerClass.newInstance();</span><br><span class=\"line\">            Method addAssetPathMethod = assetManagerClass.getMethod(<span class=\"string\">&quot;addAssetPath&quot;</span>, String.class);</span><br><span class=\"line\">            addAssetPathMethod.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">            addAssetPathMethod.invoke(assertManagerObj, path);</span><br><span class=\"line\">            <span class=\"comment\">//åœ¨åˆ›å»ºä¸€ä¸ªResource</span></span><br><span class=\"line\">            resources = <span class=\"keyword\">new</span> Resources(assertManagerObj, activity.getResources().getDisplayMetrics(), activity.getResources().getConfiguration());</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//å¯¹å¤–æä¾›æ’ä»¶çš„classLoader</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ClassLoader <span class=\"title\">getClassLoader</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> loader;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//æ’ä»¶ä¸­çš„Resource</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Resources <span class=\"title\">getResource</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> resources;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ç°åœ¨ä¸»Appå¯ä»¥å®ç°æ’ä»¶åŒ–åŠŸèƒ½äº†</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// åŠ è½½å¯¹åº”æ’ä»¶</span></span><br><span class=\"line\">HookManager.getInstance().loadPlugin(<span class=\"keyword\">this</span>)</span><br><span class=\"line\"><span class=\"comment\">// é€šè¿‡è·³åˆ°ProxyActivity æ¥æ¨¡æ‹Ÿå®ç°å¯¹åº”æ’ä»¶Activity</span></span><br><span class=\"line\">Intent intent = <span class=\"keyword\">new</span> Intent(<span class=\"keyword\">this</span>, ProxyActivity.class);<span class=\"comment\">//è¿™é‡Œå°±æ˜¯ä¸€ä¸ªå å‘çš„activity</span></span><br><span class=\"line\"><span class=\"comment\">//è¿™é‡Œæ˜¯æ‹¿åˆ°æˆ‘ä»¬åŠ è½½çš„æ’ä»¶çš„ç¬¬ä¸€ä¸ªactivityçš„å…¨ç±»å</span></span><br><span class=\"line\">intent.putExtra(<span class=\"string\">&quot;ClassName&quot;</span>,HookManager.getInstance().packageInfo.activities[<span class=\"number\">0</span>].name);</span><br><span class=\"line\">startActivity(intent);</span><br></pre></td></tr></table></figure>\n<p>é€šè¿‡è¿™ç§ä»£ç†æ¨¡æ‹Ÿæ–¹å¼ä¹Ÿå¯ä»¥å®ç° Serviceã€BroadcastReceiverã€ContentProviderç»„ä»¶çš„ä»£ç†</p>\n<h5 id=\"é—®é¢˜\">é—®é¢˜<a title=\"#é—®é¢˜\" href=\"#é—®é¢˜\"></a></h5>\n<p>æ³¨æ„äº‹é¡¹ï¼š</p>\n<ul>\n<li>ProxyActivityä¸­éœ€è¦é‡å†™getResoucesï¼ŒgetAssetsï¼ŒgetClassLoaderæ–¹æ³•è¿”å›æ’ä»¶çš„ç›¸åº”å¯¹è±¡ã€‚ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä»¥åŠå’Œç”¨æˆ·äº¤äº’ç›¸å…³å‡½æ•°ï¼Œå¦‚onResumeï¼ŒonStopï¼ŒonBackPressedonï¼ŒKeyUponWindowï¼ŒFocusChangedç­‰éœ€è¦è½¬å‘ç»™æ’ä»¶ã€‚</li>\n<li>PluginActivityä¸­æ‰€æœ‰è°ƒç”¨contextçš„ç›¸å…³çš„æ–¹æ³•ï¼Œå¦‚setContentViewï¼ŒgetLayoutInflaterï¼ŒgetSystemServiceç­‰éƒ½éœ€è¦è°ƒç”¨ProxyActivityçš„ç›¸åº”æ–¹æ³•ã€‚</li>\n</ul>\n<p>ç¼ºç‚¹</p>\n<ul>\n<li>æ’ä»¶ä¸­çš„Activityå¿…é¡»ç»§æ‰¿PluginActivityï¼Œå¼€å‘ä¾µå…¥æ€§å¼ºã€‚</li>\n<li>å¦‚æœæƒ³æ”¯æŒActivityçš„singleTaskï¼ŒsingleInstanceç­‰launchModeæ—¶ï¼Œéœ€è¦è‡ªå·±ç®¡ç†Activityæ ˆï¼Œå®ç°èµ·æ¥å¾ˆç¹çã€‚</li>\n<li>æ’ä»¶ä¸­éœ€è¦å°å¿ƒå¤„ç†Contextï¼Œå®¹æ˜“å‡ºé”™ã€‚</li>\n<li>å¦‚æœæƒ³æŠŠä¹‹å‰çš„æ¨¡å—æ”¹é€ æˆæ’ä»¶éœ€è¦å¾ˆå¤šé¢å¤–çš„å·¥ä½œã€‚</li>\n</ul>\n<p>è¯¥æ–¹å¼è™½ç„¶èƒ½å¤Ÿå¾ˆå¥½çš„å®ç°å¯åŠ¨æ’ä»¶Activityçš„ç›®çš„ï¼Œä½†æ˜¯ç”±äºå¼€å‘å¼ä¾µå…¥æ€§å¾ˆå¼ºï¼Œdynamic-load-apkä¹‹åçš„æ’ä»¶åŒ–æ–¹æ¡ˆå¾ˆå°‘ç»§ç»­ä½¿ç”¨è¯¥æ–¹å¼ï¼Œè€Œæ˜¯é€šè¿‡hookç³»ç»Ÿå¯åŠ¨Activityçš„è¿‡ç¨‹ï¼Œè®©å¯åŠ¨æ’ä»¶ä¸­çš„Activityåƒå¯åŠ¨ä¸»å·¥ç¨‹çš„Activityä¸€æ ·ç®€å•ã€‚</p>\n<h4 id=\"åŠ¨æ€æ›¿æ¢æ–¹æ¡ˆï¼šæä¾›å¯¹androidåº•å±‚çš„å„ç§ç±»è¿›è¡Œhookï¼Œæ¥å®ç°åŠ è½½æ’ä»¶ä¸­çš„å››å¤§ç»„ä»¶ï¼Œä»¥droidpluginæ¡†æ¶ä¸ºä»£è¡¨\">åŠ¨æ€æ›¿æ¢æ–¹æ¡ˆï¼šæä¾›å¯¹Androidåº•å±‚çš„å„ç§ç±»è¿›è¡ŒHookï¼Œæ¥å®ç°åŠ è½½æ’ä»¶ä¸­çš„å››å¤§ç»„ä»¶ï¼Œä»¥DroidPluginæ¡†æ¶ä¸ºä»£è¡¨<a title=\"#åŠ¨æ€æ›¿æ¢æ–¹æ¡ˆï¼šæä¾›å¯¹androidåº•å±‚çš„å„ç§ç±»è¿›è¡Œhookï¼Œæ¥å®ç°åŠ è½½æ’ä»¶ä¸­çš„å››å¤§ç»„ä»¶ï¼Œä»¥droidpluginæ¡†æ¶ä¸ºä»£è¡¨\" href=\"#åŠ¨æ€æ›¿æ¢æ–¹æ¡ˆï¼šæä¾›å¯¹androidåº•å±‚çš„å„ç§ç±»è¿›è¡Œhookï¼Œæ¥å®ç°åŠ è½½æ’ä»¶ä¸­çš„å››å¤§ç»„ä»¶ï¼Œä»¥droidpluginæ¡†æ¶ä¸ºä»£è¡¨\"></a></h4>\n<p>å®ç°æ–¹æ¡ˆ:</p>\n<ul>\n<li>Hook Instrumentå®ç°</li>\n<li>Hook Handlerå®ç°</li>\n</ul>\n<p>ä»£ç Demo:<a href=\"https://github.com/Onion99/AndroidComponentPlugin\" target=\"_blank\">Onion99/AndroidComponentPlugin: Androidä¸Šç®€å•å®ç°å››å¤§ç»„ä»¶çš„æ’ä»¶åŒ–</a><br>\nå‚è€ƒ : <a href=\"https://developer.aliyun.com/article/873723?spm=a2c6h.12883283.0.0.67d543078VqvHa&amp;scm=20140722.ID_873723.P_121.MO_938-ST_5186-V_1-ID_873723-OR_rec\" target=\"_blank\">Android Hookå‘Šè¯‰ä½  å¦‚ä½•å¯åŠ¨æœªæ³¨å†Œçš„Activity</a></p>\n<h3 id=\"refer\">Refer<a title=\"#refer\" href=\"#refer\"></a></h3>\n<p><a href=\"https://www.jianshu.com/p/71585d744076\" target=\"_blank\">Androidæ’ä»¶åŒ–(ä¸€))</a><br>\n<a href=\"https://zhuanlan.zhihu.com/p/33017826\" target=\"_blank\">æ·±å…¥ç†è§£Androidæ’ä»¶åŒ–æŠ€æœ¯ - çŸ¥ä¹ (zhihu.com)</a><br>\n<a href=\"https://blog.csdn.net/n_fly/article/details/113865650\" target=\"_blank\">Androidæ’ä»¶åŒ–å®ç°æ–¹æ¡ˆ_å®‰å“æ’ä»¶åŒ–</a></p>\n",
            "tags": [
                "é»‘ç§‘æŠ€"
            ]
        },
        {
            "id": "https://onion99.github.io/2022/03/08/phzbEh3JEzAC0XwD/",
            "url": "https://onion99.github.io/2022/03/08/phzbEh3JEzAC0XwD/",
            "title": "Androidé»‘ç§‘æŠ€ - çƒ­ä¿®å¤",
            "date_published": "2022-03-07T22:38:05.000Z",
            "content_html": "<blockquote>\n<p>çƒ­ä¿®å¤æœ¬è´¨å°±æ˜¯å°†é”™è¯¯çš„ä»£ç æ›¿æ¢æˆæ­£ç¡®çš„ä»£ç ,ä½†è¿™é‡Œçš„æ›¿æ¢ä¸æ˜¯æ”¹å†™åŸæœ‰çš„ä»£ç ,è€Œæ˜¯æä¾›ä¸€ä»½æ–°çš„æ­£ç¡®çš„ä»£ç ,è®©åº”ç”¨è¿è¡Œæ—¶ç»•è¿‡é”™è¯¯çš„ä»£ç ,ä»è€Œæ‰§è¡Œæ­£ç¡®çš„ä»£ç </p>\n</blockquote>\n<p><img src=\"https://s1.ax1x.com/2022/03/06/bDtcIx.png\" alt=\"bDtcIx.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<span id=\"more\"></span>\n<p>åŸºç¡€çŸ¥è¯†:</p>\n<ul>\n<li><a href=\"https://fullstackaction.com/pages/ccf9c0/#%E4%B8%80%E3%80%81dex-class-%E6%B5%85%E6%9E%90\" target=\"_blank\">çƒ­ä¿®å¤ä¸æ’ä»¶åŒ–åŸºç¡€ - dexä¸class</a></li>\n<li><a href=\"https://fullstackaction.com/pages/1084c4/\" target=\"_blank\">çƒ­ä¿®å¤ä¸æ’ä»¶åŒ–åŸºç¡€ - Javaä¸Androidè™šæ‹Ÿæœº</a></li>\n<li><a href=\"https://fullstackaction.com/pages/a5eb80/\" target=\"_blank\">çƒ­ä¿®å¤ä¸æ’ä»¶åŒ–åŸºç¡€ - Javaä¸Androidçš„ç±»åŠ è½½å™¨</a></li>\n</ul>\n<h2 id=\"å®ç°æ–¹æ¡ˆ\">å®ç°æ–¹æ¡ˆ<a title=\"#å®ç°æ–¹æ¡ˆ\" href=\"#å®ç°æ–¹æ¡ˆ\"></a></h2>\n<h3 id=\"nativeå±‚æ›¿æ¢æ–¹æ¡ˆ\">Nativeå±‚æ›¿æ¢æ–¹æ¡ˆ<a title=\"#nativeå±‚æ›¿æ¢æ–¹æ¡ˆ\" href=\"#nativeå±‚æ›¿æ¢æ–¹æ¡ˆ\"></a></h3>\n<blockquote>\n<p>åº•å±‚æ›¿æ¢ï¼Œä¿®æ”¹javaæ–¹æ³•åœ¨nativeå±‚çš„å‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘ä¿®å¤åçš„æ–¹æ³•ä»¥è¾¾åˆ°ä¿®å¤ç›®çš„</p>\n</blockquote>\n<p>Android/Javaä»£ç çš„æœ€å°ç»„ç»‡æ–¹å¼æ˜¯æ–¹æ³•ï¼ˆMethodï¼Œå®é™…ä¸Šï¼Œæ¯ä¸€ä¸ªdexæ–‡ä»¶æœ€å¤šå¯ä»¥åŒ…å«65536ï¼ˆ0xffffï¼‰ä¸ªæ–¹æ³•ï¼‰ï¼Œæ¯ä¸ªæ–¹æ³•åœ¨ARTè™šæ‹Ÿæœºä¸­éƒ½æœ‰ä¸€ä¸ªArtMethodç»“æ„ä½“æŒ‡é’ˆä¸ä¹‹å¯¹åº”ï¼ŒArtMethodç»“æ„ä½“ä¸­åŒ…å«äº†Javaæ–¹æ³•çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰§è¡Œå…¥å£ã€è®¿é—®æƒé™ã€æ‰€å±ç±»å’Œä»£ç æ‰§è¡Œåœ°å€ç­‰ç­‰ã€‚æ¢å¥è¯è¯´ï¼Œè™šæ‹Ÿæœºå°±æ˜¯é€šè¿‡ArtMethodç»“æ„ä½“æ¥æ“çºµJavaæ–¹æ³•çš„ã€‚ArtMethodç»“æ„å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ArtMethod</span> <span class=\"title\">FINAL</span> &#123;</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"keyword\">protected</span>:</span><br><span class=\"line\">  GcRoot&lt;mirror::Class&gt; declaring_class_;</span><br><span class=\"line\"></span><br><span class=\"line\">  std::atomic&lt;std::<span class=\"keyword\">uint32_t</span>&gt; access_flags_;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Offset to the CodeItem.</span></span><br><span class=\"line\">  <span class=\"keyword\">uint32_t</span> dex_code_item_offset_;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Index into method_ids of the dex file associated with this method.</span></span><br><span class=\"line\">  <span class=\"keyword\">uint32_t</span> dex_method_index_;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">uint16_t</span> method_index_;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">uint16_t</span> hotness_count_;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">PtrSizedFields</span> &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">// Depending on the method type, the data is</span></span><br><span class=\"line\">    <span class=\"comment\">//   - native method: pointer to the JNI function registered to this method</span></span><br><span class=\"line\">    <span class=\"comment\">//                    or a function to resolve the JNI function,</span></span><br><span class=\"line\">    <span class=\"comment\">//   - conflict method: ImtConflictTable,</span></span><br><span class=\"line\">    <span class=\"comment\">//   - abstract/interface method: the single-implementation if any,</span></span><br><span class=\"line\">    <span class=\"comment\">//   - proxy method: the original interface method or constructor,</span></span><br><span class=\"line\">    <span class=\"comment\">//   - other methods: the profiling data.</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span>* data_;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Method dispatch from quick compiled code invokes this pointer which may cause bridging into</span></span><br><span class=\"line\">    <span class=\"comment\">// the interpreter.</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span>* entry_point_from_quick_compiled_code_;</span><br><span class=\"line\">  &#125; </span><br><span class=\"line\">  ptr_sized_fields_;</span><br><span class=\"line\">...</span><br><span class=\"line\">ï½</span><br></pre></td></tr></table></figure>\n<p>å…¶ä¸­æœ‰ä¸€ä¸ªå…³é”®æŒ‡é’ˆï¼Œå®ƒæ˜¯æ–¹æ³•çš„æ‰§è¡Œå…¥å£ï¼š<br>\n<code>entry_point_from_quick_compiled_code_</code><br>\nä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘æ–¹æ³•ä½“ç¼–è¯‘åå¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤ã€‚é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬èƒ½hookè¿™ä¸ªæŒ‡é’ˆï¼Œç”±åŸæ¥æŒ‡å‘æœ‰bugçš„æ–¹æ³•ï¼Œå˜æˆæŒ‡å‘æ­£ç¡®çš„æ–¹æ³•ï¼Œå°±è¾¾åˆ°äº†ä¿®å¤çš„ç›®çš„ã€‚è¿™å°±æ˜¯nativeå±‚æ›¿æ¢æ–¹æ¡ˆçš„æ ¸å¿ƒåŸç†ã€‚å…·ä½“å®ç°æ–¹æ¡ˆå¯ä»¥æ˜¯æ”¹å˜æŒ‡é’ˆæŒ‡å‘ï¼ˆAndFixï¼‰ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ›¿æ¢æ•´ä¸ªç»“æ„ä½“ï¼ˆSophixï¼‰ã€‚</p>\n<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåº•å±‚æ›¿æ¢æ–¹æ¡ˆè™½ç„¶æ˜¯å³ä½¿ç”Ÿæ•ˆçš„ï¼Œä½†æ˜¯å› ä¸ºä¸ä¼šåŠ è½½æ–°ç±»ï¼Œè€Œæ˜¯ç›´æ¥ä¿®æ”¹åŸç±»ï¼Œæ‰€ä»¥ä¿®æ”¹çš„ä»£ç ä¸èƒ½å¢åŠ æ–°çš„æ–¹æ³•ï¼Œå¦åˆ™ä¼šé€ æˆç´¢å¼•æ•°ä¸æ–¹æ³•æ•°ä¸åŒ¹é…ï¼Œæ— æ³•é€šè¿‡ç´¢å¼•æ‰¾åˆ°æ­£ç¡®æ–¹æ³•ï¼Œå­—æ®µåŒç†</p>\n<h3 id=\"ç±»åŠ è½½æ–¹æ¡ˆ\">ç±»åŠ è½½æ–¹æ¡ˆ<a title=\"#ç±»åŠ è½½æ–¹æ¡ˆ\" href=\"#ç±»åŠ è½½æ–¹æ¡ˆ\"></a></h3>\n<blockquote>\n<p>åŠ è½½ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œéƒ½ä¼šå»å¾ªç¯dexElementsæ•°ç»„å–å‡ºé‡Œé¢çš„dexæ–‡ä»¶ï¼Œç„¶åä»dexæ–‡ä»¶ä¸­æ‰¾ç›®æ ‡ç±»ï¼Œåªè¦ç›®æ ‡ç±»æ‰¾åˆ°ï¼Œåˆ™ç›´æ¥é€€å‡ºå¾ªç¯ï¼Œä¹Ÿå°±æ˜¯åé¢çš„dexæ–‡ä»¶å°±æ²¡æœ‰è¢«å–åˆ°çš„æœºä¼šã€‚å°†çƒ­ä¿®å¤çš„ç±»æ”¾åœ¨dexElements[]çš„æœ€å‰é¢ï¼Œè¿™æ ·åŠ è½½ç±»æ—¶ <strong>ä¼šä¼˜å…ˆåŠ è½½åˆ°è¦ä¿®å¤çš„ç±»</strong>ä»¥è¾¾åˆ°ä¿®å¤ç›®çš„</p>\n</blockquote>\n<p><img src=\"https://s1.ax1x.com/2022/03/06/bDduwj.png\" alt=\"bDduwj.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>åŸºäºjvmçš„javaåº”ç”¨æ˜¯é€šè¿‡ClassLoaderæ¥åŠ è½½åº”ç”¨ä¸­çš„classçš„ï¼ŒAndroidå¯¹JVMä¼˜åŒ–è¿‡ï¼Œä½¿ç”¨çš„æ˜¯ART(ä»¥å‰æ˜¯Dalvik)ï¼Œclassæ–‡ä»¶ä¼šè¢«æ‰“åŒ…è¿›dexæ–‡ä»¶ä¸­ï¼Œåº•å±‚è™šæ‹Ÿæœºæœ‰æ‰€ä¸åŒï¼Œé‚£ä¹ˆå®ƒä»¬çš„ç±»åŠ è½½å™¨ä¹Ÿä¼šæœ‰æ‰€åŒºåˆ«ï¼Œåœ¨Androidä¸­ï¼Œè¦åŠ è½½dexæ–‡ä»¶ä¸­çš„classæ–‡ä»¶å°±éœ€è¦ç”¨åˆ° PathClassLoader æˆ– DexClassLoader è¿™ä¸¤ä¸ªAndroidä¸“ç”¨çš„ç±»åŠ è½½å™¨ã€‚</p>\n<p><img src=\"https://s1.ax1x.com/2022/03/07/bsEKiR.png\" alt=\"bsEKiR.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h4 id=\"åŸç†\">åŸç†<a title=\"#åŸç†\" href=\"#åŸç†\"></a></h4>\n<p><img src=\"https://s1.ax1x.com/2022/03/07/bsdsXT.png\" alt=\"bsdsXT.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h4 id=\"ç”Ÿæˆä¿®å¤dex\">ç”Ÿæˆä¿®å¤Dex<a title=\"#ç”Ÿæˆä¿®å¤dex\" href=\"#ç”Ÿæˆä¿®å¤dex\"></a></h4>\n<p>1.å°†å‡ºbugçš„ç±»ä¿®æ”¹æ­£ç¡®ï¼Œç„¶åæ‰§è¡Œæ‰“åŒ…æµç¨‹  <a href=\"https://imgtu.com/i/bsNkSf\" target=\"_blank\"><img src=\"https://s1.ax1x.com/2022/03/07/bsNkSf.png\" alt=\"bsNkSf.png\" loading=\"lazy\"></a></p>\n<p>2.æ­¤æ—¶å–å‡ºå·¥ç¨‹ç›®å½•ä¸‹çš„/build/intermediates/javac/debug/classes/åŒ…è·¯å¾„/æ–‡ä»¶å¤¹ä¸‹å¯¹åº”çš„classæ–‡ä»¶</p>\n<p>3.åœ¨å¤åˆ¶è¿™ä¸ªclassæ–‡ä»¶æ—¶ï¼Œéœ€è¦æŠŠå®ƒæ‰€åœ¨çš„å®Œæ•´åŒ…ç›®å½•ä¸€èµ·å¤åˆ¶ï¼Œç„¶ååœ¨å‘½ä»¤è¡Œä¸‹cdåˆ°è¯¥ç›®å½•ï¼Œæ‰§è¡Œ<code>dx --dex --output=patch.dex åŒ…åè·¯å¾„/éœ€è¦ä¿®å¤çš„ç±»æ–‡ä»¶</code>,æ­¤æ—¶ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆpatch.dexæ–‡ä»¶  <a href=\"https://imgtu.com/i/bsNQf0\" target=\"_blank\"><img src=\"https://s1.ax1x.com/2022/03/07/bsNQf0.png\" alt=\"bsNQf0.png\" loading=\"lazy\"></a></p>\n<p>4.ç„¶åå°†patch.dexæ–‡ä»¶å½“æˆè¡¥ä¸åŒ…æ”¾å…¥èµ„æºæ–‡ä»¶å¤¹rawä¸‹å³å¯ã€‚</p>\n<p>æŒ‡ä»¤ä¸ºï¼šdx --dex --output=patch.dex com/xxx/xxx/fixbug.class -&gt; ç”Ÿæˆpatch.dexæ–‡ä»¶</p>\n<p>ä¹Ÿå¯ä»¥å†™æˆï¼šdx --dex --output=patch.jar com/xxx/xxx/fixbug.class -&gt; ç”Ÿæˆpatch.jaræ–‡ä»¶</p>\n<p>ClassLoaderå¯ä»¥åŠ è½½.dexæ–‡ä»¶ï¼Œæˆ–è€….zipã€.jarã€.apkä¸­åŒ…å«çš„.dexæ–‡ä»¶</p>\n<h4 id=\"å®è·µ\">å®è·µ<a title=\"#å®è·µ\" href=\"#å®è·µ\"></a></h4>\n<p>Application:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ä¹‹æ‰€ä»¥è¦åœ¨æœ¬ç±»ä¸­åšè¡¥ä¸åŒ…çš„å®‰è£…æ˜¯å› ä¸ºæ€•å¦‚æœåœ¨åé¢çš„æµç¨‹ä¸­åšå®‰è£…ä¼šé€ æˆæœ‰äº›å¸¦bugçš„ç±»å¦‚æœå·²ç»è¢«ç³»ç»ŸåŠ è½½çš„è¯ï¼Œåç»­è¡¥ä¸åŒ…å®‰è£…ä¹‹å</span></span><br><span class=\"line\"><span class=\"comment\"> * è¡¥ä¸åŒ…ä¸­çš„ç±»å¾—ä¸åˆ°æ‰§è¡Œï¼Œå› ä¸ºç±»åŠ è½½æœ‰ç¼“å­˜æœºåˆ¶ï¼Œç³»ç»Ÿä¼šå°†åŠ è½½è¿‡çš„ç±»åšä¸€ä»½å†…å­˜ç¼“å­˜ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyApplication</span> <span class=\"keyword\">extends</span> <span class=\"title\">Application</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate();</span><br><span class=\"line\">        <span class=\"comment\">// æ­¤å¤„ä¸ºåŠ è½½è¡¥ä¸åŒ…ï¼Œå…¶å®çœŸå®åº”ç”¨åœºæ™¯æ˜¯ä»æœåŠ¡ç«¯ä¸‹è½½è¡¥ä¸æ–‡ä»¶ï¼Œå› ä¸ºæœ¬å·¥ç¨‹ä¸ºç¤ºä¾‹æ‰€ä»¥ç›´æ¥å°†å…¶æ”¾åœ¨rawèµ„æºæ–‡ä»¶ç›®å½•ä¸‹å»è¯»å–ï¼Œçœå»äº†ä¸‹è½½è¿‡ç¨‹</span></span><br><span class=\"line\">        File patchFile = <span class=\"keyword\">new</span> File(getCacheDir().getAbsolutePath() + File.separator + <span class=\"string\">&quot;patch.dex&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// ä¸ºäº†é«˜ç‰ˆæœ¬Androidè®¿é—®å¤–éƒ¨å­˜å‚¨éœ€è¦åˆ†åŒºç­‰é—®é¢˜ï¼Œå› ä¸ºæ­¤å¤„ä»…åšç¤ºä¾‹è®²è§£æ‰€ä»¥å°±ç›´æ¥å°†åŒ…æ‹·è´åˆ°ç§æœ‰ç›®å½•ä¸­</span></span><br><span class=\"line\">            <span class=\"comment\">// æ‹·è´åˆ°ç§æœ‰ç›®å½•ä¸­è¿˜æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯é¿å…åœ¨è¡¥ä¸åŒ…å®‰è£…è¿‡ç¨‹ä¸­åŒ…æ–‡ä»¶è¢«åˆ é™¤é€ æˆå®‰è£…å¤±è´¥</span></span><br><span class=\"line\">            copyFile(patchFile);</span><br><span class=\"line\">            <span class=\"comment\">// å®‰è£…è¡¥ä¸åŒ…</span></span><br><span class=\"line\">            HotFix.installPatch(<span class=\"keyword\">this</span>, patchFile);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">copyFile</span><span class=\"params\">(File dest)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">        InputStream input = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        OutputStream output = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// ç”±äºæœ¬é¡¹ç›®æ˜¯æµ‹è¯•åŠŸèƒ½ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥å°†è¡¥ä¸åŒ…æ”¾åœ¨å·¥ç¨‹å†…ï¼ŒçœŸå®å¼€å‘ç¯å¢ƒä¸­åº”è¯¥æ˜¯æ”¾åœ¨æœåŠ¡å™¨ç„¶åä¸‹è½½ä¸‹æ¥</span></span><br><span class=\"line\">            input = getResources().openRawResource(R.raw.patch);</span><br><span class=\"line\">            output = <span class=\"keyword\">new</span> FileOutputStream(dest);</span><br><span class=\"line\">            <span class=\"keyword\">byte</span>[] buf = <span class=\"keyword\">new</span> <span class=\"keyword\">byte</span>[<span class=\"number\">1024</span>];</span><br><span class=\"line\">            <span class=\"keyword\">int</span> bytesRead;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> ((bytesRead = input.read(buf)) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                output.write(buf, <span class=\"number\">0</span>, bytesRead);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            input.close();</span><br><span class=\"line\">            output.close();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>HotFix.installPatch:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HotFix</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">installPatch</span><span class=\"params\">(Application application, File patch)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (patch == <span class=\"keyword\">null</span> || !patch.exists()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">             * 1.è·å–å½“å‰çš„ç±»åŠ è½½å™¨z</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            ClassLoader classLoader = application.getClassLoader();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">             * 2.è·å–åˆ°dexElementså±æ€§ä»¥ä¾¿åç»­å‘å‰è¿½åŠ patch.dex</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            Field pathListField = ReflectUtils.findField(classLoader, <span class=\"string\">&quot;pathList&quot;</span>);</span><br><span class=\"line\">            Object pathList = pathListField.get(classLoader);</span><br><span class=\"line\">            Field dexElementsField = ReflectUtils.findField(pathList, <span class=\"string\">&quot;dexElements&quot;</span>);</span><br><span class=\"line\">            Object[] dexElements = (Object[]) dexElementsField.get(pathList);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">             * 3.é€šè¿‡åå°„è°ƒç”¨DexPathListç±»ä¸­çš„makePathElements()æ–¹æ³•å°†patch.dexæœ€ç»ˆè½¬æ¢ä¸ºElement[]æ•°ç»„ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">             * DexPathListä¸€ç³»åˆ—æ–¹æ³•éƒ½æ˜¯ç”¨æ¥å°†è¡¥ä¸åŒ…è½¬æ¢ä¸ºElement[]æ•°ç»„çš„ï¼Œå¦‚makePathElementsï¼ŒmakeDexElements..</span></span><br><span class=\"line\"><span class=\"comment\">             * å…·ä½“çš„APIæ ¹æ®çœŸå®APIçš„ç‰ˆæœ¬ä¸åŒæ–¹æ³•å‚æ•°ç­‰å¯èƒ½ä¼šæœ‰å‡ºå…¥ï¼Œæ‰€ä»¥è¿™é‡Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å®é™…ä¸Šåº”è¯¥é€šè¿‡åˆ¤æ–­å»å…¼å®¹å„ä¸ªç‰ˆæœ¬ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">             * æ­¤å¤„å› ä¸ºæ˜¯ç¤ºä¾‹æ‰€ä»¥æ²¡åšå…¼å®¹</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            List&lt;File&gt; files = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">            files.add(patch);</span><br><span class=\"line\">            Method method = ReflectUtils.findMethod(pathList, <span class=\"string\">&quot;makePathElements&quot;</span>, List.class, File.class, List.class);</span><br><span class=\"line\">            ArrayList&lt;IOException&gt; suppressedExceptions = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">            Object[] patchElements = (Object[]) method.invoke(pathList, files, application.getCacheDir(), suppressedExceptions);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">             * 4.åˆå¹¶patchElements+dexElements,å°†è¡¥ä¸åŒ…çš„.dexæ–‡ä»¶æ’å…¥æ•°ç»„æœ€å‰é¢ï¼Œåç»­åœ¨åŠ è½½ç±»çš„æ—¶å€™ä¼šä¼˜å…ˆä»ç¬¬ä¸€ä¸ªå¼€å§‹éå†æŸ¥æ‰¾ç±»</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            Object[] newElements = (Object[]) Array.newInstance(dexElements.getClass().getComponentType(), dexElements.length + patchElements.length);</span><br><span class=\"line\">            System.arraycopy(patchElements, <span class=\"number\">0</span>, newElements, <span class=\"number\">0</span>, patchElements.length);</span><br><span class=\"line\">            System.arraycopy(dexElements, <span class=\"number\">0</span>, newElements, patchElements.length, dexElements.length);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">             * 5.å°†æ–°æ•°ç»„ç½®æ¢æ‰BaseDexClassLoader -&gt; pathList -&gt; dexElementså±æ€§ï¼Œè‡³æ­¤å·¥ä½œå®Œæˆ</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            dexElementsField.set(pathList, newElements);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ReflectUtils</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/* æ‰¾åˆ°åå°„å±æ€§ **/</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Field <span class=\"title\">findField</span><span class=\"params\">(Object instance, String name)</span> </span>&#123;</span><br><span class=\"line\">        Class&lt;?&gt; clz = instance.getClass();</span><br><span class=\"line\">        Field field = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (clz != Object.class) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                field = clz.getDeclaredField(name);</span><br><span class=\"line\">                field.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> field;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (NoSuchFieldException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//å‘çˆ¶ç±»å¯»æ‰¾å±æ€§</span></span><br><span class=\"line\">            clz = clz.getSuperclass();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> field;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/* æ‰¾åˆ°åå°„å‡½æ•° **/</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Method <span class=\"title\">findMethod</span><span class=\"params\">(Object instance, String name, Class&lt;?&gt;... parameterTypes)</span> </span>&#123;</span><br><span class=\"line\">        Class&lt;?&gt; clz = instance.getClass();</span><br><span class=\"line\">        Method method = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (clz != Object.class) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                method = clz.getDeclaredMethod(name, parameterTypes);</span><br><span class=\"line\">                method.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> method;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (NoSuchMethodException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//å‘çˆ¶ç±»å¯»æ‰¾å±æ€§</span></span><br><span class=\"line\">            clz = clz.getSuperclass();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> method;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/* æ‰¾åˆ°åå°„æ‰€æœ‰å‡½æ•°æ•°ç»„ **/</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Method[] findAllMethods(Object instance) &#123;</span><br><span class=\"line\">        Class&lt;?&gt; clz = instance.getClass();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> clz.getDeclaredMethods();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å®é™…ä¸Šï¼Œç±»æ›¿æ¢æ–¹æ¡ˆçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼šå°†ä¿®æ”¹åçš„patchï¼ˆåŒ…å«bugç±»æ–‡ä»¶ï¼‰æ‰“åŒ…æˆdexæ–‡ä»¶ï¼Œç„¶åhook ClassLoaderåŠ è½½æµç¨‹ï¼Œå°†è¿™ä¸ªdexæ–‡ä»¶æ’å…¥åˆ°Elementæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚å› ä¸ºåŠ è½½ç±»æ˜¯ä¾æ¬¡è¿›è¡Œçš„ï¼Œæ‰€ä»¥è™šæ‹Ÿæœºä»ç¬¬ä¸€ä¸ªElementæ‰¾åˆ°ç±»åï¼Œå°±ä¸ä¼šå†åŠ è½½bugç±»äº†ã€‚</p>\n<p>ç±»åŠ è½½æ–¹æ¡ˆä¹Ÿæœ‰ç¼ºç‚¹ï¼Œå› ä¸ºç±»åŠ è½½åæ— æ³•å¸è½½ï¼Œæ‰€ä»¥ç±»åŠ è½½æ–¹æ¡ˆå¿…é¡»é‡å¯Appï¼Œè®©bugç±»é‡æ–°åŠ è½½åæ‰èƒ½ç”Ÿæ•ˆ</p>\n<h3 id=\"instant-runæ–¹æ¡ˆ\">Instant Runæ–¹æ¡ˆ<a title=\"#instant-runæ–¹æ¡ˆ\" href=\"#instant-runæ–¹æ¡ˆ\"></a></h3>\n<blockquote>\n<p>Instant Run æ–¹æ¡ˆçš„æ ¸å¿ƒæ€æƒ³æ˜¯â€”â€”æ’æ¡©ï¼Œåœ¨ç¼–è¯‘æ—¶é€šè¿‡æ’æ¡©åœ¨æ¯ä¸€ä¸ªæ–¹æ³•ä¸­æ’å…¥ä»£ç ï¼Œä¿®æ”¹ä»£ç é€»è¾‘ï¼Œåœ¨éœ€è¦æ—¶ç»•è¿‡é”™è¯¯æ–¹æ³•ï¼Œè°ƒç”¨patchç±»çš„æ­£ç¡®æ–¹æ³•</p>\n</blockquote>\n<p>é¦–å…ˆï¼Œåœ¨ç¼–è¯‘æ—¶Instant Runä¸ºæ¯ä¸ªç±»æ’å…¥IncrementalChangeå˜é‡ï¼š<br>\n<code>IncrementalChange  $change;</code></p>\n<p>ä¸ºæ¯ä¸€ä¸ªæ–¹æ³•æ·»åŠ ç±»ä¼¼å¦‚ä¸‹ä»£ç ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class=\"line\">        IncrementalChange var2 = $change;</span><br><span class=\"line\">        <span class=\"comment\">//$changeä¸ä¸ºnullï¼Œè¡¨ç¤ºè¯¥ç±»æœ‰ä¿®æ”¹ï¼Œéœ€è¦é‡å®šå‘</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(var2 != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//é€šè¿‡access$dispatchæ–¹æ³•è·³è½¬åˆ°patchç±»çš„æ­£ç¡®æ–¹æ³•</span></span><br><span class=\"line\">            var2.access$dispatch(<span class=\"string\">&quot;onCreate.(Landroid/os/Bundle;)V&quot;</span>, <span class=\"keyword\">new</span> Object[]&#123;<span class=\"keyword\">this</span>, savedInstanceState&#125;);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">super</span>.onCreate(savedInstanceState);</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.setContentView(<span class=\"number\">2130968601</span>);</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.tv = (TextView)<span class=\"keyword\">this</span>.findViewById(<span class=\"number\">2131492944</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>å¦‚ä¸Šä»£ç ï¼Œå½“ä¸€ä¸ªç±»è¢«ä¿®æ”¹åï¼ŒInstant Runä¼šä¸ºè¿™ä¸ªç±»æ–°å»ºä¸€ä¸ªç±»ï¼Œå‘½åä¸ºxxx&amp;overrideï¼Œä¸”å®ç°IncrementalChangeæ¥å£ï¼Œå¹¶ä¸”èµ‹å€¼ç»™åŸç±»çš„$changeå˜é‡ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span>$<span class=\"title\">override</span> <span class=\"keyword\">implements</span> <span class=\"title\">IncrementalChange</span> </span>&#123;</span><br><span class=\"line\">ï½</span><br></pre></td></tr></table></figure>\n<p>æ­¤æ—¶ï¼Œåœ¨è¿è¡Œæ—¶åŸç±»ä¸­æ¯ä¸ªæ–¹æ³•çš„var2 != nullï¼Œé€šè¿‡accessdispatchï¼ˆå‚æ•°æ˜¯æ–¹æ³•åå’ŒåŸå‚æ•°ï¼‰å®šä½åˆ°patchç±»MainActivityoverrideä¸­ä¿®æ”¹åçš„æ–¹æ³•ã€‚</p>\n<p>Instant Runæ˜¯googleåœ¨AS2.0æ—¶ç”¨æ¥å®ç°â€œçƒ­éƒ¨ç½²â€çš„ï¼ŒåŒæ—¶ä¹Ÿä¸ºâ€œçƒ­ä¿®å¤â€æä¾›äº†ä¸€ä¸ªç»ä½³çš„æ€è·¯ã€‚ç¾å›¢çš„Robustå°±æ˜¯åŸºäºæ­¤ã€‚</p>\n<h3 id=\"soåº“ä¿®å¤\">SOåº“ä¿®å¤<a title=\"#soåº“ä¿®å¤\" href=\"#soåº“ä¿®å¤\"></a></h3>\n<h4 id=\"æ¥å£è°ƒç”¨æ›¿æ¢\">æ¥å£è°ƒç”¨æ›¿æ¢<a title=\"#æ¥å£è°ƒç”¨æ›¿æ¢\" href=\"#æ¥å£è°ƒç”¨æ›¿æ¢\"></a></h4>\n<p>sdkæä¾›æ¥å£æ›¿æ¢Systemé»˜è®¤åŠ è½½soåº“çš„æ¥å£</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SOPatchManger.loadLibrary(String libName)</span><br><span class=\"line\"><span class=\"comment\">//ä»£æ›¿</span></span><br><span class=\"line\">System.loadLibrary(String libName)</span><br></pre></td></tr></table></figure>\n<p>SOPatchManger.loadLibraryæ¥å£åŠ è½½soåº“çš„æ—¶å€™ä¼˜å…ˆå°è¯•å»åŠ è½½sdkæŒ‡å®šç›®å½•ä¸‹è¡¥ä¸çš„soã€‚è‹¥ä¸å­˜åœ¨ï¼Œåˆ™å†å»åŠ è½½å®‰è£…apkç›®å½•ä¸‹çš„soåº“</p>\n<p>ä¼˜ç‚¹ï¼šä¸éœ€è¦å¯¹ä¸åŒsdkç‰ˆæœ¬è¿›è¡Œå…¼å®¹ï¼Œæ‰€ä»¥sdkç‰ˆæœ¬éƒ½æ˜¯System.loadLibraryè¿™ä¸ªæ¥å£<br>\nç¼ºç‚¹ï¼šéœ€è¦ä¾µå…¥ä¸šåŠ¡ä»£ç ï¼Œæ›¿æ¢æ‰Systemé»˜è®¤åŠ è½½soåº“çš„æ¥å£</p>\n<h4 id=\"åå°„æ³¨å…¥\">åå°„æ³¨å…¥<a title=\"#åå°„æ³¨å…¥\" href=\"#åå°„æ³¨å…¥\"></a></h4>\n<p>é‡‡å–ç±»ä¼¼ç±»ä¿®å¤åå°„æ³¨å…¥æ–¹å¼ï¼Œåªè¦æŠŠè¡¥ä¸soåº“çš„è·¯å¾„æ’å…¥åˆ°nativeLibraryDirectoriesæ•°ç»„çš„æœ€å‰é¢ï¼Œå°±èƒ½å¤Ÿè¾¾åˆ°åŠ è½½soåº“çš„æ—¶å€™æ˜¯è¡¥ä¸soåº“è€Œä¸æ˜¯åŸæ¥soåº“çš„ç›®å½•ï¼Œä»è€Œè¾¾åˆ°ä¿®å¤ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"built_in\">String</span> <span class=\"function\"><span class=\"title\">findLibrary</span>(<span class=\"params\"><span class=\"built_in\">String</span> libraryName</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">String</span> fileName = System.mapLibraryName(libraryName);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (NativeLibraryElement element : nativeLibraryPathElements) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">String</span> path = element.findNativeLibrary(fileName);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (path != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> path;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>ä¼˜ç‚¹ï¼šä¸éœ€ä¾µå…¥ç”¨æˆ·æ¥å£è°ƒç”¨<br>\nç¼ºç‚¹ï¼šéœ€è¦åšç‰ˆæœ¬å…¼å®¹æ§åˆ¶ï¼Œå…¼å®¹æ€§è¾ƒå·®</p>\n<h2 id=\"çƒ­ä¿®å¤æŠ€æœ¯æ–¹æ¡ˆé€‰å‹\">çƒ­ä¿®å¤æŠ€æœ¯æ–¹æ¡ˆé€‰å‹<a title=\"#çƒ­ä¿®å¤æŠ€æœ¯æ–¹æ¡ˆé€‰å‹\" href=\"#çƒ­ä¿®å¤æŠ€æœ¯æ–¹æ¡ˆé€‰å‹\"></a></h2>\n<p><img src=\"https://s1.ax1x.com/2022/03/06/bDwH8x.png\" alt=\"bDwH8x.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h2 id=\"çƒ­ä¿®å¤å’Œæ’ä»¶åŒ–åŒºåˆ«\">çƒ­ä¿®å¤å’Œæ’ä»¶åŒ–åŒºåˆ«<a title=\"#çƒ­ä¿®å¤å’Œæ’ä»¶åŒ–åŒºåˆ«\" href=\"#çƒ­ä¿®å¤å’Œæ’ä»¶åŒ–åŒºåˆ«\"></a></h2>\n<blockquote>\n<p>æ’ä»¶åŒ–å’Œçƒ­ä¿®å¤çš„åŸç†ï¼Œéƒ½æ˜¯åŠ¨æ€åŠ è½½ dexï¼apk ä¸­çš„ç±»ï¼èµ„æºï¼Œè®©å®¿ä¸»æ­£å¸¸çš„åŠ è½½å’Œè¿è¡Œæ’ä»¶ï¼ˆè¡¥ä¸ï¼‰ä¸­çš„å†…å®¹</p>\n</blockquote>\n<ul>\n<li>\n<p>æ’ä»¶åŒ–ç›®æ ‡æ˜¯æƒ³æŠŠéœ€è¦å®ç°çš„æ¨¡å—æˆ–åŠŸèƒ½å½“åšä¸€ä¸ªç‹¬ç«‹çš„æå–å‡ºæ¥ï¼Œå‡å°‘å®¿ä¸»çš„è§„æ¨¡ã€‚é‡åœ¨è§£å†³ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»¥åŠèµ„æºçš„é—®é¢˜</p>\n</li>\n<li>\n<p>çƒ­ä¿®å¤ç›®æ ‡åœ¨ä¿®å¤å·²æœ‰çš„é—®é¢˜ã€‚é‡åœ¨è§£å†³æ›¿æ¢å·²æœ‰çš„æœ‰é—®é¢˜çš„ç±»ï¼æ–¹æ³•ï¼èµ„æºç­‰</p>\n</li>\n</ul>\n<h2 id=\"deemo\">Deemo<a title=\"#deemo\" href=\"#deemo\"></a></h2>\n<p><a href=\"https://github.com/jiangzhengnan/Syringe\" target=\"_blank\">jiangzhengnan/Syringe: ğŸ“Œ æ’ä»¶åŒ–æ³¨å…¥å·¥ç¨‹(çƒ­ä¿®å¤+æ’ä»¶åŒ–)</a></p>\n<h2 id=\"refer\">Refer<a title=\"#refer\" href=\"#refer\"></a></h2>\n<p><a href=\"https://www.jianshu.com/p/cb1f0702d59f\" target=\"_blank\">çƒ­ä¿®å¤â€”â€”æ·±å…¥æµ…å‡ºåŸç†ä¸å®ç°</a><br>\n<a href=\"https://www.cnblogs.com/not2/p/11392733.html\" target=\"_blank\">çƒ­ä¿®å¤ - è¥¿è´é›ª</a><br>\n<a href=\"https://zhuanlan.zhihu.com/p/109169752\" target=\"_blank\">Androidçƒ­ä¿®å¤æŠ€æœ¯,ä½ ä¼šæ€ä¹ˆé€‰ï¼Ÿ</a><br>\n<a href=\"https://github.com/BigSweet/hotFixALL\" target=\"_blank\">BigSweet/hotFixALL: æ•´ç†andfix,thinker,robustçƒ­ä¿®å¤ä½¿ç”¨æ–¹æ³•å’ŒåŸç†</a><br>\n<a href=\"https://github.com/yoyiyi/SoleilNotes/blob/master/Android/%E7%83%AD%E4%BF%AE%E5%A4%8D.md\" target=\"_blank\">SoleilNotes/çƒ­ä¿®å¤.md at master Â· yoyiyi/SoleilNotes</a></p>\n",
            "tags": [
                "é»‘ç§‘æŠ€"
            ]
        },
        {
            "id": "https://onion99.github.io/2022/03/08/ukYPIjylHjywfytF/",
            "url": "https://onion99.github.io/2022/03/08/ukYPIjylHjywfytF/",
            "title": "Androidé»‘ç§‘æŠ€ - çƒ­ä¿®å¤å’Œæ’ä»¶åŒ–åŸºç¡€",
            "date_published": "2022-03-07T22:31:41.000Z",
            "content_html": "<h3 id=\"dalvikå’Œ-art\">Dalvikå’Œ ART<a title=\"#dalvikå’Œ-art\" href=\"#dalvikå’Œ-art\"></a></h3>\n<p>DVMä¹Ÿæ˜¯å®ç°äº†JVMè§„èŒƒçš„ä¸€ä¸ªè™šæ‹Ÿå™¨ï¼Œé»˜è®¤ä½¿ç”¨CMSåƒåœ¾å›æ”¶å™¨ï¼Œä½†æ˜¯ä¸JVMè¿è¡Œ Class å­—èŠ‚ç ä¸åŒï¼ŒDVM æ‰§è¡Œ Dex(Dalvik Executable Format) â€”â€”ä¸“ä¸º Dalvik è®¾è®¡çš„ä¸€ç§å‹ç¼©æ ¼å¼ã€‚Dex æ–‡ä»¶æ˜¯å¾ˆå¤š .class æ–‡ä»¶å¤„ç†å‹ç¼©åçš„äº§ç‰©ï¼Œæœ€ç»ˆå¯ä»¥åœ¨ Android è¿è¡Œæ—¶ç¯å¢ƒæ‰§è¡Œã€‚</p>\n<span id=\"more\"></span>\n<p>ARTï¼ˆAndroid Runtimeï¼‰ æ˜¯åœ¨ Android 4.4 ä¸­å¼•å…¥çš„ä¸€ä¸ªå¼€å‘è€…é€‰é¡¹ï¼Œä¹Ÿæ˜¯ Android 5.0 åŠæ›´é«˜ç‰ˆæœ¬çš„é»˜è®¤ Android è¿è¡Œæ—¶ã€‚</p>\n<p>ART å’Œ Dalvik éƒ½æ˜¯è¿è¡Œ Dex å­—èŠ‚ç çš„å…¼å®¹è¿è¡Œæ—¶ï¼Œå› æ­¤é’ˆå¯¹ Dalvik å¼€å‘çš„åº”ç”¨ä¹Ÿèƒ½åœ¨ ART ç¯å¢ƒä¸­è¿ä½œã€‚</p>\n<p>Dalvikå’Œ ARTç¼–è¯‘åŒºåˆ«<br>\n<img src=\"https://s1.ax1x.com/2022/03/07/bydjWn.png\" alt=\"bydjWn.png\" loading=\"lazy\"></p>\n<p><a href=\"https://source.android.google.cn/devices/tech/dalvik/gc-debug\" target=\"_blank\">source.android.google.cn/devices/tecâ€¦</a></p>\n<p>dexoptä¸dexaotåŒºåˆ«:</p>\n<ul>\n<li>dexopt<br>\nåœ¨Dalvikä¸­è™šæ‹Ÿæœºåœ¨åŠ è½½ä¸€ä¸ªdexæ–‡ä»¶æ—¶ï¼Œå¯¹ dex æ–‡ä»¶ è¿›è¡Œ éªŒè¯ å’Œ ä¼˜åŒ–çš„æ“ä½œï¼Œå…¶å¯¹ dex æ–‡ä»¶çš„ä¼˜åŒ–ç»“æœå˜æˆäº† odex(Optimized dex) æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å’Œ dex æ–‡ä»¶å¾ˆåƒï¼Œåªæ˜¯ä½¿ç”¨äº†ä¸€äº›ä¼˜åŒ–æ“ä½œç ã€‚</li>\n<li>dex2oat<br>\nART é¢„å…ˆç¼–è¯‘æœºåˆ¶ï¼Œåœ¨å®‰è£…æ—¶å¯¹ dex æ–‡ä»¶æ‰§è¡Œdexoptä¼˜åŒ–ä¹‹åå†å°†odexè¿›è¡Œ AOT æå‰ç¼–è¯‘æ“ä½œï¼Œç¼–è¯‘ä¸ºOATï¼ˆå®é™…ä¸Šæ˜¯ELFæ–‡ä»¶ï¼‰å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆæœºå™¨ç ï¼‰ã€‚ï¼ˆç›¸æ¯”åšè¿‡ODEXä¼˜åŒ–ï¼Œæœªåšè¿‡ä¼˜åŒ–çš„DEXè½¬æ¢æˆOATè¦èŠ±è´¹æ›´é•¿çš„æ—¶é—´ï¼‰</li>\n</ul>\n<h3 id=\"ç±»åŠ è½½\">ç±»åŠ è½½<a title=\"#ç±»åŠ è½½\" href=\"#ç±»åŠ è½½\"></a></h3>\n<blockquote>\n<p>ä»»ä½•ä¸€ä¸ª Java ç¨‹åºéƒ½æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ª class æ–‡ä»¶ç»„æˆï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œéœ€è¦å°† class æ–‡ä»¶åŠ è½½åˆ° JVM ä¸­æ‰å¯ä»¥ä½¿ç”¨ï¼Œè´Ÿè´£åŠ è½½è¿™äº› class æ–‡ä»¶çš„å°±æ˜¯ Java çš„ç±»åŠ è½½æœºåˆ¶ã€‚</p>\n</blockquote>\n<p>Androidä¸­å¸¸ç”¨çš„æœ‰ä¸¤ç§ç±»åŠ è½½å™¨ï¼ŒDexClassLoaderå’ŒPathClassLoaderï¼Œå®ƒä»¬éƒ½ç»§æ‰¿äºBaseDexClassLoaderã€‚ç›¸å…³æºç å¦‚ä¸‹ï¼š</p>\n<p><img src=\"https://pic1.zhimg.com/80/v2-43a7045200722c1aea24966765f82570_720w.jpg\" alt=\"\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>åŒºåˆ«åœ¨äºè°ƒç”¨çˆ¶ç±»æ„é€ å™¨æ—¶ï¼ŒDexClassLoaderå¤šä¼ äº†ä¸€ä¸ªoptimizedDirectoryå‚æ•°ï¼Œè¿™ä¸ªç›®å½•å¿…é¡»æ˜¯å†…éƒ¨å­˜å‚¨è·¯å¾„ï¼Œç”¨æ¥ç¼“å­˜ç³»ç»Ÿåˆ›å»ºçš„Dexæ–‡ä»¶ã€‚è€ŒPathClassLoaderè¯¥å‚æ•°ä¸ºnullï¼Œåªèƒ½åŠ è½½å†…éƒ¨å­˜å‚¨ç›®å½•çš„Dexæ–‡ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨DexClassLoaderå»åŠ è½½å¤–éƒ¨çš„apkï¼Œç”¨æ³•å¦‚ä¸‹ï¼š</p>\n<p><img src=\"https://pic3.zhimg.com/80/v2-280d8e49c4b6aab388bc1f8b906f13f2_720w.jpg\" alt=\"\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h4 id=\"refer\">Refer<a title=\"#refer\" href=\"#refer\"></a></h4>\n<p><a href=\"https://juejin.cn/post/7018534681620512805\" target=\"_blank\">Android çƒ­ä¿®å¤æ ¸å¿ƒåŸç†ï¼ŒClassLoaderç±»åŠ è½½ </a><br>\n<a href=\"https://blog.csdn.net/qq_35090026/article/details/122909541#:~:text=Android%E4%B8%AD%E7%9A%84ClassLoader%E7%B1%BB%E5%9E%8B%E5%88%86%E5%88%AB%E6%98%AF%E7%B3%BB%E7%BB%9F%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8A%A0%E8%BD%BD%E5%99%A8%E3%80%82%20%E5%85%B6%E4%B8%AD%E7%B3%BB%E7%BB%9F%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E4%B8%BB%E8%A6%81%E5%8C%85%E6%8B%AC3%E7%A7%8D%EF%BC%8C%E5%88%86%E5%88%AB%E6%98%AF%20BootClassLoader%20%E3%80%81,PathClassLoader%20%E5%92%8C%20DexClassLoader%20%E3%80%82\" target=\"_blank\">Android ClassLoaderç±»åŠ è½½æœºåˆ¶</a><br>\n<a href=\"https://blog.csdn.net/qq_32506429/article/details/122783941\" target=\"_blank\">Android ClassLoaderæœºåˆ¶ä¸çƒ­ä¿®å¤</a><br>\n<a href=\"https://blog.csdn.net/xiangzhihong8/article/details/52880327\" target=\"_blank\">Android ClassLoaderè¯¦è§£</a></p>\n<h3 id=\"åŒäº²å§”æ‰˜æœºåˆ¶\">åŒäº²å§”æ‰˜æœºåˆ¶<a title=\"#åŒäº²å§”æ‰˜æœºåˆ¶\" href=\"#åŒäº²å§”æ‰˜æœºåˆ¶\"></a></h3>\n<p>ClassLoaderè°ƒç”¨loadClassæ–¹æ³•åŠ è½½ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>\n<p><img src=\"https://pic2.zhimg.com/80/v2-20dca70a7fca2413de158563cb7d27d1_720w.jpg\" alt=\"\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>å¯ä»¥çœ‹å‡ºClassLoaderåŠ è½½ç±»æ—¶ï¼Œå…ˆæŸ¥çœ‹è‡ªèº«æ˜¯å¦å·²ç»åŠ è½½è¿‡è¯¥ç±»ï¼Œå¦‚æœæ²¡æœ‰åŠ è½½è¿‡ä¼šé¦–å…ˆè®©çˆ¶åŠ è½½å™¨å»åŠ è½½ï¼Œå¦‚æœçˆ¶åŠ è½½å™¨æ— æ³•åŠ è½½è¯¥ç±»æ—¶æ‰ä¼šè°ƒç”¨è‡ªèº«çš„findClassæ–¹æ³•åŠ è½½ï¼Œè¯¥æœºåˆ¶å¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…äº†ç±»çš„é‡å¤åŠ è½½ã€‚</p>\n<h3 id=\"dexclassloaderçš„dexpathlist\">DexClassLoaderçš„DexPathList<a title=\"#dexclassloaderçš„dexpathlist\" href=\"#dexclassloaderçš„dexpathlist\"></a></h3>\n<blockquote>\n<p>DexPathListæ˜¯åœ¨æ„é€ DexClassLoaderæ—¶ç”Ÿæˆçš„ï¼Œå…¶å†…éƒ¨åŒ…å«äº†DexFile</p>\n</blockquote>\n<p><img src=\"https://s1.ax1x.com/2022/03/07/by01BT.png\" alt=\"by01BT.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>DexPathListçš„loadClassä¼šå»éå†DexFileç›´åˆ°æ‰¾åˆ°éœ€è¦åŠ è½½çš„ç±»ã€‚</p>\n<p><img src=\"https://pic3.zhimg.com/80/v2-ddf43519948c3b9ab3f15ff19cf77dfe_720w.jpg\" alt=\"\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>è…¾è®¯çš„qqç©ºé—´çƒ­ä¿®å¤æŠ€æœ¯æ­£æ˜¯åˆ©ç”¨äº†DexClassLoaderçš„åŠ è½½æœºåˆ¶ï¼Œå°†éœ€è¦æ›¿æ¢çš„ç±»æ·»åŠ åˆ°dexElementsçš„å‰é¢ï¼Œè¿™æ ·ç³»ç»Ÿä¼šä½¿ç”¨å…ˆæ‰¾åˆ°çš„ä¿®å¤è¿‡çš„ç±»ã€‚</p>\n<h3 id=\"èµ„æºåŠ è½½\">èµ„æºåŠ è½½<a title=\"#èµ„æºåŠ è½½\" href=\"#èµ„æºåŠ è½½\"></a></h3>\n<p>Androidç³»ç»Ÿé€šè¿‡Resourceå¯¹è±¡åŠ è½½èµ„æºï¼Œä¸‹é¢ä»£ç å±•ç¤ºäº†è¯¥å¯¹è±¡çš„ç”Ÿæˆè¿‡ç¨‹ã€‚</p>\n<p><img src=\"https://pic1.zhimg.com/80/v2-ab6ea5aad79904422d2fa7d8bc87a64c_720w.jpg\" alt=\"\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>å› æ­¤ï¼Œåªè¦å°†æ’ä»¶apkçš„è·¯å¾„åŠ å…¥åˆ°AssetManagerä¸­ï¼Œä¾¿èƒ½å¤Ÿå®ç°å¯¹æ’ä»¶èµ„æºçš„è®¿é—®ã€‚</p>\n<p>å…·ä½“å®ç°æ—¶ï¼Œç”±äºAssetManagerå¹¶ä¸æ˜¯ä¸€ä¸ªpublicçš„ç±»ï¼Œéœ€è¦é€šè¿‡åå°„å»åˆ›å»ºï¼Œå¹¶ä¸”éƒ¨åˆ†Romå¯¹åˆ›å»ºçš„Resourceç±»è¿›è¡Œäº†ä¿®æ”¹ï¼Œæ‰€ä»¥éœ€è¦è€ƒè™‘ä¸åŒRomçš„å…¼å®¹æ€§ã€‚</p>\n<h3 id=\"refer-1\">Refer<a title=\"#refer-1\" href=\"#refer-1\"></a></h3>\n<p><a href=\"https://zhuanlan.zhihu.com/p/33017826\" target=\"_blank\">æ·±å…¥ç†è§£Androidæ’ä»¶åŒ–æŠ€æœ¯ </a></p>\n",
            "tags": [
                "é»‘ç§‘æŠ€"
            ]
        },
        {
            "id": "https://onion99.github.io/2022/03/03/p2ie22dC9NcVwpEH/",
            "url": "https://onion99.github.io/2022/03/03/p2ie22dC9NcVwpEH/",
            "title": "æºç å­¦ä¹ -LiveData",
            "date_published": "2022-03-02T17:47:39.000Z",
            "content_html": "<blockquote>\n<p><a href=\"https://developer.android.google.cn/reference/androidx/lifecycle/LiveData\" target=\"_blank\"><code>LiveData</code></a> æ˜¯ä¸€ç§å¯è§‚å¯Ÿçš„æ•°æ®å­˜å‚¨å™¨ç±»ã€‚ä¸å¸¸è§„çš„å¯è§‚å¯Ÿç±»ä¸åŒï¼ŒLiveData å…·æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥èƒ½åŠ›ï¼Œæ„æŒ‡å®ƒéµå¾ªå…¶ä»–åº”ç”¨ç»„ä»¶ï¼ˆå¦‚ Activityã€Fragment æˆ– Serviceï¼‰çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™ç§æ„ŸçŸ¥èƒ½åŠ›å¯ç¡®ä¿ LiveData ä»…æ›´æ–°å¤„äºæ´»è·ƒç”Ÿå‘½å‘¨æœŸçŠ¶æ€çš„åº”ç”¨ç»„ä»¶è§‚å¯Ÿè€…</p>\n</blockquote>\n<span id=\"more\"></span>\n<h3 id=\"ä¼˜ç‚¹\">ä¼˜ç‚¹<a title=\"#ä¼˜ç‚¹\" href=\"#ä¼˜ç‚¹\"></a></h3>\n<ul>\n<li>ç¡®ä¿ç•Œé¢ç¬¦åˆæ•°æ®çŠ¶æ€\n<ul>\n<li>LiveData éµå¾ªè§‚å¯Ÿè€…æ¨¡å¼ã€‚å½“åº•å±‚æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒLiveData ä¼šé€šçŸ¥ Observer å¯¹è±¡ã€‚æ‚¨å¯ä»¥æ•´åˆä»£ç ä»¥åœ¨è¿™äº› Observer å¯¹è±¡ä¸­æ›´æ–°ç•Œé¢ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ‚¨æ— éœ€åœ¨æ¯æ¬¡åº”ç”¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶æ›´æ–°ç•Œé¢ï¼Œå› ä¸ºè§‚å¯Ÿè€…ä¼šæ›¿æ‚¨å®Œæˆæ›´æ–°ã€‚</li>\n</ul>\n</li>\n<li>ä¸ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼\n<ul>\n<li>è§‚å¯Ÿè€…ä¼šç»‘å®šåˆ° Lifecycle å¯¹è±¡ï¼Œå¹¶åœ¨å…¶å…³è”çš„ç”Ÿå‘½å‘¨æœŸé­åˆ°é”€æ¯åè¿›è¡Œè‡ªæˆ‘æ¸…ç†ã€‚</li>\n</ul>\n</li>\n<li>ä¸ä¼šå›  Activity åœæ­¢è€Œå¯¼è‡´å´©æºƒ\n<ul>\n<li>å¦‚æœè§‚å¯Ÿè€…çš„ç”Ÿå‘½å‘¨æœŸå¤„äºéæ´»è·ƒçŠ¶æ€ï¼ˆå¦‚è¿”å›æ ˆä¸­çš„ Activityï¼‰ï¼Œåˆ™å®ƒä¸ä¼šæ¥æ”¶ä»»ä½• LiveData äº‹ä»¶ã€‚</li>\n</ul>\n</li>\n<li>ä¸å†éœ€è¦æ‰‹åŠ¨å¤„ç†ç”Ÿå‘½å‘¨æœŸ\n<ul>\n<li>ç•Œé¢ç»„ä»¶åªæ˜¯è§‚å¯Ÿç›¸å…³æ•°æ®ï¼Œä¸ä¼šåœæ­¢æˆ–æ¢å¤è§‚å¯Ÿã€‚LiveData å°†è‡ªåŠ¨ç®¡ç†æ‰€æœ‰è¿™äº›æ“ä½œï¼Œå› ä¸ºå®ƒåœ¨è§‚å¯Ÿæ—¶å¯ä»¥æ„ŸçŸ¥ç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€å˜åŒ–ã€‚</li>\n</ul>\n</li>\n<li>æ•°æ®å§‹ç»ˆä¿æŒæœ€æ–°çŠ¶æ€\n<ul>\n<li>å¦‚æœç”Ÿå‘½å‘¨æœŸå˜ä¸ºéæ´»è·ƒçŠ¶æ€ï¼Œå®ƒä¼šåœ¨å†æ¬¡å˜ä¸ºæ´»è·ƒçŠ¶æ€æ—¶æ¥æ”¶æœ€æ–°çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæ›¾ç»åœ¨åå°çš„ Activity ä¼šåœ¨è¿”å›å‰å°åç«‹å³æ¥æ”¶æœ€æ–°çš„æ•°æ®ã€‚</li>\n</ul>\n</li>\n<li>é€‚å½“çš„é…ç½®æ›´æ”¹\n<ul>\n<li>å¦‚æœç”±äºé…ç½®æ›´æ”¹ï¼ˆå¦‚è®¾å¤‡æ—‹è½¬ï¼‰è€Œé‡æ–°åˆ›å»ºäº† Activity æˆ– Fragmentï¼Œå®ƒä¼šç«‹å³æ¥æ”¶æœ€æ–°çš„å¯ç”¨æ•°æ®ã€‚</li>\n</ul>\n</li>\n<li>å…±äº«èµ„æº\n<ul>\n<li>æ‚¨å¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼æ‰©å±• LiveData å¯¹è±¡ä»¥å°è£…ç³»ç»ŸæœåŠ¡ï¼Œä»¥ä¾¿åœ¨åº”ç”¨ä¸­å…±äº«å®ƒä»¬ã€‚LiveData å¯¹è±¡è¿æ¥åˆ°ç³»ç»ŸæœåŠ¡ä¸€æ¬¡ï¼Œç„¶åéœ€è¦ç›¸åº”èµ„æºçš„ä»»ä½•è§‚å¯Ÿè€…åªéœ€è§‚å¯Ÿ LiveData å¯¹è±¡ã€‚å¦‚éœ€äº†è§£è¯¦æƒ…ï¼Œè¯·å‚é˜…æ‰©å±• LiveDataã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"ä½¿ç”¨\">ä½¿ç”¨<a title=\"#ä½¿ç”¨\" href=\"#ä½¿ç”¨\"></a></h3>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DetailVideModel</span> : <span class=\"type\">ViewModel &#123;</span></span></span><br><span class=\"line\">\t  <span class=\"keyword\">val</span> getTopTabLiveData <span class=\"keyword\">by</span> lazy &#123;  MutableLiveData&lt;<span class=\"built_in\">Boolean</span>&gt;() &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MediaDetailsActivity</span> : <span class=\"type\">BaseActivity</span></span>()&#123;</span><br><span class=\"line\">\t  viewModel.getTopTabLiveData.observe(<span class=\"keyword\">this</span>)&#123;</span><br><span class=\"line\">\t       <span class=\"comment\">// do some thing    </span></span><br><span class=\"line\">\t  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>![I8k2xH.png](<a href=\"https://z3.ax1x.com/2021/11/08/I8k2xH.png\">https://z3.ax1x.com/2021/11/08/I8k2xH.png</a> =100x100)</p>\n<h3 id=\"observer()åšäº†ä»€ä¹ˆ\">observer()åšäº†ä»€ä¹ˆ<a title=\"#observer()åšäº†ä»€ä¹ˆ\" href=\"#observer()åšäº†ä»€ä¹ˆ\"></a></h3>\n<blockquote>\n<p>å°†æŒ‡å®šäº‹ä»¶è·Ÿç”Ÿå‘½å‘¨æœŸç»‘å®š</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LiveData</span>&lt;<span class=\"title\">T</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/* åœ¨ç»™å®šæ‰€æœ‰è€…çš„ç”Ÿå‘½å‘¨æœŸå†…å°†ç»™å®šçš„è§‚å¯Ÿè€…æ·»åŠ åˆ°è§‚å¯Ÿè€…åˆ—è¡¨ä¸­ã€‚ */</span></span><br><span class=\"line\">    <span class=\"meta\">@MainThread</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">observe</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> LifecycleOwner owner, <span class=\"meta\">@NonNull</span> Observer&lt;? <span class=\"keyword\">super</span> T&gt; observer)</span> </span>&#123;</span><br><span class=\"line\">        assertMainThread(<span class=\"string\">&quot;observe&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// åˆ¤æ–­ç”Ÿå‘½å‘¨æœŸä¸ºé”€æ¯,åˆ™å¿½ç•¥</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (owner.getLifecycle().getCurrentState() == DESTROYED) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"comment\">// å®ä¾‹ä¸€ä¸ªæ–°çš„ç”Ÿå‘½å‘¨æœŸç»‘å®šè§‚å¯Ÿè€…</span></span><br><span class=\"line\">        LifecycleBoundObserver wrapper = <span class=\"keyword\">new</span> LifecycleBoundObserver(owner, observer);</span><br><span class=\"line\">        <span class=\"comment\">// åˆ¤æ–­æ˜¯å¦ä¹‹å‰å·²ç»èµ‹å€¼,æ¥é˜²æ­¢æœ‰ç…ç¬”é‡å¤è°ƒç”¨,ä¸“æ²»ä»£ç æ°´åœŸä¸æœ</span></span><br><span class=\"line\">        ObserverWrapper existing = mObservers.putIfAbsent(observer, wrapper);</span><br><span class=\"line\">        <span class=\"comment\">// æ³¨æ„çœ‹LifecycleBoundObserver.isAttachedTo()</span></span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœä¹‹å‰å·²ç»èµ‹å€¼ä½†åˆæœ‰ç…ç¬”åœ¨ä¸åŒLifecycleOwner(ç”Ÿå‘½å‘¨æœŸç®¡ç†è€…)ä¸­è°ƒç”¨,è¯ä¸å¤šè¯´,ç›´æ¥ç»™crash,googleå°±æ˜¯ç‰›é€¼</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (existing != <span class=\"keyword\">null</span> &amp;&amp; !existing.isAttachedTo(owner)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">&quot;Cannot add the same observer&quot;</span></span><br><span class=\"line\">                    + <span class=\"string\">&quot; with different lifecycles&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœå·²ç»èµ‹å€¼ä¸”ä¸Šé¢ç…ç¬”å¤„ç†æ²¡é—®é¢˜,å°±ä¸å†åšå¤„ç†äº†</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (existing != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// çœ‹åˆ°äº†æ²¡æœ‰,æ ¸å¿ƒå•Š,ç²¾é«“å•Š,ç»™å½“å‰LifecycleOwneråŠ å…¥Observer(è§‚å¯Ÿè€…),åœ¨ç”Ÿå‘½å‘¨æœŸå„ä¸ªé˜¶æ®µå“åº”äº‹ä»¶</span></span><br><span class=\"line\">        owner.getLifecycle().addObserver(wrapper);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> &#125;   </span><br></pre></td></tr></table></figure>\n<p>çœ‹çœ‹mObservers.putIfAbsent:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* LinkedListï¼Œå®ƒä¼ªè£…æˆä¸€ä¸ªMapå¹¶æ”¯æŒåœ¨è¿­ä»£æœŸé—´è¿›è¡Œä¿®æ”¹ã€‚å®ƒä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SafeIterableMap</span>&lt;<span class=\"title\">K</span>, <span class=\"title\">V</span>&gt; <span class=\"keyword\">implements</span> <span class=\"title\">Iterable</span>&lt;<span class=\"title\">Map</span>.<span class=\"title\">Entry</span>&lt;<span class=\"title\">K</span>, <span class=\"title\">V</span>&gt;&gt; </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* å¦‚æœæŒ‡å®šçš„é”®å°šæœªä¸å€¼å…³è”ï¼Œåˆ™å°†å…¶ä¸ç»™å®šå€¼å…³è”,è¿”å›ä¸æŒ‡å®šé”®å…³è”çš„å‰ä¸€ä¸ªå€¼ï¼Œå¦‚æœè¯¥é”®æ²¡æœ‰æ˜ å°„ï¼Œåˆ™null */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">putIfAbsent</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> K key, <span class=\"meta\">@NonNull</span> V v)</span> </span>&#123;</span><br><span class=\"line\">        Entry&lt;K, V&gt; entry = get(key);</span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœç»™å®šçš„å€¼å·²ç»å­˜åœ¨,åˆ™è¿”å›å€¼</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (entry != <span class=\"keyword\">null</span>) <span class=\"keyword\">return</span> entry.mValue;</span><br><span class=\"line\">        <span class=\"comment\">// å¦åˆ™å­˜è¿›å»,çœŸä¼¼å‰å®³å•Š</span></span><br><span class=\"line\">        put(key, v);</span><br><span class=\"line\">        <span class=\"comment\">// è¿”å›ä»£è¡¨ä¹‹å‰ä¸å­˜åœ¨çš„nullå€¼,è¿™å°±æ˜¯ç†è§£æœ‰æœ¨æœ‰ </span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> &#125;   </span><br></pre></td></tr></table></figure>\n<p>çœ‹çœ‹LifecycleBoundObserver :</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LifecycleBoundObserver</span> <span class=\"keyword\">extends</span> <span class=\"title\">ObserverWrapper</span> <span class=\"keyword\">implements</span> <span class=\"title\">LifecycleEventObserver</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@NonNull</span></span><br><span class=\"line\">    <span class=\"comment\">// ç”Ÿå‘½å‘¨æœŸç®¡ç†è€…</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> LifecycleOwner mOwner;</span><br><span class=\"line\">    <span class=\"comment\">// çœ‹åˆ°è¿™é‡Œæ²¡,ç›´æ¥èµ‹å€¼äº†,æœ‰ä»€ä¹ˆå¥½è¯´çš„</span></span><br><span class=\"line\">    LifecycleBoundObserver(<span class=\"meta\">@NonNull</span> LifecycleOwner owner, Observer&lt;? <span class=\"keyword\">super</span> T&gt; observer) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(observer);</span><br><span class=\"line\">        mOwner = owner;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// æœ‰ç‚¹æ„æ€,è¿™é‡Œåˆ¤æ–­æ˜¯å¦å¤„åœ¨æ´»è·ƒçŠ¶æ€,å°±å¯ä»¥ä»–å¦ˆçš„åšæ­£ç¡®çš„ç”Ÿå‘½å‘¨æœŸå›è°ƒå“åº”</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">shouldBeActive</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mOwner.getLifecycle().getCurrentState().isAtLeast(STARTED);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onStateChanged</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> LifecycleOwner source,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">            <span class=\"meta\">@NonNull</span> Lifecycle.Event event)</span> </span>&#123;</span><br><span class=\"line\">        Lifecycle.State currentState = mOwner.getLifecycle().getCurrentState();</span><br><span class=\"line\">        <span class=\"comment\">// è‹¥ç”Ÿå‘½å‘¨æœŸå·²ä¸ºé”€æ¯çŠ¶æ€, åˆ™ç§»é™¤ observer, é¿å…å†…å­˜æ³„éœ²</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (currentState == DESTROYED) &#123;</span><br><span class=\"line\">            removeObserver(mObserver);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Lifecycle.State prevState = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (prevState != currentState) &#123;</span><br><span class=\"line\">            prevState = currentState;</span><br><span class=\"line\">            activeStateChanged(shouldBeActive());</span><br><span class=\"line\">            currentState = mOwner.getLifecycle().getCurrentState();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// åˆ¤æ–­ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸç®¡ç†è€…æ˜¯å¦ä¸ºåŒä¸€ä¸ª</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">isAttachedTo</span><span class=\"params\">(LifecycleOwner owner)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mOwner == owner;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">detachObserver</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        mOwner.getLifecycle().removeObserver(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¥½äº†åˆ°è¿™LiveData.observe()å·²ç»è§‚å¯Ÿå®Œæ¯•äº†,åˆ°çœ‹çœ‹LiveData.postValue()äº†,<br>\nåˆ«è¯´,googleè¿˜æ˜¯æœ‰ç‚¹è®²ç©¶çš„,çœ‹çœ‹è¿™ä¸ªå®˜æ–¹æç¤º:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">liveData.postValue(<span class=\"string\">&quot;a&quot;</span>);<span class=\"comment\">// å¼‚æ­¥ä¼ å€¼</span></span><br><span class=\"line\">liveData.setValue(<span class=\"string\">&quot;b&quot;</span>); <span class=\"comment\">//åŒæ­¥ä¼ å€¼</span></span><br><span class=\"line\"><span class=\"comment\">// ç»“æœ: å€¼â€œbâ€å°†é¦–å…ˆè®¾ç½®ï¼Œç„¶åä¸»çº¿ç¨‹å°†ç”¨å€¼â€œaâ€è¦†ç›–å®ƒã€‚</span></span><br><span class=\"line\"><span class=\"comment\">// å¦‚æœåœ¨æ­¤ä¸»çº¿ç¨‹æ‰§è¡ŒpostValue()ä¹‹å‰å¤šæ¬¡è°ƒç”¨postValue()ï¼Œåˆ™åªä¼šè°ƒåº¦æœ€åä¸€ä¸ªå€¼</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"postvalue()åšäº†ä»€ä¹ˆ\">postValue()åšäº†ä»€ä¹ˆ<a title=\"#postvalue()åšäº†ä»€ä¹ˆ\" href=\"#postvalue()åšäº†ä»€ä¹ˆ\"></a></h3>\n<blockquote>\n<p>ä»–å¦ˆçš„,è¿˜èƒ½åšä»€ä¹ˆ,å°±æ˜¯ä¼ å€¼å•Š,è¿™è¿˜ç”¨è¯´çš„æ–‡ç« åˆ°æ­¤ç»“æŸäº†,ä¸ä¼šå§,ä¸ä¼šå§,å¼‚æ­¥ä¼ å€¼å¾—æ³¨æ„å¤„ç†å¤šçº¿ç¨‹ä¸‹çš„å…±äº«å˜é‡é—®é¢˜å‘¢</p>\n</blockquote>\n<p>![I8mrdA.png](<a href=\"https://z3.ax1x.com/2021/11/08/I8mrdA.png\">https://z3.ax1x.com/2021/11/08/I8mrdA.png</a> =100x100)</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">postValue</span><span class=\"params\">(T value)</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">boolean</span> postTask;</span><br><span class=\"line\">   <span class=\"keyword\">synchronized</span> (mDataLock) &#123;</span><br><span class=\"line\">     <span class=\"comment\">// åˆ¤æ–­ä¹‹å‰æ˜¯å¦å·²ç»èµ‹å€¼è¿‡äº†</span></span><br><span class=\"line\">     postTask = mPendingData == NOT_SET;</span><br><span class=\"line\">     <span class=\"comment\">// ç»™mPendingDataèµ‹å€¼ </span></span><br><span class=\"line\">     mPendingData = value;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   <span class=\"comment\">// çœ‹åˆ°æ²¡æœ‰,ä»–å¦ˆçš„,ä¹‹å‰å·²ç»èµ‹å€¼å°±returnäº†,å¥½æ°”å“¦,å¹²å˜›è¿™æ ·å‘¢</span></span><br><span class=\"line\">   <span class=\"comment\">// å˜¿,çœ‹ä¸‹mPostValueRunnableæ²¡æœ‰,ä»–å°±æ˜¯é˜²æ­¢ç…ç¬”å¤šçº¿ç¨‹ä¸‹å¤šæ¬¡èµ‹ç›¸åŒå€¼åšçš„</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> (!postTask) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">   <span class=\"comment\">// æŠŠä¼ å€¼çº¿ç¨‹æ”¾åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œ</span></span><br><span class=\"line\">   ArchTaskExecutor.getInstance().postToMainThread(mPostValueRunnable);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"comment\">// æœªèµ‹å€¼çŠ¶æ€</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Object NOT_SET = <span class=\"keyword\">new</span> Object()</span><br><span class=\"line\"><span class=\"comment\">// é»˜è®¤å°±æ˜¯æœªèµ‹å€¼çŠ¶æ€</span></span><br><span class=\"line\"><span class=\"keyword\">volatile</span> Object mPendingData = NOT_SET</span><br><span class=\"line\"><span class=\"comment\">// ä¼ å€¼çº¿ç¨‹</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Runnable mPostValueRunnable = <span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">  <span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">  <span class=\"meta\">@Override</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// çœ‹åˆ°æ²¡æœ‰,çœŸæ­£ä¼ å€¼éƒ½æ˜¯é€šè¿‡newValueæ¥ä¼ çš„å¥½ä¸å¥½</span></span><br><span class=\"line\">    Object newValue;</span><br><span class=\"line\">    <span class=\"keyword\">synchronized</span> (mDataLock) &#123;</span><br><span class=\"line\">      newValue = mPendingData;</span><br><span class=\"line\">      <span class=\"comment\">// å˜¿å˜¿,è¿™é‡Œå›å½’é»˜è®¤æœªèµ‹å€¼çŠ¶æ€äº†</span></span><br><span class=\"line\">      mPendingData = NOT_SET;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// æœ€ç»ˆè¿˜æ˜¯è°ƒåˆ°setValueå•Š,æœç„¶å•Š,æ¡æ¡é“è·¯é€šsetValueå•Š</span></span><br><span class=\"line\">    setValue((T) newValue);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"setvalue()\">setValue()<a title=\"#setvalue()\" href=\"#setvalue()\"></a></h3>\n<blockquote>\n<blockquote>\n<p>æœ‰ä»€ä¹ˆå¥½è¯´çš„,å…¶ä»–çš„ä¸€æªç§’äº†,æˆ‘æ‰æ˜¯ä¼ è¾“æ•°æ®çš„æ ¸å¿ƒä»£ç å¥½ä¸å¥½,å±,dispatchingValueæ‰æ˜¯</p>\n</blockquote>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// è®¾ç½®ä¼ è¾“æ•°æ®ã€‚ å¦‚æœæœ‰æ´»è·ƒçš„ObserverWrapper(è§‚å¯Ÿè€…)ï¼Œå€¼å°†è¢«åˆ†å‘ç»™ä»–ä»¬ã€‚    </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">setValue</span><span class=\"params\">(T value)</span> </span>&#123;</span><br><span class=\"line\">  assertMainThread(<span class=\"string\">&quot;setValue&quot;</span>);</span><br><span class=\"line\">  mVersion++;</span><br><span class=\"line\">  mData = value;</span><br><span class=\"line\">  dispatchingValue(<span class=\"keyword\">null</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings(&quot;WeakerAccess&quot;)</span> <span class=\"comment\">/* synthetic access */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">dispatchingValue</span><span class=\"params\">(<span class=\"meta\">@Nullable</span> ObserverWrapper initiator)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// åˆ¤æ–­äº‹ä»¶åˆ†å‘æ˜¯å¦å·²ç»åœ¨æ‰§è¡Œ,æ˜¯åˆ™æ‰“æ–­</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mDispatchingValue) &#123;</span><br><span class=\"line\">            mDispatchInvalidated = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// äº‹ä»¶åˆ†å‘å¼€å§‹</span></span><br><span class=\"line\">        mDispatchingValue = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            mDispatchInvalidated = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (initiator != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                considerNotify(initiator);</span><br><span class=\"line\">                initiator = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (Iterator&lt;Map.Entry&lt;Observer&lt;? <span class=\"keyword\">super</span> T&gt;, ObserverWrapper&gt;&gt; iterator =</span><br><span class=\"line\">                        mObservers.iteratorWithAdditions(); iterator.hasNext(); ) &#123;</span><br><span class=\"line\">                    considerNotify(iterator.next().getValue());</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (mDispatchInvalidated) <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">while</span> (mDispatchInvalidated);</span><br><span class=\"line\">        <span class=\"comment\">// äº‹ä»¶åˆ†å‘ç»“æŸ</span></span><br><span class=\"line\">        mDispatchingValue = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">considerNotify</span><span class=\"params\">(ObserverWrapper observer)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœç”Ÿå‘½å‘¨æœŸç®¡ç†è€…å·²ç»é”€æ¯,åˆ™å¿½ç•¥</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!observer.mActive) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// åœ¨åˆ†å‘ä¹‹å‰æ£€æŸ¥ä¸‹æœ€å…ˆçŠ¶æ€,å¦‚æœä¸åœ¨æ´»è·ƒé˜¶æ®µ,åˆ™ä¸æ”¹å˜çŠ¶æ€</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!observer.shouldBeActive()) &#123;</span><br><span class=\"line\">            observer.activeStateChanged(<span class=\"keyword\">false</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// åˆ¤æ–­version , å› ä¸ºä»ä¸Šé¢æ¥çœ‹,æ¯æ¬¡èµ‹å€¼versionéƒ½ä¼šå˜å¾—</span></span><br><span class=\"line\">        <span class=\"comment\">// ä»–å¦ˆçš„çš„,è¿™æ ·å°±ä¸ä¼šé™·å…¥å¤šæ¬¡åˆ†å‘,ä¿è¯åªå–æœ€å…ˆçš„ä¼ å€¼</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (observer.mLastVersion &gt;= mVersion) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        observer.mLastVersion = mVersion;</span><br><span class=\"line\">        <span class=\"comment\">// æ‰§è¡Œæ¯ä¸ªç”Ÿå‘½å‘¨æœŸç®¡ç†è€…çš„è§‚å¯Ÿè€…çš„äº‹ä»¶åˆ†å‘</span></span><br><span class=\"line\">        observer.mObserver.onChanged((T) mData);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>getåˆ°æ²¡æœ‰?<br>\n<img src=\"https://z3.ax1x.com/2021/11/08/I8YNWQ.png\" alt=\"I8YNWQ.png\" loading=\"lazy\">]</p>\n",
            "tags": [
                "æºç è§£æ"
            ]
        },
        {
            "id": "https://onion99.github.io/2022/03/02/uVaapTCHAYrYDaHP/",
            "url": "https://onion99.github.io/2022/03/02/uVaapTCHAYrYDaHP/",
            "title": "æºç å­¦ä¹ -Lifecycle",
            "date_published": "2022-03-01T17:33:23.000Z",
            "content_html": "<p><img src=\"https://s4.ax1x.com/2022/03/01/blNKTx.png\" alt=\"space\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<blockquote>\n<p>Jetpack Lifecycle æä¾›äº†å¯ç”¨äºæ„å»ºç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥å‹ç»„ä»¶çš„ç±»å’Œæ¥å£,ä»è€Œæ ¹æ® Activity æˆ– Fragment çš„å½“å‰ç”Ÿå‘½å‘¨æœŸçŠ¶æ€è‡ªåŠ¨è°ƒæ•´å…¶è¡Œä¸º,è®°ä½æˆ‘ä»¬è¦è§£æçš„æ˜¯Jet Pack Lifecycle ,è€Œä¸æ˜¯ åŸæœ‰Activity/Fragmentçš„ç”Ÿå‘½å‘¨æœŸæµç¨‹</p>\n</blockquote>\n<span id=\"more\"></span>\n<h3 id=\"ä½¿ç”¨\">ä½¿ç”¨<a title=\"#ä½¿ç”¨\" href=\"#ä½¿ç”¨\"></a></h3>\n<h4 id=\"é€šè¿‡-defaultlifecycleobserver-å®ç°\">é€šè¿‡ DefaultLifecycleObserver å®ç°<a title=\"#é€šè¿‡-defaultlifecycleobserver-å®ç°\" href=\"#é€šè¿‡-defaultlifecycleobserver-å®ç°\"></a></h4>\n<blockquote>\n<p>ç±»å¯ä»¥é€šè¿‡å®ç° DefaultLifecycleObserver å¹¶æ›¿æ¢ç›¸åº”çš„æ–¹æ³•ï¼ˆå¦‚ onCreate å’Œ onStart ç­‰ï¼‰æ¥ç›‘æ§ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨ Lifecycle ç±»çš„ addObserver() æ–¹æ³•å¹¶ä¼ é€’è§‚å¯Ÿå™¨çš„å®ä¾‹æ¥æ·»åŠ è§‚å¯Ÿå™¨</p>\n</blockquote>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// æ„å»ºç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥å‹ç»„ä»¶</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyObserver</span> : <span class=\"type\">DefaultLifecycleObserver &#123;</span></span></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onResume</span><span class=\"params\">(owner: <span class=\"type\">LifecycleOwner</span>)</span></span> &#123;</span><br><span class=\"line\">        connect() <span class=\"comment\">// åœ¨é¡µé¢ onResume æ—¶è¿æ¥</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onPause</span><span class=\"params\">(owner: <span class=\"type\">LifecycleOwner</span>)</span></span> &#123;</span><br><span class=\"line\">        disconnect() <span class=\"comment\">// åœ¨é¡µé¢ onStop æ—¶è¿æ¥</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// æ·»åŠ ç”Ÿå‘½å‘¨æœŸè§‚å¯Ÿå™¨</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(...)</span></span> &#123;</span><br><span class=\"line\">\t    myLifecycleOwner.getLifecycle().addObserver(MyObserver())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"é€šè¿‡æ³¨è§£å®ç°licecycle-observer\">é€šè¿‡æ³¨è§£å®ç°Licecycle Observer<a title=\"#é€šè¿‡æ³¨è§£å®ç°licecycle-observer\" href=\"#é€šè¿‡æ³¨è§£å®ç°licecycle-observer\"></a></h4>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ILifecycleObserver</span> : <span class=\"type\">LifecycleObserver &#123;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@OnLifecycleEvent(Lifecycle.Event.ON_CREATE)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(owner: <span class=\"type\">LifecycleOwner</span>)</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@OnLifecycleEvent(Lifecycle.Event.ON_START)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onStart</span><span class=\"params\">(owner: <span class=\"type\">LifecycleOwner</span>)</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@OnLifecycleEvent(Lifecycle.Event.ON_RESUME)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onResume</span><span class=\"params\">(owner: <span class=\"type\">LifecycleOwner</span>)</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@OnLifecycleEvent(Lifecycle.Event.ON_PAUSE)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onPause</span><span class=\"params\">(owner: <span class=\"type\">LifecycleOwner</span>)</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@OnLifecycleEvent(Lifecycle.Event.ON_STOP)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onStop</span><span class=\"params\">(owner: <span class=\"type\">LifecycleOwner</span>)</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@OnLifecycleEvent(Lifecycle.Event.ON_DESTROY)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onDestroy</span><span class=\"params\">(owner: <span class=\"type\">LifecycleOwner</span>)</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@OnLifecycleEvent(Lifecycle.Event.ON_ANY)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onLifecycleChanged</span><span class=\"params\">(owner: <span class=\"type\">LifecycleOwner</span>, event: <span class=\"type\">Lifecycle</span>.<span class=\"type\">Event</span>)</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 2</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyObserver</span> : <span class=\"type\">ILifecycleObserver &#123;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(owner: <span class=\"type\">LifecycleOwner</span>)</span></span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onStart</span><span class=\"params\">(owner: <span class=\"type\">LifecycleOwner</span>)</span></span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onResume</span><span class=\"params\">(owner: <span class=\"type\">LifecycleOwner</span>)</span></span> &#123;</span><br><span class=\"line\">        connect() <span class=\"comment\">// åœ¨é¡µé¢ onResume æ—¶è¿æ¥</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onPause</span><span class=\"params\">(owner: <span class=\"type\">LifecycleOwner</span>)</span></span> &#123;</span><br><span class=\"line\">        disconnect() <span class=\"comment\">// åœ¨é¡µé¢ onStop æ—¶è¿æ¥</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onStop</span><span class=\"params\">(owner: <span class=\"type\">LifecycleOwner</span>)</span></span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onDestroy</span><span class=\"params\">(owner: <span class=\"type\">LifecycleOwner</span>)</span></span> &#123;&#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onLifecycleChanged</span><span class=\"params\">(owner: <span class=\"type\">LifecycleOwner</span>, event: <span class=\"type\">Lifecycle</span>.<span class=\"type\">Event</span>)</span></span> &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"è§£æ\">è§£æ<a title=\"#è§£æ\" href=\"#è§£æ\"></a></h3>\n<h4 id=\"classç»„æˆ\">Classç»„æˆ<a title=\"#classç»„æˆ\" href=\"#classç»„æˆ\"></a></h4>\n<ol>\n<li>é¦–å…ˆæˆ‘ä»¬å¾—çŸ¥é“Activity/Fragmentæ˜¯å¦‚ä½•å®ç°LifecycleOwnerçš„</li>\n</ol>\n<p>LifecycleOwner:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">LifecycleOwner</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Returns the Lifecycle of the provider.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@NonNull</span></span><br><span class=\"line\">    <span class=\"function\">Lifecycle <span class=\"title\">getLifecycle</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¯ä»¥çœ‹åˆ°Fragment å’ŒActivityéƒ½å®ç°äº†ç›¸å…³çš„LifecycleOwneræ¥å£</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Fragment</span> <span class=\"keyword\">implements</span> <span class=\"title\">ComponentCallbacks</span>, <span class=\"title\">OnCreateContextMenuListener</span>, <span class=\"title\">LifecycleOwner</span>,</span></span><br><span class=\"line\"><span class=\"class\">        <span class=\"title\">ViewModelStoreOwner</span>, <span class=\"title\">HasDefaultViewModelProviderFactory</span>, <span class=\"title\">SavedStateRegistryOwner</span>,</span></span><br><span class=\"line\"><span class=\"class\">        <span class=\"title\">ActivityResultCaller</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    LifecycleRegistry mLifecycleRegistry;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">initLifecycle</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        mLifecycleRegistry = <span class=\"keyword\">new</span> LifecycleRegistry(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Lifecycle <span class=\"title\">getLifecycle</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mLifecycleRegistry;</span><br><span class=\"line\">    &#125;    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ComponentActivity</span> <span class=\"keyword\">extends</span> <span class=\"title\">androidx</span>.<span class=\"title\">core</span>.<span class=\"title\">app</span>.<span class=\"title\">ComponentActivity</span> <span class=\"keyword\">implements</span></span></span><br><span class=\"line\"><span class=\"class\">        <span class=\"title\">ContextAware</span>,</span></span><br><span class=\"line\"><span class=\"class\">        <span class=\"title\">LifecycleOwner</span>,</span></span><br><span class=\"line\"><span class=\"class\">        <span class=\"title\">ViewModelStoreOwner</span>,</span></span><br><span class=\"line\"><span class=\"class\">        <span class=\"title\">HasDefaultViewModelProviderFactory</span>,</span></span><br><span class=\"line\"><span class=\"class\">        <span class=\"title\">SavedStateRegistryOwner</span>,</span></span><br><span class=\"line\"><span class=\"class\">        <span class=\"title\">OnBackPressedDispatcherOwner</span>,</span></span><br><span class=\"line\"><span class=\"class\">        <span class=\"title\">ActivityResultRegistryOwner</span>,</span></span><br><span class=\"line\"><span class=\"class\">        <span class=\"title\">ActivityResultCaller</span> </span>&#123;&#125; </span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>æ˜ç¡®LifecycleRegistryä¸»è¦ä½œç”¨</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* å®šä¹‰ä¸€ä¸ªå…·æœ‰ Android ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Lifecycle</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@MainThread</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title\">addObserver</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> LifecycleObserver observer)</span></span>;</span><br><span class=\"line\">    <span class=\"meta\">@MainThread</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title\">removeObserver</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> LifecycleObserver observer)</span></span>;</span><br><span class=\"line\">    <span class=\"comment\">// ç”Ÿå‘½å‘¨æœŸäº‹ä»¶,è¡¨æ˜å·²è¢«åˆ†å‘çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶,æ˜ å°„åˆ°Activityå’ŒFragmentä¸­çš„å›è°ƒäº‹ä»¶ </span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">Event</span> </span>&#123;</span><br><span class=\"line\">        ON_CREATE,ON_START,ON_RESUME,ON_PAUSE,ON_STOP,ON_DESTROY,ON_ANY;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// ç”Ÿå‘½å‘¨æœŸçŠ¶æ€,è¡¨æ˜ç»„ä»¶çš„å½“å‰çŠ¶æ€</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">State</span> </span>&#123;</span><br><span class=\"line\">        DESTROYED,INITIALIZED,CREATED,STARTED,RESUMED;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* å¯ä»¥å¤„ç†å¤šä¸ªObserverçš„Lifecycleå®ç°,Fragmentå’ŒActivityä½¿ç”¨ */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LifecycleRegistry</span> <span class=\"keyword\">extends</span> <span class=\"title\">Lifecycle</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">LifecycleRegistry</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> LifecycleOwner provider, <span class=\"keyword\">boolean</span> enforceMainThread)</span> </span>&#123;</span><br><span class=\"line\">        mLifecycleOwner = <span class=\"keyword\">new</span> WeakReference&lt;&gt;(provider);</span><br><span class=\"line\">        mState = INITIALIZED;</span><br><span class=\"line\">        mEnforceMainThread = enforceMainThread;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>åˆ°è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥å¤§è‡´è¿™ä¹ˆè®¤ä¸ºäº†, LifecycleOwner é€šè¿‡è·å–å½“å‰å¯¹åº”çš„ LifecycleRegistry  ç®¡ç†å¤šä¸ªLicecycleObserver,ç„¶ååœ¨ç”Ÿå‘½å‘¨æœŸçŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶,å¤„ç†ä¸åŒçŠ¶æ€äº‹ä»¶çš„åˆ†æ”¾</li>\n</ol>\n<h4 id=\"activity-æ˜¯å¦‚ä½•å®ç°jetpack-lifecycleäº‹ä»¶åˆ†æ”¾çš„?\">Activity æ˜¯å¦‚ä½•å®ç°Jetpack Lifecycleäº‹ä»¶åˆ†æ”¾çš„?<a title=\"#activity-æ˜¯å¦‚ä½•å®ç°jetpack-lifecycleäº‹ä»¶åˆ†æ”¾çš„?\" href=\"#activity-æ˜¯å¦‚ä½•å®ç°jetpack-lifecycleäº‹ä»¶åˆ†æ”¾çš„?\"></a></h4>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> androidx.core.app;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ComponentActivity</span> <span class=\"title\">extends</span> <span class=\"title\">Activity</span> <span class=\"title\">implements</span> <span class=\"title\">LifecycleOwner</span>,<span class=\"type\">KeyEventDispatcher.Component &#123;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> LifecycleRegistry mLifecycleRegistry = new LifecycleRegistry(<span class=\"keyword\">this</span>); <span class=\"comment\">//1</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">protected</span> void onCreate(<span class=\"meta\">@Nullable</span> Bundle savedInstanceState) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState);</span><br><span class=\"line\">        ReportFragment.injectIfNeededIn(<span class=\"keyword\">this</span>); <span class=\"comment\">// 3</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Lifecycle getLifecycle() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mLifecycleRegistry; <span class=\"comment\">// 2</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ³¨æ„çœ‹ReportFragment:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ReportFragment</span> <span class=\"keyword\">extends</span> <span class=\"title\">Fragment</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String REPORT_FRAGMENT_TAG = <span class=\"string\">&quot;androidx.lifecycle&quot;</span></span><br><span class=\"line\">            + <span class=\"string\">&quot;.LifecycleDispatcher.report_fragment_tag&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">injectIfNeededIn</span><span class=\"params\">(Activity activity)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Build.VERSION.SDK_INT &gt;= <span class=\"number\">29</span>) &#123;</span><br><span class=\"line\">         activity.registerActivityLifecycleCallbacks(<span class=\"keyword\">new</span> LifecycleCallbacks());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">       </span><br><span class=\"line\">        android.app.FragmentManager manager = activity.getFragmentManager();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (manager.findFragmentByTag(REPORT_FRAGMENT_TAG) == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            manager.beginTransaction().add(<span class=\"keyword\">new</span> ReportFragment(), REPORT_FRAGMENT_TAG).commit();</span><br><span class=\"line\">            <span class=\"comment\">// Hopefully, we are the first to make a transaction.</span></span><br><span class=\"line\">            manager.executePendingTransactions();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@SuppressWarnings(&quot;deprecation&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">dispatch</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Activity activity, <span class=\"meta\">@NonNull</span> Lifecycle.Event event)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//å·²ç»è¢«æ ‡æ³¨ä¸º@Deprecated</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (activity <span class=\"keyword\">instanceof</span> LifecycleRegistryOwner) &#123;</span><br><span class=\"line\">            ((LifecycleRegistryOwner) activity).getLifecycle().handleLifecycleEvent(event);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (activity <span class=\"keyword\">instanceof</span> LifecycleOwner) &#123;</span><br><span class=\"line\">            Lifecycle lifecycle = ((LifecycleOwner) activity).getLifecycle();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (lifecycle <span class=\"keyword\">instanceof</span> LifecycleRegistry) &#123;</span><br><span class=\"line\">                ((LifecycleRegistry) lifecycle).handleLifecycleEvent(event);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> ReportFragment <span class=\"title\">get</span><span class=\"params\">(Activity activity)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (ReportFragment) activity.getFragmentManager().findFragmentByTag(</span><br><span class=\"line\">                REPORT_FRAGMENT_TAG);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityCreated</span><span class=\"params\">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onActivityCreated(savedInstanceState);</span><br><span class=\"line\">        dispatchCreate(mProcessListener);</span><br><span class=\"line\">        dispatch(Lifecycle.Event.ON_CREATE);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onStart</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onStart();</span><br><span class=\"line\">        dispatchStart(mProcessListener);</span><br><span class=\"line\">        dispatch(Lifecycle.Event.ON_START);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onResume</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onResume();</span><br><span class=\"line\">        dispatchResume(mProcessListener);</span><br><span class=\"line\">        dispatch(Lifecycle.Event.ON_RESUME);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onPause</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onPause();</span><br><span class=\"line\">        dispatch(Lifecycle.Event.ON_PAUSE);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onStop</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onStop();</span><br><span class=\"line\">        dispatch(Lifecycle.Event.ON_STOP);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onDestroy</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onDestroy();</span><br><span class=\"line\">        dispatch(Lifecycle.Event.ON_DESTROY);</span><br><span class=\"line\">        <span class=\"comment\">// just want to be sure that we won&#x27;t leak reference to an activity</span></span><br><span class=\"line\">        mProcessListener = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">dispatch</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Lifecycle.Event event)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Build.VERSION.SDK_INT &lt; <span class=\"number\">29</span>) &#123;</span><br><span class=\"line\">            dispatch(getActivity(), event);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//API29åŠä»¥ä¸Šç›´æ¥ä½¿ç”¨Application.ActivityLifecycleCallbacksæ¥ç›‘å¬ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LifecycleCallbacks</span> <span class=\"keyword\">implements</span> <span class=\"title\">Application</span>.<span class=\"title\">ActivityLifecycleCallbacks</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityCreated</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Activity activity,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                <span class=\"meta\">@Nullable</span> Bundle bundle)</span> </span>&#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityPostCreated</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Activity activity,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                <span class=\"meta\">@Nullable</span> Bundle savedInstanceState)</span> </span>&#123;</span><br><span class=\"line\">            dispatch(activity, Lifecycle.Event.ON_CREATE);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityStarted</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Activity activity)</span> </span>&#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityPostStarted</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Activity activity)</span> </span>&#123;</span><br><span class=\"line\">            dispatch(activity, Lifecycle.Event.ON_START);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityResumed</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Activity activity)</span> </span>&#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityPostResumed</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Activity activity)</span> </span>&#123;</span><br><span class=\"line\">            dispatch(activity, Lifecycle.Event.ON_RESUME);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityPrePaused</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Activity activity)</span> </span>&#123;</span><br><span class=\"line\">            dispatch(activity, Lifecycle.Event.ON_PAUSE);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityPaused</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Activity activity)</span> </span>&#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityPreStopped</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Activity activity)</span> </span>&#123;</span><br><span class=\"line\">            dispatch(activity, Lifecycle.Event.ON_STOP);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityStopped</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Activity activity)</span> </span>&#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivitySaveInstanceState</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Activity activity,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                <span class=\"meta\">@NonNull</span> Bundle bundle)</span> </span>&#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityPreDestroyed</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Activity activity)</span> </span>&#123;</span><br><span class=\"line\">            dispatch(activity, Lifecycle.Event.ON_DESTROY);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityDestroyed</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Activity activity)</span> </span>&#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>é€šè¿‡ä¸€ä¸ªé€æ˜çš„Fragmentæ¥åˆ†å‘ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œè¿™æ ·å¯¹äºActivityæ¥è¯´æ˜¯æ— ä¾µå…¥çš„ã€‚åˆ†æˆä¸¤éƒ¨åˆ†é€»è¾‘ï¼š</p>\n<ul>\n<li>å½“API&gt;=29æ—¶ï¼Œç›´æ¥ä½¿ç”¨Application.ActivityLifecycleCallbacksæ¥åˆ†å‘ç”Ÿå‘½å‘¨æœŸäº‹ä»¶</li>\n<li>è€Œå½“API&lt;29æ—¶ï¼Œåœ¨Fragmentçš„ç”Ÿå‘½å‘¨æœŸå›è°ƒä¸­è¿›è¡Œäº†äº‹ä»¶åˆ†å‘ã€‚<br>\nä½†æ®Šé€”åŒå½’ï¼Œä¸¤è€…æœ€ç»ˆéƒ½ä¼šèµ°åˆ°<code>dispatch(Activity activity, Lifecycle.Event event)</code>æ–¹æ³•</li>\n</ul>\n<h4 id=\"lifecycleobserver-æ˜¯å¦‚ä½•è¢«å“åº”çš„?\">LifecycleObserver æ˜¯å¦‚ä½•è¢«å“åº”çš„?<a title=\"#lifecycleobserver-æ˜¯å¦‚ä½•è¢«å“åº”çš„?\" href=\"#lifecycleobserver-æ˜¯å¦‚ä½•è¢«å“åº”çš„?\"></a></h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 1 */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ReportFragment</span></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// äº‹ä»¶åˆ†å‘</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">dispatch</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Activity activity, <span class=\"meta\">@NonNull</span> Lifecycle.Event event)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (activity <span class=\"keyword\">instanceof</span> LifecycleRegistryOwner) &#123;</span><br><span class=\"line\">            ((LifecycleRegistryOwner) activity).getLifecycle().handleLifecycleEvent(event);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (activity <span class=\"keyword\">instanceof</span> LifecycleOwner) &#123;</span><br><span class=\"line\">            Lifecycle lifecycle = ((LifecycleOwner) activity).getLifecycle();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (lifecycle <span class=\"keyword\">instanceof</span> LifecycleRegistry) &#123;</span><br><span class=\"line\">                ((LifecycleRegistry) lifecycle).handleLifecycleEvent(event);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/* 2 */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LifecycleRegistry</span> <span class=\"keyword\">extends</span> <span class=\"title\">Lifecycle</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1-å¤„ç†ç”Ÿå‘½å‘¨æœŸäº‹ä»¶</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">handleLifecycleEvent</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Lifecycle.Event event)</span> </span>&#123;</span><br><span class=\"line\">        enforceMainThreadIfNeeded(<span class=\"string\">&quot;handleLifecycleEvent&quot;</span>);</span><br><span class=\"line\">        moveToState(event.getTargetState());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 2.2-åˆ¤æ–­ç”Ÿå‘½å‘¨æœŸçŠ¶æ€</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">moveToState</span><span class=\"params\">(State next)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mState == next) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        mState = next;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mHandlingEvent || mAddingObserverCounter != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            mNewEventOccurred = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            <span class=\"comment\">// we will figure out what to do on upper level.</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        mHandlingEvent = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        sync();</span><br><span class=\"line\">        mHandlingEvent = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 2-3 åŒæ­¥çŠ¶æ€è‡³LifecycleObserver</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">sync</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        LifecycleOwner lifecycleOwner = mLifecycleOwner.get();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (lifecycleOwner == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalStateException(<span class=\"string\">&quot;LifecycleOwner of this LifecycleRegistry is already&quot;</span></span><br><span class=\"line\">                    + <span class=\"string\">&quot;garbage collected. It is too late to change lifecycle state.&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (!isSynced()) &#123;</span><br><span class=\"line\">            mNewEventOccurred = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            <span class=\"comment\">// no need to check eldest for nullability, because isSynced does it for us.</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (mState.compareTo(mObserverMap.eldest().getValue().mState) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                backwardPass(lifecycleOwner);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            Entry&lt;LifecycleObserver, ObserverWithState&gt; newest = mObserverMap.newest();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!mNewEventOccurred &amp;&amp; newest != <span class=\"keyword\">null</span></span><br><span class=\"line\">                    &amp;&amp; mState.compareTo(newest.getValue().mState) &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                forwardPass(lifecycleOwner);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        mNewEventOccurred = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">forwardPass</span><span class=\"params\">(LifecycleOwner lifecycleOwner)</span> </span>&#123;</span><br><span class=\"line\">        Iterator&lt;Entry&lt;LifecycleObserver, ObserverWithState&gt;&gt; ascendingIterator =</span><br><span class=\"line\">                mObserverMap.iteratorWithAdditions();</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (ascendingIterator.hasNext() &amp;&amp; !mNewEventOccurred) &#123;</span><br><span class=\"line\">            Entry&lt;LifecycleObserver, ObserverWithState&gt; entry = ascendingIterator.next();</span><br><span class=\"line\">            ObserverWithState observer = entry.getValue();</span><br><span class=\"line\">            <span class=\"keyword\">while</span> ((observer.mState.compareTo(mState) &lt; <span class=\"number\">0</span> &amp;&amp; !mNewEventOccurred</span><br><span class=\"line\">                    &amp;&amp; mObserverMap.contains(entry.getKey()))) &#123;</span><br><span class=\"line\">                pushParentState(observer.mState);</span><br><span class=\"line\">                <span class=\"keyword\">final</span> Event event = Event.upFrom(observer.mState);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (event == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalStateException(<span class=\"string\">&quot;no event up from &quot;</span> + observer.mState);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                observer.dispatchEvent(lifecycleOwner, event);</span><br><span class=\"line\">                popParentState();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">backwardPass</span><span class=\"params\">(LifecycleOwner lifecycleOwner)</span> </span>&#123;</span><br><span class=\"line\">        Iterator&lt;Entry&lt;LifecycleObserver, ObserverWithState&gt;&gt; descendingIterator =</span><br><span class=\"line\">                mObserverMap.descendingIterator();</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (descendingIterator.hasNext() &amp;&amp; !mNewEventOccurred) &#123;</span><br><span class=\"line\">            Entry&lt;LifecycleObserver, ObserverWithState&gt; entry = descendingIterator.next();</span><br><span class=\"line\">            ObserverWithState observer = entry.getValue();</span><br><span class=\"line\">            <span class=\"keyword\">while</span> ((observer.mState.compareTo(mState) &gt; <span class=\"number\">0</span> &amp;&amp; !mNewEventOccurred</span><br><span class=\"line\">                    &amp;&amp; mObserverMap.contains(entry.getKey()))) &#123;</span><br><span class=\"line\">                Event event = Event.downFrom(observer.mState);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (event == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalStateException(<span class=\"string\">&quot;no event down from &quot;</span> + observer.mState);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                pushParentState(event.getTargetState());</span><br><span class=\"line\">                observer.dispatchEvent(lifecycleOwner, event);</span><br><span class=\"line\">                popParentState();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"refer\">Refer<a title=\"#refer\" href=\"#refer\"></a></h3>\n<p><a href=\"https://www.mo4tech.com/analysis-of-the-basic-use-and-rationale-of-android-jetpack-component-lifecycle.html\" target=\"_blank\">Analysis of the basic use and rationale of Android Jetpack component Lifecycle - Moment For Technology (mo4tech.com)</a></p>\n<p><a href=\"https://blog.csdn.net/u013700502/article/details/118469311\" target=\"_blank\">Android Jetpackç³»åˆ—ä¹‹Lifecycle_å°é©¬å¿«è·‘çš„åšå®¢-CSDNåšå®¢_androidä¸­lifecycle</a></p>\n",
            "tags": [
                "æºç è§£æ"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/30/9S5c1rplpdSAbIxR/",
            "url": "https://onion99.github.io/2021/11/30/9S5c1rplpdSAbIxR/",
            "title": "æºç å­¦ä¹ -ViewModel",
            "date_published": "2021-11-29T23:30:53.000Z",
            "content_html": "<p>é¦–å…ˆçœ‹çœ‹ViewModelæ˜¯æ€ä¹ˆæ ·å®ä¾‹åŒ–</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"keyword\">open</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"type\">&lt;T : ViewModel?&gt;</span> <span class=\"title\">getFragmentScopeViewModel</span><span class=\"params\">(modelClass: <span class=\"type\">Class</span>&lt;<span class=\"type\">T</span>&gt;)</span></span>: T &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!::fragmentProvider.isInitialized) &#123;</span><br><span class=\"line\">        fragmentProvider = ViewModelProvider(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> fragmentProvider.<span class=\"keyword\">get</span>(modelClass)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"keyword\">open</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"type\">&lt;T : ViewModel?&gt;</span> <span class=\"title\">getActivityScopeViewModel</span><span class=\"params\">(modelClass: <span class=\"type\">Class</span>&lt;<span class=\"type\">T</span>&gt;)</span></span>: T &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!::activityProvider.isInitialized) &#123;</span><br><span class=\"line\">        activityProvider = ViewModelProvider(requireActivity())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> activityProvider.<span class=\"keyword\">get</span>(modelClass)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æˆ‘è¶…,åŸæ¥æ˜¯é€šè¿‡ä¸€ä¸ªViewModelProviderå»getåˆ°çš„,ä»–å¦ˆçš„è¿™æ˜¯å¹²ä»€ä¹ˆçš„å‘¢,ä¸ºä»€ä¹ˆè¦é€šè¿‡ViewModelProviderè·å–å‘¢<br>\n<img src=\"http://img.doutula.com/production/uploads/image/2019/06/06/20190606755268_TSvBec.jpg\" alt=\"\" loading=\"lazy\"><br>\næˆ‘æ€ä¹ˆçŸ¥é“,ç§ç§å®˜æ–¹æ­£å„¿å…«ç»çš„å›ç­”å§<br>\n<code>ViewModel</code>:æ—¨åœ¨ä»¥æ³¨é‡ç”Ÿå‘½å‘¨æœŸçš„æ–¹å¼å­˜å‚¨å’Œç®¡ç†ç•Œé¢ç›¸å…³çš„æ•°æ®ã€‚ViewModel ç±»è®©æ•°æ®å¯åœ¨å‘ç”Ÿå±å¹•æ—‹è½¬ç­‰é…ç½®æ›´æ”¹åç»§ç»­ç•™å­˜<br>\n<code>ViewModelProvider</code>: ViewModelçš„è¾…åŠ©ç¨‹åºç±»ï¼Œè¯¥ç±»è´Ÿè´£ä¸ºç•Œé¢å‡†å¤‡æ•°æ®ã€‚åœ¨é…ç½®æ›´æ”¹æœŸé—´ä¼šè‡ªåŠ¨ä¿ç•™ ViewModel å¯¹è±¡ï¼Œä»¥ä¾¿å®ƒä»¬å­˜å‚¨çš„æ•°æ®ç«‹å³å¯ä¾›ä¸‹ä¸€ä¸ª activity æˆ– fragment å®ä¾‹ä½¿ç”¨</p>\n<span id=\"more\"></span>\n<p>å¥½å®¶ä¼™,åŸæ¥æ˜¯è¿™å¯¹ç»„åˆ,ä»¥ç”Ÿå‘½å‘¨æœŸçš„æ–¹å¼è€¶,çœ‹çœ‹æœ‰ä»€ä¹ˆä¸åŒ</p>\n<h3 id=\"activtyä¸viewmodelçš„ç”Ÿå‘½å‘¨æœŸ\">Activtyä¸ViewModelçš„ç”Ÿå‘½å‘¨æœŸ<a title=\"#activtyä¸viewmodelçš„ç”Ÿå‘½å‘¨æœŸ\" href=\"#activtyä¸viewmodelçš„ç”Ÿå‘½å‘¨æœŸ\"></a></h3>\n<blockquote>\n<p>ç‰›é€¼,æˆ˜æ–—ç›´è‡³Finish</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/11/08/I8L0jU.png\" alt=\"I8L0jU.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>å®˜æ–¹è¯´:ViewModelå¯¹è±¡å­˜åœ¨çš„æ—¶é—´èŒƒå›´æ˜¯è·å– ViewModel æ—¶ä¼ é€’ç»™ ViewModelProvider çš„Lifecycleã€‚ViewModelå°†ä¸€ç›´ç•™åœ¨å†…å­˜ä¸­ï¼Œç›´åˆ°é™å®šå…¶å­˜åœ¨æ—¶é—´èŒƒå›´çš„Lifecycleæ°¸ä¹…æ¶ˆå¤±ï¼š<br>\nå¯¹äºactivityï¼Œæ˜¯åœ¨activityå®Œæˆæ—¶ï¼›<br>\nå¯¹äºfragmentï¼Œæ˜¯åœ¨ fragmentåˆ†ç¦»æ—¶</p>\n<p>å¥½äº†,æ¥çœ‹çœ‹ViewModelProvideræ˜¯æ€æ ·å®ç°æ„é€ çš„</p>\n<h3 id=\"viewmodelprovider()\">ViewModelProvider()<a title=\"#viewmodelprovider()\" href=\"#viewmodelprovider()\"></a></h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ViewModelProvider</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> ViewModelStoreOwner owner)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// å°¼ç›çš„,å·å·è°ƒç”¨å¦ä¸€æ„é€ å‡½æ•°</span></span><br><span class=\"line\">        <span class=\"comment\">// 1.åˆ›å»ºç”¨æ¥å­˜å‚¨ViewModelçš„ViewModelStore, 2. åˆ›å»ºç”¨äºå®ä¾‹åŒ–æ–°ViewModelçš„Factory</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>(owner.getViewModelStore(), owner <span class=\"keyword\">instanceof</span> HasDefaultViewModelProviderFactory</span><br><span class=\"line\">                ? ((HasDefaultViewModelProviderFactory) owner).getDefaultViewModelProviderFactory()</span><br><span class=\"line\">                : NewInstanceFactory.getInstance());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"viewmodelstore\">ViewModelStore<a title=\"#viewmodelstore\" href=\"#viewmodelstore\"></a></h4>\n<p>è¿™ä¸ªæ˜¯æ¥å£ä½•è®¸ç©æ„,åŸæ¥åˆ°åé¢Activity,Fragmentç­‰éƒ½å®ç°äº†è¿™ä¸ªæ¥å£,ä»¥æ¥è·å–è·Ÿå½“å‰ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„ViewModelStore,çœ‹åˆ°æ²¡æœ‰,æœ‰å›¾æœ‰çœŸç›¸<br>\n<img src=\"https://z3.ax1x.com/2021/11/08/I8xIk4.png\" alt=\"I8xIk4.png\" loading=\"lazy\"><br>\nçœ‹çœ‹<code>ComponentActivity.getViewModelStore()</code>:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ViewModelStore <span class=\"title\">getViewModelStore</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (getApplication() == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalStateException(<span class=\"string\">&quot;Your activity is not yet attached to the &quot;</span></span><br><span class=\"line\">                + <span class=\"string\">&quot;Application instance. You can&#x27;t request ViewModel before onCreate call.&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// å‰,è¿™é‡Œç…§æˆ‘çŒœæƒ³è‚¯å®šæ˜¯å®ç°ViewModelStoreçš„å•ä¾‹</span></span><br><span class=\"line\">    ensureViewModelStore();</span><br><span class=\"line\">    <span class=\"comment\">// è¿”å›ä¸æ­¤Activityå…³è”çš„ViewModelStore</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> mViewModelStore;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//...</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">ensureViewModelStore</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mViewModelStore == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// æ£€ç´¢å…ˆå‰ç”±onRetainNonConfigurationInstance()è¿”å›çš„é…ç½®å˜æ›´åçš„ç¼“å­˜é…ç½®</span></span><br><span class=\"line\">        NonConfigurationInstances nc = (NonConfigurationInstances) getLastNonConfigurationInstance();</span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœç¼“å­˜é…ç½®ä¸ä¸ºç©º,åˆ™å–ç¼“å­˜é…ç½®çš„viewModelStore</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (nc != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            mViewModelStore = nc.viewModelStore;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// å¦åˆ™è‡ªå·±å®ä¾‹ä¸€ä¸ª</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mViewModelStore == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            mViewModelStore = <span class=\"keyword\">new</span> ViewModelStore();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;    </span><br></pre></td></tr></table></figure>\n<p>å˜¿å˜¿,å­˜å‚¨ViewModelçš„ViewModelStore,ç‰›é€¼å•Š,ç”¨ä¸€ä¸ªHashMapæ¥ç¼“å­˜çœ‹åˆ°æœ‰æœ¨æœ‰:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ViewModelStore</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> HashMap&lt;String, ViewModel&gt; mMap = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">put</span><span class=\"params\">(String key, ViewModel viewModel)</span> </span>&#123;</span><br><span class=\"line\">        ViewModel oldViewModel = mMap.put(key, viewModel);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (oldViewModel != <span class=\"keyword\">null</span>) oldViewModel.onCleared();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">final</span> ViewModel <span class=\"title\">get</span><span class=\"params\">(String key)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mMap.get(key);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">Set&lt;String&gt; <span class=\"title\">keys</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> HashSet&lt;&gt;(mMap.keySet());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">clear</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (ViewModel vm : mMap.values()) &#123;</span><br><span class=\"line\">            vm.clear();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        mMap.clear();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://z3.ax1x.com/2021/11/08/IG8UgA.png\" alt=\"IG8UgA.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h4 id=\"viewmodelproviderfactory\">ViewModelProviderFactory<a title=\"#viewmodelproviderfactory\" href=\"#viewmodelproviderfactory\"></a></h4>\n<p>åŒæ ·çš„åé¢Activity,Fragmentç­‰ä¹Ÿå®ç°äº†HasDefaultViewModelProviderFactoryæ¥å£,å®ç°è‡ªå·±åˆ›å»ºViewModelçš„ViewModelProviderFactory, æ¥çœ‹å›¾<br>\n<img src=\"https://z3.ax1x.com/2021/11/08/IGEOT1.png\" alt=\"IGEOT1.png\" loading=\"lazy\"><br>\nå†æ¥çœ‹çœ‹<code>ComponentActivity.getViewModelStore()</code>:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> ViewModelProvider.<span class=\"function\">Factory <span class=\"title\">getDefaultViewModelProviderFactory</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (getApplication() == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalStateException(<span class=\"string\">&quot;Your activity is not yet attached to the &quot;</span></span><br><span class=\"line\">                + <span class=\"string\">&quot;Application instance. You can&#x27;t request ViewModel before onCreate call.&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// å¦ˆçš„,å°±æ˜¯è¿™ä¹ˆç®€å•,ç›´æ¥å®ä¾‹åŒ–</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mDefaultFactory == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        mDefaultFactory = <span class=\"keyword\">new</span> SavedStateViewModelFactory(</span><br><span class=\"line\">                getApplication(),</span><br><span class=\"line\">                <span class=\"keyword\">this</span>,</span><br><span class=\"line\">                getIntent() != <span class=\"keyword\">null</span> ? getIntent().getExtras() : <span class=\"keyword\">null</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mDefaultFactory;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æœ‰ç‚¹ä¸œè¥¿,è¿™æ ·å°±å®ä¾‹<code>SavedStateViewModelFactory</code>äº†,çœ‹çœ‹å…·ä½“æ€ä¹ˆ<code>get()</code>éœ</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ç¬¬ä¸€æ­¥:å°get</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> &lt;T extends ViewModel&gt; <span class=\"function\">T <span class=\"title\">get</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Class&lt;T&gt; modelClass)</span> </span>&#123;</span><br><span class=\"line\">    String canonicalName = modelClass.getCanonicalName();</span><br><span class=\"line\">    <span class=\"comment\">// å¥½å®¶ä¼™,çœ‹åˆ°æ²¡æœ‰,å¦‚æœè¿™é‡Œåˆ¤æ–­æ˜¯å±€éƒ¨ç±»æˆ–è€…åŒ¿åç±»,å°±ç›´æ¥ç»™crashäº†,è°·æ­Œå°±æ˜¯ç‰›é€¼</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (canonicalName == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">&quot;Local and anonymous classes can not be ViewModels&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// å˜¿,ç»§ç»­getä¸‹å»</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> get(DEFAULT_KEY + <span class=\"string\">&quot;:&quot;</span> + canonicalName, modelClass);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// ç¬¬äºŒæ­¥:å¤§get</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> &lt;T extends ViewModel&gt; <span class=\"function\">T <span class=\"title\">get</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> String key, <span class=\"meta\">@NonNull</span> Class&lt;T&gt; modelClass)</span> </span>&#123;</span><br><span class=\"line\">    ViewModel viewModel = mViewModelStore.get(key);</span><br><span class=\"line\">    <span class=\"comment\">// é¦–å…ˆæ˜¯åˆ¤æ–­æ˜¯å¦æœ‰ç¼“å­˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (modelClass.isInstance(viewModel)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mFactory <span class=\"keyword\">instanceof</span> OnRequeryFactory) &#123;</span><br><span class=\"line\">            ((OnRequeryFactory) mFactory).onRequery(viewModel);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (T) viewModel;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// ç„¶åå¦‚æœä¸ºnull,åˆ™é€šè¿‡å…·ä½“å·¥å‚ç±»å»å®ä¾‹åŒ–ViewModel</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mFactory <span class=\"keyword\">instanceof</span> KeyedFactory) &#123;</span><br><span class=\"line\">        viewModel = ((KeyedFactory) mFactory).create(key, modelClass);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        viewModel = mFactory.create(modelClass);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// å˜¿å˜¿,æ”¾è¿›ç¼“å­˜</span></span><br><span class=\"line\">    mViewModelStore.put(key, viewModel);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (T) viewModel;</span><br><span class=\"line\">&#125; </span><br><span class=\"line\"><span class=\"comment\">// ViewModelçš„å®ä¾‹åŒ–</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> &lt;T extends ViewModel&gt; <span class=\"function\">T <span class=\"title\">create</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> String key, <span class=\"meta\">@NonNull</span> Class&lt;T&gt; modelClass)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> isAndroidViewModel = AndroidViewModel.class.isAssignableFrom(modelClass);</span><br><span class=\"line\">    Constructor&lt;T&gt; constructor;</span><br><span class=\"line\">    <span class=\"comment\">// é€šè¿‡åå°„,å»æ‰¾åˆ°å½“å‰ViewModelçš„æ„é€ å‡½æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isAndroidViewModel &amp;&amp; mApplication != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        constructor = findMatchingConstructor(modelClass, ANDROID_VIEWMODEL_SIGNATURE);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        constructor = findMatchingConstructor(modelClass, VIEWMODEL_SIGNATURE);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (constructor == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mFactory.create(modelClass);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    SavedStateHandleController controller = SavedStateHandleController.create(</span><br><span class=\"line\">            mSavedStateRegistry, mLifecycle, key, mDefaultArgs);</span><br><span class=\"line\">    <span class=\"comment\">// å˜¿å˜¿,è°ƒç”¨æ„é€ å‡½æ•°,å®ä¾‹åŒ–        </span></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        T viewmodel;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (isAndroidViewModel &amp;&amp; mApplication != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            viewmodel = constructor.newInstance(mApplication, controller.getHandle());</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            viewmodel = constructor.newInstance(controller.getHandle());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        viewmodel.setTagIfAbsent(TAG_SAVED_STATE_HANDLE_CONTROLLER, controller);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> viewmodel;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (IllegalAccessException e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(<span class=\"string\">&quot;Failed to access &quot;</span> + modelClass, e);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (InstantiationException e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(<span class=\"string\">&quot;A &quot;</span> + modelClass + <span class=\"string\">&quot; cannot be instantiated.&quot;</span>, e);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (InvocationTargetException e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(<span class=\"string\">&quot;An exception happened in constructor of &quot;</span></span><br><span class=\"line\">                + modelClass, e.getCause());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;   </span><br></pre></td></tr></table></figure>\n<h3 id=\"viewmodelçš„æ¶æ„ä½œç”¨\">ViewModelçš„æ¶æ„ä½œç”¨<a title=\"#viewmodelçš„æ¶æ„ä½œç”¨\" href=\"#viewmodelçš„æ¶æ„ä½œç”¨\"></a></h3>\n<p>å‘å®˜æ–¹æ•¬ç¤¼,æ‡‚ä¸æ‡‚è¿™å¼ å›¾çš„å«é‡‘é‡,æ‡‚ä¸æ‡‚MMVM<br>\n<img src=\"https://z3.ax1x.com/2021/11/08/IGd3ff.png\" alt=\"IGd3ff.png\" loading=\"lazy\"><br>\n<img src=\"https://z3.ax1x.com/2021/11/08/IGwfKg.png\" alt=\"IGwfKg.png\" loading=\"lazy\"></p>\n",
            "tags": [
                "æºç è§£æ"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/30/hu0861X6Ltf32fYt/",
            "url": "https://onion99.github.io/2021/11/30/hu0861X6Ltf32fYt/",
            "title": "æºç å­¦ä¹ -DataBinding",
            "date_published": "2021-11-29T23:27:07.000Z",
            "content_html": "<h3 id=\"sameple\">Sameple<a title=\"#sameple\" href=\"#sameple\"></a></h3>\n<p>é¦–å…ˆ,æˆ‘ä»¬æ¥çœ‹çœ‹DataBindingä½¿ç”¨:</p>\n<ol>\n<li>ç»™layoutæ–‡ä»¶å¥—å¨ƒ:</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">layout</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">FrameLayout</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">androidx.viewpager.widget.ViewPager</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/home_pager&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">com.flyco.tablayout.SlidingTabLayout</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/home_tab&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">FrameLayout</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">layout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>åœ¨Fragmentæˆ–è€…Viewä¸­è·å–bindingå¯¹è±¡</li>\n</ol>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">binding = DataBindingUtil.inflate(inflater,layoutRes,container,<span class=\"literal\">false</span>)</span><br></pre></td></tr></table></figure>\n<p>è¶…,å°±æ˜¯è¿™ä¹ˆç®€å•,æ¥ä»<code>inflate</code>å¼€å§‹è§£æ</p>\n<span id=\"more\"></span>\n<h3 id=\"databindingutil.inflateæ¢³ç†\">DataBindingUtil.inflateæ¢³ç†<a title=\"#databindingutil.inflateæ¢³ç†\" href=\"#databindingutil.inflateæ¢³ç†\"></a></h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> &lt;T extends ViewDataBinding&gt; <span class=\"function\">T <span class=\"title\">inflate</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        <span class=\"meta\">@NonNull</span> LayoutInflater inflater, <span class=\"keyword\">int</span> layoutId, <span class=\"meta\">@Nullable</span> ViewGroup parent,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        <span class=\"keyword\">boolean</span> attachToParent, <span class=\"meta\">@Nullable</span> DataBindingComponent bindingComponent)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// æ£€æŸ¥åº·åº·æ˜¯ä¸æ˜¯å­layouté™„åŠ åˆ°çˆ¶layout,ä¸€èˆ¬æ˜¯false,å› ä¸ºå¦‚æœä¸ºtureä¼šå¯¼è‡´å­layoutçš„layoutparams å¤±æ•ˆ</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> useChildren = parent != <span class=\"keyword\">null</span> &amp;&amp; attachToParent;</span><br><span class=\"line\">    <span class=\"comment\">// ä¸Šé¢ä¸€èˆ¬ä¸ºfalse,é‚£è¿™é‡Œä¸€èˆ¬ä¹Ÿæ˜¯é›¶è›‹å•Š</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> startChildren = useChildren ? parent.getChildCount() : <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"comment\">// è§£æxmlç”ŸæˆView,æ”¾ç©ºå¤§è„‘å°±æ˜¯è¿™æ ·,æ·±ç©¶çš„è¯,æˆ‘åªèƒ½ç”©ä¸€ç¯‡éƒ­ç¥çš„æ–‡ç« äº†:https://blog.csdn.net/guolin_blog/article/details/12921889</span></span><br><span class=\"line\">    <span class=\"comment\">// ä»€ä¹ˆå…·ä½“inflateæ˜¯æ€ä¹ˆæ ·,ä¸å¬ä¸å¬ç‹å…«å¿µç»</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> View view = inflater.inflate(layoutId, parent, attachToParent);</span><br><span class=\"line\">    <span class=\"comment\">// å˜¿å˜¿,è¿™é‡Œå¼€å§‹binding</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (useChildren) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> bindToAddedViews(bindingComponent, parent, startChildren, layoutId);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> bind(bindingComponent, view, layoutId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> DataBinderMapper sMapper = <span class=\"keyword\">new</span> DataBinderMapperImpl();</span><br><span class=\"line\"><span class=\"keyword\">static</span> &lt;T extends ViewDataBinding&gt; <span class=\"function\">T <span class=\"title\">bind</span><span class=\"params\">(DataBindingComponent bindingComponent, View root,<span class=\"keyword\">int</span> layoutId)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ä¸ç†äº†,è¿™é‡Œå°±æ‹¿åˆ°bindingäº†,å¯ä»¥ç›´æ¥å¼•ç”¨Viewäº†,åœæ­¢æ€è€ƒ</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (T) sMapper.getDataBinder(bindingComponent, root, layoutId);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>é—®é¢˜æ¥äº†,å®ƒæ˜¯æ€ä¹ˆå–å¾—æˆ‘è¦çš„DataBindingå¯¹è±¡ä¸”åˆæ˜¯æ€ä¹ˆå®ç°Viewç»‘å®šçš„?</p>\n<ol>\n<li>å¥½,æ¥åº·åº·,è¿™ä¸ª<code>DataBinderMapperImpl</code>,è¿™æ˜¯ç¼–è¯‘é˜¶æ®µä¸‹kaptè‡ªåŠ¨ç”Ÿæˆçš„:</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> androidx.databinding;</span><br><span class=\"line\"><span class=\"comment\">// å¥½å®¶ä¼™,è¿™é‡Œç›´æ¥ç»§æ‰¿MergedDataBinderMapper </span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DataBinderMapperImpl</span> <span class=\"keyword\">extends</span> <span class=\"title\">MergedDataBinderMapper</span> </span>&#123;</span><br><span class=\"line\">  DataBinderMapperImpl() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// æ·»åŠ kaptä¸‹ç”Ÿæˆå½“å‰Moduleçš„DataBinderMapperImpl</span></span><br><span class=\"line\">    addMapper(<span class=\"keyword\">new</span> com.xxx.xxx.DataBinderMapperImpl());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"comment\">// åˆå¹¶å…¶ä»–Mapperçš„DataBindingMapper </span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MergedDataBinderMapper</span> <span class=\"keyword\">extends</span> <span class=\"title\">DataBinderMapper</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Set&lt;Class&lt;? extends DataBinderMapper&gt;&gt; mExistingMappers = <span class=\"keyword\">new</span> HashSet&lt;&gt;();</span><br><span class=\"line\">    <span class=\"comment\">// æ·»åŠ Mapper,å¦‚æœå·²ç»å­˜åœ¨åˆ™å¿½ç•¥</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addMapper</span><span class=\"params\">(DataBinderMapper mapper)</span> </span>&#123;</span><br><span class=\"line\">        Class&lt;? extends DataBinderMapper&gt; mapperClass = mapper.getClass();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mExistingMappers.add(mapperClass)) &#123;</span><br><span class=\"line\">            mMappers.add(mapper);</span><br><span class=\"line\">            <span class=\"keyword\">final</span> List&lt;DataBinderMapper&gt; dependencies = mapper.collectDependencies();</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(DataBinderMapper dependency : dependencies) &#123;</span><br><span class=\"line\">                addMapper(dependency);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li><code>MergedDataBinderMapper.getDataBinder</code>:</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ViewDataBinding <span class=\"title\">getDataBinder</span><span class=\"params\">(DataBindingComponent bindingComponent, View view,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        <span class=\"keyword\">int</span> layoutId)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// éå†ä¹‹å‰æ·»åŠ çš„mMappers    </span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(DataBinderMapper mapper : mMappers) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// å¥½äº†,è¿™é‡Œè·å–å¯¹åº”çš„Mapperçš„DataBinder,è¶…,æƒ³æƒ³ä¹‹å‰æ·»åŠ äº†å“ªä¸ªMapper</span></span><br><span class=\"line\">        <span class=\"comment\">// æ²¡é”™,ä¸æ­£å¥½å¯¹ä¸Štmdçš„ä¸Šé¢1çš„com.xxx.xxx.DataBinderMapperImpl()</span></span><br><span class=\"line\">        ViewDataBinding result = mapper.getDataBinder(bindingComponent, view, layoutId);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (result != <span class=\"keyword\">null</span>) <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (loadFeatures()) <span class=\"keyword\">return</span> getDataBinder(bindingComponent, view, layoutId);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>è®©æˆ‘ä»¬æ¥åº·åº·kaptç”Ÿæˆçš„<code>com.xxx.xxx.DataBinderMapperImpl()</code>åˆ°åº•æœ‰ä»€ä¹ˆ</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DataBinderMapperImpl</span> <span class=\"keyword\">extends</span> <span class=\"title\">DataBinderMapper</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// layout id ç´¢å¼•</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> LAYOUT_FRAGMENTHOME = <span class=\"number\">40</span>;</span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> SparseIntArray INTERNAL_LAYOUT_ID_LOOKUP = <span class=\"keyword\">new</span> SparseIntArray(<span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">    INTERNAL_LAYOUT_ID_LOOKUP.put(com.xmiles.callshow.R.layout.fragment_home, LAYOUT_FRAGMENTHOME);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"meta\">@Override</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> ViewDataBinding <span class=\"title\">getDataBinder</span><span class=\"params\">(DataBindingComponent component, View view, <span class=\"keyword\">int</span> layoutId)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// æ‹¿åˆ°ç´¢å¼•çš„id</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> localizedLayoutId = INTERNAL_LAYOUT_ID_LOOKUP.get(layoutId);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(localizedLayoutId &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">final</span> Object tag = view.getTag();</span><br><span class=\"line\">      <span class=\"comment\">// åˆ¤æ–­tag</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span>(tag == <span class=\"keyword\">null</span>)<span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(<span class=\"string\">&quot;view must have a tag&quot;</span>);</span><br><span class=\"line\">      <span class=\"comment\">// è¿™é‡Œå¦‚æœå¸ƒå±€æ•°é‡è¶…50,ä¸ºé¿å…ä¸€ä¸ªæ–¹æ³•ä½“è¿‡å¤§,ä¼šé¢å¤–æ–°å»ºå¦å¤–ä¸€ä¸ªå‡½æ•°å»å¤„ç†,è¿™é‡Œä¸ºå¥½å±•ç¤º,æ•´ä¸ªç±»æˆ‘å°±åˆ é™¤äº†å¾ˆå¤šå…¶ä»–å¸ƒå±€å‚æ•°</span></span><br><span class=\"line\">      <span class=\"keyword\">int</span> methodIndex = (localizedLayoutId - <span class=\"number\">1</span>) / <span class=\"number\">50</span>;</span><br><span class=\"line\">      <span class=\"comment\">// è·Ÿæ®å¯¹åº”componetç”Ÿæˆå¯¹åº”çš„ViewDetaBinding</span></span><br><span class=\"line\">      <span class=\"keyword\">switch</span>(methodIndex) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">0</span>: &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> internalGetViewDataBinding0(component, view, localizedLayoutId, tag);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>: &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> internalGetViewDataBinding1(component, view, localizedLayoutId, tag);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// GetViewDataBinding</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ViewDataBinding <span class=\"title\">internalGetViewDataBinding0</span><span class=\"params\">(DataBindingComponent component,View view, <span class=\"keyword\">int</span> internalId, Object tag)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span>(internalId) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span>  LAYOUT_FRAGMENTHOME: &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"string\">&quot;layout/fragment_home_0&quot;</span>.equals(tag)) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> FragmentHomeBindingImpl(component, view);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">&quot;The tag for fragment_home is invalid. Received: &quot;</span> + tag);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"refer\">Refer<a title=\"#refer\" href=\"#refer\"></a></h3>\n<p><a href=\"https://www.jianshu.com/p/4be20cc58f17\" target=\"_blank\">Androidæ¶æ„ç»„ä»¶ä¹‹DataBindingæºç è§£æ - ç®€ä¹¦ (jianshu.com)</a><br>\n<a href=\"https://www.jianshu.com/p/4e9a1ab05bb5\" target=\"_blank\">DataBindingæºç åˆ†æ - ç®€ä¹¦ (jianshu.com)</a></p>\n",
            "tags": [
                "æºç è§£æ"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/08/qX2v7eB61IheaBrH/",
            "url": "https://onion99.github.io/2021/11/08/qX2v7eB61IheaBrH/",
            "title": "Javaå¹¶å‘(4) - CAS",
            "date_published": "2021-11-07T18:59:57.000Z",
            "content_html": "<p>é”æœºåˆ¶é—®é¢˜:</p>\n<ul>\n<li>åœ¨å¤šçº¿ç¨‹ç«äº‰ä¸‹ï¼ŒåŠ é”ã€é‡Šæ”¾é”ä¼šå¯¼è‡´æ¯”è¾ƒå¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œè°ƒåº¦å»¶æ—¶ï¼Œå¼•èµ·æ€§èƒ½é—®é¢˜</li>\n<li>ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ä¼šå¯¼è‡´å…¶å®ƒæ‰€æœ‰éœ€è¦æ­¤é”çš„çº¿ç¨‹æŒ‚èµ·</li>\n<li>å¦‚æœä¸€ä¸ªä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹ç­‰å¾…ä¸€ä¸ªä¼˜å…ˆçº§ä½çš„çº¿ç¨‹é‡Šæ”¾é”ä¼šå¯¼è‡´ä¼˜å…ˆçº§å€’ç½®ï¼Œå¼•èµ·æ€§èƒ½é£é™©</li>\n</ul>\n<p>volatile æ˜¯ä¸é”™çš„æœºåˆ¶ï¼Œä½†æ˜¯ volatile ä¸èƒ½ä¿è¯åŸå­æ€§ï¼Œå› æ­¤å¯¹äºåŒæ­¥æœ€ç»ˆè¿˜æ˜¯è¦å›åˆ°é”æœºåˆ¶ä¸Šæ¥ã€‚ç‹¬å é”æ˜¯ä¸€ç§æ‚²è§‚é”ï¼Œsynchronized å°±æ˜¯ä¸€ç§ç‹¬å é”ï¼Œä¼šå¯¼è‡´å…¶å®ƒæ‰€æœ‰éœ€è¦é”çš„çº¿ç¨‹æŒ‚èµ·ï¼Œç­‰å¾…æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”ã€‚è€Œå¦ä¸€ä¸ªæ›´åŠ æœ‰æ•ˆçš„é”å°±æ˜¯ä¹è§‚é”</p>\n<blockquote>\n<p>ä¹è§‚é”å³æ€»æ˜¯å‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶å’Œ CAS ç®—æ³•å®ç°</p>\n</blockquote>\n<span id=\"more\"></span>\n<h3 id=\"åŸå­æ“ä½œ\">åŸå­æ“ä½œ<a title=\"#åŸå­æ“ä½œ\" href=\"#åŸå­æ“ä½œ\"></a></h3>\n<blockquote>\n<p>æ‰€è°“â€œåŸå­â€æ“ä½œï¼Œæ˜¯æŒ‡ä¸€ç»„ä¸å¯åˆ†å‰²çš„æ“ä½œï¼šæ“ä½œè€…å¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œæ“ä½œæ—¶ï¼Œè¦ä¹ˆå®Œæˆæ‰€æœ‰æ“ä½œåå…¶ä»–æ“ä½œè€…æ‰èƒ½æ“ä½œï¼›è¦ä¹ˆè¿™ä¸ªæ“ä½œè€…ä¸èƒ½è¿›è¡Œä»»ä½•æ“ä½œ</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/11/04/Ie5YA1.png\" alt=\"Ie5YA1.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestAtomic</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// å®ä¾‹åŒ–äº†ä¸€ä¸ªAtomicIntegerç±»çš„å¯¹è±¡atomicå¹¶å®šä¹‰åˆå§‹å€¼ä¸º1</span></span><br><span class=\"line\">        AtomicInteger atomic = <span class=\"keyword\">new</span> AtomicInteger(<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"comment\">// è¿›è¡Œatomicçš„åŸå­åŒ–æ“ä½œï¼šå¢åŠ 1å¹¶ä¸”è·å–è¿™ä¸ªå¢åŠ åçš„æ–°å€¼</span></span><br><span class=\"line\">        atomic.incrementAndGet();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"cas-åŸç†\">CAS åŸç†<a title=\"#cas-åŸç†\" href=\"#cas-åŸç†\"></a></h3>\n<blockquote>\n<p>CAS çš„æ€æƒ³å¾ˆç®€å•ï¼Œä¸‰ä¸ªå‚æ•°ï¼šå½“å‰å†…å­˜å€¼ Vã€æ—§çš„é¢„æœŸå€¼ Aã€å³å°†æ›´æ–°çš„å€¼ Bï¼Œå½“ä¸”ä»…å½“é¢„æœŸå€¼ A å’Œå†…å­˜å€¼ V ç›¸åŒæ—¶ï¼Œå°†å†…å­˜å€¼ä¿®æ”¹ä¸º B å¹¶è¿”å› trueï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸åšï¼Œå¹¶è¿”å› falseã€‚æˆ‘ä»¬æ‹¿ AtomicInteger ç±»æ¥åˆ†æï¼Œå…ˆæ¥çœ‹çœ‹ AtomicInteger é™æ€ä»£ç å—ç‰‡æ®µ</p>\n</blockquote>\n<h3 id=\"casç¼ºç‚¹\">CASç¼ºç‚¹<a title=\"#casç¼ºç‚¹\" href=\"#casç¼ºç‚¹\"></a></h3>\n<ul>\n<li>å¾ªç¯æ—¶é—´é•¿å¼€é”€å¾ˆå¤§</li>\n<li>åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ</li>\n<li>ABAé—®é¢˜</li>\n</ul>\n",
            "tags": [
                "å¹¶å‘"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/04/cNDSpE5p4avS2tOi/",
            "url": "https://onion99.github.io/2021/11/04/cNDSpE5p4avS2tOi/",
            "title": "è‡ªå®šä¹‰View(11) - æ»šåŠ¨é€Ÿåº¦å’Œæ»šåŠ¨è®¡ç®—",
            "date_published": "2021-11-03T22:09:36.000Z",
            "content_html": "<h3 id=\"velocitytracker\">VelocityTracker<a title=\"#velocitytracker\" href=\"#velocitytracker\"></a></h3>\n<blockquote>\n<p>è·Ÿè¸ªæ‰‹æŒ‡åœ¨æ»‘åŠ¨è¿‡ç¨‹ä¸­çš„é€Ÿåº¦ï¼ŒåŒ…æ‹¬æ°´å¹³å’Œç«–ç›´æ–¹å‘çš„é€Ÿåº¦</p>\n</blockquote>\n<span id=\"more\"></span>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">VelocityTrackerTestView</span>(<span class=\"title\">context</span>: <span class=\"title\">Context</span>?, <span class=\"title\">attrs</span>: <span class=\"title\">AttributeSet</span>?) : <span class=\"title\">View</span>(<span class=\"title\">context</span>, <span class=\"title\">attrs</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//1ã€åˆ›å»ºå®ä¾‹</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">var</span> mVelocityTracker = VelocityTracker.obtain()</span><br><span class=\"line\">    <span class=\"meta\">@SuppressLint(&quot;ClickableViewAccessibility&quot;)</span></span><br><span class=\"line\">    <span class=\"function\">override fun <span class=\"title\">onTouchEvent</span><span class=\"params\">(event: MotionEvent)</span>: Boolean </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//2ã€é‡ç½®</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (event.actionMasked == MotionEvent.ACTION_DOWN) &#123;</span><br><span class=\"line\">            mVelocityTracker.clear()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//3ã€å¼€å§‹è¿½è¸ª</span></span><br><span class=\"line\">        mVelocityTracker.addMovement(event)</span><br><span class=\"line\"> </span><br><span class=\"line\">        when (event.actionMasked) &#123;</span><br><span class=\"line\">            MotionEvent.ACTION_DOWN -&gt; &#123;</span><br><span class=\"line\">                <span class=\"comment\">//...</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            MotionEvent.ACTION_MOVE -&gt; &#123;</span><br><span class=\"line\">                <span class=\"comment\">//o...</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            MotionEvent.ACTION_UP -&gt; &#123;</span><br><span class=\"line\">                <span class=\"comment\">//é€Ÿåº¦ = ï¼ˆ ç»ˆç‚¹ä½ç½®(px) - èµ·ç‚¹ä½ç½®(px) ï¼‰/ æ—¶é—´æ®µ(ms)</span></span><br><span class=\"line\">                <span class=\"comment\">//4ã€è®¾ç½®æ—¶é—´æ®µ</span></span><br><span class=\"line\">                mVelocityTracker.computeCurrentVelocity(<span class=\"number\">1000</span>)</span><br><span class=\"line\">                <span class=\"comment\">//5ã€è·å–xæ–¹å‘ã€yæ–¹å‘çš„é€Ÿåº¦</span></span><br><span class=\"line\">                <span class=\"comment\">//å…¶ä¸­getXVelocityã€getYVelocityæ–¹æ³•çš„å‚æ•°æ˜¯pointerIdï¼Œç”¨äºå¤šæŒ‡è§¦æ§ã€‚ä¸è€ƒè™‘å¤šæŒ‡æ—¶ï¼Œå¯ä»¥ä¸ç”¨ä¼ å‚æ•°</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> xVelocity = mVelocityTracker.getXVelocity(<span class=\"number\">0</span>)</span><br><span class=\"line\">                <span class=\"keyword\">var</span> yVelocity = mVelocityTracker.getYVelocity(<span class=\"number\">0</span>)</span><br><span class=\"line\">                <span class=\"comment\">//...</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\">override fun <span class=\"title\">onDetachedFromWindow</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//6ã€å½“ä¸éœ€è¦ä½¿ç”¨æ—¶ï¼Œé‡ç½®å¹¶å›æ”¶å†…å­˜</span></span><br><span class=\"line\">        mVelocityTracker.clear()</span><br><span class=\"line\">        mVelocityTracker.recycle()</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onDetachedFromWindow()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>VelocityTracker ä¸€èˆ¬ç”¨æ¥åˆ¤æ–­å½“å‰æ˜¯å¦è¾¾åˆ°ä¸€å®šçš„æ»‘åŠ¨é€Ÿåº¦æ¥è§¦å‘ Fling çš„æ•ˆæœï¼Œè¿™ä¸ªæ»‘åŠ¨é€Ÿåº¦æˆ‘ä»¬å¯ä»¥è‡ªå·±è®¾ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç³»ç»Ÿæä¾›çš„æ¥è·å–</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">var</span> mViewConfiguration : ViewConfiguration = ViewConfiguration.get(context)</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">var</span> mMaxFlingVelocity = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"comment\">//è§¦å‘flingçš„é€Ÿåº¦</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">var</span> mMinFlingVelocity = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">init &#123;</span><br><span class=\"line\">    mMaxFlingVelocity = mViewConfiguration.scaledMaximumFlingVelocity</span><br><span class=\"line\">    mMinFlingVelocity = mViewConfiguration.scaledMinimumFlingVelocity</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"scroller\">Scroller<a title=\"#scroller\" href=\"#scroller\"></a></h3>\n<p>åœ¨ View ç±»é‡Œé¢ï¼Œæœ‰ä¸¤ä¸ªå’Œæ»šåŠ¨ç›¸å…³çš„ç±» scrollTo() å’Œ scrollByã€‚è¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥å®ç° View å†…å®¹çš„ç§»åŠ¨ï¼Œæ¯”å¦‚è¯´ä¸€ä¸ª TextViewï¼Œå¦‚æœä½¿ç”¨ scrollTo()ï¼Œé‚£ä¹ˆç§»åŠ¨çš„æ˜¯é‡Œé¢çš„æ–‡å­—è€Œä¸æ˜¯ä½ç½®ï¼ŒscrollBy() ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆæ˜¯ç§»åŠ¨ï¼Œä¸æ˜¯æ»šåŠ¨å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯ç¬é—´å®Œæˆï¼Œè€Œä¸æ˜¯å¸¦æœ‰æ»šåŠ¨è¿‡ç¨‹çš„æ»šåŠ¨ï¼Œæ‰€ä»¥è¯´å¦‚æœè¦å®ç°æ•ˆæœæ¯”è¾ƒå¥½çš„æ»šåŠ¨è¿˜æ˜¯éœ€è¦ Scroller</p>\n<p>å¸¸ç”¨API:</p>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th style=\"text-align:center\">API</th>\n<th style=\"text-align:center\">ç®€ä»‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">computeScrollOffset()</td>\n<td style=\"text-align:center\">åˆ¤æ–­å½“å‰çš„æ»‘åŠ¨åŠ¨ä½œæ˜¯å¦å®Œæˆçš„</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">getCurrX()ã€getCurrY()</td>\n<td style=\"text-align:center\">è·å–å½“å‰æ»‘åŠ¨çš„åæ ‡å€¼</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">getFinalX()ã€getFinalY()</td>\n<td style=\"text-align:center\">è·å–æœ€ç»ˆæ»‘åŠ¨åœæ­¢æ—¶çš„åæ ‡</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">isFinished()</td>\n<td style=\"text-align:center\">ç”¨æ¥åˆ¤æ–­å½“å‰æ»šåŠ¨æ˜¯å¦ç»“æŸ</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">startScroll(int startX, int startY, int dx, int dy)</td>\n<td style=\"text-align:center\">ç”¨æ¥å¼€å§‹æ»šåŠ¨ï¼Œè¿™ä¸ªæ˜¯å¾ˆé‡è¦çš„ä¸€ä¸ªè§¦å‘computeScroll()çš„æ–¹æ³•ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨computeScrollé‡Œé¢è·å–æ»šåŠ¨çš„ä¿¡æ¯ï¼Œç„¶åå®Œæˆæˆ‘ä»¬çš„éœ€è¦ã€‚è¿™ä¸ªè¿˜æœ‰ä¸€ä¸ªå¸¦æœ‰æ»šåŠ¨æŒç»­æ—¶é—´çš„é‡è½½å‡½æ•°ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚è‡ªç”±ä½¿ç”¨ã€‚ç‰¹åˆ«è¦æ³¨æ„è¿™å››ä¸ªå‚æ•°ï¼ŒstartXå’ŒstartYæ˜¯å¼€å§‹çš„åæ ‡ä½ç½®ï¼Œæ­£æ•°å·¦ä¸Šï¼Œè´Ÿæ•°å³ä¸‹ï¼Œdxã€dyåŒç†ï¼Œå½“åœ¨computeScroll()è·å–getCurrX()çš„æ—¶å€™ï¼Œå˜åŒ–èŒƒå›´å°±ä¸è¿™é‡Œåœ°è®¾ç½®æœ‰å…³ã€‚</td>\n</tr>\n</tbody>\n</table></div></div><h3 id=\"overscroller\">OverScroller<a title=\"#overscroller\" href=\"#overscroller\"></a></h3>\n<blockquote>\n<p>å¯¹è¶…å‡ºæ»‘åŠ¨è¾¹ç•Œçš„æƒ…å†µçš„å¤„ç†</p>\n</blockquote>\n",
            "tags": [
                "å›¾å½¢ç»˜åˆ¶"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/04/dY7a31QepeVitGkX/",
            "url": "https://onion99.github.io/2021/11/04/dY7a31QepeVitGkX/",
            "title": "è‡ªå®šä¹‰View(10) - GestureDetector",
            "date_published": "2021-11-03T22:08:39.000Z",
            "content_html": "<h3 id=\"gesturedetector\">GestureDetector<a title=\"#gesturedetector\" href=\"#gesturedetector\"></a></h3>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th>ç›‘å¬å™¨</th>\n<th>ç®€ä»‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>OnContextClickListener</td>\n<td>è¿™ä¸ªå¾ˆå®¹æ˜“è®©äººè”æƒ³åˆ°ContextMenuï¼Œç„¶è€Œå®ƒå’ŒContextMenuå¹¶æ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼Œå®ƒæ˜¯åœ¨Android6.0(API 23)æ‰æ·»åŠ çš„ä¸€ä¸ªé€‰é¡¹ï¼Œæ˜¯ç”¨äºæ£€æµ‹å¤–éƒ¨è®¾å¤‡ä¸Šçš„æŒ‰é’®æ˜¯å¦æŒ‰ä¸‹çš„ï¼Œä¾‹å¦‚è“ç‰™è§¦æ§ç¬”ä¸Šçš„æŒ‰é’®ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¿½ç•¥å³å¯ã€‚</td>\n</tr>\n<tr>\n<td>OnDoubleTapListener</td>\n<td>åŒå‡»äº‹ä»¶ï¼Œæœ‰ä¸‰ä¸ªå›è°ƒç±»å‹ï¼šåŒå‡»(DoubleTap)ã€å•å‡»ç¡®è®¤(SingleTapConfirmed) å’Œ åŒå‡»äº‹ä»¶å›è°ƒ(DoubleTapEvent)</td>\n</tr>\n<tr>\n<td>OnGestureListener</td>\n<td>æ‰‹åŠ¿æ£€æµ‹ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ç±»å‹äº‹ä»¶ï¼šæŒ‰ä¸‹(Down)ã€ ä¸€æ‰”(Fling)ã€é•¿æŒ‰(LongPress)ã€æ»šåŠ¨(Scroll)ã€è§¦æ‘¸åé¦ˆ(ShowPress) å’Œ å•å‡»æŠ¬èµ·(SingleTapUp)</td>\n</tr>\n<tr>\n<td>SimpleOnGestureListener</td>\n<td>è¿™ä¸ªæ˜¯ä¸Šè¿°ä¸‰ä¸ªæ¥å£çš„ç©ºå®ç°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨è¿™ä¸ªæ¯”è¾ƒå¤šï¼Œä¹Ÿæ¯”è¾ƒæ–¹ä¾¿</td>\n</tr>\n</tbody>\n</table></div></div><span id=\"more\"></span>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1.åˆ›å»ºä¸€ä¸ªç›‘å¬å›è°ƒ</span></span><br><span class=\"line\">SimpleOnGestureListener listener = <span class=\"keyword\">new</span> SimpleOnGestureListener() &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span> <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onDoubleTap</span><span class=\"params\">(MotionEvent e)</span> </span>&#123;</span><br><span class=\"line\">        Toast.makeText(MainActivity.<span class=\"keyword\">this</span>, <span class=\"string\">&quot;åŒå‡»666&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">super</span>.onDoubleTap(e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">// 2.åˆ›å»ºä¸€ä¸ªæ£€æµ‹å™¨</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> GestureDetector detector = <span class=\"keyword\">new</span> GestureDetector(<span class=\"keyword\">this</span>, listener);</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">// 3.ç»™ç›‘å¬å™¨è®¾ç½®æ•°æ®æº</span></span><br><span class=\"line\">view.setOnTouchListener(<span class=\"keyword\">new</span> View.OnTouchListener() &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span> <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onTouch</span><span class=\"params\">(View v, MotionEvent event)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> detector.onTouchEvent(event);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"scalegesturedetector\">ScaleGestureDetector<a title=\"#scalegesturedetector\" href=\"#scalegesturedetector\"></a></h3>\n<blockquote>\n<p>Android ç¼©æ”¾æ‰‹åŠ¿æ£€æµ‹ ScaleGestureDetectorï¼Œåœ¨å¤§å¤šæ•°çš„æƒ…å†µä¸‹ç¼©æ”¾æ‰‹åŠ¿éƒ½ä¸æ˜¯å•ç‹¬å­˜åœ¨çš„ï¼Œéœ€è¦é…åˆå…¶å®ƒçš„æ‰‹åŠ¿æ¥ä½¿ç”¨</p>\n</blockquote>\n<h4 id=\"sample\">sample<a title=\"#sample\" href=\"#sample\"></a></h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ScaleGestureDemoView</span> <span class=\"keyword\">extends</span> <span class=\"title\">View</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String TAG = <span class=\"string\">&quot;ScaleGestureDemoView&quot;</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">private</span> ScaleGestureDetector mScaleGestureDetector;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ScaleGestureDemoView</span><span class=\"params\">(Context context)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(context);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ScaleGestureDemoView</span><span class=\"params\">(Context context, <span class=\"meta\">@Nullable</span> AttributeSet attrs)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(context, attrs);</span><br><span class=\"line\">        initScaleGestureDetector();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">initScaleGestureDetector</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        mScaleGestureDetector = <span class=\"keyword\">new</span> ScaleGestureDetector(getContext(), </span><br><span class=\"line\">                <span class=\"keyword\">new</span> ScaleGestureDetector.SimpleOnScaleGestureListener() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onScaleBegin</span><span class=\"params\">(ScaleGestureDetector detector)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onScale</span><span class=\"params\">(ScaleGestureDetector detector)</span> </span>&#123;</span><br><span class=\"line\">                Log.i(TAG, <span class=\"string\">&quot;focusX = &quot;</span> + detector.getFocusX());       <span class=\"comment\">// ç¼©æ”¾ä¸­å¿ƒï¼Œxåæ ‡</span></span><br><span class=\"line\">                Log.i(TAG, <span class=\"string\">&quot;focusY = &quot;</span> + detector.getFocusY());       <span class=\"comment\">// ç¼©æ”¾ä¸­å¿ƒyåæ ‡</span></span><br><span class=\"line\">                Log.i(TAG, <span class=\"string\">&quot;scale = &quot;</span> + detector.getScaleFactor());   <span class=\"comment\">// ç¼©æ”¾å› å­</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onScaleEnd</span><span class=\"params\">(ScaleGestureDetector detector)</span> </span>&#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onTouchEvent</span><span class=\"params\">(MotionEvent event)</span> </span>&#123;</span><br><span class=\"line\">        mScaleGestureDetector.onTouchEvent(event);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "å›¾å½¢ç»˜åˆ¶"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/04/z3aQsRLVolBbFVsl/",
            "url": "https://onion99.github.io/2021/11/04/z3aQsRLVolBbFVsl/",
            "title": "è‡ªå®šä¹‰View(9) - äº‹ä»¶åˆ†å‘",
            "date_published": "2021-11-03T22:07:31.000Z",
            "content_html": "<blockquote>\n<p>äº‹ä»¶åˆ†å‘çš„è¿‡ç¨‹å…¶å®ä¹Ÿå°±æ˜¯äº‹ä»¶ä¼ é€’è¿‡ç¨‹ã€‚äº‹ä»¶ä¼ é€’çš„é¡ºåºç”±Acticityä¼ é€’åˆ°æ ¹Viewï¼Œè¿™ä¸ªæ ¹View é€šå¸¸æ˜¯ä¸€ä¸ªViewGroup(ViewGroupæœ¬èº«ä¹Ÿæ˜¯Viewçš„å­ç±»)ï¼Œç„¶åå†ä¼ é€’ç»™ViewGroupä¸‹çš„å­View, è‹¥äº‹ä»¶åœ¨è‡ªä¸Šè€Œä¸‹çš„ä¼ é€’è¿‡ç¨‹ä¸­ä¸€ç›´æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œåˆ™äº‹ä»¶ä¼šåå‘å‘ä¸Šä¼ é€’ï¼Œæ­¤æ—¶çˆ¶ViewGroupå¯ä»¥å¯¹äº‹ä»¶è¿›è¡Œæ¶ˆè´¹ï¼Œè‹¥ä»ç„¶æ²¡æœ‰è¢«æ¶ˆè´¹çš„è¯ï¼Œæœ€åä¼šå›åˆ°Activityçš„onTouchEvent</p>\n</blockquote>\n<p>æ‰€ä»¥å¾ˆå¤šæ—¶å€™å¦‚æœæœ‰å†²çªçš„è¯,æœ€å…ˆæ¶ˆè´¹çš„æ˜¯æœ€åº•éƒ¨çš„å­View<br>\n<img src=\"https://z3.ax1x.com/2021/11/03/IE3gqf.png\" alt=\"IE3gqf.png\" loading=\"lazy\"></p>\n<span id=\"more\"></span>\n<h3 id=\"äº‹ä»¶åˆ†å‘method\">äº‹ä»¶åˆ†å‘Method<a title=\"#äº‹ä»¶åˆ†å‘method\" href=\"#äº‹ä»¶åˆ†å‘method\"></a></h3>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th style=\"text-align:center\">æ–¹æ³•</th>\n<th style=\"text-align:center\">ä½œç”¨</th>\n<th style=\"text-align:center\">è°ƒç”¨æ—¶åˆ»</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">dispatchTouchEvent()</td>\n<td style=\"text-align:center\">ç”¨æ¥è¿›è¡Œäº‹ä»¶ä¼ é€’</td>\n<td style=\"text-align:center\">å¦‚æœäº‹ä»¶èƒ½å¤Ÿä¼ é€’ç»™å½“å‰ Viewï¼Œé‚£ä¹ˆæ­¤æ–¹æ³•ä¸€å®šä¼šè¢«è°ƒç”¨</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">onInterceptTouchEvent()</td>\n<td style=\"text-align:center\">ç”¨æ¥æ˜¯å¦æ‹¦æˆªäº‹ä»¶</td>\n<td style=\"text-align:center\">å¦‚æœå½“å‰ View æ‹¦æˆªäº†æŸä¸ªäº‹ä»¶ï¼Œé‚£ä¹ˆåœ¨åŒä¸€ä¸ªäº‹ä»¶åºåˆ—å½“ä¸­ï¼Œæ­¤æ–¹æ³•ä¸ä¼šè¢«å†æ¬¡è°ƒç”¨</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">onTouchEvent()</td>\n<td style=\"text-align:center\">å¤„ç†äº‹ä»¶</td>\n<td style=\"text-align:center\">åœ¨ dispatchTouchEvent()æ–¹æ³•ä¸­è°ƒç”¨</td>\n</tr>\n</tbody>\n</table></div></div><h3 id=\"äº‹ä»¶åˆ†å‘é¡ºåº\">äº‹ä»¶åˆ†å‘é¡ºåº<a title=\"#äº‹ä»¶åˆ†å‘é¡ºåº\" href=\"#äº‹ä»¶åˆ†å‘é¡ºåº\"></a></h3>\n<p>Activity&amp;Window</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">dispatchTouchEvent</span><span class=\"params\">(MotionEvent ev)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ev.getAction() == MotionEvent.ACTION_DOWN) &#123;</span><br><span class=\"line\">        onUserInteraction();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// å½“äº‹ä»¶æ²¡æœ‰è¢«ä»»ä½•å­View æ¶ˆè´¹æ—¶,å³è¿™é‡Œä¸ºfalseæ—¶,æœ€ç»ˆæ‰§è¡Œè‡ªå·±çš„nTouchEvent</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (getWindow().superDispatchTouchEvent(ev)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> onTouchEvent(ev);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>DecorView(FrameLayout çš„å­ç±»)</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PhoneWindow</span> <span class=\"keyword\">extends</span> <span class=\"title\">Window</span> <span class=\"keyword\">implements</span> <span class=\"title\">MenuBuilder</span>.<span class=\"title\">Callback</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">superDispatchTouchEvent</span><span class=\"params\">(MotionEvent event)</span> </span>&#123;</span><br><span class=\"line\">\t    <span class=\"keyword\">return</span> mDecor.superDispatchTouchEvent(event);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DecorView</span> <span class=\"keyword\">extends</span> <span class=\"title\">FrameLayout</span> <span class=\"keyword\">implements</span> <span class=\"title\">RootViewSurfaceTaker</span></span>&#123;</span><br><span class=\"line\">\t    <span class=\"comment\">//FrameLayout å¹¶æ²¡æœ‰é‡å†™dispatchTouchEventæ–¹æ³•ï¼Œæ‰€ä»¥äº‹ä»¶å¼€å§‹äº¤ç”± ViewGroup çš„ dispatchTouchEvent å¼€å§‹åˆ†å‘äº†</span></span><br><span class=\"line\">\t    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">superDispatchTouchEvent</span><span class=\"params\">(MotionEvent event)</span> </span>&#123;</span><br><span class=\"line\">\t        <span class=\"keyword\">return</span> <span class=\"keyword\">super</span>.dispatchTouchEvent(event);</span><br><span class=\"line\">\t    &#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ViewGroup</p>\n<ul>\n<li>åˆ¤æ–­äº‹ä»¶æ˜¯å¤Ÿéœ€è¦è¢« ViewGroup æ‹¦æˆª</li>\n<li>éå†æ‰€æœ‰å­Viewï¼Œé€ä¸ªåˆ†å‘äº‹ä»¶</li>\n<li>å°†äº‹ä»¶äº¤ç»™ViewGroupè‡ªå·±æˆ–è€…ç›®æ ‡å­Viewå¤„ç†</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">dispatchTouchEvent</span><span class=\"params\">(MotionEvent ev)</span> </span>&#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> handled = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (onFilterTouchEventForSecurity(ev)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> action = ev.getAction();</span><br><span class=\"line\">    </span><br><span class=\"line\">        <span class=\"comment\">// å…ˆæ£€éªŒäº‹ä»¶æ˜¯å¦éœ€è¦è¢«ViewGroupæ‹¦æˆª</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> intercepted;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (actionMasked == MotionEvent.ACTION_DOWN || mFirstTouchTarget != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// æ ¡éªŒæ˜¯å¦ç»™mGroupFlagsè®¾ç½®äº†FLAG_DISALLOW_INTERCEPTæ ‡å¿—ä½</span></span><br><span class=\"line\">            <span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!disallowIntercept) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// èµ°onInterceptTouchEventåˆ¤æ–­æ˜¯å¦æ‹¦æˆªäº‹ä»¶</span></span><br><span class=\"line\">                intercepted = onInterceptTouchEvent(ev);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                intercepted = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            intercepted = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> split = (mGroupFlags &amp; FLAG_SPLIT_MOTION_EVENTS) != <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!canceled &amp;&amp; !intercepted) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// æ³¨æ„ACTION_DOWNç­‰äº‹ä»¶æ‰ä¼šèµ°éå†æ‰€æœ‰å­Viewçš„æµç¨‹</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (actionMasked == MotionEvent.ACTION_DOWN</span><br><span class=\"line\">                    || (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN)</span><br><span class=\"line\">                    || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123;</span><br><span class=\"line\">            </span><br><span class=\"line\">                <span class=\"comment\">// å¼€å§‹éå†æ‰€æœ‰å­Viewå¼€å§‹é€ä¸ªåˆ†å‘äº‹ä»¶</span></span><br><span class=\"line\">                <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> childrenCount = mChildrenCount;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (childrenCount != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = childrenCount - <span class=\"number\">1</span>; i &gt;= <span class=\"number\">0</span>; i--) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// åˆ¤æ–­è§¦æ‘¸ç‚¹æ˜¯å¦åœ¨è¿™ä¸ªViewçš„å†…éƒ¨</span></span><br><span class=\"line\">                        <span class=\"keyword\">final</span> View child = children[i];</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (!canViewReceivePointerEvents(child)</span><br><span class=\"line\">                                || !isTransformedTouchPointInView(x, y, child, <span class=\"keyword\">null</span>)) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    </span><br><span class=\"line\">                        <span class=\"comment\">// äº‹ä»¶è¢«å­Viewæ¶ˆè´¹ï¼Œé€€å‡ºå¾ªç¯ï¼Œä¸å†ç»§ç»­åˆ†å‘ç»™å…¶ä»–å­View</span></span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (dispatchTransformedTouchEvent(ev, <span class=\"keyword\">false</span>, child, idBitsToAssign)) &#123;</span><br><span class=\"line\">                        </span><br><span class=\"line\">                            <span class=\"comment\">// addTouchTargetå†…éƒ¨å°†mFirstTouchTargetè®¾ç½®ä¸ºchildï¼Œå³ä¸ä¸ºnull</span></span><br><span class=\"line\">                            newTouchTarget = addTouchTarget(child, idBitsToAssign);</span><br><span class=\"line\">                            alreadyDispatchedToNewTouchTarget = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// äº‹ä»¶æœªè¢«ä»»ä½•å­Viewæ¶ˆè´¹ï¼Œè‡ªå·±å¤„ç†</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mFirstTouchTarget == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// No touch targets so treat this as an ordinary view.</span></span><br><span class=\"line\">            handled = dispatchTransformedTouchEvent(ev, canceled, <span class=\"keyword\">null</span>,</span><br><span class=\"line\">                    TouchTarget.ALL_POINTER_IDS);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å°†MotionEvent.ACTION_DOWNåç»­äº‹ä»¶åˆ†å‘ç»™mFirstTouchTargetæŒ‡å‘çš„View</span></span><br><span class=\"line\">            TouchTarget predecessor = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            TouchTarget target = mFirstTouchTarget;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (target != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">final</span> TouchTarget next = target.next;</span><br><span class=\"line\">                <span class=\"comment\">// å¦‚æœå·²ç»åœ¨ä¸Šé¢çš„éå†è¿‡ç¨‹ä¸­ä¼ é€’è¿‡äº‹ä»¶ï¼Œè·³è¿‡æœ¬æ¬¡ä¼ é€’</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget) &#123;</span><br><span class=\"line\">                    handled = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> cancelChild = resetCancelNextUpFlag(target.child)</span><br><span class=\"line\">                            || intercepted;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (dispatchTransformedTouchEvent(ev, cancelChild,</span><br><span class=\"line\">                            target.child, target.pointerIdBits)) &#123;</span><br><span class=\"line\">                        handled = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                </span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                predecessor = target;</span><br><span class=\"line\">                target = next;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// Update list of touch targets for pointer up or cancel, if needed.</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (canceled</span><br><span class=\"line\">                || actionMasked == MotionEvent.ACTION_UP</span><br><span class=\"line\">                || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123;</span><br><span class=\"line\">            resetTouchState();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_UP) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> actionIndex = ev.getActionIndex();</span><br><span class=\"line\">            <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> idBitsToRemove = <span class=\"number\">1</span> &lt;&lt; ev.getPointerId(actionIndex);</span><br><span class=\"line\">            removePointersFromTouchTargets(idBitsToRemove);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> handled;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">resetTouchState</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    clearTouchTargets();</span><br><span class=\"line\">    resetCancelNextUpFlag(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    mGroupFlags &amp;= ~FLAG_DISALLOW_INTERCEPT;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">clearTouchTargets</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    TouchTarget target = mFirstTouchTarget;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (target != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            TouchTarget next = target.next;</span><br><span class=\"line\">            target.recycle();</span><br><span class=\"line\">            target = next;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">while</span> (target != <span class=\"keyword\">null</span>);</span><br><span class=\"line\">        mFirstTouchTarget = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> TouchTarget <span class=\"title\">addTouchTarget</span><span class=\"params\">(View child, <span class=\"keyword\">int</span> pointerIdBits)</span> </span>&#123;</span><br><span class=\"line\">    TouchTarget target = TouchTarget.obtain(child, pointerIdBits);</span><br><span class=\"line\">    target.next = mFirstTouchTarget;</span><br><span class=\"line\">    mFirstTouchTarget = target;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> target;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> <span class=\"title\">dispatchTransformedTouchEvent</span><span class=\"params\">(MotionEvent event, <span class=\"keyword\">boolean</span> cancel,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                                              View child, <span class=\"keyword\">int</span> desiredPointerIdBits)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> handled;</span><br><span class=\"line\">    <span class=\"comment\">// æ³¨æ„ä¼ å‚childä¸ºnullæ—¶ï¼Œè°ƒç”¨çš„æ˜¯è‡ªå·±çš„dispatchTouchEvent</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (child == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        handled = <span class=\"keyword\">super</span>.dispatchTouchEvent(event);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        handled = child.dispatchTouchEvent(transformedEvent);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> handled;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onInterceptTouchEvent</span><span class=\"params\">(MotionEvent ev)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// é»˜è®¤ä¸æ‹¦æˆªäº‹ä»¶</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>View:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">dispatchTouchEvent</span><span class=\"params\">(MotionEvent event)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (onFilterTouchEventForSecurity(event)) &#123;</span><br><span class=\"line\">        \t<span class=\"comment\">// åˆ¤æ–­äº‹ä»¶æ˜¯å¦å…ˆäº¤ç»™ouTouchæ–¹æ³•å¤„ç†</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (mOnTouchListener != <span class=\"keyword\">null</span> &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED &amp;&amp;</span><br><span class=\"line\">                    mOnTouchListener.onTouch(<span class=\"keyword\">this</span>, event)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// onTouchæœªæ¶ˆè´¹äº‹ä»¶ï¼Œä¼ ç»™onTouchEvent</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (onTouchEvent(event)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç»¼ä¸Š\">ç»¼ä¸Š<a title=\"#ç»¼ä¸Š\" href=\"#ç»¼ä¸Š\"></a></h3>\n<ul>\n<li>View äº‹ä»¶åˆ†å‘çš„æœ¬è´¨æ˜¯é€’å½’ã€‚</li>\n<li>é€’å½’çš„æœ¬è´¨æ˜¯ï¼Œä»»åŠ¡çš„ä¸‹å‘å’Œç»“æœçš„ä¸ŠæŠ¥ã€‚</li>\n<li>View äº‹ä»¶åˆ†å‘è®¾è®¡æˆé€’å½’ï¼Œæ˜¯ä¸ºäº†é…åˆ View çš„æ’ç‰ˆè§„åˆ™ï¼Œå½¢æˆç¬¦åˆç”¨æˆ·ç›´è§‰çš„è§¦æ§ä½“éªŒã€‚</li>\n<li>View äº‹ä»¶åˆ†å‘çš„å¯¹è±¡æ˜¯ä¸€ä¸ª MotionEventã€‚</li>\n<li>ä¸€æ¬¡ç”¨æˆ·è§¦æ§æ“ä½œåŒ…å«å¤šä¸ª MotionEventï¼ˆä¾‹å¦‚ä» ACTION_DOWN åˆ° ACTION_UP ï¼‰ï¼Œä¹Ÿå³ä¼šèµ°å¤šæ¬¡äº‹ä»¶åˆ†å‘æµç¨‹ã€‚</li>\n<li>ä¸€æ¬¡ View äº‹ä»¶åˆ†å‘æµç¨‹åŒ…å« â€œé€’â€ æµç¨‹å’Œ â€œå½’â€ æµç¨‹ï¼Œâ€œé€’â€ æµç¨‹å¯ä»¥å›  ViewGroup çš„æ‹¦æˆªè€Œæå‰æ­¥å…¥ â€œå½’â€ æµç¨‹ã€‚</li>\n<li>child å¯ä»¥é€šè¿‡ getParent.requestDisallowInterceptTouchEvent é˜»æ­¢çˆ¶å®¹å™¨çš„æ‹¦æˆªã€‚å› è€Œéœ€è¦å·®å¼‚åŒ–åœ°é…ç½®é˜ˆå€¼ï¼Œæ¥ç¡®ä¿ child æ‰§è¡Œ getParent.requestDisallowInterceptTouchEvent ä¼˜å…ˆäºçˆ¶å®¹å™¨ onInterceptTouchEvent è¿”å› trueï¼ˆä¸ç„¶éƒ½å…ˆè¢«æ‹¦æˆªäº†ï¼Œchild å“ªæœ‰æœºä¼šé˜»æ­¢ï¼Ÿï¼‰</li>\n<li>åœ¨â€œå½’â€æµç¨‹ä¸­ï¼Œå”¯æœ‰å½“å‰å±‚çº§çš„ super.dispatchTouchEvent è¿”å›äº† trueï¼Œæ‰è®¤å®šè¢«æ¶ˆè´¹ï¼Œè¢«æ¶ˆè´¹å‰ï¼Œä¸‹çº§éƒ½æœ‰å¹²æ´»ï¼Œåªæ˜¯ç»“æœä¸ OKã€‚è¢«æ¶ˆè´¹åï¼Œä¸Šçº§éƒ½ä¸éœ€è¦å¹²æ´»ï¼Œç›´æ¥å‘ä¸Šä¼ è¾¾æ¶ˆè´¹è€…çš„åŠŸã€‚</li>\n</ul>\n<h3 id=\"äº‹ä»¶å†²çªè§£å†³\">äº‹ä»¶å†²çªè§£å†³<a title=\"#äº‹ä»¶å†²çªè§£å†³\" href=\"#äº‹ä»¶å†²çªè§£å†³\"></a></h3>\n<ul>\n<li>ä»çˆ¶Viewç€æ‰‹, é‡å†™onInterceptTouchEventæ–¹æ³•ï¼Œåœ¨çˆ¶Viewéœ€è¦æ‹¦æˆªçš„æ—¶å€™æ‹¦æˆªï¼Œä¸è¦çš„æ—¶å€™è¿”å›false</li>\n<li>ä»å­Viewç€æ‰‹, é‡å†™å­ Viewçš„dispatchTouchEventæ–¹æ³•ï¼Œåœ¨Action_down åŠ¨ä½œä¸­é€šè¿‡æ–¹æ³• requestDisallowInterceptTouchEventï¼ˆtrueï¼‰ å…ˆè¯·æ±‚ çˆ¶ Viewä¸è¦æ‹¦æˆªäº‹ä»¶ï¼Œè¿™æ ·ä¿è¯å­ View èƒ½å¤Ÿæ¥å—åˆ° Action_move äº‹ä»¶ï¼Œå†åœ¨ Action_move åŠ¨ä½œä¸­æ ¹æ®è‡ªå·±çš„é€»è¾‘æ˜¯å¦è¦æ‹¦æˆªäº‹ä»¶ï¼Œä¸éœ€è¦æ‹¦æˆªäº‹ä»¶çš„è¯å†äº¤ç»™ çˆ¶ View å¤„ç†</li>\n</ul>\n<h3 id=\"refer\">Refer<a title=\"#refer\" href=\"#refer\"></a></h3>\n<p><a href=\"https://juejin.cn/post/6844903894103883789\" target=\"_blank\">å­¦ä¹  View äº‹ä»¶åˆ†å‘ï¼Œå°±åƒå¤–åœ°äººä¸Šäº†é»‘è½¦ï¼ - æ˜é‡‘ (juejin.cn)</a><br>\n<a href=\"https://juejin.cn/post/6965649194744807461\" target=\"_blank\">View äº‹ä»¶åˆ†å‘æœºåˆ¶ï¼Œçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† - æ˜é‡‘ (juejin.cn)</a><br>\n<a href=\"https://blog.csdn.net/u010289802/article/details/86169939\" target=\"_blank\">Android æ‰‹æŠŠæ‰‹è¿›é˜¶è‡ªå®šä¹‰Viewï¼ˆåï¼‰- äº‹ä»¶åˆ†å‘æœºåˆ¶è§£æ_lerendançš„åšå®¢-CSDNåšå®¢</a></p>\n",
            "tags": [
                "å›¾å½¢ç»˜åˆ¶"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/04/p4CRfuQemJ4TOlAs/",
            "url": "https://onion99.github.io/2021/11/04/p4CRfuQemJ4TOlAs/",
            "title": "è‡ªå®šä¹‰View(8) - draw ç»˜åˆ¶è¿‡ç¨‹",
            "date_published": "2021-11-03T22:03:38.000Z",
            "content_html": "<blockquote>\n<p>Android é‡Œé¢çš„ç»˜åˆ¶éƒ½æ˜¯æŒ‰é¡ºåºçš„ï¼Œå…ˆç»˜åˆ¶çš„å†…å®¹ä¼šè¢«åç»˜åˆ¶çš„ç›–ä½</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/11/03/IES7KP.png\" alt=\"IES7KP.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<span id=\"more\"></span>\n<h3 id=\"draw-è¿‡ç¨‹è§£æ\">draw è¿‡ç¨‹è§£æ<a title=\"#draw-è¿‡ç¨‹è§£æ\" href=\"#draw-è¿‡ç¨‹è§£æ\"></a></h3>\n<p>ä¸€ä¸ªå®Œæ•´çš„ç»˜åˆ¶è¿‡ç¨‹ä¼šä¾æ¬¡ç»˜åˆ¶ä»¥ä¸‹å‡ ä¸ªå†…å®¹ï¼š<br>\n<img src=\"https://z3.ax1x.com/2021/11/03/IEp3Ie.png\" alt=\"IEp3Ie.png\" loading=\"lazy\"></p>\n<ul>\n<li><code>drawBackground()</code>ç»˜åˆ¶èƒŒæ™¯\n<ul>\n<li>è¿™ä¸ªæ–¹æ³•æ˜¯ private çš„ï¼Œä¸èƒ½é‡å†™ï¼Œä½ å¦‚æœè¦è®¾ç½®èƒŒæ™¯ï¼Œåªèƒ½ç”¨è‡ªå¸¦çš„ API å»è®¾ç½®</li>\n</ul>\n</li>\n<li><code>onDraw()</code>ç»˜åˆ¶ä¸»ä½“\n<ul>\n<li>è¿™ä¸ªæ–¹æ³•åœ¨ View å’Œ ViewGroup é‡Œéƒ½æ˜¯ç©ºå®ç°ï¼Œå› æ­¤è‡ªå®šä¹‰æ—¶éœ€è¦å¤å†™</li>\n</ul>\n</li>\n<li><code>dispatchDraw()</code>ç»˜åˆ¶å­ View\n<ul>\n<li>åœ¨äºå•ä¸€ View ä¸­æ— å­ Viewï¼Œæ•…åœ¨ View ä¸­æ­¤æ–¹æ³•é»˜è®¤ä¸ºç©ºå®</li>\n<li>åœ¨ ViewGroupä¸­ç³»ç»Ÿå·²ç»å¤å†™å¥½æ­¤æ–¹æ³•å¯¹å…¶å­è§†å›¾è¿›è¡Œç»˜åˆ¶å› æ­¤æˆ‘ä»¬ä¸éœ€è¦å¤å†™</li>\n</ul>\n</li>\n<li><code>onDrawForeground()</code>æ»‘åŠ¨è¾¹ç¼˜æ¸å˜å’Œæ»‘åŠ¨æ¡ä»¥åŠå‰æ™¯</li>\n</ul>\n<p>ViewGroupä¸­çš„<code>dispatchDraw()</code>:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">dispatchDraw</span><span class=\"params\">(Canvas canvas)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> usingRenderNodeProperties = canvas.isRecordingFor(mRenderNode);</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> childrenCount = mChildrenCount;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> View[] children = mChildren;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> flags = mGroupFlags;</span><br><span class=\"line\">    <span class=\"comment\">// åŠ¨ç”»å¤„ç†</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((flags &amp; FLAG_RUN_ANIMATION) != <span class=\"number\">0</span> &amp;&amp; canAnimate()) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> buildCache = !isHardwareAccelerated();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; childrenCount; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">final</span> View child = children[i];</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((child.mViewFlags &amp; VISIBILITY_MASK) == VISIBLE) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">final</span> LayoutParams params = child.getLayoutParams();</span><br><span class=\"line\">                attachLayoutAnimationParameters(child, params, i, childrenCount);</span><br><span class=\"line\">                bindLayoutAnimation(child);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// xxx</span></span><br><span class=\"line\">        controller.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// é—´è·å¤„ç†</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> clipSaveCount = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> clipToPadding = (flags &amp; CLIP_TO_PADDING_MASK) == CLIP_TO_PADDING_MASK;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (clipToPadding) &#123;</span><br><span class=\"line\">        clipSaveCount = canvas.save(Canvas.CLIP_SAVE_FLAG);</span><br><span class=\"line\">        canvas.clipRect(mScrollX + mPaddingLeft, mScrollY + mPaddingTop,</span><br><span class=\"line\">                mScrollX + mRight - mLeft - mPaddingRight,</span><br><span class=\"line\">                mScrollY + mBottom - mTop - mPaddingBottom);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// éå†å­View</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; childrenCount; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((transientChild.mViewFlags &amp; VISIBILITY_MASK) == VISIBLE ||transientChild.getAnimation() != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 2. ç»˜åˆ¶å­Viewè§†å›¾    </span></span><br><span class=\"line\">                more |= drawChild(canvas, transientChild, drawingTime);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"drawé¡ºåº\">drawé¡ºåº<a title=\"#drawé¡ºåº\" href=\"#drawé¡ºåº\"></a></h3>\n<h4 id=\"ondraw()\">onDraw()<a title=\"#ondraw()\" href=\"#ondraw()\"></a></h4>\n<blockquote>\n<p>è‡ªå®šä¹‰ç»˜åˆ¶æœ€åŸºæœ¬çš„å½¢æ€ï¼šç»§æ‰¿ View ç±»ï¼Œåœ¨ onDraw() ä¸­å®Œå…¨è‡ªå®šä¹‰å®ƒçš„ç»˜åˆ¶</p>\n</blockquote>\n<p>å®šä¹‰ View æ—¶ï¼Œç»˜åˆ¶ä»£ç å†™åœ¨ super.onDraw() çš„ä¸Šé¢è¿˜æ˜¯ä¸‹é¢éƒ½æ— æ‰€è°“,ä½†åŸºäºå·²æœ‰æ§ä»¶çš„è‡ªå®šä¹‰ç»˜åˆ¶ï¼Œå°±ä¸èƒ½ä¸è€ƒè™‘ <code>super.onDraw()</code> äº†ï¼Œä½ éœ€è¦æ ¹æ®è‡ªå·±çš„éœ€æ±‚ï¼Œåˆ¤æ–­å‡ºä½ ç»˜åˆ¶çš„å†…å®¹éœ€è¦ç›–ä½æ§ä»¶åŸæœ‰çš„å†…å®¹è¿˜æ˜¯éœ€è¦è¢«æ§ä»¶åŸæœ‰çš„å†…å®¹ç›–ä½ï¼Œä»è€Œç¡®å®šä½ çš„ç»˜åˆ¶ä»£ç æ˜¯åº”è¯¥å†™åœ¨ super.onDraw() çš„ä¸Šé¢è¿˜æ˜¯ä¸‹é¢ã€‚</p>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th style=\"text-align:center\">ä¸Šé¢</th>\n<th style=\"text-align:center\">ä¸‹é¢</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/03/IEFrgH.png\" alt=\"IEFrgH.png\" loading=\"lazy\"></td>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/03/IEFHrn.png\" alt=\"IEFHrn.png\" loading=\"lazy\"></td>\n</tr>\n</tbody>\n</table></div></div><h4 id=\"dispatchdraw()\">dispatchDraw()<a title=\"#dispatchdraw()\" href=\"#dispatchdraw()\"></a></h4>\n<blockquote>\n<p>å¦‚æœæƒ³åœ¨ä¸€ä¸ªViewGroupä¸­æŒ‰ä¸Šé¢çš„åšæ³•åœ¨ä¸‹é¢æ·»åŠ ç»˜åˆ¶å†…å®¹åˆ™æ˜¯ä¸è¡Œçš„,å› ä¸ºåœ¨ç»˜åˆ¶è¿‡ç¨‹ä¸­æ¯ä¸€ä¸ª ViewGroup ä¼šå…ˆè°ƒç”¨è‡ªå·±çš„ onDraw() æ¥ç»˜åˆ¶å®Œè‡ªå·±çš„ä¸»ä½“ä¹‹åå†å»ç»˜åˆ¶å®ƒçš„å­ View,ä¼šè¦†ç›–å…¶ä¸»ä½“</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/11/03/IEEpH1.png\" alt=\"IEEpH1.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpottedLinearLayout</span> <span class=\"keyword\">extends</span> <span class=\"title\">LinearLayout</span> </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"comment\">// æŠŠ onDraw() æ¢æˆäº† dispatchDraw()</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">dispatchDraw</span><span class=\"params\">(Canvas canvas)</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">super</span>.dispatchDraw(canvas);</span><br><span class=\"line\">       ... <span class=\"comment\">// ç»˜åˆ¶æ–‘ç‚¹</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è™½ç„¶ View å’Œ ViewGroup éƒ½æœ‰ dispatchDraw() æ–¹æ³•ï¼Œä¸è¿‡ç”±äº View æ˜¯æ²¡æœ‰å­ View çš„ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¥è¯´ dispatchDraw() è¿™ä¸ªæ–¹æ³•åªå¯¹ ViewGroupï¼ˆä»¥åŠå®ƒçš„å­ç±»ï¼‰æœ‰æ„ä¹‰ã€‚</p>\n<h4 id=\"ondrawforeground()\">onDrawForeground()<a title=\"#ondrawforeground()\" href=\"#ondrawforeground()\"></a></h4>\n<blockquote>\n<p>å‰æ™¯å‰åå¤„ç†</p>\n</blockquote>\n<p>åœ¨ super.onDrawForeground() çš„ä¸Šé¢</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppImageView</span> <span class=\"keyword\">extends</span> <span class=\"title\">ImageView</span> </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onDrawForeground</span><span class=\"params\">(Canvas canvas)</span> </span>&#123;</span><br><span class=\"line\">       ... <span class=\"comment\">// ç»˜åˆ¶ã€ŒNewã€æ ‡ç­¾</span></span><br><span class=\"line\">       <span class=\"keyword\">super</span>.onDrawForeground(canvas);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://z3.ax1x.com/2021/11/03/IEVgSS.png\" alt=\"IEVgSS.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>åœ¨ super.onDrawForeground() çš„ä¸‹é¢:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppImageView</span> <span class=\"keyword\">extends</span> <span class=\"title\">ImageView</span> </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onDrawForeground</span><span class=\"params\">(Canvas canvas)</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">super</span>.onDrawForeground(canvas);</span><br><span class=\"line\">       ... <span class=\"comment\">// ç»˜åˆ¶ã€ŒNewã€æ ‡ç­¾</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://z3.ax1x.com/2021/11/03/IEZV0A.png\" alt=\"IEZV0A.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h4 id=\"draw()\">draw()<a title=\"#draw()\" href=\"#draw()\"></a></h4>\n<h3 id=\"æ€»ç»“\">æ€»ç»“<a title=\"#æ€»ç»“\" href=\"#æ€»ç»“\"></a></h3>\n<p><img src=\"https://z3.ax1x.com/2021/11/03/IEZ1XQ.png\" alt=\"IEZ1XQ.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n",
            "tags": [
                "å›¾å½¢ç»˜åˆ¶"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/04/ZyOr4iLxJj7nAQxR/",
            "url": "https://onion99.github.io/2021/11/04/ZyOr4iLxJj7nAQxR/",
            "title": "è‡ªå®šä¹‰View(7) - layout å¸ƒå±€è¿‡ç¨‹",
            "date_published": "2021-11-03T22:02:46.000Z",
            "content_html": "<p><img src=\"https://s2.ax1x.com/2019/12/06/QJQEcR.jpg\" alt=\"viewasds\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<span id=\"more\"></span>\n<h3 id=\"layout-ç±»å‹\">layout ç±»å‹<a title=\"#layout-ç±»å‹\" href=\"#layout-ç±»å‹\"></a></h3>\n<p><img src=\"https://z3.ax1x.com/2021/11/03/IA7tv4.png\" alt=\"IA7tv4.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h3 id=\"view-çš„-layout-è¿‡ç¨‹\">View çš„ layout è¿‡ç¨‹<a title=\"#view-çš„-layout-è¿‡ç¨‹\" href=\"#view-çš„-layout-è¿‡ç¨‹\"></a></h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// æŒ‡å®šè§†å›¾åŠå…¶æ‰€æœ‰å­è§†å›¾çš„å¤§å°å’Œä½ç½® è¿™æ˜¯å¸ƒå±€æœºåˆ¶çš„ç¬¬äºŒé˜¶æ®µ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">layout</span><span class=\"params\">(<span class=\"keyword\">int</span> l, <span class=\"keyword\">int</span> t, <span class=\"keyword\">int</span> r, <span class=\"keyword\">int</span> b)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// åˆ¤æ–­æ˜¯å¦measure,æ²¡æœ‰çš„è¯å†measureä¸€é</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((mPrivateFlags3 &amp; PFLAG3_MEASURE_NEEDED_BEFORE_LAYOUT) != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        onMeasure(mOldWidthMeasureSpec, mOldHeightMeasureSpec);</span><br><span class=\"line\">        mPrivateFlags3 &amp;= ~PFLAG3_MEASURE_NEEDED_BEFORE_LAYOUT;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// å½“å‰è§†å›¾çš„å››ä¸ªé¡¶ç‚¹</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> oldL = mLeft;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> oldT = mTop;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> oldB = mBottom;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> oldR = mRight;</span><br><span class=\"line\">    <span class=\"comment\">// åˆ¤æ–­è§†å›¾å¤§å°æˆ–è€…ä½ç½®æ˜¯å¦å‘ç”Ÿæ”¹å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> changed = isLayoutModeOptical(mParent) ?</span><br><span class=\"line\">            setOpticalFrame(l, t, r, b) : setFrame(l, t, r, b);</span><br><span class=\"line\">    <span class=\"comment\">// å‘ç”Ÿæ”¹å˜        </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (changed || (mPrivateFlags &amp; PFLAG_LAYOUT_REQUIRED) == PFLAG_LAYOUT_REQUIRED) &#123;</span><br><span class=\"line\">        onLayout(changed, l, t, r, b);</span><br><span class=\"line\">        <span class=\"comment\">// å¯¹äºå•ä¸€Viewçš„laytouè¿‡ç¨‹ï¼šç”±äºå•ä¸€Viewæ˜¯æ²¡æœ‰å­Viewçš„ï¼Œæ•…onLayoutï¼ˆï¼‰æ˜¯ä¸€ä¸ªç©ºå®ç°-&gt;&gt;åˆ†æ3</span></span><br><span class=\"line\">        <span class=\"comment\">// å¯¹äºViewGroupçš„laytouè¿‡ç¨‹ï¼šç”±äºç¡®å®šä½ç½®ä¸å…·ä½“å¸ƒå±€æœ‰å…³ï¼Œæ‰€ä»¥onLayoutï¼ˆï¼‰åœ¨ViewGroupä¸º1ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œéœ€é‡å†™å®ç°</span></span><br><span class=\"line\"></span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://z3.ax1x.com/2021/11/03/IAqjZd.png\" alt=\"IAqjZd.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h3 id=\"viewgroup-çš„-layout-è¿‡ç¨‹\">ViewGroup çš„ layout è¿‡ç¨‹<a title=\"#viewgroup-çš„-layout-è¿‡ç¨‹\" href=\"#viewgroup-çš„-layout-è¿‡ç¨‹\"></a></h3>\n<blockquote>\n<p>ViewGroup çš„ layout è¿‡ç¨‹ç¡®å®šä½ç½®ä¸å…·ä½“çš„å¸ƒå±€æœ‰å…³ï¼Œæ‰€ä»¥åœ¨ ViewGroup ä¸­æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œéœ€è¦é‡å†™å®ç°</p>\n</blockquote>\n<p>å¤å†™<code> onLayout()</code>æ­¥éª¤:</p>\n<ol>\n<li>éå†æ‰€æœ‰å­ View</li>\n<li>æ ¹æ®è‡ªèº«éœ€æ±‚è®¡ç®—å½“å‰å­ View çš„å››ä¸ªä½ç½®å€¼ï¼ˆéœ€è‡ªèº«å®ç°ï¼‰</li>\n<li>æ ¹æ®ä¸Šè¿° 4 ä¸ªä½ç½®çš„è®¡ç®—å€¼ï¼Œè®¾ç½®å­ View çš„ 4 ä¸ªé¡¶ç‚¹ï¼šè°ƒç”¨å­ View çš„ layout æ–¹æ³•ï¼Œå³ç¡®å®šäº†å­ View åœ¨çˆ¶å®¹å™¨é‡Œçš„ä½ç½®</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ViewGroupçš„onLayoutå®ç°çš„å¤§è‡´æ€è·¯</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onLayout</span><span class=\"params\">(<span class=\"keyword\">boolean</span> changed, <span class=\"keyword\">int</span> left, <span class=\"keyword\">int</span> top, <span class=\"keyword\">int</span> right, <span class=\"keyword\">int</span> bottom)</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"comment\">// å‚æ•°è¯´æ˜</span></span><br><span class=\"line\">   <span class=\"comment\">// changed å½“å‰Viewçš„å¤§å°å’Œä½ç½®æ”¹å˜äº† </span></span><br><span class=\"line\">   <span class=\"comment\">// left å·¦éƒ¨ä½ç½®  top é¡¶éƒ¨ä½ç½®  right å³éƒ¨ä½ç½®  bottom åº•éƒ¨ä½ç½®</span></span><br><span class=\"line\">   <span class=\"comment\">// 1. éå†å­Viewï¼šå¾ªç¯æ‰€æœ‰å­View</span></span><br><span class=\"line\">   <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>; i&lt;getChildCount(); i++) &#123;</span><br><span class=\"line\">         View child = getChildAt(i);   </span><br><span class=\"line\">         <span class=\"comment\">// 2. è®¡ç®—å½“å‰å­Viewçš„å››ä¸ªä½ç½®å€¼</span></span><br><span class=\"line\">         <span class=\"comment\">// 2.1 ä½ç½®çš„è®¡ç®—é€»è¾‘éœ€è‡ªå·±å®ç°ï¼Œä¹Ÿæ˜¯è‡ªå®šä¹‰Viewçš„å…³é”®</span></span><br><span class=\"line\">         calculate();</span><br><span class=\"line\">         <span class=\"comment\">// 2.2 å¯¹è®¡ç®—åçš„ä½ç½®å€¼è¿›è¡Œèµ‹å€¼</span></span><br><span class=\"line\">         <span class=\"keyword\">int</span> mLeft  = Left</span><br><span class=\"line\">         <span class=\"keyword\">int</span> mTop  = Top</span><br><span class=\"line\">         <span class=\"keyword\">int</span> mRight = Right</span><br><span class=\"line\">         <span class=\"keyword\">int</span> mBottom = Bottom</span><br><span class=\"line\"> </span><br><span class=\"line\">       <span class=\"comment\">// 3. æ ¹æ®ä¸Šè¿°4ä¸ªä½ç½®çš„è®¡ç®—å€¼è®¾ç½®å­Viewçš„4ä¸ªé¡¶ç‚¹ï¼šè°ƒç”¨å­viewçš„layout() &amp; ä¼ é€’è®¡ç®—è¿‡çš„å‚æ•°</span></span><br><span class=\"line\">       <span class=\"comment\">// å³ç¡®å®šäº†å­Viewåœ¨çˆ¶å®¹å™¨çš„ä½ç½®</span></span><br><span class=\"line\">       child.layout(mLeft, mTop, mRight, mBottom);</span><br><span class=\"line\">       <span class=\"comment\">// è¯¥è¿‡ç¨‹ç±»ä¼¼äºå•ä¸€Viewçš„layoutè¿‡ç¨‹ä¸­çš„layout()å’ŒonLayout()</span></span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://z3.ax1x.com/2021/11/03/IAL1L4.png\" alt=\"IAL1L4.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h4 id=\"viewgroup-å­ç±»ï¼ˆlinearlayoutï¼‰çš„-layout-è¿‡ç¨‹åˆ†æ\">ViewGroup å­ç±»ï¼ˆLinearLayoutï¼‰çš„ layout è¿‡ç¨‹åˆ†æ<a title=\"#viewgroup-å­ç±»ï¼ˆlinearlayoutï¼‰çš„-layout-è¿‡ç¨‹åˆ†æ\" href=\"#viewgroup-å­ç±»ï¼ˆlinearlayoutï¼‰çš„-layout-è¿‡ç¨‹åˆ†æ\"></a></h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onLayout</span><span class=\"params\">(<span class=\"keyword\">boolean</span> changed, <span class=\"keyword\">int</span> l, <span class=\"keyword\">int</span> t, <span class=\"keyword\">int</span> r, <span class=\"keyword\">int</span> b)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// æ ¹æ®è‡ªèº«æ–¹å‘å±æ€§ï¼Œè€Œé€‰æ‹©ä¸åŒçš„å¤„ç†æ–¹å¼</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mOrientation == VERTICAL) &#123;</span><br><span class=\"line\">        layoutVertical(l, t, r, b);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        layoutHorizontal(l, t, r, b);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ ¹æ® LinearLayout çš„æ–¹å‘ï¼ˆverticalã€horizontalï¼‰è¿›å…¥ä¸åŒçš„å¸ƒå±€è¿‡ç¨‹ï¼Œè¿™é‡Œæˆ‘ä»¬åªé€‰å‚ç›´æ–¹å‘çš„å¸ƒå±€è¿‡ç¨‹ï¼Œå³layoutVertical()</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">layoutVertical</span><span class=\"params\">(<span class=\"keyword\">int</span> left, <span class=\"keyword\">int</span> top, <span class=\"keyword\">int</span> right, <span class=\"keyword\">int</span> bottom)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// å­Viewçš„æ•°é‡</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> count = getVirtualChildCount();</span><br><span class=\"line\">    <span class=\"comment\">// 1. éå†å­View</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; count; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> View child = getVirtualChildAt(i);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (child == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            childTop += measureNullChild(i);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (child.getVisibility() != GONE) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 2. è®¡ç®—å­Viewçš„æµ‹é‡å®½ / é«˜å€¼</span></span><br><span class=\"line\">            <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> childWidth = child.getMeasuredWidth();</span><br><span class=\"line\">            <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> childHeight = child.getMeasuredHeight();</span><br><span class=\"line\"> </span><br><span class=\"line\">            <span class=\"comment\">// 3. ç¡®å®šè‡ªèº«å­Viewçš„ä½ç½®</span></span><br><span class=\"line\">            <span class=\"comment\">// å³ï¼šé€’å½’è°ƒç”¨å­Viewçš„setChildFrame()ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨äº†å­Viewçš„layout() -&gt;&gt;åˆ†æ2</span></span><br><span class=\"line\">            setChildFrame(child, childLeft, childTop + getLocationOffset(child), childWidth, childHeight);</span><br><span class=\"line\"> </span><br><span class=\"line\">            <span class=\"comment\">// childTopé€æ¸å¢å¤§ï¼Œå³åé¢çš„å­å…ƒç´ ä¼šè¢«æ”¾ç½®åœ¨é ä¸‹çš„ä½ç½®</span></span><br><span class=\"line\">            <span class=\"comment\">// è¿™ç¬¦åˆå‚ç›´æ–¹å‘çš„LinearLayoutçš„ç‰¹æ€§</span></span><br><span class=\"line\">            childTop += childHeight + lp.bottomMargin + getNextLocationOffset(child);</span><br><span class=\"line\"> </span><br><span class=\"line\">            i += getChildrenSkipCount(child, i);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">setChildFrame</span><span class=\"params\">( View child, <span class=\"keyword\">int</span> left, <span class=\"keyword\">int</span> top, <span class=\"keyword\">int</span> width, <span class=\"keyword\">int</span> height)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// setChildFrameï¼ˆï¼‰ä»…ä»…åªæ˜¯è°ƒç”¨äº†å­Viewçš„layoutï¼ˆï¼‰è€Œå·²</span></span><br><span class=\"line\">    child.layout(left, top, left ++ width, top + height);</span><br><span class=\"line\">    <span class=\"comment\">// åœ¨å­Viewçš„layoutï¼ˆï¼‰åˆé€šè¿‡è°ƒç”¨setFrameï¼ˆï¼‰ç¡®å®šViewçš„å››ä¸ªé¡¶ç‚¹</span></span><br><span class=\"line\">    <span class=\"comment\">// å³ç¡®å®šäº†å­Viewçš„ä½ç½®</span></span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æ­¤ä¸æ–­å¾ªç¯ç¡®å®šæ‰€æœ‰å­Viewçš„ä½ç½®ï¼Œæœ€ç»ˆç¡®å®šViewGroupçš„ä½ç½®</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"getmeasurewidth-å’Œ-getwidth-åŒºåˆ«\">getMeasureWidth å’Œ getWidth åŒºåˆ«<a title=\"#getmeasurewidth-å’Œ-getwidth-åŒºåˆ«\" href=\"#getmeasurewidth-å’Œ-getwidth-åŒºåˆ«\"></a></h3>\n<blockquote>\n<p>æŸäº›æƒ…å†µä¸‹ï¼ŒView éœ€è¦å¤šæ¬¡ measure æ‰èƒ½ç¡®å®šè‡ªå·±çš„æµ‹é‡å®½é«˜ï¼Œåœ¨å‰å‡ æ¬¡çš„æµ‹é‡è¿‡ç¨‹ä¸­ï¼Œå…¶å¾—å‡ºçš„æµ‹é‡å®½é«˜æœ‰å¯èƒ½å’Œæœ€ç»ˆå®½é«˜ä¸ä¸€è‡´.ï¼Œä½†æœ€ç»ˆæ¥è¯´ï¼Œæµ‹é‡å®½é«˜è¿˜æ˜¯å’Œæœ€ç»ˆå®½é«˜ç›¸åŒã€‚</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/11/03/IAjrmF.png\" alt=\"IAjrmF.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n",
            "tags": [
                "å›¾å½¢ç»˜åˆ¶"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/04/Qj9f1VMJJowv5Lfb/",
            "url": "https://onion99.github.io/2021/11/04/Qj9f1VMJJowv5Lfb/",
            "title": "è‡ªå®šä¹‰View(6) - measure æµ‹é‡è¿‡ç¨‹",
            "date_published": "2021-11-03T22:00:58.000Z",
            "content_html": "<p><img src=\"https://s2.ax1x.com/2019/12/06/QJQEcR.jpg\" alt=\"QJQEcR.jpg\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<span id=\"more\"></span>\n<h3 id=\"measurespec\">MeasureSpec<a title=\"#measurespec\" href=\"#measurespec\"></a></h3>\n<blockquote>\n<p>MeasureSpec ä»£è¡¨æµ‹é‡è§„æ ¼ï¼Œæ˜¯ä¸€ä¸ª 32 ä½çš„ int å€¼ï¼Œé«˜ 2 ä½ä»£è¡¨ SpecModeï¼ˆæµ‹é‡æ¨¡å¼ï¼‰ï¼Œä½ 30 ä½ä»£è¡¨ SpecSizeï¼ˆæµ‹é‡å¤§å°ï¼‰</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/11/02/IF7OM9.png\" alt=\"IF7OM9.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>MeasureSpec é€šè¿‡å°† SpecMode å’Œ SpecSize æ‰“åŒ…æˆä¸€ä¸ª int å€¼æ¥é¿å…è¿‡å¤šçš„å†…å­˜åˆ†é…ï¼Œå¹¶æä¾›äº†æ‰“åŒ…å’Œè§£åŒ…çš„æ–¹æ³•</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onMeasure</span><span class=\"params\">(<span class=\"keyword\">int</span> widthMeasureSpec, <span class=\"keyword\">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> widthMode = MeasureSpec.getMode(widthMeasureSpec);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> widthSize = MeasureSpec.getSize(widthMeasureSpec);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> heightMode = MeasureSpec.getMode(heightMeasureSpec);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> heightSize = MeasureSpec.getSize(heightMeasureSpec);</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"specmode\">SpecMode<a title=\"#specmode\" href=\"#specmode\"></a></h4>\n<p><img src=\"https://z3.ax1x.com/2021/11/02/IFbTc4.png\" alt=\"IFbTc4.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h3 id=\"measurespecå€¼è®¡ç®—\">MeasureSpecå€¼è®¡ç®—<a title=\"#measurespecå€¼è®¡ç®—\" href=\"#measurespecå€¼è®¡ç®—\"></a></h3>\n<blockquote>\n<p>View çš„ MeasureSpec å€¼æ˜¯ç”± View çš„å¸ƒå±€å‚æ•°å’Œçˆ¶å®¹å™¨ çš„ MeasureSpec å€¼è®¡ç®—</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/11/03/IAVp1e.png\" alt=\"IAVp1e.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æºç åˆ†æï¼šgetChildMeasureSpecï¼ˆï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"> * ä½œç”¨ï¼šæ ¹æ®çˆ¶è§†å›¾çš„MeasureSpec &amp; å¸ƒå±€å‚æ•°LayoutParamsï¼Œè®¡ç®—å•ä¸ªå­Viewçš„MeasureSpec</span></span><br><span class=\"line\"><span class=\"comment\"> * æ³¨ï¼šå­viewçš„å¤§å°ç”±çˆ¶viewçš„MeasureSpecå€¼ å’Œ å­viewçš„LayoutParamså±æ€§ å…±åŒå†³å®š</span></span><br><span class=\"line\"><span class=\"comment\"> * å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> spec           çˆ¶viewçš„è¯¦ç»†æµ‹é‡å€¼ (MeasureSpec)</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> padding        viewå½“å‰å°ºå¯¸çš„çš„å†…è¾¹è·å’Œå¤–è¾¹è·(padding, margin)</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> childDimension å­è§†å›¾çš„å¸ƒå±€å‚æ•°ï¼ˆå®½ / é«˜ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">getChildMeasureSpec</span><span class=\"params\">(<span class=\"keyword\">int</span> spec, <span class=\"keyword\">int</span> padding, <span class=\"keyword\">int</span> childDimension)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//çˆ¶viewçš„æµ‹é‡æ¨¡å¼</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> specMode = MeasureSpec.getMode(spec);</span><br><span class=\"line\">    <span class=\"comment\">//çˆ¶viewçš„å¤§å°</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> specSize = MeasureSpec.getSize(spec);</span><br><span class=\"line\">    <span class=\"comment\">//é€šè¿‡çˆ¶viewè®¡ç®—å‡ºçš„å­viewå¤§å° = çˆ¶å¤§å°-è¾¹è·ï¼ˆçˆ¶è¦æ±‚çš„å¤§å°ï¼Œä½†å­viewä¸ä¸€å®šç”¨è¿™ä¸ªå€¼ï¼‰   </span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> size = Math.max(<span class=\"number\">0</span>, specSize - padding);</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">//å­viewæƒ³è¦çš„å®é™…å¤§å°å’Œæ¨¡å¼ï¼ˆéœ€è¦è®¡ç®—ï¼‰  </span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> resultSize = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> resultMode = <span class=\"number\">0</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">//é€šè¿‡çˆ¶viewçš„MeasureSpecå’Œå­viewçš„LayoutParamsç¡®å®šå­viewçš„å¤§å°  </span></span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (specMode) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//å½“çˆ¶viewçš„æ¨¡å¼ä¸ºEXACITYæ—¶ï¼Œçˆ¶viewå¼ºåŠ ç»™å­viewç¡®åˆ‡çš„å€¼</span></span><br><span class=\"line\">        <span class=\"comment\">//ä¸€èˆ¬æ˜¯çˆ¶viewè®¾ç½®ä¸ºmatch_parentæˆ–è€…å›ºå®šå€¼çš„ViewGroup </span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> MeasureSpec.EXACTLY:</span><br><span class=\"line\">            <span class=\"comment\">// å½“å­viewçš„LayoutParams&gt;0ï¼Œå³æœ‰ç¡®åˆ‡çš„å€¼  </span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (childDimension &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//å­viewå¤§å°ä¸ºå­è‡ªèº«æ‰€èµ‹çš„å€¼ï¼Œæ¨¡å¼å¤§å°ä¸ºEXACTLY  </span></span><br><span class=\"line\">                resultSize = childDimension;</span><br><span class=\"line\">                resultMode = MeasureSpec.EXACTLY;</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">//å½“å­viewçš„LayoutParamsä¸ºMATCH_PARENTæ—¶(-1)  </span></span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (childDimension == LayoutParams.MATCH_PARENT) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//å­viewå¤§å°ä¸ºçˆ¶viewå¤§å°ï¼Œæ¨¡å¼ä¸ºEXACTLY  </span></span><br><span class=\"line\">                resultSize = size;</span><br><span class=\"line\">                resultMode = MeasureSpec.EXACTLY;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// å½“å­viewçš„LayoutParamsä¸ºWRAP_CONTENTæ—¶(-2)      </span></span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (childDimension == LayoutParams.WRAP_CONTENT) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//å­viewå†³å®šè‡ªå·±çš„å¤§å°ï¼Œä½†æœ€å¤§ä¸èƒ½è¶…è¿‡çˆ¶viewï¼Œæ¨¡å¼ä¸ºAT_MOST  </span></span><br><span class=\"line\">                resultSize = size;</span><br><span class=\"line\">                resultMode = MeasureSpec.AT_MOST;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"comment\">// å½“çˆ¶viewçš„æ¨¡å¼ä¸ºAT_MOSTæ—¶ï¼Œçˆ¶viewå¼ºåŠ ç»™å­viewä¸€ä¸ªæœ€å¤§çš„å€¼ã€‚ï¼ˆä¸€èˆ¬æ˜¯çˆ¶viewè®¾ç½®ä¸ºwrap_contentï¼‰  </span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> MeasureSpec.AT_MOST:</span><br><span class=\"line\">            <span class=\"comment\">// é“ç†åŒä¸Š  </span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (childDimension &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                resultSize = childDimension;</span><br><span class=\"line\">                resultMode = MeasureSpec.EXACTLY;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (childDimension == LayoutParams.MATCH_PARENT) &#123;</span><br><span class=\"line\">                resultSize = size;</span><br><span class=\"line\">                resultMode = MeasureSpec.AT_MOST;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (childDimension == LayoutParams.WRAP_CONTENT) &#123;</span><br><span class=\"line\">                resultSize = size;</span><br><span class=\"line\">                resultMode = MeasureSpec.AT_MOST;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"comment\">// å½“çˆ¶viewçš„æ¨¡å¼ä¸ºUNSPECIFIEDæ—¶ï¼Œçˆ¶å®¹å™¨ä¸å¯¹viewæœ‰ä»»ä½•é™åˆ¶ï¼Œè¦å¤šå¤§ç»™å¤šå¤§</span></span><br><span class=\"line\">        <span class=\"comment\">// å¤šè§äºListViewã€GridView  </span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> MeasureSpec.UNSPECIFIED:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (childDimension &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// å­viewå¤§å°ä¸ºå­è‡ªèº«æ‰€èµ‹çš„å€¼  </span></span><br><span class=\"line\">                resultSize = childDimension;</span><br><span class=\"line\">                resultMode = MeasureSpec.EXACTLY;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (childDimension == LayoutParams.MATCH_PARENT) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// å› ä¸ºçˆ¶viewä¸ºUNSPECIFIEDï¼Œæ‰€ä»¥MATCH_PARENTçš„è¯å­ç±»å¤§å°ä¸º0  </span></span><br><span class=\"line\">                resultSize = <span class=\"number\">0</span>;</span><br><span class=\"line\">                resultMode = MeasureSpec.UNSPECIFIED;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (childDimension == LayoutParams.WRAP_CONTENT) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// å› ä¸ºçˆ¶viewä¸ºUNSPECIFIEDï¼Œæ‰€ä»¥WRAP_CONTENTçš„è¯å­ç±»å¤§å°ä¸º0  </span></span><br><span class=\"line\">                resultSize = <span class=\"number\">0</span>;</span><br><span class=\"line\">                resultMode = MeasureSpec.UNSPECIFIED;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> MeasureSpec.makeMeasureSpec(resultSize, resultMode);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://z3.ax1x.com/2021/11/03/IAemLj.png\" alt=\"IAemLj.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h3 id=\"measure-è¿‡ç¨‹\">Measure è¿‡ç¨‹<a title=\"#measure-è¿‡ç¨‹\" href=\"#measure-è¿‡ç¨‹\"></a></h3>\n<p><img src=\"https://z3.ax1x.com/2021/11/03/IAuMTA.png\" alt=\"IAuMTA.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>å¸ƒå±€è¿‡ç¨‹è‡ªå®šä¹‰çš„æ–¹å¼</p>\n<ol>\n<li>é‡å†™  <code>onMeasure()</code>  æ¥ä¿®æ”¹å·²æœ‰çš„  <code>View</code>  çš„å°ºå¯¸ï¼›</li>\n<li>é‡å†™  <code>onMeasure()</code>  æ¥å…¨æ–°å®šåˆ¶è‡ªå®šä¹‰  <code>View</code>  çš„å°ºå¯¸ï¼›</li>\n<li>é‡å†™  <code>onMeasure()</code>  å’Œ  <code>onLayout()</code>  æ¥å…¨æ–°å®šåˆ¶è‡ªå®šä¹‰  <code>ViewGroup</code>  çš„å†…éƒ¨å¸ƒå±€ã€‚</li>\n</ol>\n<h4 id=\"viewçš„measure\">Viewçš„measure<a title=\"#viewçš„measure\" href=\"#viewçš„measure\"></a></h4>\n<p>View çš„ measure è¿‡ç¨‹ç”±å…¶<code>measure()</code> æ–¹æ³•å®Œæˆï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* æºç åˆ†æï¼šmeasureï¼ˆï¼‰</span></span><br><span class=\"line\"><span class=\"comment\">* å®šä¹‰ï¼šMeasureè¿‡ç¨‹çš„å…¥å£ï¼›å±äºView.javaç±» &amp; finalç±»å‹ï¼Œå³å­ç±»ä¸èƒ½é‡å†™æ­¤æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"comment\">* ä½œç”¨ï¼šåŸºæœ¬æµ‹é‡é€»è¾‘çš„åˆ¤æ–­</span></span><br><span class=\"line\"><span class=\"comment\">**/</span> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">measure</span><span class=\"params\">(<span class=\"keyword\">int</span> widthMeasureSpec, <span class=\"keyword\">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"comment\">// åˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°æµ‹é‡           </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (forceLayout || needsLayout) &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        <span class=\"comment\">// åˆ¤æ–­æ˜¯å¦æœ‰ç¼“å­˜</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> cacheIndex = forceLayout ? -<span class=\"number\">1</span> : mMeasureCache.indexOfKey(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cacheIndex &lt; <span class=\"number\">0</span> || sIgnoreMeasureCache) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å¼€å§‹æµ‹é‡</span></span><br><span class=\"line\">            onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class=\"line\">            mPrivateFlags3 &amp;= ~PFLAG3_MEASURE_NEEDED_BEFORE_LAYOUT;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">long</span> value = mMeasureCache.valueAt(cacheIndex);</span><br><span class=\"line\">            <span class=\"comment\">// Casting a long to int drops the high 32 bits, no mask needed</span></span><br><span class=\"line\">            setMeasuredDimensionRaw((<span class=\"keyword\">int</span>) (value &gt;&gt; <span class=\"number\">32</span>), (<span class=\"keyword\">int</span>) value);</span><br><span class=\"line\">            mPrivateFlags3 |= PFLAG3_MEASURE_NEEDED_BEFORE_LAYOUT;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;  </span><br></pre></td></tr></table></figure>\n<p><code>setMeasuredDimension()</code>æ–¹æ³•ä¼šè®¾ç½® View çš„å®½/é«˜çš„æµ‹é‡å€¼ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦çœ‹<code>getDefaultSize()</code> æ–¹æ³•å³å¯</p>\n<p><img src=\"https://z3.ax1x.com/2021/11/03/IAGYZT.png\" alt=\"IAGYZT.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * onMeasureï¼ˆï¼‰è¦çš„åšæ˜¯äº‹æƒ…</span></span><br><span class=\"line\"><span class=\"comment\"> * 1. æ ¹æ®Viewå®½/é«˜çš„æµ‹é‡è§„æ ¼è®¡ç®—Viewçš„å®½/é«˜å€¼ï¼šgetDefaultSize()</span></span><br><span class=\"line\"><span class=\"comment\"> * 2. å­˜å‚¨æµ‹é‡åçš„Viewå®½ / é«˜ï¼šsetMeasuredDimension()</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onMeasure</span><span class=\"params\">(<span class=\"keyword\">int</span> widthMeasureSpec, <span class=\"keyword\">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class=\"line\">     setMeasuredDimension(getDefaultSize(getSuggestedMinimumWidth(), widthMeasureSpec),</span><br><span class=\"line\">             getDefaultSize(getSuggestedMinimumHeight(), heightMeasureSpec));</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * <span class=\"doctag\">@param</span> size        æä¾›çš„é»˜è®¤å¤§å°</span></span><br><span class=\"line\"><span class=\"comment\">  * <span class=\"doctag\">@param</span> measureSpec å®½/é«˜çš„æµ‹é‡è§„æ ¼</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">getDefaultSize</span><span class=\"params\">(<span class=\"keyword\">int</span> size, <span class=\"keyword\">int</span> measureSpec)</span> </span>&#123;</span><br><span class=\"line\">     <span class=\"comment\">// è®¾ç½®é»˜è®¤å¤§å°</span></span><br><span class=\"line\">     <span class=\"keyword\">int</span> result = size;</span><br><span class=\"line\">     <span class=\"comment\">// è·å–å®½/é«˜æµ‹é‡è§„æ ¼çš„æ¨¡å¼ &amp; æµ‹é‡å¤§å°</span></span><br><span class=\"line\">     <span class=\"keyword\">int</span> specMode = MeasureSpec.getMode(measureSpec);</span><br><span class=\"line\">     <span class=\"keyword\">int</span> specSize = MeasureSpec.getSize(measureSpec);</span><br><span class=\"line\">     <span class=\"keyword\">switch</span> (specMode) &#123;</span><br><span class=\"line\">       <span class=\"comment\">// æ¨¡å¼ä¸ºUNSPECIFIEDæ—¶ï¼Œä½¿ç”¨æä¾›çš„é»˜è®¤å¤§å° = å‚æ•°Size</span></span><br><span class=\"line\">       <span class=\"keyword\">case</span> MeasureSpec.UNSPECIFIED:</span><br><span class=\"line\">         result = size;</span><br><span class=\"line\">         <span class=\"keyword\">break</span>;</span><br><span class=\"line\">       <span class=\"comment\">// æ¨¡å¼ä¸ºAT_MOST,EXACTLYæ—¶ï¼Œä½¿ç”¨Viewæµ‹é‡åçš„å®½/é«˜å€¼ = measureSpecä¸­çš„Size  </span></span><br><span class=\"line\">       <span class=\"keyword\">case</span> MeasureSpec.AT_MOST:</span><br><span class=\"line\">       <span class=\"keyword\">case</span> MeasureSpec.EXACTLY:</span><br><span class=\"line\">         result = specSize;</span><br><span class=\"line\">         <span class=\"keyword\">break</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     <span class=\"comment\">// è¿”å›Viewçš„å®½/é«˜å€¼</span></span><br><span class=\"line\">     <span class=\"keyword\">return</span> result;</span><br><span class=\"line\"> &#125;  </span><br></pre></td></tr></table></figure>\n<p>å½“æ¨¡å¼æ˜¯ UNSPECIFIED æ—¶ï¼Œä½¿ç”¨çš„æ˜¯æä¾›çš„é»˜è®¤å¤§å°:</p>\n<ul>\n<li>è‹¥ View æ— è®¾ç½®èƒŒæ™¯ï¼Œé‚£ä¹ˆ View çš„å®½åº¦ = mMinWidthã€‚mMinWidthä¸º android:minWidthå±æ€§æ‰€æŒ‡å®šçš„å€¼ï¼Œé»˜è®¤ä¸º 0</li>\n<li>è‹¥ Viewè®¾ç½®äº†èƒŒæ™¯ï¼ŒView çš„å®½åº¦ä¸º mMinWidth å’Œ mBackground.getMinimumWidth()ä¸­çš„æœ€å¤§å€¼ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">int</span> <span class=\"title\">getSuggestedMinimumWidth</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (mBackground == <span class=\"keyword\">null</span>) ? mMinWidth : max(mMinWidth, mBackground.getMinimumWidth());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th style=\"text-align:center\">è¿‡ç¨‹</th>\n<th style=\"text-align:center\">è¡Œä¸ºä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/03/IAJ9mV.png\" alt=\"IAJ9mV.png\" loading=\"lazy\"></td>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/03/IAJ1te.png\" alt=\"IAJ1te.png\" loading=\"lazy\"></td>\n</tr>\n</tbody>\n</table></div></div><h4 id=\"viewgroupçš„measure\">ViewGroupçš„measure<a title=\"#viewgroupçš„measure\" href=\"#viewgroupçš„measure\"></a></h4>\n<blockquote>\n<p>ViewGroupæ˜¯ä¸ªæŠ½è±¡ç±»,ä¸åŒViewGroupçš„onMeasureçš„å®ç°éƒ½ä¸ªä¸ç›¸åŒ,é™¤äº†å®Œæˆè‡ªå·±çš„ measure è¿‡ç¨‹ä»¥å¤–ï¼Œè¿˜ä¼šéå†å»è°ƒç”¨æ‰€æœ‰å­å…ƒç´ çš„ measure æ–¹æ³•ï¼Œå„ä¸ªå­å…ƒç´ å†é€’å½’å»æ‰§è¡Œè¿™ä¸ªè¿‡ç¨‹</p>\n</blockquote>\n<ol>\n<li>éå†æ‰€æœ‰å­ View &amp; æµ‹é‡ï¼šmeasureChildren()</li>\n<li>åˆå¹¶æ‰€æœ‰å­ View çš„å°ºå¯¸å¤§å°ï¼Œæœ€ç»ˆå¾—åˆ° ViewGroup çš„æµ‹é‡å€¼ï¼ˆéœ€è‡ªèº«å®ç°ï¼‰</li>\n<li>å­˜å‚¨æµ‹é‡å View å®½/é«˜çš„å€¼ï¼šè°ƒç”¨ setMeasuredDimension()</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onMeasure</span><span class=\"params\">(<span class=\"keyword\">int</span> widthMeasureSpec, <span class=\"keyword\">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// å®šä¹‰å­˜æ”¾æµ‹é‡åçš„Viewå®½/é«˜çš„å˜é‡</span></span><br><span class=\"line\">      <span class=\"keyword\">int</span> widthMeasure ;</span><br><span class=\"line\">      <span class=\"keyword\">int</span> heightMeasure ;</span><br><span class=\"line\">      <span class=\"comment\">// 1. éå†æ‰€æœ‰å­ View &amp; æµ‹é‡(measureChildren())</span></span><br><span class=\"line\">      measureChildren(widthMeasureSpec, heightMeasureSpec)ï¼›</span><br><span class=\"line\">      <span class=\"comment\">// 2. åˆå¹¶æ‰€æœ‰å­Viewçš„å°ºå¯¸å¤§å°ï¼Œæœ€ç»ˆå¾—åˆ°ViewGroupçˆ¶è§†å›¾çš„æµ‹é‡å€¼</span></span><br><span class=\"line\">      <span class=\"comment\">// éœ€è‡ªèº«å®ç°</span></span><br><span class=\"line\">      measureMerge();</span><br><span class=\"line\">      <span class=\"comment\">// 3. å­˜å‚¨æµ‹é‡åViewå®½/é«˜çš„å€¼ï¼šè°ƒç”¨setMeasuredDimension()</span></span><br><span class=\"line\">      <span class=\"comment\">// ç±»ä¼¼å•ä¸€Viewçš„è¿‡ç¨‹ï¼Œæ­¤å¤„ä¸ä½œè¿‡å¤šæè¿°</span></span><br><span class=\"line\">      setMeasuredDimension(widthMeasure,  heightMeasure);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>measureChildren()</code>éå†å­ View å¹¶ä¸”è°ƒç”¨ measureChild() è¿›è¡Œä¸‹ä¸€æ­¥æµ‹é‡</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">measureChildren</span><span class=\"params\">(<span class=\"keyword\">int</span> widthMeasureSpec, <span class=\"keyword\">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// è¦æ±‚è¯¥è§†å›¾çš„æ‰€æœ‰å­è§†å›¾åº¦é‡è‡ªå·±ï¼ŒåŒæ—¶è€ƒè™‘è¯¥è§†å›¾çš„MeasureSpecè¦æ±‚åŠå…¶å¡«å……ã€‚æˆ‘ä»¬è·³è¿‡äº†å¤„äºGONEçŠ¶æ€çš„å­èŠ‚ç‚¹</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> size = mChildrenCount;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> View[] children = mChildren;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; size; ++i) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> View child = children[i];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((child.mViewFlags &amp; VISIBILITY_MASK) != GONE) &#123;</span><br><span class=\"line\">            measureChild(child, widthMeasureSpec, heightMeasureSpec);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th style=\"text-align:center\">è¿‡ç¨‹</th>\n<th style=\"text-align:center\">è¡Œä¸ºä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/03/IAokqI.png\" alt=\"IAokqI.png\" loading=\"lazy\"></td>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/03/IAo1Ln.png\" alt=\"IAo1Ln.png\" loading=\"lazy\"></td>\n</tr>\n</tbody>\n</table></div></div><h5 id=\"linearlayout-measureåˆ†æ\">LinearLayout measureåˆ†æ<a title=\"#linearlayout-measureåˆ†æ\" href=\"#linearlayout-measureåˆ†æ\"></a></h5>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onMeasure</span><span class=\"params\">(<span class=\"keyword\">int</span> widthMeasureSpec, <span class=\"keyword\">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// æ ¹æ®ä¸åŒçš„å¸ƒå±€å±æ€§è¿›è¡Œä¸åŒçš„è®¡ç®—</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mOrientation == VERTICAL) &#123;</span><br><span class=\"line\">        measureVertical(widthMeasureSpec, heightMeasureSpec);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        measureHorizontal(widthMeasureSpec, heightMeasureSpec);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">measureVertical</span><span class=\"params\">(<span class=\"keyword\">int</span> widthMeasureSpec, <span class=\"keyword\">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// è·å–å‚ç›´æ–¹å‘ä¸Šçš„å­Viewä¸ªæ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> count = getVirtualChildCount();</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// éå†å­Viewè·å–å…¶é«˜åº¦ï¼Œå¹¶è®°å½•ä¸‹å­Viewä¸­æœ€é«˜çš„é«˜åº¦æ•°å€¼</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; count; ++i) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> View child = getVirtualChildAt(i);</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"comment\">// å­Viewä¸å¯è§ï¼Œç›´æ¥è·³è¿‡è¯¥Viewçš„measureè¿‡ç¨‹ï¼ŒgetChildrenSkipCount()è¿”å›å€¼æ’ä¸º0</span></span><br><span class=\"line\">        <span class=\"comment\">// æ³¨ï¼šè‹¥viewçš„å¯è§å±æ€§è®¾ç½®ä¸ºVIEW.INVISIBLEï¼Œè¿˜æ˜¯ä¼šè®¡ç®—è¯¥viewå¤§å°</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (child.getVisibility() == View.GONE) &#123;</span><br><span class=\"line\">           i += getChildrenSkipCount(child, i);</span><br><span class=\"line\">           <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"comment\">// è®°å½•å­Viewæ˜¯å¦æœ‰weightå±æ€§è®¾ç½®ï¼Œç”¨äºåé¢åˆ¤æ–­æ˜¯å¦éœ€è¦äºŒæ¬¡measure</span></span><br><span class=\"line\">        totalWeight += lp.weight;</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (heightMode == MeasureSpec.EXACTLY &amp;&amp; lp.height == <span class=\"number\">0</span> &amp;&amp; lp.weight &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å¦‚æœLinearLayoutçš„specModeä¸ºEXACTLYä¸”å­Viewè®¾ç½®äº†weightå±æ€§ï¼Œåœ¨è¿™é‡Œä¼šè·³è¿‡å­Viewçš„measureè¿‡ç¨‹</span></span><br><span class=\"line\">            <span class=\"comment\">// åŒæ—¶æ ‡è®°skippedMeasureå±æ€§ä¸ºtrueï¼Œåé¢ä¼šæ ¹æ®è¯¥å±æ€§å†³å®šæ˜¯å¦è¿›è¡Œç¬¬äºŒæ¬¡measure</span></span><br><span class=\"line\">            <span class=\"comment\">// è‹¥LinearLayoutçš„å­Viewè®¾ç½®äº†weightï¼Œä¼šè¿›è¡Œä¸¤æ¬¡measureè®¡ç®—ï¼Œæ¯”è¾ƒè€—æ—¶</span></span><br><span class=\"line\">            <span class=\"comment\">// è¿™å°±æ˜¯ä¸ºä»€ä¹ˆLinearLayoutçš„å­Viewéœ€è¦ä½¿ç”¨weightå±æ€§æ—¶å€™ï¼Œæœ€å¥½æ›¿æ¢æˆRelativeLayoutå¸ƒå±€</span></span><br><span class=\"line\">            <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> totalLength = mTotalLength;</span><br><span class=\"line\">            mTotalLength = Math.max(totalLength, totalLength + lp.topMargin + lp.bottomMargin);</span><br><span class=\"line\">            skippedMeasure = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> oldHeight = Integer.MIN_VALUE;</span><br><span class=\"line\">            <span class=\"comment\">// æ­¥éª¤1ï¼šéå†æ‰€æœ‰å­View &amp; æµ‹é‡ï¼šmeasureChildrenï¼ˆï¼‰</span></span><br><span class=\"line\">            <span class=\"comment\">// æ³¨ï¼šè¯¥æ–¹æ³•å†…éƒ¨ï¼Œæœ€ç»ˆä¼šè°ƒç”¨measureChildrenï¼ˆï¼‰ï¼Œä»è€Œ éå†æ‰€æœ‰å­View &amp; æµ‹é‡</span></span><br><span class=\"line\">            measureChildBeforeLayout(child, i, widthMeasureSpec, <span class=\"number\">0</span>, heightMeasureSpec, totalWeight == <span class=\"number\">0</span> ? mTotalLength : <span class=\"number\">0</span>);</span><br><span class=\"line\">                   ...</span><br><span class=\"line\">            <span class=\"comment\">//æ­¥éª¤2ï¼šåˆå¹¶æ‰€æœ‰å­Viewçš„å°ºå¯¸å¤§å°,æœ€ç»ˆå¾—åˆ°ViewGroupçˆ¶è§†å›¾çš„æµ‹é‡å€¼ï¼ˆè‡ªèº«å®ç°ï¼‰</span></span><br><span class=\"line\">            <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> childHeight = child.getMeasuredHeight();</span><br><span class=\"line\"> </span><br><span class=\"line\">            <span class=\"comment\">// 1. mTotalLengthç”¨äºå­˜å‚¨LinearLayoutåœ¨ç«–ç›´æ–¹å‘çš„é«˜åº¦</span></span><br><span class=\"line\">            <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> totalLength = mTotalLength;</span><br><span class=\"line\"> </span><br><span class=\"line\">            <span class=\"comment\">// 2. æ¯æµ‹é‡ä¸€ä¸ªå­Viewçš„é«˜åº¦ï¼Œ mTotalLengthå°±ä¼šå¢åŠ </span></span><br><span class=\"line\">            mTotalLength = Math.max(totalLength, totalLength + childHeight + lp.topMargin +</span><br><span class=\"line\">                           lp.bottomMargin + getNextLocationOffset(child));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// 3. è®°å½•LinearLayoutå ç”¨çš„æ€»é«˜åº¦</span></span><br><span class=\"line\">    <span class=\"comment\">// å³é™¤äº†å­Viewçš„é«˜åº¦ï¼Œè¿˜æœ‰æœ¬èº«çš„paddingå±æ€§å€¼</span></span><br><span class=\"line\">    mTotalLength += mPaddingTop + mPaddingBottom;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> heightSize = mTotalLength;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> heightSizeAndState = resolveSizeAndState(heightSize, heightMeasureSpec, <span class=\"number\">0</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">//æ­¥éª¤3ï¼šå­˜å‚¨æµ‹é‡åViewå®½/é«˜çš„å€¼ï¼šè°ƒç”¨setMeasuredDimension()</span></span><br><span class=\"line\">    setMeasuredDimension(resolveSizeAndState(maxWidth, widthMeasureSpec, childState), heightSizeAndState);</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"è·å–viewçš„å®½é«˜\">è·å–Viewçš„å®½é«˜<a title=\"#è·å–viewçš„å®½é«˜\" href=\"#è·å–viewçš„å®½é«˜\"></a></h3>\n<blockquote>\n<p>Activity å¯åŠ¨æ—¶ï¼Œåœ¨ onCreate()ã€onStart()ã€onResume() ä¸­å‡æ— æ³•æ­£ç¡®çš„å¾—åˆ°æŸä¸ª View çš„å®½é«˜ä¿¡æ¯ï¼Œè¿™æ˜¯å› ä¸º View çš„ measure è¿‡ç¨‹å’Œ Activity çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸æ˜¯åŒæ­¥æ‰§è¡Œçš„</p>\n</blockquote>\n<ul>\n<li>onWindowFocusChanged()\n<ul>\n<li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒonWindowFocusChanged() ä¼šè¢«è°ƒç”¨å¤šæ¬¡ï¼Œå½“ Activity çš„çª—å£å¾—åˆ°ç„¦ç‚¹å’Œå¤±å»ç„¦ç‚¹æ—¶å‡ä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚</li>\n</ul>\n</li>\n<li>View.post(runnable)</li>\n<li>ViewTreeObserver</li>\n<li>æ‰‹åŠ¨è°ƒç”¨ View çš„ measure æ–¹æ³•</li>\n</ul>\n<h3 id=\"refer\">Refer<a title=\"#refer\" href=\"#refer\"></a></h3>\n<p><a href=\"https://blog.csdn.net/u010289802/article/details/80183142\" target=\"_blank\">Android çŸ¥è¯†ä½“ç³»å­¦ä¹ ç›®å½•_lerendançš„åšå®¢-CSDNåšå®¢</a></p>\n",
            "tags": [
                "å›¾å½¢ç»˜åˆ¶"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/04/SA664RldODNgeCrz/",
            "url": "https://onion99.github.io/2021/11/04/SA664RldODNgeCrz/",
            "title": "è‡ªå®šä¹‰View(5) - åŠ¨ç”»",
            "date_published": "2021-11-03T21:59:44.000Z",
            "content_html": "<blockquote>\n<p>ä¸‰è€…æ€§èƒ½æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸º ViewPropertyAnimator å’Œ ObjectAnimator çš„å†…éƒ¨å®ç°å…¶å®éƒ½æ˜¯ ValueAnimatorï¼ŒObjectAnimator æ›´æ˜¯æœ¬æ¥å°±æ˜¯ ValueAnimator çš„å­ç±»ï¼Œå·®åˆ«åªæ˜¯ä½¿ç”¨çš„ä¾¿æ·æ€§ä»¥åŠåŠŸèƒ½çš„çµæ´»æ€§ã€‚</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/11/02/IFf4h9.gif\" alt=\"IFf4h9.gif\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<span id=\"more\"></span>\n<h3 id=\"viewpropertyanimator\">ViewPropertyAnimator<a title=\"#viewpropertyanimator\" href=\"#viewpropertyanimator\"></a></h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">view.animate()</span><br><span class=\"line\">        .scaleX(<span class=\"number\">1</span>)</span><br><span class=\"line\">        .scaleY(<span class=\"number\">1</span>)</span><br><span class=\"line\">        .alpha(<span class=\"number\">1</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"objectanimator\">ObjectAnimator<a title=\"#objectanimator\" href=\"#objectanimator\"></a></h3>\n<blockquote>\n<p>å¤šä¸ªåŠ¨ç”»é…åˆæ‰§è¡Œ</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PropertyValuesHolder holder1 = PropertyValuesHolder.ofFloat(<span class=\"string\">&quot;scaleX&quot;</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">PropertyValuesHolder holder2 = PropertyValuesHolder.ofFloat(<span class=\"string\">&quot;scaleY&quot;</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">PropertyValuesHolder holder3 = PropertyValuesHolder.ofFloat(<span class=\"string\">&quot;alpha&quot;</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">ObjectAnimator animator = ObjectAnimator.ofPropertyValuesHolder(view, holder1, holder2, holder3)</span><br><span class=\"line\">animator.start();</span><br></pre></td></tr></table></figure>\n<h3 id=\"valueanimator\">ValueAnimator<a title=\"#valueanimator\" href=\"#valueanimator\"></a></h3>\n<blockquote>\n<p>ValueAnimator æœ¬èº«ä¸ä½œç”¨äºä»»ä½•ä¸€ä¸ªå±æ€§ï¼Œä¹Ÿä¸æä¾›ä»»ä½•ä¸€ç§åŠ¨ç”»ã€‚å®ƒå°±æ˜¯ä¸€ä¸ªæ•°å€¼å‘ç”Ÿå™¨ï¼Œå¯ä»¥äº§ç”Ÿæƒ³è¦çš„å„ç§æ•°å€¼</p>\n</blockquote>\n<p>ValueAnimator å¹¶ä¸å¸¸ç”¨ï¼Œå› ä¸ºå®ƒçš„åŠŸèƒ½å¤ªåŸºç¡€äº†ã€‚ValueAnimator æ˜¯ ObjectAnimator çš„çˆ¶ç±»ï¼Œå®é™…ä¸Šï¼ŒValueAnimator å°±æ˜¯ä¸€ä¸ªä¸èƒ½æŒ‡å®šç›®æ ‡å¯¹è±¡ç‰ˆæœ¬çš„ ObjectAnimato</p>\n",
            "tags": [
                "å›¾å½¢ç»˜åˆ¶"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/04/ZOnr24kULe7cQgsc/",
            "url": "https://onion99.github.io/2021/11/04/ZOnr24kULe7cQgsc/",
            "title": "è‡ªå®šä¹‰View(4) - Canvasç›¸å…³",
            "date_published": "2021-11-03T21:58:53.000Z",
            "content_html": "<h3 id=\"èŒƒå›´è£åˆ‡\">èŒƒå›´è£åˆ‡<a title=\"#èŒƒå›´è£åˆ‡\" href=\"#èŒƒå›´è£åˆ‡\"></a></h3>\n<h4 id=\"cliprect\">clipRect<a title=\"#cliprect\" href=\"#cliprect\"></a></h4>\n<p><img src=\"https://z3.ax1x.com/2021/11/02/IFKTER.png\" alt=\"IFKTER.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">canvas.clipRect(left, top, right, bottom);</span><br><span class=\"line\">canvas.drawBitmap(bitmap, x, y, paint);</span><br><span class=\"line\"><span class=\"comment\">// åŠ ä¸Š Canvas.save() å’Œ Canvas.restore() æ¥åŠæ—¶æ¢å¤ç»˜åˆ¶èŒƒå›´</span></span><br><span class=\"line\">canvas.save();</span><br><span class=\"line\">canvas.clipRect(left, top, right, bottom);</span><br><span class=\"line\">canvas.drawBitmap(bitmap, x, y, paint);</span><br><span class=\"line\">canvas.restore();</span><br></pre></td></tr></table></figure>\n<span id=\"more\"></span>\n<h4 id=\"clippath\">clipPath<a title=\"#clippath\" href=\"#clippath\"></a></h4>\n<p><img src=\"https://z3.ax1x.com/2021/11/02/IFM9UI.md.png\" alt=\"IFM9UI.md.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">canvas.save();</span><br><span class=\"line\">canvas.clipPath(path1);</span><br><span class=\"line\">canvas.drawBitmap(bitmap, point1.x, point1.y, paint);</span><br><span class=\"line\">canvas.restore();</span><br><span class=\"line\"></span><br><span class=\"line\">canvas.save();</span><br><span class=\"line\">canvas.clipPath(path2);</span><br><span class=\"line\">canvas.drawBitmap(bitmap, point2.x, point2.y, paint);</span><br><span class=\"line\">canvas.restore();</span><br></pre></td></tr></table></figure>\n<h3 id=\"å‡ ä½•å˜æ¢\">å‡ ä½•å˜æ¢<a title=\"#å‡ ä½•å˜æ¢\" href=\"#å‡ ä½•å˜æ¢\"></a></h3>\n<h4 id=\"äºŒç»´å˜æ¢\">äºŒç»´å˜æ¢<a title=\"#äºŒç»´å˜æ¢\" href=\"#äºŒç»´å˜æ¢\"></a></h4>\n<blockquote>\n<p>å¤„ç†å¸¸è§çš„äºŒç»´å˜æ¢</p>\n</blockquote>\n<ul>\n<li><code>Canvas.translate()</code> å¹³ç§»</li>\n<li><code>Canvas.rotate()</code> æ—‹è½¬</li>\n<li><code>Canvas.scale()</code> ç¼©æ”¾</li>\n<li><code>Canvas.skew()</code> é”™åˆ‡</li>\n</ul>\n<h4 id=\"matrixå˜æ¢\">Matrixå˜æ¢<a title=\"#matrixå˜æ¢\" href=\"#matrixå˜æ¢\"></a></h4>\n<blockquote>\n<p>ç”¨æ¥å¤„ç†ä¸å¸¸è§çš„äºŒç»´å˜æ¢</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/11/02/IFn6qs.png\" alt=\"IFn6qs.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<ul>\n<li><code>Canvas.setMatrix(matrix)</code>\n<ul>\n<li>ç”¨ <code>Matrix</code> ç›´æ¥æ›¿æ¢ <code>Canvas</code> å½“å‰çš„å˜æ¢çŸ©é˜µï¼Œå³æŠ›å¼ƒ <code>Canvas</code> å½“å‰çš„å˜æ¢</li>\n</ul>\n</li>\n<li><code>Canvas.concat(matrix)</code>\n<ul>\n<li>ç”¨ <code>Canvas</code> å½“å‰çš„å˜æ¢çŸ©é˜µå’Œ <code>Matrix</code> ç›¸ä¹˜ï¼Œå³åŸºäº <code>Canvas</code> å½“å‰çš„å˜æ¢ï¼Œå åŠ ä¸Š <code>Matrix</code> ä¸­çš„å˜æ¢</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Matrix matrix = <span class=\"keyword\">new</span> Matrix();</span><br><span class=\"line\"><span class=\"keyword\">float</span> pointsSrc = &#123;left, top, right, top, left, bottom, right, bottom&#125;;</span><br><span class=\"line\"><span class=\"keyword\">float</span> pointsDst = &#123;left - <span class=\"number\">10</span>, top + <span class=\"number\">50</span>, right + <span class=\"number\">120</span>, top - <span class=\"number\">90</span>, left + <span class=\"number\">20</span>, bottom + <span class=\"number\">30</span>, right + <span class=\"number\">20</span>, bottom + <span class=\"number\">60</span>&#125;;</span><br><span class=\"line\">...</span><br><span class=\"line\">matrix.reset();</span><br><span class=\"line\">matrix.setPolyToPoly(pointsSrc, <span class=\"number\">0</span>, pointsDst, <span class=\"number\">0</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\">canvas.save();</span><br><span class=\"line\">canvas.concat(matrix);</span><br><span class=\"line\">canvas.drawBitmap(bitmap, x, y, paint);</span><br><span class=\"line\">canvas.restore();</span><br></pre></td></tr></table></figure>\n<h4 id=\"camera\">Camera<a title=\"#camera\" href=\"#camera\"></a></h4>\n<blockquote>\n<p>å¤„ç†ä¸‰ç»´æ—‹è½¬</p>\n</blockquote>\n<h5 id=\"camera.rotate*\">Camera.rotate*<a title=\"#camera.rotate*\" href=\"#camera.rotate*\"></a></h5>\n<p><img src=\"https://z3.ax1x.com/2021/11/02/IFZoMd.md.png\" alt=\"IFZoMd.md.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Camera camera =  <span class=\"keyword\">new</span>  Camera();</span><br><span class=\"line\">Point point1 = <span class=\"keyword\">new</span> Point(<span class=\"number\">200</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\">Point point2 = <span class=\"keyword\">new</span> Point(<span class=\"number\">600</span>, <span class=\"number\">200</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onDraw</span><span class=\"params\">(Canvas canvas)</span> </span>&#123;</span><br><span class=\"line\">   canvas.save();</span><br><span class=\"line\">   camera.save(); <span class=\"comment\">// ä¿å­˜ Camera çš„çŠ¶æ€</span></span><br><span class=\"line\">   camera.rotateX(<span class=\"number\">30</span>); <span class=\"comment\">// æ—‹è½¬ Camera çš„ä¸‰ç»´ç©ºé—´</span></span><br><span class=\"line\">   camera.applyToCanvas(canvas); <span class=\"comment\">// æŠŠæ—‹è½¬æŠ•å½±åˆ° Canvas</span></span><br><span class=\"line\">   camera.restore(); <span class=\"comment\">// æ¢å¤ Camera çš„çŠ¶æ€</span></span><br><span class=\"line\">   canvas.drawBitmap(bitmap, point1.x, point1.y, paint);</span><br><span class=\"line\">   canvas.restore();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å±…ä¸­å¤„ç†:<br>\n<img src=\"https://z3.ax1x.com/2021/11/02/IFesfS.png\" alt=\"IFesfS.png\" loading=\"lazy\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">int</span> bitmapWidth = bitmap.getWidth();</span><br><span class=\"line\"><span class=\"keyword\">int</span> bitmapHeight = bitmap.getHeight();</span><br><span class=\"line\"><span class=\"keyword\">int</span> center1X = point1.x + bitmapWidth / <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> center1Y = point1.y + bitmapHeight / <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> center2X = point2.x + bitmapWidth / <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> center2Y = point2.y + bitmapHeight / <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">camera.save();</span><br><span class=\"line\">matrix.reset();</span><br><span class=\"line\">camera.rotateX(<span class=\"number\">30</span>);</span><br><span class=\"line\">camera.getMatrix(matrix);</span><br><span class=\"line\">camera.restore();</span><br><span class=\"line\">matrix.preTranslate(-center1X, -center1Y);</span><br><span class=\"line\">matrix.postTranslate(center1X, center1Y);</span><br><span class=\"line\">canvas.save();</span><br><span class=\"line\">canvas.concat(matrix);</span><br><span class=\"line\">canvas.drawBitmap(bitmap, point1.x, point1.y, paint);</span><br><span class=\"line\">canvas.restore();</span><br></pre></td></tr></table></figure>\n<h5 id=\"camera.translate\">Camera.translate<a title=\"#camera.translate\" href=\"#camera.translate\"></a></h5>\n<h5 id=\"camera.setlocation\">Camera.setLocation<a title=\"#camera.setlocation\" href=\"#camera.setlocation\"></a></h5>\n<blockquote>\n<p>è®¾ç½®è™šæ‹Ÿç›¸æœºçš„ä½ç½®</p>\n</blockquote>\n",
            "tags": [
                "å›¾å½¢ç»˜åˆ¶"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/04/VjI1fQxy8MSFqUqm/",
            "url": "https://onion99.github.io/2021/11/04/VjI1fQxy8MSFqUqm/",
            "title": "è‡ªå®šä¹‰View(3) - Textç›¸å…³",
            "date_published": "2021-11-03T21:57:48.000Z",
            "content_html": "<h3 id=\"æ–‡å­—ç»˜åˆ¶(canvas)\">æ–‡å­—ç»˜åˆ¶(Canvas)<a title=\"#æ–‡å­—ç»˜åˆ¶(canvas)\" href=\"#æ–‡å­—ç»˜åˆ¶(canvas)\"></a></h3>\n<h4 id=\"ç»˜åˆ¶æ–¹å¼\">ç»˜åˆ¶æ–¹å¼<a title=\"#ç»˜åˆ¶æ–¹å¼\" href=\"#ç»˜åˆ¶æ–¹å¼\"></a></h4>\n<h5 id=\"drawtext\">drawText<a title=\"#drawtext\" href=\"#drawtext\"></a></h5>\n<p><img src=\"https://z3.ax1x.com/2021/11/02/IiheJA.png\" alt=\"IiheJA.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<span id=\"more\"></span>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">String text = <span class=\"string\">&quot;Hello HenCoder&quot;</span>;</span><br><span class=\"line\">...</span><br><span class=\"line\">canvas.drawText(text, <span class=\"number\">200</span>, <span class=\"number\">100</span>, paint);</span><br></pre></td></tr></table></figure>\n<h5 id=\"drawtextrun\">drawTextRun<a title=\"#drawtextrun\" href=\"#drawtextrun\"></a></h5>\n<h5 id=\"drawtextonpath\">drawTextOnPath<a title=\"#drawtextonpath\" href=\"#drawtextonpath\"></a></h5>\n<blockquote>\n<p>æ²¿ç€ä¸€æ¡ Path æ¥ç»˜åˆ¶æ–‡å­—</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/11/02/IihNzq.png\" alt=\"IihNzq.png\" loading=\"lazy\"><br>\n<code>drawTextOnPath()</code> ä½¿ç”¨çš„ <code>Path</code> ï¼Œæ‹å¼¯å¤„å…¨ç”¨åœ†è§’ï¼Œåˆ«ç”¨å°–è§’</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">canvas.drawPath(path, paint); <span class=\"comment\">// æŠŠ Path ä¹Ÿç»˜åˆ¶å‡ºæ¥ï¼Œç†è§£èµ·æ¥æ›´æ–¹ä¾¿</span></span><br><span class=\"line\">canvas.drawTextOnPath(<span class=\"string\">&quot;Hello HeCoder&quot;</span>, path, <span class=\"number\">0</span>, <span class=\"number\">0</span>, paint);</span><br></pre></td></tr></table></figure>\n<h5 id=\"staticlayout\">StaticLayout<a title=\"#staticlayout\" href=\"#staticlayout\"></a></h5>\n<blockquote>\n<p>è¿›è¡Œå¤šè¡Œæ–‡å­—çš„ç»˜åˆ¶</p>\n</blockquote>\n<ul>\n<li>View çš„è¾¹ç¼˜è‡ªåŠ¨æŠ˜è¡Œ</li>\n<li>åœ¨æ¢è¡Œç¬¦ <code>\\n</code> å¤„æ¢è¡Œ</li>\n</ul>\n<p><img src=\"https://z3.ax1x.com/2021/11/02/Iih7Yd.md.png\" alt=\"Iih7Yd.md.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">String text1 = <span class=\"string\">&quot;Lorem Ipsum is simply dummy text of the printing and typesetting industry.&quot;</span>;</span><br><span class=\"line\">StaticLayout staticLayout1 = <span class=\"keyword\">new</span> StaticLayout(text1, paint, <span class=\"number\">600</span>,</span><br><span class=\"line\">        Layout.Alignment.ALIGN_NORMAL, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">String text2 = <span class=\"string\">&quot;a\\nbc\\ndefghi\\njklm\\nnopqrst\\nuvwx\\nyz&quot;</span>;</span><br><span class=\"line\">StaticLayout staticLayout2 = <span class=\"keyword\">new</span> StaticLayout(text2, paint, <span class=\"number\">600</span>,</span><br><span class=\"line\">        Layout.Alignment.ALIGN_NORMAL, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"keyword\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">canvas.save();</span><br><span class=\"line\">canvas.translate(<span class=\"number\">50</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\">staticLayout1.draw(canvas);</span><br><span class=\"line\">canvas.translate(<span class=\"number\">0</span>, <span class=\"number\">200</span>);</span><br><span class=\"line\">staticLayout2.draw(canvas);</span><br><span class=\"line\">canvas.restore();</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ–‡å­—ç»˜åˆ¶è¾…åŠ©(paint)\">æ–‡å­—ç»˜åˆ¶è¾…åŠ©(Paint)<a title=\"#æ–‡å­—ç»˜åˆ¶è¾…åŠ©(paint)\" href=\"#æ–‡å­—ç»˜åˆ¶è¾…åŠ©(paint)\"></a></h3>\n<h4 id=\"æ ·å¼è®¾ç½®\">æ ·å¼è®¾ç½®<a title=\"#æ ·å¼è®¾ç½®\" href=\"#æ ·å¼è®¾ç½®\"></a></h4>\n<ul>\n<li><code>setTextSize(float textSize)</code></li>\n<li><code>setTypeface(Typeface typeface)</code></li>\n<li><code>setFakeBoldText(boolean fakeBoldText)</code>æ˜¯å¦ä½¿ç”¨ä¼ªç²—ä½“</li>\n<li><code>setStrikeThruText(boolean strikeThruText)</code>æ˜¯å¦åŠ åˆ é™¤çº¿</li>\n<li><code>setUnderlineText(boolean underlineText)</code></li>\n<li><code>setTextSkewX(float skewX)</code> æ–‡å­—æ¨ªåˆ‡è§’åº¦</li>\n<li><code>setTextScaleX(float scaleX)</code></li>\n<li><code>setLetterSpacing(float letterSpacing)</code> å­—ç¬¦é—´è·</li>\n<li><code>setFontFeatureSettings(String settings)</code></li>\n<li><code>setTextAlign(Paint.Align align)</code></li>\n<li><code>setTextLocale(Locale locale)</code>è¯­è¨€åŒºåŸŸ</li>\n<li><code>setHinting(int mode)</code>å­—ä½“å¾®è°ƒ</li>\n<li><code>setSubpixelText(boolean subpixelText)</code>æ˜¯å¦å¼€å¯åƒç´ çº§çš„æŠ—é”¯é½¿</li>\n</ul>\n<h4 id=\"æµ‹é‡\">æµ‹é‡<a title=\"#æµ‹é‡\" href=\"#æµ‹é‡\"></a></h4>\n<ul>\n<li><code>getFontSpacing()</code> è·å–æ¨èçš„è¡Œè·\n<ul>\n<li><img src=\"https://z3.ax1x.com/2021/11/02/IiboRg.png\" alt=\"IiboRg.png\" loading=\"lazy\" class=\"Ï†bp\"></li>\n</ul>\n</li>\n<li><code>getFontMetrics()</code>\n<ul>\n<li><img src=\"https://z3.ax1x.com/2021/11/02/IibtM9.png\" alt=\"IibtM9.png\" loading=\"lazy\" class=\"Ï†bp\"></li>\n</ul>\n</li>\n<li><code>getTextBounds()</code> è·å–æ–‡å­—èŒƒå›´</li>\n<li><code>measureText()</code>æµ‹é‡æ–‡å­—çš„å®½åº¦å¹¶è¿”å›</li>\n<li><code>getTextWidths()</code>è·å–å­—ç¬¦ä¸²ä¸­æ¯ä¸ªå­—ç¬¦çš„å®½åº¦</li>\n<li><code>breakText()</code> å’Œ <code>measureText()</code> çš„åŒºåˆ«æ˜¯ï¼Œ breakText() æ˜¯åœ¨ç»™å‡ºå®½åº¦ä¸Šé™çš„å‰æä¸‹æµ‹é‡æ–‡å­—çš„å®½åº¦ã€‚å¦‚æœæ–‡å­—çš„å®½åº¦è¶…å‡ºäº†ä¸Šé™ï¼Œé‚£ä¹ˆåœ¨ä¸´è¿‘è¶…é™çš„ä½ç½®æˆªæ–­æ–‡å­—</li>\n<li>å…‰æ ‡ç›¸å…³\n<ul>\n<li><code>getRunAdvance()</code>è®¡ç®—å‡ºæŸä¸ªå­—ç¬¦å¤„å…‰æ ‡çš„ <code>x</code> åæ ‡\n<ul>\n<li><img src=\"https://z3.ax1x.com/2021/11/02/Iibnrn.png\" alt=\"Iibnrn.png\" loading=\"lazy\" class=\"Ï†bp\"></li>\n<li><img src=\"https://z3.ax1x.com/2021/11/02/IibMV0.md.png\" alt=\"IibMV0.md.png\" loading=\"lazy\" class=\"Ï†bp\"></li>\n</ul>\n</li>\n<li><code>getOffsetForAdvance</code> è®¡ç®—ç¬¬å‡ ä¸ªå­—ç¬¦æœ€æ¥è¿‘è¿™ä¸ªåæ ‡</li>\n</ul>\n</li>\n<li><code>hasGlyph()</code>æ£€æŸ¥æŒ‡å®šçš„å­—ç¬¦ä¸²ä¸­æ˜¯å¦æ˜¯ä¸€ä¸ªå•ç‹¬çš„å­—å½¢\n<ul>\n<li><img src=\"https://z3.ax1x.com/2021/11/02/IiH9tU.png\" alt=\"IiH9tU.png\" loading=\"lazy\" class=\"Ï†bp\"></li>\n</ul>\n</li>\n</ul>\n",
            "tags": [
                "å›¾å½¢ç»˜åˆ¶"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/02/weRgrdLnBqIUWkcH/",
            "url": "https://onion99.github.io/2021/11/02/weRgrdLnBqIUWkcH/",
            "title": "è‡ªå®šä¹‰View(2) - Paintç›¸å…³",
            "date_published": "2021-11-01T22:19:10.000Z",
            "content_html": "<h3 id=\"color\">Color<a title=\"#color\" href=\"#color\"></a></h3>\n<h4 id=\"åŸºæœ¬é¢œè‰²\">åŸºæœ¬é¢œè‰²<a title=\"#åŸºæœ¬é¢œè‰²\" href=\"#åŸºæœ¬é¢œè‰²\"></a></h4>\n<p>setColor(int color):</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">paint.setColor(Color.parseColor(<span class=\"string\">&quot;#009688&quot;</span>));</span><br><span class=\"line\">canvas.drawRect(<span class=\"number\">30</span>, <span class=\"number\">30</span>, <span class=\"number\">230</span>, <span class=\"number\">180</span>, paint);</span><br></pre></td></tr></table></figure>\n<span id=\"more\"></span>\n<p>setARGB(int a, int r, int g, int b)</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">paint.setARGB(<span class=\"number\">100</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">canvas.drawLine(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">200</span>, <span class=\"number\">200</span>, paint);</span><br></pre></td></tr></table></figure>\n<h4 id=\"shader\">Shader<a title=\"#shader\" href=\"#shader\"></a></h4>\n<h5 id=\"lineargradient(çº¿æ€§æ¸å˜)\">LinearGradient(çº¿æ€§æ¸å˜)<a title=\"#lineargradient(çº¿æ€§æ¸å˜)\" href=\"#lineargradient(çº¿æ€§æ¸å˜)\"></a></h5>\n<p><img src=\"https://z3.ax1x.com/2021/11/01/ICK7e1.png\" alt=\"ICK7e1.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Shader shader = <span class=\"keyword\">new</span> LinearGradient(<span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">500</span>, <span class=\"number\">500</span>, Color.parseColor(<span class=\"string\">&quot;#E91E63&quot;</span>),</span><br><span class=\"line\">        Color.parseColor(<span class=\"string\">&quot;#2196F3&quot;</span>), Shader.TileMode.CLAMP);</span><br><span class=\"line\">paint.setShader(shader);</span><br><span class=\"line\">...</span><br><span class=\"line\">canvas.drawCircle(<span class=\"number\">300</span>, <span class=\"number\">300</span>, <span class=\"number\">200</span>, paint);</span><br></pre></td></tr></table></figure>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th style=\"text-align:center\">CLAMP</th>\n<th style=\"text-align:center\">MIRROR</th>\n<th style=\"text-align:center\">REPEAT</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/ICuIVP.png\" alt=\"ICuIVP.png\" loading=\"lazy\"></td>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/ICKWJU.png\" alt=\"ICKWJU.png\" loading=\"lazy\"></td>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/ICK5QJ.png\" alt=\"ICK5QJ.png\" loading=\"lazy\"></td>\n</tr>\n</tbody>\n</table></div></div><h5 id=\"radialgradient(è¾å°„æ¸å˜)\">RadialGradient(è¾å°„æ¸å˜)<a title=\"#radialgradient(è¾å°„æ¸å˜)\" href=\"#radialgradient(è¾å°„æ¸å˜)\"></a></h5>\n<p><img src=\"https://z3.ax1x.com/2021/11/01/IClQRU.png\" alt=\"IClQRU.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Shader shader = <span class=\"keyword\">new</span> RadialGradient(<span class=\"number\">300</span>, <span class=\"number\">300</span>, <span class=\"number\">200</span>, Color.parseColor(<span class=\"string\">&quot;#E91E63&quot;</span>),</span><br><span class=\"line\">        Color.parseColor(<span class=\"string\">&quot;#2196F3&quot;</span>), Shader.TileMode.CLAMP);</span><br><span class=\"line\">paint.setShader(shader);</span><br><span class=\"line\">...</span><br><span class=\"line\">canvas.drawCircle(<span class=\"number\">300</span>, <span class=\"number\">300</span>, <span class=\"number\">200</span>, paint);  </span><br></pre></td></tr></table></figure>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th style=\"text-align:center\">CLAMP</th>\n<th style=\"text-align:center\">MIRROR</th>\n<th style=\"text-align:center\">REPEAT</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/IClfW8.png\" alt=\"IClfW8.png\" loading=\"lazy\"></td>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/IC1SOJ.png\" alt=\"IC1SOJ.png\" loading=\"lazy\"></td>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/IC1SOJ.png\" alt=\"IC1SOJ.png\" loading=\"lazy\"></td>\n</tr>\n</tbody>\n</table></div></div><h5 id=\"sweepgradient(æ‰«ææ¸å˜)\">SweepGradient(æ‰«ææ¸å˜)<a title=\"#sweepgradient(æ‰«ææ¸å˜)\" href=\"#sweepgradient(æ‰«ææ¸å˜)\"></a></h5>\n<p><img src=\"https://z3.ax1x.com/2021/11/01/IC3N8K.png\" alt=\"IC3N8K.png\" loading=\"lazy\">]</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Shader shader = <span class=\"keyword\">new</span> SweepGradient(<span class=\"number\">300</span>, <span class=\"number\">300</span>, Color.parseColor(<span class=\"string\">&quot;#E91E63&quot;</span>),</span><br><span class=\"line\">        Color.parseColor(<span class=\"string\">&quot;#2196F3&quot;</span>));</span><br><span class=\"line\">paint.setShader(shader);</span><br><span class=\"line\">...</span><br><span class=\"line\">canvas.drawCircle(<span class=\"number\">300</span>, <span class=\"number\">300</span>, <span class=\"number\">200</span>, paint);</span><br></pre></td></tr></table></figure>\n<h5 id=\"bitmapshader\">BitmapShader<a title=\"#bitmapshader\" href=\"#bitmapshader\"></a></h5>\n<p><img src=\"https://z3.ax1x.com/2021/11/01/IC8dJ0.png\" alt=\"IC8dJ0.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Bitmap bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.batman);</span><br><span class=\"line\">Shader shader = <span class=\"keyword\">new</span> BitmapShader(bitmap, Shader.TileMode.CLAMP, Shader.TileMode.CLAMP);</span><br><span class=\"line\">paint.setShader(shader);</span><br><span class=\"line\">...</span><br><span class=\"line\">canvas.drawCircle(<span class=\"number\">300</span>, <span class=\"number\">300</span>, <span class=\"number\">200</span>, paint);</span><br></pre></td></tr></table></figure>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th style=\"text-align:center\">CLAMP</th>\n<th style=\"text-align:center\">MIRROR</th>\n<th style=\"text-align:center\">REPEAT</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/ICGhAs.png\" alt=\"ICGhAs.png\" loading=\"lazy\"></td>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/ICG7cT.png\" alt=\"ICG7cT.png\" loading=\"lazy\"></td>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/ICGLB4.png\" alt=\"ICGLB4.png\" loading=\"lazy\"></td>\n</tr>\n</tbody>\n</table></div></div><h5 id=\"composeshader-æ··åˆç€è‰²å™¨\">ComposeShader æ··åˆç€è‰²å™¨<a title=\"#composeshader-æ··åˆç€è‰²å™¨\" href=\"#composeshader-æ··åˆç€è‰²å™¨\"></a></h5>\n<blockquote>\n<p>æ‰€è°“æ··åˆï¼Œå°±æ˜¯æŠŠä¸¤ä¸ª Shader ä¸€èµ·ä½¿ç”¨ã€‚</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/11/01/ICUmdg.png\" alt=\"ICUmdg.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ç¬¬ä¸€ä¸ª Shaderï¼šå¤´åƒçš„ Bitmap</span></span><br><span class=\"line\">Bitmap bitmap1 = BitmapFactory.decodeResource(getResources(), R.drawable.batman);</span><br><span class=\"line\">Shader shader1 = <span class=\"keyword\">new</span> BitmapShader(bitmap1, Shader.TileMode.CLAMP, Shader.TileMode.CLAMP);</span><br><span class=\"line\"><span class=\"comment\">// ç¬¬äºŒä¸ª Shaderï¼šä»ä¸Šåˆ°ä¸‹çš„çº¿æ€§æ¸å˜ï¼ˆç”±é€æ˜åˆ°é»‘è‰²ï¼‰</span></span><br><span class=\"line\">Bitmap bitmap2 = BitmapFactory.decodeResource(getResources(), R.drawable.batman_logo);</span><br><span class=\"line\">Shader shader2 = <span class=\"keyword\">new</span> BitmapShader(bitmap2, Shader.TileMode.CLAMP, Shader.TileMode.CLAMP);</span><br><span class=\"line\"><span class=\"comment\">// ComposeShaderï¼šç»“åˆä¸¤ä¸ª Shader</span></span><br><span class=\"line\">Shader shader = <span class=\"keyword\">new</span> ComposeShader(shader1, shader2, PorterDuff.Mode.SRC_OVER);</span><br><span class=\"line\">paint.setShader(shader);</span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">canvas.drawCircle(<span class=\"number\">300</span>, <span class=\"number\">300</span>, <span class=\"number\">300</span>, paint);</span><br></pre></td></tr></table></figure>\n<h4 id=\"porterduff\">PorterDuff<a title=\"#porterduff\" href=\"#porterduff\"></a></h4>\n<h3 id=\"patheffect\">PathEffect<a title=\"#patheffect\" href=\"#patheffect\"></a></h3>\n<h4 id=\"style\">Style<a title=\"#style\" href=\"#style\"></a></h4>\n<p><code>Paint.setStrokeWidth</code>:çº¿æ¡å®½åº¦<br>\n<img src=\"https://z3.ax1x.com/2021/11/01/ICvqQe.png\" alt=\"ICvqQe.png\" loading=\"lazy\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">paint.setStyle(Paint.Style.STROKE);</span><br><span class=\"line\">paint.setStrokeWidth(<span class=\"number\">1</span>);</span><br><span class=\"line\">canvas.drawCircle(<span class=\"number\">150</span>, <span class=\"number\">125</span>, <span class=\"number\">100</span>, paint);</span><br><span class=\"line\">paint.setStrokeWidth(<span class=\"number\">5</span>);</span><br><span class=\"line\">canvas.drawCircle(<span class=\"number\">400</span>, <span class=\"number\">125</span>, <span class=\"number\">100</span>, paint);</span><br><span class=\"line\">paint.setStrokeWidth(<span class=\"number\">40</span>);</span><br><span class=\"line\">canvas.drawCircle(<span class=\"number\">650</span>, <span class=\"number\">125</span>, <span class=\"number\">100</span>, paint);</span><br></pre></td></tr></table></figure>\n<p><code>Paint.setStrokeCap</code>:çº¿æ¡å½¢çŠ¶</p>\n<p><img src=\"https://z3.ax1x.com/2021/11/01/ICxkLj.png\" alt=\"ICxkLj.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p><code>Paint.setStrokeJoin</code>:æ‹è§’å½¢çŠ¶</p>\n<p><img src=\"https://z3.ax1x.com/2021/11/01/ICxQlF.png\" alt=\"ICxQlF.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p><code>Paint.setStrokeMiter</code>:æ‹è§’è¾¹ç¼˜</p>\n<p><img src=\"https://z3.ax1x.com/2021/11/01/ICzenH.png\" alt=\"image\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h4 id=\"filter\">Filter<a title=\"#filter\" href=\"#filter\"></a></h4>\n<p><code>PathEffect.setDither()</code>:å›¾åƒæŠ–åŠ¨<br>\n<img src=\"https://z3.ax1x.com/2021/11/01/ICL31H.png\" alt=\"ICL31H.png\" loading=\"lazy\"></p>\n<p><code>PathEffect.setFilterBitmap()</code>:åŒçº¿æ€§è¿‡æ»¤<br>\n<img src=\"https://z3.ax1x.com/2021/11/01/ICvZ8O.png\" alt=\"ICvZ8O.png\" loading=\"lazy\"></p>\n<h4 id=\"effect\">Effect<a title=\"#effect\" href=\"#effect\"></a></h4>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th style=\"text-align:center\">Name</th>\n<th style=\"text-align:center\">Effect</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">CornerPathEffect</td>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/ICgRkq.png\" alt=\"ICgRkq.png\" loading=\"lazy\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">DiscretePathEffect</td>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/ICgGOH.png\" alt=\"ICgGOH.png\" loading=\"lazy\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">DashPathEffect</td>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/ICcXQg.png\" alt=\"ICcXQg.png\" loading=\"lazy\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">PathDashPathEffect</td>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/IC6T8U.png\" alt=\"IC6T8U.png\" loading=\"lazy\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">SumPathEffect</td>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/ICyBpF.png\" alt=\"ICyBpF.png\" loading=\"lazy\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">ComposePathEffect</td>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/ICy8yj.png\" alt=\"ICy8yj.png\" loading=\"lazy\"></td>\n</tr>\n</tbody>\n</table></div></div><h4 id=\"shadowlayer\">ShadowLayer<a title=\"#shadowlayer\" href=\"#shadowlayer\"></a></h4>\n<blockquote>\n<p>ç»˜åˆ¶å±‚ä¸‹æ–¹çš„é˜´å½±æ•ˆæœ</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/11/01/ICstPO.png\" alt=\"ICstPO.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">paint.setShadowLayer(<span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, Color.RED);</span><br><span class=\"line\">canvas.drawText(text, <span class=\"number\">80</span>, <span class=\"number\">300</span>, paint);</span><br></pre></td></tr></table></figure>\n<h4 id=\"maskfilter\">MaskFilter<a title=\"#maskfilter\" href=\"#maskfilter\"></a></h4>\n<blockquote>\n<p>ç»˜åˆ¶å±‚ä¸Šæ–¹çš„é™„åŠ æ•ˆæœ</p>\n</blockquote>\n<p>BlurMaskFilter(æ¨¡ç³Šæ•ˆæœ):</p>\n<p><img src=\"https://z3.ax1x.com/2021/11/01/ICrhE6.md.png\" alt=\"ICrhE6.md.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">paint.setMaskFilter(<span class=\"keyword\">new</span> BlurMaskFilter(<span class=\"number\">50</span>, BlurMaskFilter.Blur.NORMAL));</span><br><span class=\"line\">canvas.drawBitmap(bitmap, <span class=\"number\">100</span>, <span class=\"number\">100</span>, paint);</span><br></pre></td></tr></table></figure>\n<p>EmbossMaskFilter(æµ®é›•æ•ˆæœ):<br>\n<img src=\"https://z3.ax1x.com/2021/11/01/ICr0EV.png\" alt=\"ICr0EV.png\" loading=\"lazy\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// æ•°ç»„:å…‰æºæ–¹å‘,å…‰å¼ºåº¦,ç‚«å…‰ç³»æ•°,åº”ç”¨å…‰çº¿èŒƒå›´ </span></span><br><span class=\"line\">paint.setMaskFilter(<span class=\"keyword\">new</span> EmbossMaskFilter(<span class=\"keyword\">new</span> <span class=\"keyword\">float</span>[]&#123;<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>&#125;, <span class=\"number\">0.2f</span>, <span class=\"number\">8</span>, <span class=\"number\">10</span>));</span><br><span class=\"line\">canvas.drawBitmap(bitmap, <span class=\"number\">100</span>, <span class=\"number\">100</span>, paint);</span><br></pre></td></tr></table></figure>\n<h4 id=\"getpath\">getPath<a title=\"#getpath\" href=\"#getpath\"></a></h4>\n<p><code>PathEffect.getFillPath()</code>è·å–å›¾å½¢Path</p>\n<p><img src=\"https://z3.ax1x.com/2021/11/01/ICDOtU.md.png\" alt=\"ICDOtU.md.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p><code>PathEffect.getTextPath()</code>è·å–å›¾å½¢Path</p>\n<p><img src=\"https://z3.ax1x.com/2021/11/01/ICDAQs.png\" alt=\"ICDAQs.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h3 id=\"refer\">Refer<a title=\"#refer\" href=\"#refer\"></a></h3>\n<p><a href=\"https://rengwuxian.com/ui-1-2/\" target=\"_blank\">HenCoder Android å¼€å‘è¿›é˜¶: è‡ªå®šä¹‰ View 1-2 Paint è¯¦è§£ (rengwuxian.com)</a></p>\n",
            "tags": [
                "å›¾å½¢ç»˜åˆ¶"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/02/K0uh0dFU4QBtZ8Wm/",
            "url": "https://onion99.github.io/2021/11/02/K0uh0dFU4QBtZ8Wm/",
            "title": "è‡ªå®šä¹‰View(1) - åŸºæœ¬ç»˜åˆ¶",
            "date_published": "2021-11-01T22:17:37.000Z",
            "content_html": "<blockquote>\n<p>ç®€å•çš„ç»˜åˆ¶åŸºæœ¬ç”±<code>Canvas.drawxxx()</code>å’ŒPaintçš„é…ç½®ç»„æˆ</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/11/01/IC9uZj.png\" alt=\"IC9uZj.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PaintView</span> <span class=\"meta\">@JvmOverloads</span> <span class=\"keyword\">constructor</span></span>(context: Context, attrs: AttributeSet? = <span class=\"literal\">null</span>, defStyleAttr: <span class=\"built_in\">Int</span> = <span class=\"number\">0</span>) : View(context, attrs, defStyleAttr) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">val</span> mPaint <span class=\"keyword\">by</span> lazy &#123; Paint() &#125;</span><br><span class=\"line\">  <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onDraw</span><span class=\"params\">(canvas: <span class=\"type\">Canvas</span>)</span></span> &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">super</span>.onDraw(canvas)</span><br><span class=\"line\">    paint.setColor(Color.RED)<span class=\"comment\">// è®¾ç½®ä¸ºçº¢è‰²</span></span><br><span class=\"line\">    canvas.drawCircle(<span class=\"number\">300</span>, <span class=\"number\">300</span>, <span class=\"number\">200</span>, paint)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<span id=\"more\"></span>\n<h3 id=\"canvas\">Canvas<a title=\"#canvas\" href=\"#canvas\"></a></h3>\n<ul>\n<li><code>Canvas.drawArc()</code> ç»˜åˆ¶å¼§å½¢æˆ–æ‰‡å½¢<br>\n+ <code>left</code>, <code>top</code>, <code>right</code>, <code>bottom</code> æè¿°çš„æ˜¯è¿™ä¸ªå¼§å½¢æ‰€åœ¨çš„æ¤­åœ†<br>\n+ <code>startAngle</code> æ˜¯å¼§å½¢çš„èµ·å§‹è§’åº¦<br>\n+ <code>sweepAngle</code> æ˜¯å¼§å½¢åˆ’è¿‡çš„è§’åº¦<br>\n+ <code>useCenter</code> è¡¨ç¤ºæ˜¯å¦è¿æ¥åˆ°åœ†å¿ƒï¼Œå¦‚æœä¸è¿æ¥åˆ°åœ†å¿ƒï¼Œå°±æ˜¯å¼§å½¢ï¼Œå¦‚æœè¿æ¥åˆ°åœ†å¿ƒï¼Œå°±æ˜¯æ‰‡å½¢</li>\n<li><code>Canvas.drawPath()</code> ç»„åˆå›¾å½¢</li>\n</ul>\n<h3 id=\"paint\">Paint<a title=\"#paint\" href=\"#paint\"></a></h3>\n<ul>\n<li><code>Paint.setStyle(Style style)</code>  è®¾ç½®ç»˜åˆ¶æ¨¡å¼</li>\n<li><code>Paint.setColor(int color)</code>  è®¾ç½®é¢œè‰²</li>\n<li><code>Paint.setStrokeWidth(float width)</code>  è®¾ç½®çº¿æ¡å®½åº¦</li>\n<li><code>Paint.setTextSize(float textSize)</code>  è®¾ç½®æ–‡å­—å¤§å°</li>\n<li><code>Paint.setAntiAlias(boolean aa)</code>  è®¾ç½®æŠ—é”¯é½¿å¼€å…³</li>\n</ul>\n<h3 id=\"path\">Path<a title=\"#path\" href=\"#path\"></a></h3>\n<blockquote>\n<p>å¦‚æœåªç”»ä¸€ä¸ªåœ†ï¼Œæ²¡å¿…è¦ç”¨ Pathï¼Œç›´æ¥ç”¨ drawCircle() å°±è¡Œäº†ã€‚drawPath() ä¸€èˆ¬æ˜¯åœ¨ç»˜åˆ¶ç»„åˆå›¾å½¢æ—¶æ‰ä¼šç”¨åˆ°çš„</p>\n</blockquote>\n<h4 id=\"path.addxxx\">Path.addXxx<a title=\"#path.addxxx\" href=\"#path.addxxx\"></a></h4>\n<blockquote>\n<p>æ·»åŠ å­å›¾å½¢</p>\n</blockquote>\n<p><code>path.addCircle(300, 300, 200, Path.Direction.CW)</code></p>\n<h4 id=\"path.xxxto\">Path.xxxTo<a title=\"#path.xxxto\" href=\"#path.xxxto\"></a></h4>\n<blockquote>\n<p>ç”¨äºç”»çº¿ï¼ˆç›´çº¿æˆ–æ›²çº¿ï¼‰</p>\n</blockquote>\n<p><code>lineTo(float x, float y) / rLineTo(float x, float y) </code>ç”»ç›´çº¿:<br>\n<img src=\"https://z3.ax1x.com/2021/11/01/ICkWGR.png\" alt=\"ICkWGR.png\" loading=\"lazy\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">paint.setStyle(Style.STROKE);</span><br><span class=\"line\">path.lineTo(<span class=\"number\">100</span>, <span class=\"number\">100</span>); <span class=\"comment\">// ç”±å½“å‰ä½ç½® (0, 0) å‘ (100, 100) ç”»ä¸€æ¡ç›´çº¿</span></span><br><span class=\"line\">path.rLineTo(<span class=\"number\">100</span>, <span class=\"number\">0</span>); <span class=\"comment\">// ç”±å½“å‰ä½ç½® (100, 100) å‘æ­£å³æ–¹ 100 åƒç´ çš„ä½ç½®ç”»ä¸€æ¡ç›´çº¿</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://z3.ax1x.com/2021/11/01/ICASL8.png\" alt=\"ICASL8.png\" loading=\"lazy\">]</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">paint.setStyle(Style.STROKE);</span><br><span class=\"line\">path.lineTo(<span class=\"number\">100</span>, <span class=\"number\">100</span>); <span class=\"comment\">// ç”»æ–œçº¿</span></span><br><span class=\"line\">path.moveTo(<span class=\"number\">200</span>, <span class=\"number\">100</span>); <span class=\"comment\">// æˆ‘ç§»~~</span></span><br><span class=\"line\">path.lineTo(<span class=\"number\">200</span>, <span class=\"number\">0</span>); <span class=\"comment\">// ç”»ç«–çº¿</span></span><br></pre></td></tr></table></figure>\n<p><code>arcTo()</code> å’Œ <code>addArc()</code>ç”»å¼§çº¿:</p>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th style=\"text-align:center\">true</th>\n<th style=\"text-align:center\">false</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/ICEuct.png\" alt=\"ICEuct.png\" loading=\"lazy\"></td>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/ICEinK.png\" alt=\"ICEinK.png\" loading=\"lazy\"></td>\n</tr>\n</tbody>\n</table></div></div><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">paint.setStyle(Style.STROKE);</span><br><span class=\"line\">path.lineTo(<span class=\"number\">100</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\"><span class=\"comment\">// true ç›´æ¥è¿çº¿è¿åˆ°å¼§å½¢èµ·ç‚¹ï¼ˆæœ‰ç—•è¿¹ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\">// false å¼ºåˆ¶ç§»åŠ¨åˆ°å¼§å½¢èµ·ç‚¹ï¼ˆæ— ç—•è¿¹ï¼‰</span></span><br><span class=\"line\">path.arcTo(<span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">300</span>, <span class=\"number\">300</span>, -<span class=\"number\">90</span>, <span class=\"number\">90</span>, <span class=\"keyword\">true</span>/<span class=\"keyword\">false</span>); </span><br><span class=\"line\"><span class=\"comment\">// ç­‰åŒä¸Šé¢</span></span><br><span class=\"line\">paint.setStyle(Style.STROKE);</span><br><span class=\"line\">path.lineTo(<span class=\"number\">100</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\">path.addArc(<span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">300</span>, <span class=\"number\">300</span>, -<span class=\"number\">90</span>, <span class=\"number\">90</span>); <span class=\"comment\">// addArc() åªæ˜¯ä¸€ä¸ªç›´æ¥ä½¿ç”¨äº† forceMoveTo = true çš„ç®€åŒ–ç‰ˆ arcTo()</span></span><br></pre></td></tr></table></figure>\n<p><code>close() </code>å°é—­å½“å‰å­å›¾å½¢:</p>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th style=\"text-align:center\">no close</th>\n<th style=\"text-align:center\">close</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/ICVaPH.png\" alt=\"ICVaPH.png\" loading=\"lazy\"></td>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/ICVgIg.png\" alt=\"ICVgIg.png\" loading=\"lazy\"></td>\n</tr>\n</tbody>\n</table></div></div><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">paint.setStyle(Style.STROKE);</span><br><span class=\"line\">path.moveTo(<span class=\"number\">100</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\">path.lineTo(<span class=\"number\">200</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\">path.lineTo(<span class=\"number\">150</span>, <span class=\"number\">150</span>);</span><br><span class=\"line\">path.close(); </span><br></pre></td></tr></table></figure>\n<h4 id=\"path.setfilltype\">Path.setFillType<a title=\"#path.setfilltype\" href=\"#path.setfilltype\"></a></h4>\n<blockquote>\n<p>è®¾ç½®å¡«å……æ–¹å¼</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/11/01/ICFucV.png\" alt=\"ICFucV.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<div class=\"Ï†bq\"><div class=\"Ï†bs\"><table><thead>\n<tr>\n<th style=\"text-align:center\">EVEN_ODD:even-odd rule ï¼ˆå¥‡å¶åŸåˆ™ï¼‰</th>\n<th style=\"text-align:center\">WINDING: non-zero winding rule ï¼ˆéé›¶ç¯ç»•æ•°åŸåˆ™ï¼‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/ICFKXT.png\" alt=\"ICFKXT.png\" loading=\"lazy\"></td>\n<td style=\"text-align:center\"><img src=\"https://z3.ax1x.com/2021/11/01/ICFJhR.png\" alt=\"ICFJhR.png\" loading=\"lazy\"></td>\n</tr>\n</tbody>\n</table></div></div>",
            "tags": [
                "å›¾å½¢ç»˜åˆ¶"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/01/MgnT9VQ3PhWZOJAq/",
            "url": "https://onion99.github.io/2021/11/01/MgnT9VQ3PhWZOJAq/",
            "title": "è¯¾ç¨‹-ç¼–ç ä¸åŠ å¯†",
            "date_published": "2021-10-31T21:32:00.000Z",
            "content_html": "<h2 id=\"åŠ å¯†\">åŠ å¯†<a title=\"#åŠ å¯†\" href=\"#åŠ å¯†\"></a></h2>\n<blockquote>\n<p>åŠ å¯†(æ•´å®¹)æ˜¯é€šè¿‡Intranetã€Extranetå’ŒInternetè¿›è¡Œå®‰å…¨çš„ä¿¡æ¯äº¤æ¢çš„åŸºç¡€</p>\n</blockquote>\n<p>å¸¸ç”¨åŠ å¯†</p>\n<ul>\n<li>å¯¹ç§°åŠ å¯†ç®—æ³•</li>\n<li>éå¯¹ç§°åŠ å¯†ç®—æ³•</li>\n<li>å“ˆå¸Œç®—æ³•</li>\n</ul>\n<span id=\"more\"></span>\n<h3 id=\"å¯¹ç§°åŠ å¯†\">å¯¹ç§°åŠ å¯†<a title=\"#å¯¹ç§°åŠ å¯†\" href=\"#å¯¹ç§°åŠ å¯†\"></a></h3>\n<blockquote>\n<p>ä½¿â½¤ç”¨å¯†é’¥å’ŒåŠ å¯†ç®—æ³•å¯¹æ•°æ®è¿›è¡Œè½¬æ¢ï¼Œå¾—åˆ°çš„æ— æ„ä¹‰æ•°æ®å³ä¸ºå¯†â½‚; ä½¿ç”¨å¯†é’¥å’Œè§£å¯†ç®—æ³•å¯¹å¯†â½‚è¿›è¡Œé€†å‘è½¬æ¢ï¼Œå¾—åˆ°åŸæ•°æ®</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/10/28/5bxS8f.png\" alt=\"5bxS8f.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>ç®—æ³•ï¼šDESã€AES</p>\n<h3 id=\"éå¯¹ç§°åŠ å¯†\">éå¯¹ç§°åŠ å¯†<a title=\"#éå¯¹ç§°åŠ å¯†\" href=\"#éå¯¹ç§°åŠ å¯†\"></a></h3>\n<blockquote>\n<p>ä½¿â½¤å…¬é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†å¾—åˆ°å¯†æ–‡;ä½¿â½¤ç”¨ç§é’¥å¯¹æ•°æ®è¿›â¾è§£å¯†å¾—åˆ°åŸæ•°æ®</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/10/28/5bxDZd.png\" alt=\"5bxDZd.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>ç®—æ³•ï¼šRSAã€DSA</p>\n<p>å®Œæ•´çš„éå¯¹ç§°åŠ å¯†è¿‡ç¨‹:<br>\n<img src=\"https://z3.ax1x.com/2021/10/28/5qdbl9.png\" alt=\"5qdbl9.png\" loading=\"lazy\"><br>\nå¯¹æ•°æ®è¿›è¡Œç­¾åæ—¶ï¼Œå®é™…ä¸Šï¼Œæ˜¯å¯¹æ•°æ®çš„hashå€¼ï¼ˆæ‘˜è¦ï¼‰è¿›è¡Œç­¾åï¼ˆåŠ å¯†ï¼‰ï¼Œè§£å¯†æ—¶ï¼Œæ˜¯å¯¹åŸæ•°æ®è¿›è¡Œhashï¼Œå¾—åˆ°æ‘˜è¦ï¼Œå†å°†åŠ å¯†è¿‡çš„æ‘˜è¦è¿›è¡Œè§£å¯†ï¼Œå°†å¾—åˆ°çš„ä¸¤è€…å¯¹æ¯”ï¼Œå¦‚æœä¸€è‡´å°±éªŒè¯é€šè¿‡</p>\n<h4 id=\"å…¬é’¥ä¸ç§é’¥\">å…¬é’¥ä¸ç§é’¥<a title=\"#å…¬é’¥ä¸ç§é’¥\" href=\"#å…¬é’¥ä¸ç§é’¥\"></a></h4>\n<blockquote>\n<p>åŠ å¯†å¯†é’¥å°±æ˜¯å…¬é’¥ï¼Œè§£å¯†å¯†é’¥å°±æ˜¯ç§é’¥</p>\n</blockquote>\n<p>å°†åŸæ•°æ®é€šè¿‡æˆ‘çš„ç§é’¥ï¼Œä¹Ÿå°±æ˜¯ç­¾åï¼Œè¿›è¡ŒåŠ å¯†ï¼Œå¾—åˆ°ç­¾åæ•°æ®ï¼Œåˆ«äººæ‹¿æˆ‘çš„å…¬é’¥å¯¹æˆ‘çš„ç­¾åæ•°æ®è¿›è¡Œè§£å¯†ï¼ˆä¹Ÿå°±æ˜¯éªŒè¯çš„è¿‡ç¨‹ï¼‰ï¼Œå¾—åˆ°çš„å°±æ˜¯æˆ‘è¦å‘é€çš„åŸæ•°æ®ã€‚ç­¾åæ•°æ®åªæœ‰æˆ‘èƒ½é€ å‡ºæ¥ï¼Œå› ä¸ºåªæœ‰æˆ‘æ‹¥æœ‰æˆ‘çš„ç§é’¥ï¼Œè¿™å°±è¯æ˜äº†è¿™ä¸ªæ•°æ®æ˜¯æˆ‘å†™å‡ºæ¥çš„ã€‚ä¹Ÿå°±æ˜¯æ‰€è°“çš„ç­¾åçš„ä½œç”¨ã€‚</p>\n<p><img src=\"https://z3.ax1x.com/2021/10/28/5bzD6U.png\" alt=\"5bzD6U.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h4 id=\"ç­¾åå’ŒéªŒè¯\">ç­¾åå’ŒéªŒè¯<a title=\"#ç­¾åå’ŒéªŒè¯\" href=\"#ç­¾åå’ŒéªŒè¯\"></a></h4>\n<blockquote>\n<p>ç­¾åå’ŒéªŒè¯æ˜¯æ‹¿ç§é’¥åŠ å¯†ï¼ˆç­¾åï¼‰ï¼Œå…¬é’¥è§£å¯†ï¼ˆéªŒè¯ï¼‰</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/10/28/5qSkhq.png\" alt=\"5qSkhq.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h2 id=\"ç¼–ç \">ç¼–ç <a title=\"#ç¼–ç \" href=\"#ç¼–ç \"></a></h2>\n<blockquote>\n<p>ç¼–ç (åŒ–å¦†)æ˜¯ä¿¡æ¯ä»ä¸€ç§å½¢å¼æˆ–æ ¼å¼è½¬æ¢ä¸ºå¦ä¸€ç§å½¢å¼çš„è¿‡ç¨‹ã€‚è§£ç ï¼Œæ˜¯ç¼–ç çš„é€†è¿‡ç¨‹</p>\n</blockquote>\n<h3 id=\"å¸¸ç”¨ç¼–ç \">å¸¸ç”¨ç¼–ç <a title=\"#å¸¸ç”¨ç¼–ç \" href=\"#å¸¸ç”¨ç¼–ç \"></a></h3>\n<ul>\n<li>Base64ï¼Œ 16è¿›åˆ¶ï¼ŒBase32\n<ul>\n<li>å°†åŸæ¥çš„ä¿¡æ¯ç”¨å¦å¤–ä¸€ç§ç¼–ç æœºåˆ¶æ›¿æ¢</li>\n</ul>\n</li>\n<li>å¤šè¯­ç§çš„ç¼–ç  UTF-8, UTF-16,UTF-32, Unicode, ISO8859-1, GBK, GB2312\n<ul>\n<li>ä¸»è¦æ˜¯å¯¹å„ç§è¯­è¨€çš„ç¼–ç </li>\n</ul>\n</li>\n<li>BER/DERç¼–ç </li>\n<li>HTMLç¼–ç ï¼ŒJSç¼–ç ï¼ŒURLç¼–ç \n<ul>\n<li>é’ˆå¯¹è„šæœ¬è¯­è¨€æˆ–è€…æ ‡ç­¾è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œå¤„ç†</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"base64\">Base64<a title=\"#base64\" href=\"#base64\"></a></h4>\n<blockquote>\n<p>å°†äºŒè¿›åˆ¶æ•°æ®è½¬æ¢æˆç”±64ä¸ªå­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²çš„ç¼–ç ç®—æ³•</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/10/28/5qt0Cd.png\" alt=\"5qt0Cd.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>ç¼–ç ç¤ºä¾‹:<br>\n<img src=\"https://z3.ax1x.com/2021/10/28/5qNYzn.png\" alt=\"5qNYzn.png\" loading=\"lazy\"></p>\n<p>ä½œç”¨: è®©åŸæ•°æ®å…·æœ‰å­—ç¬¦ä¸²æ‰€å…·æœ‰çš„ç‰¹æ€§ï¼Œå¯ä»¥æ”¾åœ¨URLä¸­ä¼ è¾“ï¼Œå¯ä»¥ä¿å­˜åˆ°æ–‡æœ¬æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡æ™®é€šçš„èŠå¤©è½¯ä»¶è¿›è¡Œæ–‡æœ¬ä¼ è¾“</p>\n<p>Base64åŠ å¯†å›¾ç‰‡ä¼šæ›´åŠ å®‰å…¨å’Œé«˜æ•ˆå—ï¼Ÿ<br>\nä¸ä¼šï¼ŒBase64æ˜¯å…¬å¼€çš„ç®—æ³•ï¼ŒåŠ å¯†å’Œè§£å¯†éƒ½æ˜¯å…¬å¼€çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥è§£å¯†ï¼Œå› æ­¤å¹¶ä¸ä¼šæ›´å®‰å…¨ã€‚é€šè¿‡Base64åŠ å¯†çš„æ–‡ä»¶æˆ–æ•°æ®ï¼Œéƒ½ä¼šå¢å¤§çº¦1/3ï¼Œé™ä½ç½‘ç»œæ€§èƒ½ï¼Œå¢å¤§ç”¨æˆ·æµé‡ï¼Œå› æ­¤ä¹Ÿä¸å­˜åœ¨æ›´é«˜æ•ˆçš„é—®é¢˜</p>\n<h3 id=\"åº”ç”¨é¢†åŸŸ\">åº”ç”¨é¢†åŸŸ<a title=\"#åº”ç”¨é¢†åŸŸ\" href=\"#åº”ç”¨é¢†åŸŸ\"></a></h3>\n<h4 id=\"å‹ç¼©ä¸è§£å‹ç¼©\">å‹ç¼©ä¸è§£å‹ç¼©<a title=\"#å‹ç¼©ä¸è§£å‹ç¼©\" href=\"#å‹ç¼©ä¸è§£å‹ç¼©\"></a></h4>\n<blockquote>\n<p>å‹ç¼©å±äºç¼–ç è¿‡ç¨‹ï¼Œè§£å‹ç¼©å±äºè§£ç è¿‡ç¨‹</p>\n</blockquote>\n<p>å‹ç¼©ï¼šæŠŠæ•°æ®æ¢ä¸€ç§æ–¹å¼æ¥å­˜å‚¨ï¼Œä»¥å‡å°‘å­˜å‚¨ç©ºé—´ã€‚<br>\nè§£å‹ç¼©ï¼šæŠŠå‹ç¼©åçš„æ•°æ®è¿˜åŸæˆåŸå…ˆçš„å½¢å¼ï¼Œä»¥ä¾¿ä½¿ç”¨ã€‚<br>\nå¸¸â»…è§å‹ç¼©ç®—æ³•:DEFLATEï¼ˆzipï¼‰ã€JPEGã€MP3</p>\n<h4 id=\"åª’ä½“æ•°æ®çš„ç¼–è§£ç \">åª’ä½“æ•°æ®çš„ç¼–è§£ç <a title=\"#åª’ä½“æ•°æ®çš„ç¼–è§£ç \" href=\"#åª’ä½“æ•°æ®çš„ç¼–è§£ç \"></a></h4>\n<p>å›¾ç‰‡çš„ç¼–ç ï¼šæŠŠå›¾åƒæ•°æ®å†™æˆ JPGã€PNG ç­‰â½‚ä»¶çš„ç¼–ç æ ¼å¼ã€‚<br>\nå›¾â½šçš„è§£ç ï¼šæŠŠ JPGã€PNG ç­‰â½‚æ–‡ä»¶ä¸­çš„æ•°æ®è§£ææˆæ ‡å‡†çš„å›¾åƒæ•°æ®ã€‚</p>\n<h4 id=\"åºåˆ—åŒ–ä¸ååºåˆ—åŒ–\">åºåˆ—åŒ–ä¸ååºåˆ—åŒ–<a title=\"#åºåˆ—åŒ–ä¸ååºåˆ—åŒ–\" href=\"#åºåˆ—åŒ–ä¸ååºåˆ—åŒ–\"></a></h4>\n<p>åºåˆ—åŒ–: æŠŠæ•°æ®å¯¹è±¡ï¼Œä¸€èˆ¬æ˜¯å†…å­˜ä¸­çš„ï¼Œå¦‚JVMä¸­çš„å¯¹è±¡ï¼Œè½¬æ¢æˆå­—èŠ‚åºåˆ—çš„è¿‡ç¨‹ã€‚<br>\nååºåˆ—åŒ–: æŠŠå­—èŠ‚åºåˆ—é‡æ–°è½¬æ¢æˆå†…å­˜ä¸­çš„å¯¹è±¡</p>\n<h4 id=\"hash\">Hash<a title=\"#hash\" href=\"#hash\"></a></h4>\n<blockquote>\n<p>æŠŠä»»æ„æ•°æ®è½¬æ¢æˆæŒ‡å®šå¤§å°èŒƒå›´ï¼ˆé€šå¸¸å¾ˆå°ï¼‰çš„æ•°æ®</p>\n</blockquote>\n<p>ç»å…¸ç®—æ³•ï¼šMD5ã€SHA1ã€SHA256ç­‰</p>\n<p>å®é™…ç”¨é€”:</p>\n<ul>\n<li>æ•°æ®å®Œæ•´æ€§éªŒè¯\n<ul>\n<li>ä»â½¹ç»œä¸Šä¸‹è½½æ–‡ä»¶åï¼Œé€šè¿‡æ¯”å¯¹æ–‡ä»¶çš„ Hash å€¼(ä¾‹å¦‚ MD5ã€SHA1)ï¼Œå¯ä»¥ç¡®è®¤ä¸‹è½½çš„æ–‡ä»¶æ˜¯å¦æœ‰æŸåã€‚å¦‚æœä¸‹è½½çš„æ–‡ä»¶ Hash å€¼å’Œæ–‡ä»¶æä¾›æ–¹ç»™å‡ºçš„ Hash å€¼ä¸€è‡´ï¼Œåˆ™è¯æ˜ä¸‹è½½çš„æ–‡ä»¶æ˜¯å®Œå¥½æ— æŸçš„</li>\n</ul>\n</li>\n<li>å”¯ä¸€æ€§éªŒè¯\n<ul>\n<li>HashCodeæ˜¯ä¸€ä¸ªæ•°æ®çš„æŒ‡çº¹ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ä»è¿™ä¸ªæ•°æ®èº«ä¸Šé‡‡å–äº†è¶³å¤Ÿå¤šçš„ç‰¹å¾æ¥è¯æ˜â€œä½ æ˜¯ä½ â€</li>\n</ul>\n</li>\n<li>å¿«é€ŸæŸ¥æ‰¾: HashCodeå’ŒHashMap\n<ul>\n<li>HashCodeæ˜¯æ•°æ®çš„å†…å­˜åœ°å€</li>\n<li>HashMapï¼šKeyçš„HashCodeæ˜¯Valueçš„åœ°å€ï¼Œé€šè¿‡Keyçš„HashCodeå¯ä»¥æ‰¾åˆ°Value</li>\n<li>åœ¨é‡å†™equals()æ—¶ï¼Œä¹Ÿå¿…é¡»é‡å†™hashCode(),å› ä¸ºå¦‚æœä¸é‡å†™hashCode()ï¼Œå½“ä½¿ç”¨equals()æ¯”è¾ƒæ—¶ï¼ŒhashCode()æ˜¯Objectä¸­çš„hashCode()ï¼Œå¾ˆå¯èƒ½å‡ºç°ç”¨equals()åˆ¤æ–­ç›¸ç­‰è€Œç”¨hashCode()åˆ¤æ–­ä¸ç›¸ç­‰çš„æƒ…å†µ,ç”šè‡³ä¹Ÿæœ‰å¯èƒ½æ˜¯ç›¸åçš„</li>\n</ul>\n</li>\n<li>éšç§ä¿æŠ¤</li>\n</ul>\n<p>Hash æ˜¯ç¼–ç å—?<br>\nä¸æ˜¯ã€‚ Hash æ˜¯å•å‘è¿‡ç¨‹ï¼Œå¾€å¾€æ˜¯ä¸å¯é€†çš„ï¼Œæ— æ³•è¿›è¡Œé€†å‘æ¢å¤æ“ä½œï¼Œå› æ­¤ Hash ä¸å±äºç¼–ç ã€‚</p>\n<p>Hash æ˜¯åŠ å¯†å—?<br>\nä¸æ˜¯ã€‚Hash æ˜¯å•å‘è¿‡ç¨‹ï¼Œæ— æ³•è¿›è¡Œé€†å‘å›å¤æ“ä½œï¼Œå› æ­¤ Hash ä¸å±äºåŠ å¯†ã€‚(è®°ä½MD5 ä¸æ˜¯åŠ å¯†!MD5ä¸å¯é€†)</p>\n",
            "tags": [
                "è¯¾ç¨‹å­¦ä¹ "
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/01/Qqq7oSBqBc2Zgbrx/",
            "url": "https://onion99.github.io/2021/11/01/Qqq7oSBqBc2Zgbrx/",
            "title": "è¯¾ç¨‹-ç™»é™†ä¸æˆæƒ",
            "date_published": "2021-10-31T21:31:00.000Z",
            "content_html": "<h2 id=\"ç™»å½•æˆæƒã€tcp/ipã€httpså’Œä»£ç†\">ç™»å½•æˆæƒã€TCP/IPã€HTTPSå’Œä»£ç†<a title=\"#ç™»å½•æˆæƒã€tcp/ipã€httpså’Œä»£ç†\" href=\"#ç™»å½•æˆæƒã€tcp/ipã€httpså’Œä»£ç†\"></a></h2>\n<p>ç™»å½•ï¼šèº«ä»½è®¤è¯ï¼Œç¡®è®¤ä½ æ˜¯ä½ çš„è¿‡ç¨‹ã€‚<br>\næˆæƒï¼šç”±èº«ä»½æˆ–æŒæœ‰çš„ä»¤ç‰Œç¡®è®¤äº«æœ‰æŸäº›æƒé™ï¼ˆä¾‹å¦‚è·å–ç”¨æˆ·ä¿¡æ¯ï¼‰ã€‚ç™»å½•è¿‡ç¨‹å®è´¨ä¸Šçš„ç›®çš„ä¹Ÿæ˜¯ä¸ºäº†ç¡®è®¤æƒé™</p>\n<span id=\"more\"></span>\n<h3 id=\"httpä¸­æˆæƒæ–¹å¼\">HTTPä¸­æˆæƒæ–¹å¼<a title=\"#httpä¸­æˆæƒæ–¹å¼\" href=\"#httpä¸­æˆæƒæ–¹å¼\"></a></h3>\n<h4 id=\"cookie\">Cookie<a title=\"#cookie\" href=\"#cookie\"></a></h4>\n<blockquote>\n<p>ä½¿ç”¨Cookieç®¡ç†ç™»å½•çŠ¶æ€</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/10/28/5qrP4f.png\" alt=\"5qrP4f.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p><img src=\"https://z3.ax1x.com/2021/10/28/5qrmbn.png\" alt=\"5qrmbn.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h5 id=\"cookieå·¥ä½œæœºåˆ¶\">Cookieå·¥ä½œæœºåˆ¶<a title=\"#cookieå·¥ä½œæœºåˆ¶\" href=\"#cookieå·¥ä½œæœºåˆ¶\"></a></h5>\n<ol>\n<li>æœåŠ¡å™¨éœ€è¦å®¢æˆ·ç«¯ä¿å­˜çš„å†…å®¹ï¼Œæ”¾åœ¨Set-Cookieçš„headersé‡Œè¿”å›ï¼Œå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨ä¿å­˜ã€‚</li>\n<li>å®¢æˆ·ç«¯ä¿å­˜çš„Cookiesï¼Œä¼šåœ¨ä¹‹åçš„æ‰€æœ‰è¯·æ±‚é‡Œéƒ½æºå¸¦è¿›Cookie headeré‡Œå‘å›ç»™æœåŠ¡å™¨ã€‚</li>\n<li>å®¢æˆ·ç«¯ä¿å­˜Cookieæ˜¯æŒ‰ç…§æœåŠ¡å™¨åŸŸåæ¥åˆ†ç±»çš„ï¼Œä¾‹å¦‚shop.comå‘å›çš„Cookieä¿å­˜ä¸‹æ¥ä»¥åï¼Œåœ¨ä¹‹åå‘games.comçš„è¯·æ±‚ä¸­å¹¶ä¸ä¼šè¢«æºå¸¦ã€‚</li>\n<li>.å®¢æˆ·ç«¯ä¿å­˜çš„Cookieåœ¨è¶…æ—¶åä¼šè¢«åˆ é™¤ï¼Œæ²¡æœ‰è®¾ç½®è¶…æ—¶æ—¶é—´çš„Cookieï¼ˆç§°ä½œSession Cookieï¼‰åœ¨æµè§ˆå™¨å…³é—­åå°±ä¼šè‡ªåŠ¨åˆ é™¤ï¼Œå¦å¤–ï¼ŒæœåŠ¡å™¨ä¹Ÿå¯ä»¥ä¸»åŠ¨åˆ é™¤è¿˜æœªè¿‡æœŸçš„å®¢æˆ·ç«¯Cookies</li>\n<li>Cookieæ˜¯ç”±æœåŠ¡ç«¯ç®¡ç†çš„ï¼Œå®¢æˆ·ç«¯åªæ˜¯è¢«åŠ¨æ¥å—ã€‚</li>\n</ol>\n<h4 id=\"authorization-header\">Authorization Header<a title=\"#authorization-header\" href=\"#authorization-header\"></a></h4>\n<blockquote>\n<p>ä¸¤ç§ä¸»æµæ–¹å¼ Basic å’Œ Beare</p>\n</blockquote>\n<h5 id=\"basic\">Basic<a title=\"#basic\" href=\"#basic\"></a></h5>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1.</span>æ ¼å¼ï¼šAuthorization: Basic&lt;username:password(Base64)&gt;</span><br><span class=\"line\"><span class=\"number\">2.</span>Basicè®¤è¯è¿‡ç¨‹</span><br><span class=\"line\"><span class=\"number\">1.</span>æµè§ˆå™¨å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨</span><br><span class=\"line\">                GET / HTTP /<span class=\"number\">1.1</span></span><br><span class=\"line\">                Host:xxx.xxx.com</span><br><span class=\"line\"><span class=\"number\">2.</span>æœåŠ¡ç«¯å‘é€éªŒè¯è¯·æ±‚<span class=\"number\">401</span></span><br><span class=\"line\">                HTTP/<span class=\"number\">1.1</span> <span class=\"number\">401</span> Unauthorised</span><br><span class=\"line\">                Server: bfe/<span class=\"number\">1.0</span><span class=\"number\">.8</span><span class=\"number\">.18</span></span><br><span class=\"line\">                WWW-Authenticate: Basic realm=<span class=\"string\">&quot;XXXXX.com&quot;</span></span><br><span class=\"line\">                Content-<span class=\"built_in\">Type</span>: text/html; charset=utf<span class=\"number\">-8</span></span><br><span class=\"line\"><span class=\"number\">3.</span>å®¢æˆ·ç«¯æ”¶åˆ°<span class=\"number\">401</span>è¿”å›å€¼åï¼Œå°†è‡ªåŠ¨å¼¹å‡ºç™»å½•çª—å£ï¼Œç­‰å¾…ç”¨æˆ·è¾“å…¥ç”¨æˆ·åï¼Œå¯†ç </span><br><span class=\"line\"><span class=\"number\">4.</span>å°†ç”¨æˆ·åå¯†ç è¿›è¡ŒBase64ç¼–ç åå‘é€ç»™æœåŠ¡ç«¯è¿›è¡ŒéªŒè¯</span><br><span class=\"line\">                GET / HTTP/<span class=\"number\">1.1</span></span><br><span class=\"line\">                Host: xxx.xxx.xxx.com</span><br><span class=\"line\">                Authorization: Basic xxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class=\"line\"><span class=\"number\">5.</span>æœåŠ¡ç«¯å–å‡ºAuthorizationä¸­å¤´ä¿¡æ¯ï¼Œå¹¶ä¸æ•°æ®åº“è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœåˆæ³•åˆ™è¿”å›<span class=\"number\">200</span>ï¼Œä¸åˆæ³•ï¼Œåˆ™è¿”å›<span class=\"number\">401</span>ã€‚</span><br></pre></td></tr></table></figure>\n<h5 id=\"bearer\">Bearer<a title=\"#bearer\" href=\"#bearer\"></a></h5>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1.</span>æ ¼å¼ï¼šAuthorization: Bearer &lt;bearer token&gt;</span><br><span class=\"line\"><span class=\"number\">2.</span>bearer token çš„è·å–æ–¹å¼ï¼šé€šè¿‡OAuth2çš„æˆæƒæµç¨‹</span><br><span class=\"line\"><span class=\"number\">3.</span>OAuth2çš„æµç¨‹</span><br><span class=\"line\">            <span class=\"number\">1.</span>ç¬¬ä¸‰æ–¹ç½‘ç«™å‘æˆæƒç½‘ç«™ç”³è¯·æˆæƒåˆä½œï¼Œæ‹¿åˆ°client <span class=\"keyword\">id</span>å’Œclient secret</span><br><span class=\"line\">            <span class=\"number\">2.</span>ç”¨æˆ·åœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹ç½‘ç«™çš„æ—¶å€™ï¼Œç‚¹å‡»é€šè¿‡æˆæƒï¼Œç¬¬ä¸‰æ–¹ç½‘ç«™å°†è·³è½¬æˆæƒç½‘ç«™ï¼Œå¹¶å°†clientidä¼ é€’ç»™æˆæƒç½‘ç«™ã€‚</span><br><span class=\"line\">            <span class=\"number\">4.</span>æˆæƒæ–¹ç½‘ç«™æ ¹æ®clientidï¼Œå°†ç¬¬ä¸‰æ–¹ç½‘ç«™çš„ä¿¡æ¯å’Œç¬¬ä¸‰æ–¹ç½‘ç«™éœ€è¦çš„ç”¨æˆ·æƒé™å±•ç¤ºç»™ç”¨æˆ·ï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦åŒæ„æˆæƒã€‚</span><br><span class=\"line\">            <span class=\"number\">5.</span>å½“ç”¨æˆ·ç‚¹å‡»åŒæ„æˆæƒï¼Œæˆæƒæ–¹ç½‘ç«™è¿”å›ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œå¹¶ä¼ å…¥Authorization codeä½œä¸ºç”¨æˆ·è®¤å¯çš„å‡­è¯ã€‚</span><br><span class=\"line\">            <span class=\"number\">6.</span>ç¬¬ä¸‰æ–¹ç½‘ç«™å°†Authorization codeä¸Šé€ç»™è‡ªå·±çš„æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å°†Authorization codeè·Ÿè‡ªå·±æœåŠ¡å™¨ç«¯å­˜å‚¨çš„client secretå‘é€ç»™æˆæƒæ–¹æœåŠ¡å™¨ï¼Œæˆæƒæ–¹æœåŠ¡å™¨é€šè¿‡éªŒè¯åï¼Œè¿”å›ç»™access tokenï¼Œæ•´ä¸ªOAuth2æµç¨‹ç»“æŸã€‚</span><br><span class=\"line\">            <span class=\"number\">7.</span>åœ¨æ•´ä¸ªOAuthæµç¨‹ç»“æŸåï¼Œç¬¬ä¸‰æ–¹ç½‘ç«™æœåŠ¡å™¨å¯ä»¥è¯•ç”¨access token ä½œç”¨ç”¨æˆ·æˆæƒçš„tokenï¼Œç”¨æ­¤æ¥å‘æˆæƒæ–¹ç½‘ç«™è¯·æ±‚è·å–ç”¨æˆ·ä¿¡æ¯ç­‰æ“ä½œã€‚</span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"number\">4.</span>é—®é¢˜ï¼š</span><br><span class=\"line\">            ä¸ºä»€ä¹ˆOAuthè®¤è¯è¦å¼•å…¥Authorization codeï¼Œå¹¶ä¸”éœ€è¦ç”³è¯·æˆæƒçš„ç¬¬ä¸‰æ–¹å°†Authorization codeä¼ ç»™ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ï¼Œå¹¶ä¸”é€šè¿‡ç¬¬ä¸‰æ–¹æœåŠ¡å™¨å°†Authorization codeä¼ é€’ç»™æˆæƒæ–¹æœåŠ¡å™¨ã€‚ç„¶åå†è·å–æˆæƒæ–¹æœåŠ¡å™¨çš„access tokenã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†é€šä¿¡å®‰å…¨ï¼Œå› ä¸ºOAuthä¸å¼ºåˆ¶ä½¿ç”¨HTTPSï¼Œå› æ­¤éœ€è¦ä¿è¯é€šä¿¡è·¯å¾„ä¸­å­˜åœ¨çªƒå¬è€…çš„æ—¶å€™ï¼Œè¿˜èƒ½ä¿è¯è¶³å¤Ÿçš„å®‰å…¨ã€‚</span><br><span class=\"line\">            </span><br><span class=\"line\"><span class=\"number\">5.</span>ç¬¬ä¸‰æ–¹APPé€šè¿‡å¾®ä¿¡ç™»å½•çš„æµç¨‹ï¼š</span><br><span class=\"line\">            è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„OAuth2çš„æµç¨‹ã€‚</span><br><span class=\"line\">            <span class=\"number\">1.</span>ç¬¬ä¸‰æ–¹APPå‘è…¾è®¯æ–¹ç”³è¯·åˆä½œï¼Œæ‹¿åˆ°client <span class=\"keyword\">id</span> å’Œclient secret</span><br><span class=\"line\">            <span class=\"number\">2.</span>å½“ç”¨æˆ·åœ¨ç¬¬ä¸‰æ–¹APPä¸Šéœ€è¦å¾®ä¿¡ç™»å½•çš„æ—¶å€™ï¼Œç¬¬ä¸‰æ–¹APPå°†ä½¿ç”¨å¾®ä¿¡SDKæ‰“å¼€å¾®ä¿¡æˆæƒé¡µé¢ï¼Œå¹¶ä¸”ä¼ å…¥client <span class=\"keyword\">id</span>ä½œä¸ºè‡ªå·±æˆæƒ<span class=\"keyword\">id</span>ã€‚</span><br><span class=\"line\">            <span class=\"number\">3.</span>å¾®ä¿¡æ‹¿åˆ°ç¬¬ä¸‰æ–¹appçš„client <span class=\"keyword\">id</span>åï¼Œæäº¤å¾®ä¿¡åå°ï¼ŒéªŒè¯æˆåŠŸï¼Œåˆ™è¿”å›ç»™ç¬¬ä¸‰æ–¹app Authorization codeã€‚</span><br><span class=\"line\">            <span class=\"number\">4.</span>ç¬¬ä¸‰æ–¹appæ‹¿åˆ°Authorization codeåï¼Œå°†Authorization codeä¼ é€’ç»™è‡ªå·±çš„æœåŠ¡å™¨ï¼Œç¬¬ä¸‰æ–¹appçš„æœåŠ¡ç«¯å°†Authorization code ä¸ client secret ä¼ é€’ç»™å¾®ä¿¡åå°ï¼Œå¾®ä¿¡åå°éªŒè¯åè¿”å›access tokenã€‚</span><br><span class=\"line\">            <span class=\"number\">5.</span>ç¬¬ä¸‰æ–¹appåå°é€šè¿‡access token æƒ³å¾®ä¿¡åå°è¯·æ±‚è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¾®ä¿¡éªŒè¯é€šè¿‡åï¼Œåˆ™è¿”å›ç”¨æˆ·ä¿¡æ¯ã€‚</span><br><span class=\"line\">            <span class=\"number\">6.</span>æœåŠ¡å™¨æ¥å—åˆ°ç”¨æˆ·ä¿¡æ¯åï¼Œåœ¨è‡ªå·±çš„æ•°æ®åº“ä¸­å»ºç«‹ä¸€ä¸ªè´¦æˆ·ï¼Œå¹¶å°†ä»å¾®ä¿¡è·å–çš„ç”¨æˆ·ä¿¡æ¯å¡«å…¥æ•°æ®åº“ä¸­ã€‚å¹¶åˆ›å»ºç”¨æˆ·<span class=\"keyword\">id</span>ï¼Œå¹¶å°†æ­¤<span class=\"keyword\">id</span>ä¸å¾®ä¿¡<span class=\"keyword\">id</span>åšå¥½å…³è”ã€‚</span><br><span class=\"line\">            <span class=\"number\">7.</span>å½“ç¬¬ä¸‰æ–¹appåå°åˆ›å»ºå¥½ç”¨æˆ·åï¼Œæƒ³å®¢æˆ·ç«¯çš„è¯·æ±‚å‘å‡ºå“åº”ï¼Œå¹¶å›ä¼ ä¼šåˆšåˆšåˆ›å»ºçš„ç”¨æˆ·ä¿¡æ¯ã€‚</span><br><span class=\"line\">            <span class=\"number\">8.</span>å®¢æˆ·ç«¯å“åº”ï¼Œè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œç™»å½•æˆåŠŸã€‚</span><br><span class=\"line\">            </span><br><span class=\"line\"><span class=\"number\">6.</span>åœ¨è‡ªå®¶APPä¸­ä½¿ç”¨Bearer token</span><br><span class=\"line\">            éƒ¨åˆ†appä¼šåœ¨apiè®¾è®¡ä¸­ï¼Œå°†ç™»å½•å’Œæˆæƒè®¾è®¡å‡ºç±»ä¼¼äºOAuth2çš„è¿‡ç¨‹ï¼Œä»–ä¼šç®€åŒ–æ‰Authorization codeçš„æ¦‚å¿µã€‚æ—¢ç›´æ¥åœ¨æ¥å£è¯·æ±‚æˆåŠŸåï¼Œè¿”å›access tokenï¼Œç„¶åå†ä¹‹åçš„å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸­ï¼Œä½¿ç”¨è¿™ä¸ªaccess token ä½œä¸ºBearer tokenè¿›è¡Œç”¨æˆ·æ“ä½œã€‚</span><br><span class=\"line\">            </span><br><span class=\"line\"><span class=\"number\">7.</span>Refresh token</span><br><span class=\"line\">            Access token éƒ½ä¼šæœ‰å¤±æ•ˆæ—¶é—´ï¼Œå½“ä»–å¤±æ•ˆåï¼Œç¬¬ä¸‰æ–¹appçš„æœåŠ¡ç«¯ä¼šé€šè¿‡refresh token æ¥å£ä¼ å…¥refresh token æ¥è·å–æ–°çš„access tokenã€‚è¿™æ ·çš„çš„åŸå› æ˜¯å®‰å…¨ï¼Œå› ä¸ºrefresh tokenæ˜¯æ”¾ç½®åœ¨æœåŠ¡ç«¯çš„ï¼Œå³ä½¿access tokenè¢«çªƒå–ï¼Œä»–ä¹Ÿæ˜¯æœ‰å¤±æ•ˆæ—¶é—´çš„ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"tcp/ip\">TCP/IP<a title=\"#tcp/ip\" href=\"#tcp/ip\"></a></h3>\n<blockquote>\n<p>ä¸¤å°è®¡ç®—æœºä¹‹é—´çš„é€šè®¯æ˜¯é€šè¿‡TCP/IPåè®®åœ¨å› ç‰¹ç½‘ä¸Šè¿›è¡Œçš„</p>\n</blockquote>\n<p>TCPï¼šTransmission Control Protocol ä¼ è¾“æ§åˆ¶åè®®, ç”¨äºåº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡<br>\nIPï¼šInternet Protocol ç½‘é™…åè®®, ç”¨äºè®¡ç®—æœºä¹‹é—´çš„é€šä¿¡</p>\n<h4 id=\"åˆ†å±‚\">åˆ†å±‚<a title=\"#åˆ†å±‚\" href=\"#åˆ†å±‚\"></a></h4>\n<blockquote>\n<p>å› ä¸ºç½‘ç»œå…·æœ‰ä¸ç¨³å®šæ€§,è¦ä¿è¯é€šä¿¡æ­£å¸¸</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/10/28/5qccSf.png\" alt=\"5qccSf.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h4 id=\"tcpè¿æ¥\">TCPè¿æ¥<a title=\"#tcpè¿æ¥\" href=\"#tcpè¿æ¥\"></a></h4>\n<blockquote>\n<p>é€šä¿¡åŒæ–¹å»ºç«‹ç¡®è®¤ã€Œå¯ä»¥é€šä¿¡ã€ï¼Œä¸ä¼šå°†å¯¹æ–¹çš„æ¶ˆæ¯ä¸¢å¼ƒï¼Œå³ä¸ºã€Œå»ºç«‹è¿æ¥ã€</p>\n</blockquote>\n<h5 id=\"è¿æ¥å»ºç«‹\">è¿æ¥å»ºç«‹<a title=\"#è¿æ¥å»ºç«‹\" href=\"#è¿æ¥å»ºç«‹\"></a></h5>\n<p><img src=\"https://z3.ax1x.com/2021/10/28/5LRCDS.png\" alt=\"5LRCDS.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h5 id=\"è¿æ¥å…³é—­\">è¿æ¥å…³é—­<a title=\"#è¿æ¥å…³é—­\" href=\"#è¿æ¥å…³é—­\"></a></h5>\n<p><img src=\"https://z3.ax1x.com/2021/10/28/5LRGCR.png\" alt=\"5LRGCR.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h5 id=\"é•¿è¿æ¥\">é•¿è¿æ¥<a title=\"#é•¿è¿æ¥\" href=\"#é•¿è¿æ¥\"></a></h5>\n<blockquote>\n<p>å¼ºåˆ¶ä¸è®©è¿æ¥çš„é€šé“å…³é—­</p>\n</blockquote>\n<ul>\n<li>TCPçŸ­è¿æ¥\n<ul>\n<li>clientå‘serverå‘èµ·è¿æ¥è¯·æ±‚ï¼Œserveræ¥åˆ°è¯·æ±‚ï¼Œç„¶ååŒæ–¹å»ºç«‹è¿æ¥ã€‚clientå‘server å‘é€æ¶ˆæ¯ï¼Œserverå›åº”clientï¼Œç„¶åä¸€æ¬¡è¯»å†™å°±å®Œæˆäº†</li>\n<li>ä¸€èˆ¬çš„serverä¸ä¼šå›å¤å®Œclientåç«‹å³å…³é—­è¿æ¥çš„, æ‰€ä»¥ä¸€èˆ¬æ˜¯clientå…ˆå‘èµ·closeæ“ä½œ</li>\n</ul>\n</li>\n<li>TCPé•¿è¿æ¥\n<ul>\n<li>clientå‘serverå‘èµ·è¿æ¥ï¼Œserveræ¥å—clientè¿æ¥ï¼ŒåŒæ–¹å»ºç«‹è¿æ¥ã€‚Clientä¸serverå®Œæˆä¸€æ¬¡è¯»å†™ä¹‹åï¼Œå®ƒä»¬ä¹‹é—´çš„è¿æ¥å¹¶ä¸ä¼šä¸»åŠ¨å…³é—­ï¼Œåç»­çš„è¯»å†™æ“ä½œä¼šç»§ç»­ä½¿ç”¨è¿™ä¸ªè¿æ¥</li>\n</ul>\n</li>\n</ul>\n<p>æ€æ ·å®ç°é•¿è¿æ¥ï¼Ÿ<br>\nâ¼¼è·³ã€‚å³åœ¨ä¸€å®šé—´éš”æ—¶é—´å†…ï¼Œä½¿â½¤TCPè¿æ¥å‘é€è¶…çŸ­æ— æ„ä¹‰æ¶ˆæ¯æ¥è®©ç½‘å…³ä¸èƒ½å°†â¾ƒå·±å®šä¹‰ä¸ºã€Œç©ºé—²è¿æ¥ã€ï¼Œä»è€Œé˜²æ­¢ç½‘å…³å°†â¾ƒå·±çš„è¿æ¥å…³é—­</p>\n<h3 id=\"https\">HTTPS<a title=\"#https\" href=\"#https\"></a></h3>\n<blockquote>\n<p>HTTP over SSLçš„ç®€ç§°ï¼Œå³å·¥ä½œåœ¨SSL(æˆ–TLS)ä¸Šçš„HTTPã€‚æ˜¯åŠ å¯†é€šä¿¡çš„HTTP</p>\n</blockquote>\n<h4 id=\"å·¥ä½œåŸç†\">å·¥ä½œåŸç†<a title=\"#å·¥ä½œåŸç†\" href=\"#å·¥ä½œåŸç†\"></a></h4>\n<blockquote>\n<p>åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´åå•†å‡ºä¸€å¥—å¯¹ç§°å¯†é’¥ï¼Œæ¯æ¬¡å‘é€æ¶ˆæ¯ä¹‹å‰å°†å†…å®¹åŠ å¯†ï¼Œæ”¶åˆ°ä¹‹åè§£å¯†ï¼Œè¾¾åˆ°å†…å®¹çš„åŠ å¯†ä¼ è¾“</p>\n</blockquote>\n<p>ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨éå¯¹ç§°åŠ å¯†?<br>\néå¯¹ç§°åŠ å¯†ç”±äºä½¿ç”¨äº†å¤æ‚çš„æ•°å­¦åŸç†ï¼Œå› æ­¤è®¡ç®—ç›¸å½“å¤æ‚ï¼Œå¦‚æœå®Œå…¨ä½¿ç”¨éå¯¹ç§°åŠ å¯†æ¥åŠ å¯†é€šä¿¡å†…å®¹ï¼Œä¼šä¸¥é‡å½±å“ç½‘ç»œé€šä¿¡çš„æ€§èƒ½</p>\n<h4 id=\"httpsæµç¨‹\">HTTPSæµç¨‹<a title=\"#httpsæµç¨‹\" href=\"#httpsæµç¨‹\"></a></h4>\n<ol>\n<li>å®¢æˆ·ç«¯è¯·æ±‚å»ºç«‹TLSè¿æ¥</li>\n<li>æœåŠ¡å™¨å‘å›è¯ä¹¦</li>\n<li>å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨è¯ä¹¦</li>\n<li>å®¢æˆ·ç«¯ä¿¡ä»»æœåŠ¡å™¨åï¼Œå’ŒæœåŠ¡å™¨åå•†å¯¹ç§°å¯†é’¥</li>\n<li>ä½¿ç”¨å¯¹ç§°å¯†é’¥å¼€å§‹é€šä¿¡</li>\n</ol>\n<h2 id=\"about\">About<a title=\"#about\" href=\"#about\"></a></h2>\n<p><a href=\"https://www.jianshu.com/p/2a890d952461\" target=\"_blank\">ç™»å½•æˆæƒã€TCP/IPã€HTTPSå’Œä»£ç†</a><br>\n<a href=\"https://blog.csdn.net/kimlllll/article/details/103041225\" target=\"_blank\">ç¼–ç ã€åŠ å¯†ã€Hashã€TCP/IPã€HTTPS</a><br>\n<a href=\"https://github.com/hsicen/HencoderPlus/blob/master/note/04-TCPIP%E5%92%8CHTTPS.md\" target=\"_blank\">HencoderPlus/04-TCPIPå’ŒHTTPS</a></p>\n",
            "tags": [
                "è¯¾ç¨‹å­¦ä¹ "
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/01/15jfHwStpctgCeeA/",
            "url": "https://onion99.github.io/2021/11/01/15jfHwStpctgCeeA/",
            "title": "æºç å­¦ä¹ -Glide",
            "date_published": "2021-10-31T21:29:17.000Z",
            "content_html": "<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Glide.with(fragment)</span><br><span class=\"line\">    .load(myUrl)</span><br><span class=\"line\">    .into(imageView);</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://z3.ax1x.com/2021/10/26/5oUW5R.png\" alt=\"5oUW5R.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h3 id=\"with()\">with()<a title=\"#with()\" href=\"#with()\"></a></h3>\n<blockquote>\n<p>ç”¨Methodåˆå§‹åŒ–glideçš„ä¸€äº›å¿…éœ€çš„ç¯å¢ƒï¼Œç„¶åè°ƒç”¨Requestmanagerretriverçš„<code>get()</code>è·å–requestManagerã€‚å¦‚æœä¼ å…¥çš„å¯¹è±¡æ˜¯å…¨å±€Contextï¼Œä½ å°±ä¸éœ€è¦å¤„ç†ç”Ÿå‘½å‘¨æœŸ;å¦‚æœè¾“å…¥æ˜¯å…·æœ‰ç”Ÿå‘½å‘¨æœŸçš„View(åŒ…å«Frgæˆ–Act)åˆ™å°†æ·»åŠ ä¸€ä¸ªéšè—çš„Fragmentæ¥æ„ŸçŸ¥ç”Ÿå‘½å‘¨æœŸ</p>\n</blockquote>\n<span id=\"more\"></span>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> RequestManager <span class=\"title\">with</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Context context)</span> </span>&#123;  </span><br><span class=\"line\">  <span class=\"keyword\">return</span> getRetriever(context).get(context);  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"getretriever()\">getRetriever()<a title=\"#getretriever()\" href=\"#getretriever()\"></a></h4>\n<blockquote>\n<p>RequestManagerRetriever,ç”¨äºåˆ›å»ºæ–°çš„RequestManageræˆ–ä»Activityå’ŒFragmentä¸­æ£€ç´¢ç°æœ‰çš„</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@NonNull</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> RequestManagerRetriever <span class=\"title\">getRetriever</span><span class=\"params\">(<span class=\"meta\">@Nullable</span> Context context)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ç”±äºå…¶ä»–åŸå› ï¼Œä¸Šä¸‹æ–‡å¯èƒ½ä¸ºç©ºï¼ˆå³ç”¨æˆ·ä¼ å…¥ç©ºå€¼ï¼‰ï¼Œä½†å®é™…ä¸Šå®ƒåªä¼šç”±äº Fragment ç”Ÿå‘½å‘¨æœŸçš„é”™è¯¯è€Œå‘ç”Ÿã€‚</span></span><br><span class=\"line\">  Preconditions.checkNotNull(</span><br><span class=\"line\">      context,<span class=\"string\">&quot;You cannot start a load on a not yet attached View or a Fragment where getActivity() &quot;</span></span><br><span class=\"line\">          + <span class=\"string\">&quot;returns null (which usually occurs when getActivity() is called before the Fragment &quot;</span></span><br><span class=\"line\">          + <span class=\"string\">&quot;is attached or after the Fragment is destroyed).&quot;</span>);</span><br><span class=\"line\">  <span class=\"comment\">// è·å–RequestManagerRetriever</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> Glide.get(context).getRequestManagerRetriever();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"get()\">get()<a title=\"#get()\" href=\"#get()\"></a></h4>\n<blockquote>\n<p>å•ä¾‹å®ç°Glideçš„åˆå§‹åŒ–</p>\n</blockquote>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//åŒé‡æ£€æŸ¥é”å®šåœ¨è¿™é‡Œæ˜¯å®‰å…¨çš„</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> static Glide <span class=\"keyword\">get</span>(<span class=\"meta\">@NonNull</span> Context context) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (glide == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// é€šè¿‡åå°„GeneratedAppGlideModuleImplå®ä¾‹åŒ–Glide</span></span><br><span class=\"line\">    GeneratedAppGlideModule annotationGeneratedModule =</span><br><span class=\"line\">        getAnnotationGeneratedGlideModules(context.getApplicationContext()); </span><br><span class=\"line\">    synchronized (Glide.<span class=\"keyword\">class</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (glide == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        checkAndInitializeGlide(context, annotationGeneratedModule);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> glide;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"requestmanagerretriever.get()\">RequestManagerRetriever.get()<a title=\"#requestmanagerretriever.get()\" href=\"#requestmanagerretriever.get()\"></a></h4>\n<blockquote>\n<p>åˆ›å»ºå¯¹åº”ç”Ÿå‘½å‘¨æœŸçš„RequestManager</p>\n</blockquote>\n<ul>\n<li>é¦–å…ˆåˆ¤æ–­æ˜¯åœ¨å­çº¿ç¨‹,åˆ™æ‹¿ä¸€ä¸ªå…¨Contextç„¶ååœ¨å·¥å‚æ¨¡å¼åˆ›å»ºä¸‹RequestManager,æ‰€ä»¥æ¨èä¸è¦åœ¨å­çº¿ç¨‹æ‰§è¡Œæ­¤æ“ä½œ</li>\n<li>å¦‚ä¸ºFragmentActivity,åˆ™é€šè¿‡FragmentManager,åˆ›å»ºä¸€ä¸ªç©ºFragmentæ”¾è¿›å½“å‰<code>Fragment</code>æˆ–è€…<code>Activity</code>,è¿™æ ·å°±å¯ä»¥æ„ŸçŸ¥å®¿ä¸»çš„ç”Ÿå‘½å‘¨æœŸ,ç„¶ååœ¨å·¥å‚æ¨¡å¼åˆ›å»ºä¸‹RequestManager</li>\n<li>å¦‚ä¸ºActivityâ€¦</li>\n<li>å¦‚ä¸ºContextWrapperâ€¦</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> RequestManager <span class=\"title\">get</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Activity activity)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (Util.isOnBackgroundThread()) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> get(activity.getApplicationContext());</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (activity <span class=\"keyword\">instanceof</span> FragmentActivity) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> get((FragmentActivity) activity);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    assertNotDestroyed(activity);</span><br><span class=\"line\">    frameWaiter.registerSelf(activity);</span><br><span class=\"line\">    android.app.FragmentManager fm = activity.getFragmentManager();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> fragmentGet(activity, fm, <span class=\"comment\">/*parentHint=*/</span> <span class=\"keyword\">null</span>, isActivityVisible(activity));</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// FragmentActivity Simple </span></span><br><span class=\"line\"><span class=\"meta\">@NonNull</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> RequestManager <span class=\"title\">get</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> FragmentActivity activity)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (Util.isOnBackgroundThread()) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> get(activity.getApplicationContext());</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    assertNotDestroyed(activity);</span><br><span class=\"line\">    frameWaiter.registerSelf(activity);</span><br><span class=\"line\">    FragmentManager fm = activity.getSupportFragmentManager();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> supportFragmentGet(activity, fm, <span class=\"comment\">/*parentHint=*/</span> <span class=\"keyword\">null</span>, isActivityVisible(activity));</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// é€šè¿‡supportFragmentæ„ŸçŸ¥åˆ›å»º</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> RequestManager <span class=\"title\">supportFragmentGet</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    <span class=\"meta\">@NonNull</span> Context context,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    <span class=\"meta\">@NonNull</span> FragmentManager fm,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    <span class=\"meta\">@Nullable</span> Fragment parentHint,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    <span class=\"keyword\">boolean</span> isParentVisible)</span> </span>&#123;</span><br><span class=\"line\">  SupportRequestManagerFragment current = getSupportRequestManagerFragment(fm, parentHint);</span><br><span class=\"line\">  RequestManager requestManager = current.getRequestManager();</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (requestManager == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å·¥å‚æ¨¡å¼åˆ›å»º</span></span><br><span class=\"line\">    Glide glide = Glide.get(context);</span><br><span class=\"line\">    requestManager =</span><br><span class=\"line\">        factory.build(</span><br><span class=\"line\">            glide, current.getGlideLifecycle(), current.getRequestManagerTreeNode(), context);</span><br><span class=\"line\">    <span class=\"comment\">// è¿™æ˜¯ä¸€ä¸ªå°æŠ€å·§ï¼Œæˆ‘ä»¬å°†å¯åŠ¨ RequestManagerï¼Œè€Œä¸æ˜¯ç›¸åº”çš„ Lifecycleã€‚å¯åŠ¨ RequestManager æ˜¯å®‰å…¨çš„ï¼Œä½†å¯åŠ¨ Lifecycle å¯èƒ½ä¼šå¼•å‘å†…å­˜æ³„æ¼</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isParentVisible) &#123;</span><br><span class=\"line\">      requestManager.onStart();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    current.setRequestManager(requestManager);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> requestManager;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"load()\">load()<a title=\"#load()\" href=\"#load()\"></a></h3>\n<blockquote>\n<p>å¯¹å…¨å±€å˜é‡èµ‹å€¼,æ„å»ºReqeustBuilder</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Drawable Simple</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> RequestBuilder&lt;Drawable&gt; <span class=\"title\">load</span><span class=\"params\">(<span class=\"meta\">@Nullable</span> Drawable drawable)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> asDrawable().load(drawable);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"into()\">into()<a title=\"#into()\" href=\"#into()\"></a></h3>\n<p>è®¾ç½®èµ„æºåˆ°åŠ è½½çš„ImageViewä¸­ ï¼Œå–æ¶ˆä»»ä½•ç°æœ‰çš„åŠ è½½ï¼Œå¹¶é‡Šæ”¾ Glide ä¹‹å‰å¯èƒ½åŠ è½½åˆ°ImageViewçš„ä»»ä½•èµ„æºï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥è¢«é‡ç”¨</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// è®¾ç½®èµ„æºé…ç½®åˆ°TargetView</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ViewTarget&lt;ImageView, TranscodeType&gt; <span class=\"title\">into</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> ImageView view)</span> </span>&#123;</span><br><span class=\"line\">    Util.assertMainThread();</span><br><span class=\"line\">    Â·Â·Â·</span><br><span class=\"line\">    <span class=\"keyword\">return</span> into(</span><br><span class=\"line\">        glideContext.buildImageViewTarget(view, transcodeClass),</span><br><span class=\"line\">        <span class=\"comment\">/*targetListener=*/</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">        requestOptions,</span><br><span class=\"line\">        Executors.mainThreadExecutor());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"comment\">// åˆ›å»ºTargetView</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> &lt;X&gt; <span class=\"function\">ViewTarget&lt;ImageView, X&gt; <span class=\"title\">buildImageViewTarget</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">      <span class=\"meta\">@NonNull</span> ImageView imageView, <span class=\"meta\">@NonNull</span> Class&lt;X&gt; transcodeClass)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> imageViewTargetFactory.buildTarget(imageView, transcodeClass);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"comment\">// è´Ÿè´£ä¸ºæŒ‡å®šçš„android.view.Viewå­ç±»ç”Ÿæˆæ­£ç¡®ç±»å‹çš„Targetå·¥å‚</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ImageViewTargetFactory</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@NonNull</span></span><br><span class=\"line\">  <span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> &lt;Z&gt; <span class=\"function\">ViewTarget&lt;ImageView, Z&gt; <span class=\"title\">buildTarget</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">      <span class=\"meta\">@NonNull</span> ImageView view, <span class=\"meta\">@NonNull</span> Class&lt;Z&gt; clazz)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (Bitmap.class.equals(clazz)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (ViewTarget&lt;ImageView, Z&gt;) <span class=\"keyword\">new</span> BitmapImageViewTarget(view);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (Drawable.class.isAssignableFrom(clazz)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (ViewTarget&lt;ImageView, Z&gt;) <span class=\"keyword\">new</span> DrawableImageViewTarget(view);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(</span><br><span class=\"line\">          <span class=\"string\">&quot;Unhandled class: &quot;</span> + clazz + <span class=\"string\">&quot;, try .as*(Class).transcode(ResourceTranscoder)&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"into()-1\">into()<a title=\"#into()-1\" href=\"#into()-1\"></a></h4>\n<blockquote>\n<p>æ ¸å¿ƒä»£ç åŠ è½½ä»£ç ï¼Œçœ‹èµ·æ¥ç®€å•ä½†å®ç°èµ·æ¥å¤æ‚ã€‚<br>\né¦–å…ˆçœ‹çœ‹ buildRequest å¦‚ä½•åˆå§‹åŒ– request</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> &lt;Y extends Target&lt;TranscodeType&gt;&gt; <span class=\"function\">Y <span class=\"title\">into</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Y target, <span class=\"meta\">@Nullable</span> RequestListener&lt;TranscodeType&gt; targetListener, BaseRequestOptions&lt;?&gt; options, Executor callbackExecutor)</span> </span>&#123;</span><br><span class=\"line\">  Preconditions.checkNotNull(target);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!isModelSet) &#123; <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">&quot;You must call #load() before calling #into()&quot;</span>); &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ç°åœ¨çš„è¯·æ±‚</span></span><br><span class=\"line\">  Request request = buildRequest(target, targetListener, options, callbackExecutor);</span><br><span class=\"line\">  <span class=\"comment\">// ä¹‹å‰çš„è¯·æ±‚</span></span><br><span class=\"line\">  Request previous = target.getRequest();</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœä¹‹å‰çš„è¯·æ±‚å®Œæˆï¼Œé‡æ–°å¼€å§‹ä»¥é‡æ–°ä¼ é€’ç»“æœï¼Œè§¦å‘ RequestListeners å’Œ Targetsã€‚å¦‚æœè¯·æ±‚å¤±è´¥ï¼Œå°†é‡æ–°è¯·æ±‚ï¼Œ</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (request.isEquivalentTo(previous) &amp;&amp; !isSkipMemoryCacheWithCompletePreviousRequest(options, previous)) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœä¹‹å‰çš„è¯·æ±‚å·²ç»åœ¨è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥è®©å®ƒç»§ç»­è¿è¡Œè€Œä¸ä¸­æ–­</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!Preconditions.checkNotNull(previous).isRunning()) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// ä½¿ç”¨å…ˆå‰çš„è¯·æ±‚è€Œä¸æ˜¯æ–°çš„è¯·æ±‚æ¥ä¼˜åŒ–ï¼Œä¾‹å¦‚è·³è¿‡è®¾ç½®å ä½ç¬¦ã€è·Ÿè¸ªå’Œå–æ¶ˆè·Ÿè¸ªç›®æ ‡ä»¥åŠè·å–åœ¨å•ä¸ªè¯·æ±‚ä¸­å®Œæˆçš„è§†å›¾ç»´åº¦</span></span><br><span class=\"line\">      previous.begin();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> target;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  requestManager.clear(target);</span><br><span class=\"line\">  target.setRequest(request);</span><br><span class=\"line\">  requestManager.track(target, request);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> target;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"requestbuilder.buildrequest()\">RequestBuilder.buildRequest()<a title=\"#requestbuilder.buildrequest()\" href=\"#requestbuilder.buildrequest()\"></a></h4>\n<blockquote>\n<p>æ ¹æ®å­˜åœ¨çš„åœºæ™¯å»ºç«‹ä¸åŒRequest</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> Request <span class=\"title\">buildRequest</span><span class=\"params\">(Target&lt;TranscodeType&gt; target, <span class=\"meta\">@Nullable</span> RequestListener&lt;TranscodeType&gt; targetListener, BaseRequestOptions&lt;?&gt; requestOptions, Executor callbackExecutor)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> buildRequestRecursive(<span class=\"comment\">/*requestLock=*/</span> <span class=\"keyword\">new</span> Object(), target, targetListener,<span class=\"comment\">/*parentCoordinator=*/</span> <span class=\"keyword\">null</span>, transitionOptions, requestOptions.getPriority(), requestOptions.getOverrideWidth(), requestOptions.getOverrideHeight(), requestOptions, callbackExecutor);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> Request <span class=\"title\">buildRequestRecursive</span><span class=\"params\">(Object requestLock, Target&lt;TranscodeType&gt; target, <span class=\"meta\">@Nullable</span> RequestListener&lt;TranscodeType&gt; targetListener, <span class=\"meta\">@Nullable</span> RequestCoordinator parentCoordinator, TransitionOptions&lt;?, ? <span class=\"keyword\">super</span> TranscodeType&gt; transitionOptions, Priority priority, <span class=\"keyword\">int</span> overrideWidth, <span class=\"keyword\">int</span> overrideHeight, BaseRequestOptions&lt;?&gt; requestOptions, Executor callbackExecutor)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœ‰å¿…è¦é¦–å…ˆæ„å»º ErrorRequestCoordinatorï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥æ›´æ–° parentCoordinatorã€‚</span></span><br><span class=\"line\">  ErrorRequestCoordinator errorRequestCoordinator = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (errorBuilder != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">    errorRequestCoordinator = <span class=\"keyword\">new</span> ErrorRequestCoordinator(requestLock, parentCoordinator);</span><br><span class=\"line\">    parentCoordinator = errorRequestCoordinator;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  Request mainRequest = buildThumbnailRequestRecursive(requestLock, target, targetListener, parentCoordinator, transitionOptions, priority, overrideWidth, overrideHeight, requestOptions, callbackExecutor);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (errorRequestCoordinator == <span class=\"keyword\">null</span>) <span class=\"keyword\">return</span> mainRequest;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">int</span> errorOverrideWidth = errorBuilder.getOverrideWidth();</span><br><span class=\"line\">  <span class=\"keyword\">int</span> errorOverrideHeight = errorBuilder.getOverrideHeight();</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (Util.isValidDimensions(overrideWidth, overrideHeight) &amp;&amp; !errorBuilder.isValidOverride()) &#123;</span><br><span class=\"line\">    errorOverrideWidth = requestOptions.getOverrideWidth();</span><br><span class=\"line\">    errorOverrideHeight = requestOptions.getOverrideHeight();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  Request errorRequest = errorBuilder.buildRequestRecursive(requestLock, target, targetListener, errorRequestCoordinator, errorBuilder.transitionOptions, errorBuilder.getPriority(), errorOverrideWidth, errorOverrideHeight, errorBuilder, callbackExecutor);</span><br><span class=\"line\">  errorRequestCoordinator.setRequests(mainRequest, errorRequest);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> errorRequestCoordinator;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"requestbuilder.buildthumbnailrequestrecursive()\">RequestBuilder.buildThumbnailRequestRecursive()<a title=\"#requestbuilder.buildthumbnailrequestrecursive()\" href=\"#requestbuilder.buildthumbnailrequestrecursive()\"></a></h4>\n<blockquote>\n<p>æ ¹æ®æ˜¯å¦éœ€è¦ç¼©ç•¥å›¾,ç”Ÿæˆå„ç§ä¸åŒçš„Request</p>\n</blockquote>\n<p>è¿™é‡Œç»è¿‡ä¸€å±‚åˆä¸€å±‚æœ€ç»ˆæ‹¿åˆ°ä¸€ä¸ª<code>SingleRequest</code>ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> Request <span class=\"title\">buildThumbnailRequestRecursive</span><span class=\"params\">(Object requestLock, Target&lt;TranscodeType&gt; target, RequestListener&lt;TranscodeType&gt; targetListener, <span class=\"meta\">@Nullable</span> RequestCoordinator parentCoordinator, TransitionOptions&lt;?, ? <span class=\"keyword\">super</span> TranscodeType&gt; transitionOptions, Priority priority, <span class=\"keyword\">int</span> overrideWidth, <span class=\"keyword\">int</span> overrideHeight, BaseRequestOptions&lt;?&gt; requestOptions, Executor callbackExecutor)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (thumbnailBuilder != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// é€’å½’æ¡ˆä¾‹ï¼šåŒ…å«ä¸€ä¸ªæ½œåœ¨çš„é€’å½’ç¼©ç•¥å›¾Request Builder</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isThumbnailBuilt) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalStateException(</span><br><span class=\"line\">          <span class=\"string\">&quot;You cannot use a request as both the main request and a &quot;</span></span><br><span class=\"line\">              + <span class=\"string\">&quot;thumbnail, consider using clone() on the request(s) passed to thumbnail()&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    TransitionOptions&lt;?, ? <span class=\"keyword\">super</span> TranscodeType&gt; thumbTransitionOptions = thumbnailBuilder.transitionOptions;</span><br><span class=\"line\">    <span class=\"comment\">// é»˜è®¤æƒ…å†µä¸‹æˆ‘ä»¬çš„å°†è¿‡æ¸¡ç”¨åœ¨ç¼©ç•¥å›¾ï¼Œä½†é¿å…è¦†ç›–å¯èƒ½å·²æ˜ç¡®åº”ç”¨äºç¼©ç•¥å›¾è¯·æ±‚çš„è‡ªå®šä¹‰é€‰é¡¹ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (thumbnailBuilder.isDefaultTransitionOptionsSet) thumbTransitionOptions = transitionOptions;</span><br><span class=\"line\">    Priority thumbPriority = thumbnailBuilder.isPrioritySet() ? thumbnailBuilder.getPriority() : getThumbnailPriority(priority);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> thumbOverrideWidth = thumbnailBuilder.getOverrideWidth();</span><br><span class=\"line\">    <span class=\"keyword\">int</span> thumbOverrideHeight = thumbnailBuilder.getOverrideHeight();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (Util.isValidDimensions(overrideWidth, overrideHeight) &amp;&amp; !thumbnailBuilder.isValidOverride()) &#123;</span><br><span class=\"line\">      thumbOverrideWidth = requestOptions.getOverrideWidth();</span><br><span class=\"line\">      thumbOverrideHeight = requestOptions.getOverrideHeight();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ThumbnailRequestCoordinator coordinator = <span class=\"keyword\">new</span> ThumbnailRequestCoordinator(requestLock, parentCoordinator);</span><br><span class=\"line\">    Request fullRequest = obtainRequest(requestLock, target, targetListener, requestOptions, coordinator, transitionOptions, priority, overrideWidth, overrideHeight, callbackExecutor);</span><br><span class=\"line\">    isThumbnailBuilt = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    <span class=\"comment\">// é€’å½’ç”Ÿæˆç¼©ç•¥å›¾è¯·æ±‚</span></span><br><span class=\"line\">    Request thumbRequest = thumbnailBuilder.buildRequestRecursive(requestLock, target,targetListener, coordinator, thumbTransitionOptions, thumbPriority, thumbOverrideWidth, thumbOverrideHeight, thumbnailBuilder, callbackExecutor);</span><br><span class=\"line\">    isThumbnailBuilt = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    coordinator.setRequests(fullRequest, thumbRequest);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> coordinator;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (thumbSizeMultiplier != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// åŸºæœ¬æƒ…å†µï¼šç¼©ç•¥å›¾Multiplierç”Ÿæˆç¼©ç•¥å›¾è¯·æ±‚ï¼Œä½†ä¸èƒ½é€’å½’ã€‚</span></span><br><span class=\"line\">    ThumbnailRequestCoordinator coordinator = <span class=\"keyword\">new</span> ThumbnailRequestCoordinator(requestLock, parentCoordinator);</span><br><span class=\"line\">    Request fullRequest = obtainRequest(requestLock, target, targetListener, requestOptions, coordinator, transitionOptions, priority, overrideWidth, overrideHeight, callbackExecutor);</span><br><span class=\"line\">    BaseRequestOptions&lt;?&gt; thumbnailOptions = requestOptions.clone().sizeMultiplier(thumbSizeMultiplier);</span><br><span class=\"line\">    Request thumbnailRequest = obtainRequest(requestLock, target, targetListener, thumbnailOptions, coordinator, transitionOptions, getThumbnailPriority(priority), overrideWidth, overrideHeight, callbackExecutor);</span><br><span class=\"line\">    coordinator.setRequests(fullRequest, thumbnailRequest);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> coordinator;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// åŸºæœ¬æƒ…å†µï¼šæ²¡æœ‰ç¼©ç•¥å›¾</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> obtainRequest(requestLock, target, targetListener, requestOptions, parentCoordinator, transitionOptions, priority, overrideWidth, overrideHeight, callbackExecutor);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> Request <span class=\"title\">obtainRequest</span><span class=\"params\">(Object requestLock, Target&lt;TranscodeType&gt; target, RequestListener&lt;TranscodeType&gt; targetListener, BaseRequestOptions&lt;?&gt; requestOptions, RequestCoordinator requestCoordinator, TransitionOptions&lt;?, ? <span class=\"keyword\">super</span> TranscodeType&gt; transitionOptions, Priority priority, <span class=\"keyword\">int</span> overrideWidth, <span class=\"keyword\">int</span> overrideHeight, Executor callbackExecutor)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> SingleRequest.obtain(context, glideContext, requestLock, model, transcodeClass, requestOptions, overrideWidth, overrideHeight, priority, target, targetListener, requestListeners, requestCoordinator, glideContext.getEngine(), transitionOptions.getTransitionFactory(), callbackExecutor);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"requestmanager.track()\">RequestManager.track()<a title=\"#requestmanager.track()\" href=\"#requestmanager.track()\"></a></h4>\n<p>è¿™é‡ŒGlideå°†åˆ¤æ–­è¯·æ±‚æ˜¯å¦éœ€è¦æ˜¾ç¤ºï¼Œå¦‚æœå®ƒéœ€è¦ç°åœ¨æ˜¾ç¤ºåˆ™å¼€å§‹æ‰§è¡Œï¼Œå¦åˆ™clear( )ï¼Œå¹¶å°†è¯·æ±‚æ”¾å…¥é˜Ÿåˆ—ã€‚è¿™ç§è®¾è®¡æ›´ç²¾å·§ï¼Œçœç”µ</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">track</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Target&lt;?&gt; target, <span class=\"meta\">@NonNull</span> Request request)</span> </span>&#123;  </span><br><span class=\"line\">  targetTracker.track(target);  </span><br><span class=\"line\">  requestTracker.runRequest(request);  </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/** å¼€å§‹è·Ÿè¸ªç»™å®šçš„è¯·æ±‚ */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">runRequest</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> Request request)</span> </span>&#123;</span><br><span class=\"line\">  requests.add(request);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!isPaused) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¯åŠ¨å¼‚æ­¥åŠ è½½</span></span><br><span class=\"line\">    request.begin();</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// é˜²æ­¢ä»ä»¥å‰çš„è¯·æ±‚åŠ è½½ä»»ä½•ä½å›¾ï¼Œé‡Šæ”¾æ­¤è¯·æ±‚æŒæœ‰çš„ä»»ä½•èµ„æºï¼Œæ˜¾ç¤ºå½“å‰å ä½ç¬¦ï¼ˆå¦‚æœæä¾›ï¼‰ï¼Œå¹¶å°†è¯·æ±‚æ ‡è®°ä¸ºå·²å–æ¶ˆ</span></span><br><span class=\"line\">    request.clear();</span><br><span class=\"line\">    pendingRequests.add(request);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"singlerequest.begin()\">SingleRequest.begin()<a title=\"#singlerequest.begin()\" href=\"#singlerequest.begin()\"></a></h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">begin</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">synchronized</span> (requestLock) &#123;</span><br><span class=\"line\">    assertNotCallingCallbacks();</span><br><span class=\"line\">    stateVerifier.throwIfRecycled();</span><br><span class=\"line\">    startTime = LogTime.getLogTime();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (model == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (Util.isValidDimensions(overrideWidth, overrideHeight)) &#123;</span><br><span class=\"line\">        width = overrideWidth;</span><br><span class=\"line\">        height = overrideHeight;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">// å¦‚æœç”¨æˆ·è®¾ç½®å¯å›è°ƒçš„Drawables,è¿™é‡Œè¿›è¡Œæ—¥å¿—åé¦ˆ</span></span><br><span class=\"line\">      <span class=\"keyword\">int</span> logLevel = getFallbackDrawable() == <span class=\"keyword\">null</span> ? Log.WARN : Log.DEBUG;</span><br><span class=\"line\">      onLoadFailed(<span class=\"keyword\">new</span> GlideException(<span class=\"string\">&quot;Received null model&quot;</span>), logLevel);</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (status == Status.RUNNING) <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">&quot;Cannot restart a running request&quot;</span>);</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœæˆ‘ä»¬åœ¨å®Œæˆåé‡æ–°å¯åŠ¨(é€šå¸¸æ˜¯é€šè¿‡notifyDataSetChangedä¹‹ç±»çš„æ–¹å¼ï¼Œå‘ç›¸åŒçš„ç›®æ ‡æˆ–è§†å›¾å¯åŠ¨ç›¸åŒçš„è¯·æ±‚)ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°ä½¿ç”¨ä¸Šæ¬¡æ£€ç´¢åˆ°çš„èµ„æºå’Œå¤§å°ï¼Œè€Œè·³è¿‡è·å–ä¸€ä¸ªæ–°çš„å¤§å°ï¼Œå¼€å§‹ä¸€ä¸ªæ–°çš„åŠ è½½ç­‰(è¿™æ„å‘³ç€å¸Œæœ›é‡æ–°å¯åŠ¨åŠ è½½çš„ç”¨æˆ·éœ€è¦åœ¨å¼€å§‹æ–°çš„åŠ è½½ä¹‹å‰æ˜¾å¼åœ°æ¸…é™¤viewæˆ–Targetï¼Œå› ä¸ºä»–ä»¬è§‰å¾—è§†å›¾å¤§å°å·²ç»æ”¹å˜ã€‚)</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (status == Status.COMPLETE) &#123;</span><br><span class=\"line\">      onResourceReady(resource, DataSource.MEMORY_CACHE, <span class=\"comment\">/* isLoadedFromAlternateCacheKey= */</span> <span class=\"keyword\">false</span>);</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// å¯¹äºæ—¢æœªå®Œæˆä¹Ÿæœªè¿è¡Œçš„è¯·æ±‚ï¼Œé‡æ–°å¯åŠ¨å¯ä»¥è¢«è§†ä¸ºæ–°è¯·æ±‚ï¼Œå¹¶å¯ä»¥ä»å¤´å¼€å§‹è¿è¡Œ</span></span><br><span class=\"line\">    cookie = GlideTrace.beginSectionAsync(TAG);</span><br><span class=\"line\">    status = Status.WAITING_FOR_SIZE;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœå®½é«˜å·²æŒ‡å®š,åˆ™å›è°ƒonSizeReady ,å¦åˆ™å†è·å–å®½é«˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (Util.isValidDimensions(overrideWidth, overrideHeight)) &#123;</span><br><span class=\"line\">      onSizeReady(overrideWidth, overrideHeight);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      target.getSize(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((status == Status.RUNNING || status == Status.WAITING_FOR_SIZE) &amp;&amp; canNotifyStatusChanged()) &#123;</span><br><span class=\"line\">      target.onLoadStarted(getPlaceholderDrawable());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>onLoadFailed : å›¾ç‰‡æˆ–è€…èµ„æºä¸ºç©º,æŠ¥é”™å›è°ƒ</li>\n<li>onResourceReady: æœ€ç»ˆé€šè¿‡<code>Engine.release( )</code>,é‡Šæ”¾èµ„æº</li>\n<li>onSizeReady: Viewå¤§å°å·²æ˜ç¡® , æ‰§è¡Œ<code>Engine.load()</code>åŠ è½½èµ„æº</li>\n<li>getSize: è·å–Viewå¤§å°</li>\n<li>onLoadStarted: ç­‰å¾…æˆ–è¿è¡Œä¸­,å ä½å›¾å¤„ç†</li>\n</ul>\n<h4 id=\"singlerequest.onsizeready(-)\">SingleRequest.onSizeReady( )<a title=\"#singlerequest.onsizeready(-)\" href=\"#singlerequest.onsizeready(-)\"></a></h4>\n<blockquote>\n<p>å¯åŠ¨ç»™å®šå‚æ•°è¿›è¡Œå›¾ç‰‡çš„åŠ è½½, å¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸Šè°ƒç”¨</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onSizeReady</span><span class=\"params\">(<span class=\"keyword\">int</span> width, <span class=\"keyword\">int</span> height)</span> </span>&#123;</span><br><span class=\"line\">  stateVerifier.throwIfRecycled();</span><br><span class=\"line\">  <span class=\"keyword\">synchronized</span> (requestLock) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (status != Status.WAITING_FOR_SIZE) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    status = Status.RUNNING;</span><br><span class=\"line\">    <span class=\"keyword\">float</span> sizeMultiplier = requestOptions.getSizeMultiplier();</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.width = maybeApplySizeMultiplier(width, sizeMultiplier);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.height = maybeApplySizeMultiplier(height, sizeMultiplier);</span><br><span class=\"line\">    loadStatus = engine.load(glideContext, model, requestOptions.getSignature(), <span class=\"keyword\">this</span>.width, <span class=\"keyword\">this</span>.height, requestOptions.getResourceClass(), transcodeClass, priority, requestOptions.getDiskCacheStrategy(), requestOptions.getTransformations(), requestOptions.isTransformationRequired(), requestOptions.isScaleOnlyOrNoTransform(), requestOptions.getOptions(), requestOptions.isMemoryCacheable(), requestOptions.getUseUnlimitedSourceGeneratorsPool(), requestOptions.getUseAnimationPool(), requestOptions.getOnlyRetrieveFromCache(), <span class=\"keyword\">this</span>, callbackExecutor);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"engine.load(-)\">Engine.load( )<a title=\"#engine.load(-)\" href=\"#engine.load(-)\"></a></h4>\n<blockquote>\n<p>åˆ°è¿™é‡Œæƒ³éƒ½ä¸ç”¨æƒ³äº†,Engineæ‰æ˜¯çœŸæ­£åŠ è½½å›¾ç‰‡çš„Class,<br>\nEngineè´Ÿè´£æ‰§è¡Œå›¾ç‰‡åŠ è½½å’Œç®¡ç†æ´»åŠ¨èµ„æºå’Œç¼“å­˜èµ„æºã€‚</p>\n</blockquote>\n<p>æ´»åŠ¨èµ„æºæ˜¯æŒ‡é‚£äº›è‡³å°‘æä¾›ä¸€ä¸ªè¯·æ±‚ä½†æœªé‡Šæ”¾çš„èµ„æºã€‚ä¸€æ—¦èµ„æºçš„æ‰€æœ‰ä½¿ç”¨è€…éƒ½é‡Šæ”¾äº†è¯¥èµ„æºï¼Œè¯¥èµ„æºå°±ä¼šè¿›å…¥ç¼“å­˜ã€‚å¦‚æœèµ„æºä»ç¼“å­˜ä¸­è¿”å›ç»™æ–°çš„ä½¿ç”¨è€…ï¼Œå®ƒå°†è¢«é‡æ–°æ·»åŠ åˆ°æ´»åŠ¨èµ„æºä¸­ã€‚<br>\nå¦‚æœä»ç¼“å­˜ä¸­ç§»é™¤èµ„æºï¼Œå®ƒçš„èµ„æºå°†è¢«å›æ”¶å’Œé‡ç”¨(å¦‚æœå¯èƒ½çš„è¯)ï¼Œèµ„æºå°†è¢«ä¸¢å¼ƒã€‚æ²¡æœ‰ä¸¥æ ¼è¦æ±‚æ¶ˆè´¹è€…é‡Šæ”¾ä»–ä»¬çš„èµ„æºï¼Œæ‰€ä»¥æ´»è·ƒçš„èµ„æºè¢«å¼±æŒæœ‰ã€‚</p>\n<p>è¯·æ±‚æµç¨‹:</p>\n<ul>\n<li>æ£€æŸ¥å½“å‰ä½¿ç”¨çš„èµ„æºé›†ï¼Œè¿”å›æ´»åŠ¨èµ„æºï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œå¹¶å°†ä»»ä½•æ–°çš„éæ´»åŠ¨èµ„æºç§»åŠ¨åˆ°å†…å­˜ç¼“å­˜ä¸­</li>\n<li>æ£€æŸ¥å†…å­˜ç¼“å­˜å¹¶æä¾›ç¼“å­˜èµ„æºï¼ˆå¦‚æœå­˜åœ¨ï¼‰</li>\n<li>æ£€æŸ¥å½“å‰çš„ä¸€ç»„æ­£åœ¨è¿›è¡Œçš„åŠ è½½å¹¶å°† cb æ·»åŠ åˆ°è¿›è¡Œä¸­çš„åŠ è½½ï¼ˆå¦‚æœå­˜åœ¨ï¼‰</li>\n<li>å¼€å§‹åŠ è½½</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> &lt;R&gt; <span class=\"function\">LoadStatus <span class=\"title\">load</span><span class=\"params\">(GlideContext glideContext, Object model, Key signature, <span class=\"keyword\">int</span> width, <span class=\"keyword\">int</span> height, Class&lt;?&gt; resourceClass, Class&lt;R&gt; transcodeClass, Priority priority, DiskCacheStrategy diskCacheStrategy, Map&lt;Class&lt;?&gt;, Transformation&lt;?&gt;&gt; transformations, <span class=\"keyword\">boolean</span> isTransformationRequired, <span class=\"keyword\">boolean</span> isScaleOnlyOrNoTransform, Options options, <span class=\"keyword\">boolean</span> isMemoryCacheable, <span class=\"keyword\">boolean</span> useUnlimitedSourceExecutorPool, <span class=\"keyword\">boolean</span> useAnimationPool, <span class=\"keyword\">boolean</span> onlyRetrieveFromCache, ResourceCallback cb, Executor callbackExecutor)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">long</span> startTime = VERBOSE_IS_LOGGABLE ? LogTime.getLogTime() : <span class=\"number\">0</span>;</span><br><span class=\"line\">  EngineKey key = keyFactory.buildKey(model, signature, width, height, transformations,resourceClass, transcodeClass, options);</span><br><span class=\"line\">  EngineResource&lt;?&gt; memoryResource;</span><br><span class=\"line\">  <span class=\"keyword\">synchronized</span> (<span class=\"keyword\">this</span>) &#123;</span><br><span class=\"line\">    memoryResource = loadFromMemory(key, isMemoryCacheable, startTime);</span><br><span class=\"line\">    <span class=\"comment\">// åˆ¤æ–­æ˜¯å¦æœ‰ç¼“å­˜,æœ‰åˆ™ç›´æ¥åŠ è½½</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (memoryResource == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> waitForExistingOrStartNewJob(glideContext, model, signature, width, height, resourceClass, transcodeClass, priority, diskCacheStrategy, transformations, isTransformationRequired, isScaleOnlyOrNoTransform, options, isMemoryCacheable, useUnlimitedSourceExecutorPool, useAnimationPool, onlyRetrieveFromCache, cb, callbackExecutor, key, startTime);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// é¿å…åœ¨ä¿æŒEngineé”æ—¶å›è°ƒï¼Œå› ä¸ºè¿™æ ·åšä¼šæ›´å®¹æ˜“æ­»é”</span></span><br><span class=\"line\">  cb.onResourceReady(memoryResource, DataSource.MEMORY_CACHE, <span class=\"comment\">/* isLoadedFromAlternateCacheKey= */</span> <span class=\"keyword\">false</span>);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"engine.waitforexistingorstartnewjob(-)\">Engine.waitForExistingOrStartNewJob( )<a title=\"#engine.waitforexistingorstartnewjob(-)\" href=\"#engine.waitforexistingorstartnewjob(-)\"></a></h4>\n<blockquote>\n<p>ç­‰å¾…æˆ–è€…æ‰§è¡Œä»»åŠ¡</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> &lt;R&gt; <span class=\"function\">LoadStatus <span class=\"title\">waitForExistingOrStartNewJob</span><span class=\"params\">(GlideContext glideContext, Object model, Key signature, <span class=\"keyword\">int</span> width, <span class=\"keyword\">int</span> height, Class&lt;?&gt; resourceClass, Class&lt;R&gt; transcodeClass, Priority priority, DiskCacheStrategy diskCacheStrategy, Map&lt;Class&lt;?&gt;, Transformation&lt;?&gt;&gt; transformations, <span class=\"keyword\">boolean</span> isTransformationRequired, <span class=\"keyword\">boolean</span> isScaleOnlyOrNoTransform, Options options, <span class=\"keyword\">boolean</span> isMemoryCacheable, <span class=\"keyword\">boolean</span> useUnlimitedSourceExecutorPool, <span class=\"keyword\">boolean</span> useAnimationPool, <span class=\"keyword\">boolean</span> onlyRetrieveFromCache, ResourceCallback cb, Executor callbackExecutor, EngineKey key, <span class=\"keyword\">long</span> startTime)</span> </span>&#123;</span><br><span class=\"line\">  EngineJob&lt;?&gt; current = jobs.get(key, onlyRetrieveFromCache);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (current != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">    current.addCallback(cb, callbackExecutor);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> LoadStatus(cb, current);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  EngineJob&lt;R&gt; engineJob = engineJobFactory.build(key, isMemoryCacheable, useUnlimitedSourceExecutorPool, useAnimationPool, onlyRetrieveFromCache);</span><br><span class=\"line\">  DecodeJob&lt;R&gt; decodeJob = decodeJobFactory.build(glideContext, model, key, signature, width, height, resourceClass, transcodeClass, priority, diskCacheStrategy, transformations, isTransformationRequired, isScaleOnlyOrNoTransform, onlyRetrieveFromCache, options, engineJob);</span><br><span class=\"line\">  jobs.put(key, engineJob);</span><br><span class=\"line\">  engineJob.addCallback(cb, callbackExecutor);</span><br><span class=\"line\">  engineJob.start(decodeJob);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (VERBOSE_IS_LOGGABLE)  logWithTimeAndKey(<span class=\"string\">&quot;Started new load&quot;</span>, startTime, key);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> LoadStatus(cb, engineJob);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"decodejob\">DecodeJob<a title=\"#decodejob\" href=\"#decodejob\"></a></h4>\n<blockquote>\n<p>è´Ÿè´£ä»ç¼“å­˜æ•°æ®æˆ–åŸå§‹æºä¸­è§£ç èµ„æºå¹¶åº”ç”¨è½¬æ¢å’Œè½¬ç çš„ç±»</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span>  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isCancelled) &#123;</span><br><span class=\"line\">      notifyFailed();</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    runWrapped();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">runWrapped</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ä¸ºäº†åˆ¤æ–­è¿è¡ŒåŸå› ,è¿™é‡Œåšäº†ä¸‰ä¸ªåˆ¤æ–­</span></span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (runReason) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> INITIALIZE:</span><br><span class=\"line\">      <span class=\"comment\">// è·å–å½“å‰è§£ç æ•°æ®çš„é˜¶æ®µ</span></span><br><span class=\"line\">      stage = getNextStage(Stage.INITIALIZE);</span><br><span class=\"line\">      <span class=\"comment\">// è·å–æ•°æ®ç”Ÿæˆå™¨</span></span><br><span class=\"line\">      currentGenerator = getNextGenerator();</span><br><span class=\"line\">      runGenerators();</span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> SWITCH_TO_SOURCE_SERVICE:</span><br><span class=\"line\">      runGenerators();</span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> DECODE_DATA:</span><br><span class=\"line\">      decodeFromRetrievedData();</span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">default</span>:</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalStateException(<span class=\"string\">&quot;Unrecognized run reason: &quot;</span> + runReason);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"rungenerators(-)\">runGenerators( )<a title=\"#rungenerators(-)\" href=\"#rungenerators(-)\"></a></h5>\n<p>currentGeneratorå®ç°DataFetcherGeneratoræ¥å£ï¼Œè¿™ä¸ªæ¥å£ä¸»è¦ç”¨æ¥ç”Ÿæˆä¸€ç³»åˆ—çš„modelLoaderå’Œmodel</p>\n<p>ç›®å‰Glideæœ‰ä¸‰ç§ç±»ç”Ÿæˆå™¨</p>\n<ul>\n<li>ResourceCacheGenerator</li>\n<li>DataCacheGenerator</li>\n<li>SourceGenerator</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">runGenerators</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  currentThread = Thread.currentThread();</span><br><span class=\"line\">  startFetchTime = LogTime.getLogTime();</span><br><span class=\"line\">  <span class=\"keyword\">boolean</span> isStarted = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">  <span class=\"comment\">// startNext -&gt; å°è¯•å•ä¸ªæ–°çš„DataFetcherï¼Œå¦‚æœDataFetcherå·²å¯åŠ¨åˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›false</span></span><br><span class=\"line\">  <span class=\"keyword\">while</span> (!isCancelled &amp;&amp; currentGenerator != <span class=\"keyword\">null</span> &amp;&amp; !(isStarted = currentGenerator.startNext())) &#123;</span><br><span class=\"line\">    stage = getNextStage(stage);</span><br><span class=\"line\">    currentGenerator = getNextGenerator();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (stage == Stage.SOURCE) &#123;</span><br><span class=\"line\">      reschedule();</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// We&#x27;ve run out of stages and generators, give up.</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ((stage == Stage.FINISHED || isCancelled) &amp;&amp; !isStarted) &#123;</span><br><span class=\"line\">    notifyFailed();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> DataFetcherGenerator <span class=\"title\">getNextGenerator</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (stage) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> RESOURCE_CACHE:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ResourceCacheGenerator(decodeHelper, <span class=\"keyword\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">case</span> DATA_CACHE:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> DataCacheGenerator(decodeHelper, <span class=\"keyword\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">case</span> SOURCE:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> SourceGenerator(decodeHelper, <span class=\"keyword\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">case</span> FINISHED:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">default</span>:</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalStateException(<span class=\"string\">&quot;Unrecognized stage: &quot;</span> + stage);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h6 id=\"sourcegenerator.startnext()\">SourceGenerator.startNext()<a title=\"#sourcegenerator.startnext()\" href=\"#sourcegenerator.startnext()\"></a></h6>\n<p>å°†é¦–å…ˆåˆ¤æ–­ï¼Œç¼“å­˜å¦‚æœå®ƒä¸æ˜¯ç©ºçš„ï¼Œè°ƒç”¨ cacheData; å¦åˆ™ï¼Œè·å– loadDataï¼Œç„¶åæ‰§è¡Œ startNextLoad ()</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">startNext</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (dataToCache != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">    Object data = dataToCache;</span><br><span class=\"line\">    dataToCache = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">boolean</span> isDataInCache = cacheData(data);</span><br><span class=\"line\">      <span class=\"comment\">// å¦‚æœæˆ‘ä»¬æ²¡æœ‰å°†æ•°æ®å†™å…¥ç¼“å­˜ï¼ŒcacheDataæ–¹æ³•å°†å°è¯•ç›´æ¥è§£ç åŸå§‹æ•°æ®ï¼Œè€Œä¸æ˜¯é€šè¿‡ç£ç›˜ç¼“å­˜ã€‚å› ä¸ºæ­¤æ—¶cacheDataå·²ç»è°ƒç”¨äº†æˆ‘ä»¬çš„å›è°ƒå‡½æ•°ï¼Œæ‰€ä»¥é™¤äº†è¿”å›ï¼Œæ²¡æœ‰å…¶ä»–äº‹æƒ…å¯åšäº†</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!isDataInCache) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">// å¦‚æœæˆ‘ä»¬èƒ½å¤ŸæˆåŠŸåœ°å°†æ•°æ®å†™å…¥ç¼“å­˜ï¼Œé‚£ä¹ˆç°åœ¨éœ€è¦ç»§ç»­è°ƒç”¨ä¸‹é¢çš„sourceCacheGeneratoræ¥ä»ç¼“å­˜åŠ è½½æ•°æ®</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// IOExceptionæ„å‘³ç€æˆ‘ä»¬æ— æ³•å°†æ•°æ®å†™å…¥ç¼“å­˜ï¼Œæˆ–è€…åœ¨ç£ç›˜ç¼“å­˜å†™å…¥å¤±è´¥åæ— æ³•å€’å¸¦æ•°æ®ã€‚æ— è®ºå“ªç§æƒ…å†µï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç»§ç»­å°è¯•ä¸‹é¢çš„ä¸‹ä¸€ä¸ªå–å›</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (Log.isLoggable(TAG, Log.DEBUG)) &#123;</span><br><span class=\"line\">        Log.d(TAG, <span class=\"string\">&quot;Failed to properly rewind or write data to cache&quot;</span>, e);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (sourceCacheGenerator != <span class=\"keyword\">null</span> &amp;&amp; sourceCacheGenerator.startNext()) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  sourceCacheGenerator = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  loadData = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">  <span class=\"keyword\">boolean</span> started = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">  <span class=\"keyword\">while</span> (!started &amp;&amp; hasNextModelLoader()) &#123;</span><br><span class=\"line\">    loadData = helper.getLoadData().get(loadDataListIndex++);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (loadData != <span class=\"keyword\">null</span></span><br><span class=\"line\">        &amp;&amp; (helper.getDiskCacheStrategy().isDataCacheable(loadData.fetcher.getDataSource())</span><br><span class=\"line\">            || helper.hasLoadPath(loadData.fetcher.getDataClass()))) &#123;</span><br><span class=\"line\">      started = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">      startNextLoad(loadData);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> started;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"sourcegenerator.cachedata\">SourceGenerator.cacheData<a title=\"#sourcegenerator.cachedata\" href=\"#sourcegenerator.cachedata\"></a></h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿç¼“å­˜æ•°æ®ï¼Œåº”è¯¥å°è¯•ç›´æ¥ä»ç¼“å­˜è§£ç æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬ä¸èƒ½ç¼“å­˜æ•°æ®ï¼Œåº”è¯¥å°è¯•ä»æºè§£ç ï¼Œåˆ™è¿”å›false</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> <span class=\"title\">cacheData</span><span class=\"params\">(Object dataToCache)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">boolean</span> isLoadingFromSourceData = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    DataRewinder&lt;Object&gt; rewinder = helper.getRewinder(dataToCache);</span><br><span class=\"line\">    Object data = rewinder.rewindAndGet();</span><br><span class=\"line\">    Encoder&lt;Object&gt; encoder = helper.getSourceEncoder(data);</span><br><span class=\"line\">    DataCacheWriter&lt;Object&gt; writer = <span class=\"keyword\">new</span> DataCacheWriter&lt;&gt;(encoder, data, helper.getOptions());</span><br><span class=\"line\">    DataCacheKey newOriginalKey = <span class=\"keyword\">new</span> DataCacheKey(loadData.sourceKey, helper.getSignature());</span><br><span class=\"line\">    DiskCache diskCache = helper.getDiskCache();</span><br><span class=\"line\">    diskCache.put(newOriginalKey, writer);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (diskCache.get(newOriginalKey) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">      originalKey = newOriginalKey;</span><br><span class=\"line\">      sourceCacheGenerator = <span class=\"keyword\">new</span> DataCacheGenerator(Collections.singletonList(loadData.sourceKey), helper, <span class=\"keyword\">this</span>);</span><br><span class=\"line\">      <span class=\"comment\">// æˆ‘ä»¬èƒ½å¤Ÿå°†æ•°æ®å†™å…¥ç¼“å­˜</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      isLoadingFromSourceData = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">      cb.onDataFetcherReady(loadData.sourceKey, rewinder.rewindAndGet(), loadData.fetcher, loadData.fetcher.getDataSource(), loadData.sourceKey);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// å†™å…¥æ•°æ®åˆ°ç¼“å­˜å¤±è´¥çš„å¤„ç†</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isLoadingFromSourceData) &#123;</span><br><span class=\"line\">      loadData.fetcher.cleanup();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"decodehelper.getsourceencoder()\">DecodeHelper.getSourceEncoder()<a title=\"#decodehelper.getsourceencoder()\" href=\"#decodehelper.getsourceencoder()\"></a></h6>\n<p>DecodeHelper.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;X&gt; <span class=\"function\">Encoder&lt;X&gt; <span class=\"title\">getSourceEncoder</span><span class=\"params\">(X data)</span> <span class=\"keyword\">throws</span> Registry.NoSourceEncoderAvailableException </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> glideContext.getRegistry().getSourceEncoder(data);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Registry.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> &lt;X&gt; <span class=\"function\">Encoder&lt;X&gt; <span class=\"title\">getSourceEncoder</span><span class=\"params\">(<span class=\"meta\">@NonNull</span> X data)</span> <span class=\"keyword\">throws</span> NoSourceEncoderAvailableException </span>&#123;  </span><br><span class=\"line\">  Encoder&lt;X&gt; encoder = encoderRegistry.getEncoder((Class&lt;X&gt;) data.getClass());  </span><br><span class=\"line\">  <span class=\"keyword\">if</span>(encoder != <span class=\"keyword\">null</span>) &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> encoder;  </span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\">  <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NoSourceEncoderAvailableException(data.getClass());  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"register\">Register<a title=\"#register\" href=\"#register\"></a></h6>\n<blockquote>\n<p>æ¯ä¸ªæ•°æ®ç±»å‹å¯¹åº”ä¸€ä¸ªç¼–ç å™¨,Registerå°±æ˜¯ç”¨æ¥è®°å½•è¿™äº›çš„</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">registry</span><br><span class=\"line\">        .append(ByteBuffer.class, <span class=\"keyword\">new</span> ByteBufferEncoder())</span><br><span class=\"line\">        .append(InputStream.class, <span class=\"keyword\">new</span> StreamEncoder(arrayPool))</span><br><span class=\"line\">        .append(Registry.BUCKET_BITMAP, ByteBuffer.class, Bitmap.class, byteBufferBitmapDecoder)</span><br><span class=\"line\">        .append(Registry.BUCKET_BITMAP, InputStream.class, Bitmap.class, streamBitmapDecoder);</span><br></pre></td></tr></table></figure>\n<h5 id=\"decodefromretrieveddata()\">decodeFromRetrievedData()<a title=\"#decodefromretrieveddata()\" href=\"#decodefromretrieveddata()\"></a></h5>\n<blockquote>\n<p>å¤„ç†è¿”å›çš„æ•°æ®</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/10/26/5oU7rD.png\" alt=\"5oU7rD.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> &lt;Data&gt; <span class=\"function\">Resource&lt;R&gt; <span class=\"title\">decodeFromData</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    DataFetcher&lt;?&gt; fetcher, Data data, DataSource dataSource)</span> <span class=\"keyword\">throws</span> GlideException </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (data == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">long</span> startTime = LogTime.getLogTime();</span><br><span class=\"line\">    Resource&lt;R&gt; result = decodeFromFetcher(data, dataSource);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (Log.isLoggable(TAG, Log.VERBOSE)) &#123;</span><br><span class=\"line\">      logWithTimeAndKey(<span class=\"string\">&quot;Decoded result &quot;</span> + result, startTime);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">    fetcher.cleanup();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> &lt;Data&gt; <span class=\"function\">Resource&lt;R&gt; <span class=\"title\">decodeFromFetcher</span><span class=\"params\">(Data data, DataSource dataSource)</span></span></span><br><span class=\"line\"><span class=\"function\">    <span class=\"keyword\">throws</span> GlideException </span>&#123;</span><br><span class=\"line\">  LoadPath&lt;Data, ?, R&gt; path = decodeHelper.getLoadPath((Class&lt;Data&gt;) data.getClass());</span><br><span class=\"line\">  <span class=\"keyword\">return</span> runLoadPath(data, dataSource, path);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"enginejob\">EngineJob<a title=\"#enginejob\" href=\"#enginejob\"></a></h4>\n<blockquote>\n<p>é€šè¿‡æ·»åŠ å’Œåˆ é™¤åŠ è½½å›è°ƒå¹¶åœ¨åŠ è½½å®Œæˆæ—¶é€šçŸ¥å›è°ƒæ¥ç®¡ç†åŠ è½½çš„ç±»(ç®¡ç†åŠ è½½è¿‡ç¨‹ä¸­çš„ä¸€äº›å›è°ƒ)</p>\n</blockquote>\n<p>GlideExecutoræ˜¯ä¸€ä¸ªç»§æ‰¿çš„Executorserviceç±»ï¼Œå®ƒæ˜¾ç„¶æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ã€‚è¿™é‡Œé€šè¿‡decodeJobæ¥ç¡®å®šæ˜¯å¦ä»ç¼“å­˜è§£æï¼Œå¦‚æœæ˜¯ä»ç¼“å­˜è§£æï¼Œè°ƒç”¨diskCacheExecutorï¼Œå¦åˆ™ï¼Œè°ƒç”¨getActiveSourceExecutor</p>\n<ul>\n<li>willDecodeFromCache\n<ul>\n<li>å¦‚æœæ­¤ä½œä¸šå°†å°è¯•ä»ç£ç›˜ç¼“å­˜è§£ç èµ„æºï¼Œåˆ™è¿”å›true</li>\n<li>å¦‚æœå§‹ç»ˆä»æºè§£ç ï¼Œåˆ™è¿”å›false</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">start</span><span class=\"params\">(DecodeJob&lt;R&gt; decodeJob)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.decodeJob = decodeJob;</span><br><span class=\"line\">  GlideExecutor executor = decodeJob.willDecodeFromCache() ? diskCacheExecutor : getActiveSourceExecutor();</span><br><span class=\"line\">  <span class=\"comment\">// æ‰§è¡ŒdecodeJobçº¿ç¨‹ä»»åŠ¡</span></span><br><span class=\"line\">  executor.execute(decodeJob);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "æºç è§£æ"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/01/4SVquTFcR8Wyv4GV/",
            "url": "https://onion99.github.io/2021/11/01/4SVquTFcR8Wyv4GV/",
            "title": "æºç å­¦ä¹ -OkHttp",
            "date_published": "2021-10-31T21:28:18.000Z",
            "content_html": "<blockquote>\n<p>httpçš„è¿æ¥æœ¬è´¨ä¸Šæ˜¯ä¸ªsocketï¼Œæ ¹æ®httpåè®®ï¼Œé€šè¿‡socketåŒ…è£…å‘é€è¯·æ±‚å¹¶è·å¾—è¿”å›ç»“æœ</p>\n</blockquote>\n<p>ç½‘è·¯è¿æ¥åº“ä¸€å¼€å§‹çš„æ ·å­å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼Œå…¶å®åªè¦ç¬¦åˆHttpåè®®çš„è¯·æ±‚ï¼Œå°±å¯ä»¥å’Œç½‘ç»œè¿›è¡Œäº¤äº’ï¼Œç±»ä¼¼äºOkHttpçš„ç½‘ç»œè¯·æ±‚åº“ï¼Œå¸®åŠ©å¼€å‘è€…æ–¹ä¾¿å’Œå±è”½äº†Httpåè®®ä¸­ç±»ä¼¼äºè¯·æ±‚å¤´ï¼Œé‡è¿ã€åˆå¹¶ã€ä»£ç†ã€è¿”å›ç»“æœè§£æç­‰ç­‰Httpåè®®ç»†èŠ‚çš„åº”ç”¨å±‚å®ç°ã€‚</p>\n<span id=\"more\"></span>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val path = <span class=\"string\">&quot;http://www.baidu.com/&quot;</span></span><br><span class=\"line\">        val host = <span class=\"string\">&quot;www.baidu.com&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> socket: Socket? = <span class=\"keyword\">null</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> streamWriter: OutputStreamWriter? = <span class=\"keyword\">null</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> bufferedWriter: BufferedWriter? = <span class=\"keyword\">null</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            socket = Socket(host, <span class=\"number\">80</span>)</span><br><span class=\"line\">            streamWriter = OutputStreamWriter(socket.getOutputStream())</span><br><span class=\"line\">            bufferedWriter = BufferedWriter(streamWriter)</span><br><span class=\"line\">            bufferedWriter.write(<span class=\"string\">&quot;GET $path HTTP/1.1\\r\\n&quot;</span>)</span><br><span class=\"line\">            bufferedWriter.write(<span class=\"string\">&quot;Host: www.baidu.com\\r\\n&quot;</span>)</span><br><span class=\"line\">            bufferedWriter.write(<span class=\"string\">&quot;\\r\\n&quot;</span>)</span><br><span class=\"line\">            bufferedWriter.flush()</span><br><span class=\"line\">            val myRequest = BufferedReader(InputStreamReader(socket.getInputStream(), <span class=\"string\">&quot;UTF-8&quot;</span>))</span><br><span class=\"line\">            <span class=\"keyword\">var</span> d = -<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (myRequest.read().also(&#123; d = it &#125;) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                print(d.toChar())</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (e: IOException) &#123;</span><br><span class=\"line\">            e.printStackTrace()</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ•´ä½“æµç¨‹\">æ•´ä½“æµç¨‹<a title=\"#æ•´ä½“æµç¨‹\" href=\"#æ•´ä½“æµç¨‹\"></a></h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">GetExample</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// æ ¸ç½‘ç»œç®¡ç†è€… - æ ¸å¿ƒç±»</span></span><br><span class=\"line\">  <span class=\"keyword\">final</span> OkHttpClient client = <span class=\"keyword\">new</span> OkHttpClient();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\">String <span class=\"title\">run</span><span class=\"params\">(String url)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// è¯·æ±‚æ­å»º</span></span><br><span class=\"line\">    Request request = <span class=\"keyword\">new</span> Request.Builder().url(url).build();</span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">      é˜»å¡å¼execute -&gt; ç«‹å³è°ƒç”¨è¯·æ±‚ï¼Œå¹¶é˜»å¡ï¼Œç›´åˆ°å“åº”å¯ä»¥å¤„ç†æˆ–å‡ºç°é”™è¯¯</span></span><br><span class=\"line\"><span class=\"comment\">      ä¸ºäº†é¿å…èµ„æºæ³„æ¼ï¼Œè°ƒç”¨è€…åº”è¯¥å…³é—­Responseï¼Œè€ŒResponseåˆä¼šå…³é—­åº•å±‚çš„ResponseBodyã€‚ //ç¡®ä¿å“åº”(å’Œåº•å±‚å“åº”ä½“)æ˜¯å…³é—­çš„</span></span><br><span class=\"line\"><span class=\"comment\">      æ³¨æ„ï¼Œä¼ è¾“å±‚çš„æˆåŠŸ(æ¥æ”¶HTTPå“åº”ä»£ç ã€æŠ¥å¤´å’Œæ­£æ–‡)ä¸ä¸€å®šè¡¨ç¤ºåº”ç”¨å±‚çš„æˆåŠŸ:å“åº”å¯èƒ½ä»ç„¶è¡¨ç¤ºä¸æ»¡æ„çš„HTTPå“åº”ä»£ç ï¼Œå¦‚404æˆ–500ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span> (Response response = client.newCall(request).execute()) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> response.body().string();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">    GetExample example = <span class=\"keyword\">new</span> GetExample();</span><br><span class=\"line\">    String response = example.run(<span class=\"string\">&quot;https://raw.github.com/square/okhttp/master/README.md&quot;</span>);</span><br><span class=\"line\">    System.out.println(response);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://z3.ax1x.com/2021/10/25/5hiy4O.png\" alt=\"5hiy4O.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h3 id=\"è¿æ¥å»ºç«‹\">è¿æ¥å»ºç«‹<a title=\"#è¿æ¥å»ºç«‹\" href=\"#è¿æ¥å»ºç«‹\"></a></h3>\n<p>Volleyç­‰å¾ˆå¤šç½‘ç»œè¯·æ±‚æ¡†æ¶å¾ˆå¤šåº•å±‚éƒ½æ˜¯é€šè¿‡ HTTPURLConnection æ¥ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥çš„ï¼Œè€Œ OkHttp å°±æ¯”è¾ƒä¼˜ç§€äº†ã€‚å› ä¸º HTTP åè®®æ˜¯å»ºç«‹åœ¨ TCP/IP åè®®åŸºç¡€ä¹‹ä¸Šçš„ï¼Œåº•å±‚è¿˜æ˜¯èµ°çš„ Socketï¼Œæ‰€ä»¥OkHttp ç›´æ¥ä½¿ç”¨ Socket æ¥å®Œæˆ HTTP è¯·æ±‚ã€‚</p>\n<h3 id=\"okhttpclient\">OkHttpClient<a title=\"#okhttpclient\" href=\"#okhttpclient\"></a></h3>\n<p>å®˜æ–¹æ¨èæˆ‘ä»¬ä½¿ç”¨å•ä¾‹å»åˆ›å»ºOkHttpClientï¼Œé‡ç”¨æ‰€æœ‰HTTPè°ƒç”¨çš„æ—¶å€™ï¼Œæ€§èƒ½æ˜¯æœ€ä½³çš„ï¼Œ è¿™æ˜¯å› ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯éƒ½æ‹¥æœ‰è‡ªå·±çš„è¿æ¥æ± å’Œçº¿ç¨‹æ± ã€‚ é‡ç”¨è¿æ¥å’Œçº¿ç¨‹å¯å‡å°‘å»¶è¿Ÿå¹¶èŠ‚çœå†…å­˜ã€‚ ç›¸åï¼Œä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯ä¼šæµªè´¹ç©ºé—²æ± ä¸Šçš„èµ„æº</p>\n<h3 id=\"request\">Request<a title=\"#request\" href=\"#request\"></a></h3>\n<p>é‡‡ç”¨Builderçš„æ–¹å¼è¿›è¡Œè®¾è®¡ï¼Œä¸»è¦åŒ…å«äº†urlã€methodã€headersã€bodyå’ŒCacheControlç»„æˆçš„å„ç§é…ç½®é¡¹</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">final</span> Dispatcher dispatcher;  <span class=\"comment\">//åˆ†å‘å™¨</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> Proxy proxy;  <span class=\"comment\">//ä»£ç†</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> List&lt;Protocol&gt; protocols; <span class=\"comment\">//åè®®</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> List&lt;ConnectionSpec&gt; connectionSpecs; <span class=\"comment\">//ä¼ è¾“å±‚ç‰ˆæœ¬å’Œè¿æ¥åè®®</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> List&lt;Interceptor&gt; interceptors; <span class=\"comment\">//æ‹¦æˆªå™¨</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> List&lt;Interceptor&gt; networkInterceptors; <span class=\"comment\">//ç½‘ç»œæ‹¦æˆªå™¨</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> ProxySelector proxySelector; <span class=\"comment\">//ä»£ç†é€‰æ‹©</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> CookieJar cookieJar; <span class=\"comment\">//cookie</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> Cache cache; <span class=\"comment\">//ç¼“å­˜</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> InternalCache internalCache;  <span class=\"comment\">//å†…éƒ¨ç¼“å­˜</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> SocketFactory socketFactory;  <span class=\"comment\">//socket å·¥å‚</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> SSLSocketFactory sslSocketFactory; <span class=\"comment\">//å®‰å…¨å¥—æ¥å±‚socket å·¥å‚ï¼Œç”¨äºHTTPS</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> CertificateChainCleaner certificateChainCleaner; <span class=\"comment\">// éªŒè¯ç¡®è®¤å“åº”è¯ä¹¦ é€‚ç”¨ HTTPS è¯·æ±‚è¿æ¥çš„ä¸»æœºåã€‚</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> HostnameVerifier hostnameVerifier;    <span class=\"comment\">//  ä¸»æœºåå­—ç¡®è®¤</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> CertificatePinner certificatePinner;  <span class=\"comment\">//  è¯ä¹¦é“¾</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> Authenticator proxyAuthenticator;     <span class=\"comment\">//ä»£ç†èº«ä»½éªŒè¯</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> Authenticator authenticator;      <span class=\"comment\">// æœ¬åœ°èº«ä»½éªŒè¯</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> ConnectionPool connectionPool;    <span class=\"comment\">//è¿æ¥æ± ,å¤ç”¨è¿æ¥</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> Dns dns;  <span class=\"comment\">//åŸŸå</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> followSslRedirects;  <span class=\"comment\">//å®‰å…¨å¥—æ¥å±‚é‡å®šå‘</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> followRedirects;  <span class=\"comment\">//æœ¬åœ°é‡å®šå‘</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> retryOnConnectionFailure; <span class=\"comment\">//é‡è¯•è¿æ¥å¤±è´¥</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">int</span> connectTimeout;    <span class=\"comment\">//è¿æ¥è¶…æ—¶</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">int</span> readTimeout; <span class=\"comment\">//read è¶…æ—¶</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">int</span> writeTimeout; <span class=\"comment\">//write è¶…æ—¶ </span></span><br></pre></td></tr></table></figure>\n<h3 id=\"call\">Call<a title=\"#call\" href=\"#call\"></a></h3>\n<blockquote>\n<p>ä¸€ä¸ªæä¾› HTTP è¯·æ±‚æ‰§è¡Œç›¸å…³æ¥å£çš„æ¥å£ç±»ï¼Œå…·ä½“çš„å®ç°ç±»æ˜¯ RealCall</p>\n</blockquote>\n<ul>\n<li>å¯ä»¥å–æ¶ˆ</li>\n<li>æ­¤å¯¹è±¡è¡¨ç¤ºå•ä¸ªè¯·æ±‚/å“åº”å¯¹(æµ),å› æ­¤ä¸èƒ½æ‰§è¡Œä¸¤æ¬¡</li>\n</ul>\n<h4 id=\"realcall\">RealCall<a title=\"#realcall\" href=\"#realcall\"></a></h4>\n<blockquote>\n<p>OkHttpçš„åº”ç”¨å±‚å’Œç½‘ç»œå±‚ä¹‹é—´çš„æ¡¥æ¢,åŒ…å«äº†ç½‘ç»œçš„è¿æ¥ã€è¯·æ±‚ã€å“åº”å’Œæµå¤„ç†æ•´ä¸ªæµç¨‹,ä¹Ÿæ˜¯OkHttpä¸­æœ€å…³é”®æ ¸å¿ƒçš„ç±»</p>\n</blockquote>\n<h5 id=\"asynctimeout\">AsyncTimeout<a title=\"#asynctimeout\" href=\"#asynctimeout\"></a></h5>\n<p>æ­¤è¶…æ—¶ç”¨åœ¨åœ¨åå°çº¿ç¨‹æ‰§è¡Œè¶…æ—¶æ—¶æ‰§è¡Œæ“ä½œã€‚ ä½¿ç”¨å®ƒæ¥å®ç°æœ¬åœ°ä¸æ”¯æŒçš„è¶…æ—¶ï¼Œä¾‹å¦‚å†™å…¥æ—¶è¢«é˜»æ­¢çš„å¥—æ¥å­—,å­ç±»åº”è¯¥è¦†ç›–timedOutä»¥åœ¨å‘ç”Ÿè¶…æ—¶æ—¶é‡‡å–è¡ŒåŠ¨ã€‚ æ­¤æ–¹æ³•å°†ç”±å…±äº«çœ‹é—¨ç‹—çº¿ç¨‹è°ƒç”¨ï¼Œå› æ­¤ä¸åº”æ‰§è¡Œä»»ä½•é•¿æ—¶é—´è¿è¡Œçš„æ“ä½œã€‚ å¦åˆ™ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé¢ä¸´è§¦å‘å…¶ä»–è¶…æ—¶çš„é£é™©ã€‚<br>\nä½¿ç”¨sinkå’Œsourceå°†æ­¤è¶…æ—¶åº”ç”¨äºæµã€‚ è¿”å›çš„å€¼å°†è¶…æ—¶åº”ç”¨äºåŒ…è£…æµä¸Šçš„æ¯ä¸ªæ“ä½œã€‚<br>\nè°ƒç”¨è€…åº”è¯¥åœ¨æ‰§è¡Œå¯èƒ½è¶…æ—¶çš„å·¥ä½œä¹‹å‰è°ƒç”¨enter ï¼Œç„¶åé€€å‡ºã€‚ exitçš„è¿”å›å€¼è¡¨ç¤ºæ˜¯å¦è§¦å‘äº†è¶…æ—¶ã€‚ è¯·æ³¨æ„ï¼Œå¯¹timedOutçš„è°ƒç”¨æ˜¯å¼‚æ­¥çš„ï¼Œå¯ä»¥åœ¨exitä¹‹åè°ƒç”¨</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> val timeout = object : AsyncTimeout() &#123;  </span><br><span class=\"line\">  <span class=\"function\">override fun <span class=\"title\">timedOut</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">    <span class=\"comment\">// å–æ¶ˆè¯·æ±‚  </span></span><br><span class=\"line\">  cancel()  </span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\">&#125;.apply &#123;  </span><br><span class=\"line\">  timeout(client.callTimeoutMillis.toLong(), MILLISECONDS)  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"execute\">execute<a title=\"#execute\" href=\"#execute\"></a></h5>\n<blockquote>\n<p>åŒæ­¥è¯·æ±‚,  é©¬ä¸Šæ‰§è¡Œå¹¶é˜»å¡ç›´åˆ°å¯ä»¥å¤„ç†å“åº”æˆ–å‡ºç°é”™è¯¯</p>\n</blockquote>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">execute</span><span class=\"params\">()</span></span>: Response &#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * Atomicå°±æ˜¯åŸå­æ€§çš„æ„æ€ï¼Œæºç é‡Œç”¨äº†Volatileå±æ€§ï¼Œå³èƒ½å¤Ÿä¿è¯åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®è¿™ä¸ªå±æ€§å€¼</span></span><br><span class=\"line\"><span class=\"comment\">   * executed æ˜¯ä¸€ä¸ªåŸå­å˜é‡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ AtomicBoolean é«˜æ•ˆå¹¶å‘å¤„ç† â€œåªåˆå§‹åŒ–ä¸€æ¬¡â€ çš„åŠŸèƒ½è¦æ±‚,ç”¨ compareAndSet(false, true)</span></span><br><span class=\"line\"><span class=\"comment\">   * åˆ¤æ–­å¤šçº¿ç¨‹çŠ¶æ€ä¸‹ï¼Œè¯·æ±‚æ˜¯å¦é‡æ–°æ‰§è¡Œï¼šå¦‚æœå€¼ä¸ºfalseï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªIllegalStateExceptionï¼Œå¹¶è¿”å›è°ƒç”¨lazyMessageçš„ç»“æœã€‚</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  check(executed.compareAndSet(<span class=\"literal\">false</span>, <span class=\"literal\">true</span>)) &#123; <span class=\"string\">&quot;Already Executed&quot;</span> &#125;</span><br><span class=\"line\">  <span class=\"comment\">// è¶…æ—¶è®¡æ•°å¼€å§‹</span></span><br><span class=\"line\">  timeout.enter()</span><br><span class=\"line\">  <span class=\"comment\">// æ‰§è¡Œè¯·æ±‚å‰å¤„ç† -&gt; æ ˆè·Ÿè¸ªï¼Œäº‹ä»¶å›è°ƒç­‰ç­‰</span></span><br><span class=\"line\">  callStart()</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// è°ƒåº¦å™¨å¼€å§‹æ‰§è¡Œ</span></span><br><span class=\"line\">    client.dispatcher.executed(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">    <span class=\"comment\">// è¿”å›æ‹¦æˆªå™¨å¤„ç†ä¸‹çš„å“åº”</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> getResponseWithInterceptorChain()</span><br><span class=\"line\">  &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// è°ƒåº¦å™¨è¿”å›å®Œæˆä¿¡å·</span></span><br><span class=\"line\">    client.dispatcher.finished(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"enqueue\">enqueue<a title=\"#enqueue\" href=\"#enqueue\"></a></h5>\n<blockquote>\n<p>å¼‚æ­¥è°ƒåº¦,  å°†è¯·æ±‚æ”¾åˆ°é˜Ÿåˆ—ä¸­ç­‰åˆ°æ‰§è¡Œ</p>\n</blockquote>\n<p>RealCall.kt</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">enqueue</span><span class=\"params\">(responseCallback: <span class=\"type\">Callback</span>)</span></span> &#123;  </span><br><span class=\"line\">  <span class=\"comment\">// é¦–å…ˆåˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦å·²æ‰§è¡Œï¼Œå¦‚æœå·²ç»æ‰§è¡Œåˆ™æ‰“å°æ—¥å¿—ï¼Œå¹¶æŠ›å‡º IllegalStateException å¼‚å¸¸</span></span><br><span class=\"line\">  check(executed.compareAndSet(<span class=\"literal\">false</span>, <span class=\"literal\">true</span>)) &#123; <span class=\"string\">&quot;Already Executed&quot;</span> &#125;  </span><br><span class=\"line\">  callStart()  </span><br><span class=\"line\">  <span class=\"comment\">// åˆ›å»ºä¸€ä¸ªAsyncCallå¯¹è±¡,æ”¾è¿›åˆ†å‘å™¨é˜Ÿåˆ—ä¸­</span></span><br><span class=\"line\">  client.dispatcher.enqueue(AsyncCall(responseCallback))  </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">callStart</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«åœ¨æ‰§è¡Œæ­¤æ–¹æ³•æ—¶åˆ›å»ºçš„å †æ ˆè·Ÿè¸ª</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.callStackTrace = Platform.<span class=\"keyword\">get</span>().getStackTraceForCloseable(<span class=\"string\">&quot;response.body().close()&quot;</span>)</span><br><span class=\"line\">    eventListener.callStart(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Dispatcher.kt</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">///////////////////////////////////////////////////////////////////////////</span></span><br><span class=\"line\"><span class=\"comment\">// https://zhuanlan.zhihu.com/p/261397170</span></span><br><span class=\"line\"><span class=\"comment\">// ArrayDeque -  Java é›†åˆä¸­åŒç«¯é˜Ÿåˆ—çš„æ•°ç»„å®ç°</span></span><br><span class=\"line\"><span class=\"comment\">// ArrayDeque å‡ ä¹æ²¡æœ‰å®¹é‡é™åˆ¶ï¼Œè®¾è®¡ä¸ºçº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œç¦æ­¢ null å…ƒç´ </span></span><br><span class=\"line\"><span class=\"comment\">// ArrayDequeæ˜¯Dequeçš„å®ç°ç±»ï¼Œå¯ä»¥ä½œä¸ºæ ˆæ¥ä½¿ç”¨ï¼Œæ•ˆç‡é«˜äºStackï¼›ä¹Ÿå¯ä»¥ä½œä¸ºé˜Ÿåˆ—æ¥ä½¿ç”¨ï¼Œæ•ˆç‡é«˜äºLinkedListã€‚</span></span><br><span class=\"line\"><span class=\"comment\">// ArrayDeque å¤§å¤šæ•°çš„é¢æ“ä½œéƒ½åœ¨å›ºå®šæ—¶é—´å†…è¿è¡Œï¼Œä¾‹å¤–æƒ…å†µåŒ…æ‹¬ removeï¼ŒremoveFirstOccurrenceï¼ŒremoveLastOccurrenceï¼Œcontainsï¼Œiterator.remove()ï¼Œå’Œæ‰¹é‡æ“ä½œï¼Œè¿™äº›å°†ä»¥çº¿æ€§æ—¶é—´è¿è¡Œ</span></span><br><span class=\"line\"><span class=\"comment\">///////////////////////////////////////////////////////////////////////////</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">val</span> runningSyncCalls = ArrayDeque&lt;RealCall&gt;()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">internal</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">enqueue</span><span class=\"params\">(call: <span class=\"type\">AsyncCall</span>)</span></span> &#123;</span><br><span class=\"line\">  synchronized(<span class=\"keyword\">this</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å°†è¯·æ±‚ AsyncCall æ·»åŠ åˆ°å¾…æ‰§è¡Œé˜Ÿåˆ—</span></span><br><span class=\"line\">    readyAsyncCalls.add(call)</span><br><span class=\"line\">    <span class=\"comment\">// åˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦å·²å­˜åœ¨å¯å¤ç”¨çš„ hos</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!call.call.forWebSocket) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">val</span> existingCall = findExistingCallWithHost(call.host)</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (existingCall != <span class=\"literal\">null</span>) call.reuseCallsPerHostFrom(existingCall)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å°†ç¬¦åˆæ¡ä»¶çš„Callä»readyAsyncCalls æå‡åˆ°runningAsyncCallså¹¶åœ¨æ‰§è¡Œå®ƒä»¬</span></span><br><span class=\"line\">  promoteAndExecute()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>RealCall.AsyncCall</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">run</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ç»™å½“å‰AsyncCallå¼‚æ­¥çº¿ç¨‹è®¾ç½®åç§°</span></span><br><span class=\"line\">    threadName(<span class=\"string\">&quot;OkHttp <span class=\"subst\">$&#123;redactedUrl()&#125;</span>&quot;</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> signalledCallback = <span class=\"literal\">false</span></span><br><span class=\"line\">      timeout.enter()</span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// è·å–è¯·æ±‚ç»“æœ</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> response = getResponseWithInterceptorChain()</span><br><span class=\"line\">        signalledCallback = <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"comment\">// è§¦å‘ç›¸åº”å›è°ƒ</span></span><br><span class=\"line\">        responseCallback.onResponse(<span class=\"keyword\">this</span><span class=\"symbol\">@RealCall</span>, response)</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (e: IOException) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (signalledCallback) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// Do not signal the callback twice!</span></span><br><span class=\"line\">          Platform.<span class=\"keyword\">get</span>().log(<span class=\"string\">&quot;Callback failure for <span class=\"subst\">$&#123;toLoggableString()&#125;</span>&quot;</span>, Platform.INFO, e)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          responseCallback.onFailure(<span class=\"keyword\">this</span><span class=\"symbol\">@RealCall</span>, e)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (t: Throwable) &#123;</span><br><span class=\"line\">        cancel()</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!signalledCallback) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">val</span> canceledException = IOException(<span class=\"string\">&quot;canceled due to <span class=\"variable\">$t</span>&quot;</span>)</span><br><span class=\"line\">          canceledException.addSuppressed(t)</span><br><span class=\"line\">          responseCallback.onFailure(<span class=\"keyword\">this</span><span class=\"symbol\">@RealCall</span>, canceledException)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> t</span><br><span class=\"line\">      &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// å…³é—­è¯·æ±‚</span></span><br><span class=\"line\">        client.dispatcher.finished(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"dispatcher(åˆ†å‘å™¨)\">Dispatcher(åˆ†å‘å™¨)<a title=\"#dispatcher(åˆ†å‘å™¨)\" href=\"#dispatcher(åˆ†å‘å™¨)\"></a></h3>\n<blockquote>\n<p>ç”¨äºç®¡ç†å…¶å¯¹åº” OkHttpClient çš„æ‰€æœ‰è¯·æ±‚,å¯¹Callè¿›è¡Œç»Ÿä¸€çš„æ§åˆ¶ï¼Œä¾‹å¦‚ç»“æŸæ‰€æœ‰è¯·æ±‚ã€è·å–çº¿ç¨‹æ± ç­‰ç­‰</p>\n</blockquote>\n<ul>\n<li>readyAsyncCallsï¼šä¸€ä¸ªæ–°çš„å¼‚æ­¥è¯·æ±‚é¦–å…ˆä¼šè¢«åŠ å…¥è¯¥é˜Ÿåˆ—ä¸­</li>\n<li>runningAsyncCallsï¼šå½“å‰æ­£åœ¨è¿è¡Œä¸­çš„å¼‚æ­¥è¯·æ±‚</li>\n<li>runningSyncCallsï¼šå½“å‰æ­£åœ¨è¿è¡Œçš„åŒæ­¥è¯·æ±‚</li>\n</ul>\n<p>å¼‚æ­¥è¯·æ±‚è·ŸåŒæ­¥è¯·æ±‚ä¸€æ ·,æœ€ç»ˆéƒ½ä¼šè°ƒç”¨åˆ°<code>getResponseWithInterceptorChain()</code></p>\n<h3 id=\"interceptor(æ‹¦æˆªå™¨)\">Interceptor(æ‹¦æˆªå™¨)<a title=\"#interceptor(æ‹¦æˆªå™¨)\" href=\"#interceptor(æ‹¦æˆªå™¨)\"></a></h3>\n<blockquote>\n<p>Interceptor æ¥å£ä½œä¸ºä¸€ä¸ªæ‹¦æˆªå™¨çš„æŠ½è±¡æ¦‚å¿µï¼Œè¢«è®¾è®¡ä¸ºè´£ä»»é“¾ä¸Šçš„å•ä½èŠ‚ç‚¹ï¼Œç”¨äºè§‚å¯Ÿã€æ‹¦æˆªã€å¤„ç†è¯·æ±‚ç­‰ï¼Œä¾‹å¦‚æ·»åŠ  Headerã€é‡å®šå‘ã€æ•°æ®å¤„ç†ç­‰ç­‰ã€‚<br>\nInterceptor ä¹‹é—´äº’ç›¸ç‹¬ç«‹ï¼Œæ¯ä¸ª Interceptor åªè´Ÿè´£è‡ªå·±å…³æ³¨çš„ä»»åŠ¡ï¼Œä¸ä¸å…¶ä»– Interceptor æ¥è§¦ã€‚</p>\n</blockquote>\n<p>RealCall.kt</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Throws(IOException::class)</span></span><br><span class=\"line\"><span class=\"keyword\">internal</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getResponseWithInterceptorChain</span><span class=\"params\">()</span></span>: Response &#123;</span><br><span class=\"line\">  <span class=\"comment\">// <span class=\"doctag\">TODO:</span> 2021/8/13 okhttpçš„æ ¸å¿ƒæ˜¯æ‹¦æˆªå™¨ï¼Œè€Œæ‹¦æˆªå™¨æ‰€é‡‡ç”¨çš„è®¾è®¡æ¨¡å¼æ˜¯è´£ä»»é“¾è®¾è®¡ï¼Œå³æ¯ä¸ªæ‹¦æˆªå™¨åªå¤„ç†ä¸è‡ªå·±ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ https://zhuanlan.zhihu.com/p/340090732</span></span><br><span class=\"line\">  <span class=\"comment\">// æ„å»ºæ•´ä¸ªç½‘ç»œè¯·æ±‚æ‹¦æˆª</span></span><br><span class=\"line\">  <span class=\"keyword\">val</span> interceptors = mutableListOf&lt;Interceptor&gt;()</span><br><span class=\"line\">  <span class=\"comment\">// æ·»åŠ Clientçš„æ‹¦æˆªå™¨</span></span><br><span class=\"line\">  interceptors += client.interceptors</span><br><span class=\"line\">  <span class=\"comment\">// æ·»åŠ å¤±è´¥é‡è¿çš„æ‹¦æˆªå™¨</span></span><br><span class=\"line\">  interceptors += RetryAndFollowUpInterceptor(client)</span><br><span class=\"line\">  <span class=\"comment\">// æ·»åŠ è¯·æ±‚æ¡¥æ¢æ‹¦æˆªå™¨ - åœ¨å¯¹ç”¨æˆ·çš„è¯·æ±‚å¤´éƒ¨åŠ äº†ä¸€äº›ä¿¡æ¯ï¼Œç„¶ååœ¨è·å–åˆ°çš„å“åº”ä¸­ä¹Ÿåšäº†ä¸€äº›å¤„ç†ã€‚è€Œè¿™äº›å¤„ç†å¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ï¼Œå‡å°‘äº†å®¢æˆ·è¯·æ±‚çš„å·¥ä½œ</span></span><br><span class=\"line\">  interceptors += BridgeInterceptor(client.cookieJar)</span><br><span class=\"line\">  <span class=\"comment\">// æ·»åŠ ç¼“å­˜æ‹¦æˆªå™¨ - ç†æ¥è‡ªç¼“å­˜çš„è¯·æ±‚å¹¶å°†å“åº”å†™å…¥ç¼“å­˜ã€‚</span></span><br><span class=\"line\">  interceptors += CacheInterceptor(client.cache)</span><br><span class=\"line\">  <span class=\"comment\">// æ·»åŠ è¯·æ±‚ä¸­æ‹¦æˆªå™¨ - æ‰“å¼€ä¸ç›®æ ‡æœåŠ¡å™¨çš„è¿æ¥å¹¶ç»§ç»­ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨ã€‚ ç½‘ç»œå¯èƒ½ç”¨äºè¿”å›çš„å“åº”ï¼Œæˆ–ä½¿ç”¨æ¡ä»¶ GET éªŒè¯ç¼“å­˜çš„å“åº”</span></span><br><span class=\"line\">  interceptors += ConnectInterceptor</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!forWebSocket) &#123;</span><br><span class=\"line\">    interceptors += client.networkInterceptors</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// è¿™æ˜¯é“¾ä¸­çš„æœ€åä¸€ä¸ªæ‹¦æˆªå™¨ã€‚ å®ƒå¯¹æœåŠ¡å™¨è¿›è¡Œç½‘ç»œè°ƒç”¨,çœŸæ­£çš„ç½‘ç»œè¯·æ±‚ä»è¿™é‡Œå¼€å§‹</span></span><br><span class=\"line\">  interceptors += CallServerInterceptor(forWebSocket)</span><br><span class=\"line\">  <span class=\"comment\">// æ„å»ºç½‘ç»œè¯·æ±‚é“¾ - ä¸€ä¸ªå…·ä½“çš„æ‹¦æˆªå™¨é“¾ï¼Œæ‰¿è½½ç€æ•´ä¸ªæ‹¦æˆªå™¨é“¾ï¼šæ‰€æœ‰åº”ç”¨ç¨‹åºæ‹¦æˆªå™¨ã€OkHttpæ ¸å¿ƒã€æ‰€æœ‰ç½‘ç»œæ‹¦æˆªå™¨ï¼Œæœ€åæ˜¯ç½‘ç»œè°ƒç”¨è€…ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">val</span> chain = RealInterceptorChain(</span><br><span class=\"line\">      call = <span class=\"keyword\">this</span>,</span><br><span class=\"line\">      interceptors = interceptors,</span><br><span class=\"line\">      index = <span class=\"number\">0</span>,</span><br><span class=\"line\">      exchange = <span class=\"literal\">null</span>,</span><br><span class=\"line\">      request = originalRequest,</span><br><span class=\"line\">      connectTimeoutMillis = client.connectTimeoutMillis,</span><br><span class=\"line\">      readTimeoutMillis = client.readTimeoutMillis,</span><br><span class=\"line\">      writeTimeoutMillis = client.writeTimeoutMillis</span><br><span class=\"line\">  )</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> calledNoMoreExchanges = <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">val</span> response = chain.proceed(originalRequest)</span><br><span class=\"line\">    <span class=\"comment\">// æ˜¯å¦å–æ¶ˆè¯·æ±‚</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isCanceled()) &#123;</span><br><span class=\"line\">      response.closeQuietly()</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> IOException(<span class=\"string\">&quot;Canceled&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> response</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (e: IOException) &#123;</span><br><span class=\"line\">    calledNoMoreExchanges = <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"keyword\">throw</span> noMoreExchanges(e) <span class=\"keyword\">as</span> Throwable</span><br><span class=\"line\">  &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!calledNoMoreExchanges) &#123;</span><br><span class=\"line\">      noMoreExchanges(<span class=\"literal\">null</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>RealInterceptorChain.kt</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Throws(IOException::class)</span></span><br><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">proceed</span><span class=\"params\">(request: <span class=\"type\">Request</span>)</span></span>: Response &#123;</span><br><span class=\"line\">  <span class=\"comment\">// åˆ¤æ–­æ‹¦æˆªå™¨æ˜¯å¦ä¸ºç©º</span></span><br><span class=\"line\">  check(index &lt; interceptors.size)</span><br><span class=\"line\">  <span class=\"comment\">// è¯·æ±‚æ•°åŠ 1</span></span><br><span class=\"line\">  calls++</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (exchange != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    check(exchange.finder.sameHostAndPort(request.url)) &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;network interceptor <span class=\"subst\">$&#123;interceptors[index - <span class=\"number\">1</span>]&#125;</span> must retain the same host and port&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    check(calls == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;network interceptor <span class=\"subst\">$&#123;interceptors[index - <span class=\"number\">1</span>]&#125;</span> must call proceed() exactly once&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// Call the next interceptor in the chain. è°ƒç”¨é“¾ä¸­çš„ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨</span></span><br><span class=\"line\">  <span class=\"keyword\">val</span> next = copy(index = index + <span class=\"number\">1</span>, request = request)</span><br><span class=\"line\">  <span class=\"comment\">// è·å–å½“å‰çš„æ‹¦æˆªå™¨</span></span><br><span class=\"line\">  <span class=\"keyword\">val</span> interceptor = interceptors[index]</span><br><span class=\"line\">  <span class=\"comment\">// å¼€å§‹ä¸€ä¸ªä¸ªçš„æ‰§è¡Œæ¯ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œæ¯ä¸ªæ‹¦æˆªå™¨çš„interceptéƒ½ä¼šè°ƒåˆ° å½“å‰ç±»çš„proceed ï¼Œç›´è‡³æœ€åä¸€ä¸ªCallServerInterceptoræ‰§è¡Œå®Œ</span></span><br><span class=\"line\">  <span class=\"meta\">@Suppress(<span class=\"meta-string\">&quot;USELESS_ELVIS&quot;</span>)</span></span><br><span class=\"line\">  <span class=\"keyword\">val</span> response = interceptor.intercept(next) ?: <span class=\"keyword\">throw</span> NullPointerException(<span class=\"string\">&quot;interceptor <span class=\"variable\">$interceptor</span> returned null&quot;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (exchange != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    check(index + <span class=\"number\">1</span> &gt;= interceptors.size || next.calls == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      <span class=\"string\">&quot;network interceptor <span class=\"variable\">$interceptor</span> must call proceed() exactly once&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  check(response.body != <span class=\"literal\">null</span>) &#123; <span class=\"string\">&quot;interceptor <span class=\"variable\">$interceptor</span> returned a response with no body&quot;</span> &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> response</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"chain\">Chain<a title=\"#chain\" href=\"#chain\"></a></h4>\n<blockquote>\n<p>Interceptor ä¸ Chain å½¼æ­¤äº’ç›¸ä¾èµ–ï¼Œäº’ç›¸è°ƒç”¨ï¼Œå…±åŒå‘å±•ï¼Œå½¢æˆäº†ä¸€ä¸ªå®Œç¾çš„è°ƒç”¨é“¾</p>\n</blockquote>\n<p>Chain è¢«ç”¨æ¥æè¿°è´£ä»»é“¾ï¼Œé€šè¿‡å…¶ä¸­çš„ process æ–¹æ³•å¼€å§‹ä¾æ¬¡æ‰§è¡Œé“¾ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œå¹¶è¿”å›å¤„ç†åçš„ Responseã€‚<br>\nChain çš„å”¯ä¸€å®ç°ä¸º RealInterceptorChainï¼ˆä¸‹æ–‡ç®€ç§° RICï¼‰ï¼ŒRIC å¯ä»¥ç§°ä¹‹ä¸º<strong>æ‹¦æˆªå™¨è´£ä»»é“¾</strong>ï¼Œå…¶ä¸­çš„èŠ‚ç‚¹ç”± RealCall ä¸­æ·»åŠ è¿›æ¥çš„ Interceptor ä»¬ç»„æˆã€‚ç”±äº Interceptor çš„äº’ç›¸ç‹¬ç«‹æ€§ï¼ŒRIC ä¸­è¿˜ä¼šåŒ…å«ä¸€äº›å…¬å…±å‚æ•°åŠå…±äº«çš„å¯¹è±¡ã€‚</p>\n<p><img src=\"https://z3.ax1x.com/2021/10/25/5hbpJx.png\" alt=\"5hbpJx.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h3 id=\"about\">About<a title=\"#about\" href=\"#about\"></a></h3>\n<p><a href=\"https://zhuanlan.zhihu.com/p/116777864\" target=\"_blank\">OkHttpæºç æ·±åº¦è§£æ</a><br>\n<a href=\"https://zhuanlan.zhihu.com/p/104813091\" target=\"_blank\">OkHttpæºç è§£æ</a><br>\n<a href=\"https://juejin.cn/post/7020027832977850381\" target=\"_blank\">OkHttpæºç åŸç†</a></p>\n",
            "tags": [
                "æºç è§£æ"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/01/5FIszA6Ut2OHE8Sg/",
            "url": "https://onion99.github.io/2021/11/01/5FIszA6Ut2OHE8Sg/",
            "title": "å®‰å“ä¼˜åŒ–-å¸ƒå±€ä¼˜åŒ–",
            "date_published": "2021-10-31T20:50:14.000Z",
            "content_html": "<h3 id=\"å¸ƒå±€è€—æ—¶ç»Ÿè®¡\">å¸ƒå±€è€—æ—¶ç»Ÿè®¡<a title=\"#å¸ƒå±€è€—æ—¶ç»Ÿè®¡\" href=\"#å¸ƒå±€è€—æ—¶ç»Ÿè®¡\"></a></h3>\n<ul>\n<li>æ‰‹åŠ¨åŸ‹ç‚¹</li>\n<li>AOP/ArtHook\n<ul>\n<li>åˆ‡å…¥Activityçš„setContentView</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"å¸ƒå±€åŠ è½½ä¼˜åŒ–\">å¸ƒå±€åŠ è½½ä¼˜åŒ–<a title=\"#å¸ƒå±€åŠ è½½ä¼˜åŒ–\" href=\"#å¸ƒå±€åŠ è½½ä¼˜åŒ–\"></a></h3>\n<ul>\n<li>ä»£ç å†™å¸ƒå±€\n<ul>\n<li>Javaä»£ç å†™å¸ƒå±€</li>\n<li>Anko</li>\n<li>JetpackCompose</li>\n</ul>\n</li>\n<li>X2C</li>\n<li>Litho</li>\n</ul>\n<span id=\"more\"></span>\n<h3 id=\"è§†å›¾ç»˜åˆ¶ä¼˜åŒ–\">è§†å›¾ç»˜åˆ¶ä¼˜åŒ–<a title=\"#è§†å›¾ç»˜åˆ¶ä¼˜åŒ–\" href=\"#è§†å›¾ç»˜åˆ¶ä¼˜åŒ–\"></a></h3>\n<ul>\n<li>ä¼˜åŒ–å¸ƒå±€å±‚çº§ä»¥åŠåµŒå¥—\n<ul>\n<li>ä½¿ç”¨ConstraintLayout</li>\n</ul>\n</li>\n<li>é¿å…è¿‡åº¦ç»˜åˆ¶,è‡ªå®šä¹‰Viewé¿å…å¤šæ¬¡è°ƒç”¨ onDraw,onMeasure</li>\n<li>å…¶ä»–\n<ul>\n<li>ViewStub: å»¶è¿Ÿåˆå§‹åŒ–</li>\n<li>onDraw,onMeasureä¸­é¿å…åˆ›å»ºå¤§å¯¹è±¡,è€—æ—¶æ“ä½œ</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"include\">Include<a title=\"#include\" href=\"#include\"></a></h4>\n<blockquote>\n<p>æé«˜å¸ƒå±€å¤ç”¨æ€§</p>\n</blockquote>\n<p>login.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">include</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">&quot;match_parent&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">&quot;40dp&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">layout</span>=<span class=\"string\">&quot;@layout/titlebar&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<p>includeæ‰€åœ¨çš„layoutçš„å¸ƒå±€æœ‰ç»™å…¶è®¾ç½®id, è€Œincludeæ ‡ç­¾é‡Œé¢åˆç»™è‡ªå·±çš„æ ¹å®¹å™¨è®¾ç½®id,æœ€å¥½ä¸¤ä¸ªidéƒ½ç›¸åŒ,å¦åˆ™findviewæ—¶æ‹¿åˆ°ç©ºå¯¹è±¡</p>\n<h4 id=\"merge\">Merge<a title=\"#merge\" href=\"#merge\"></a></h4>\n<blockquote>\n<p>å¸®åŠ©includeæ ‡ç­¾æ’é™¤å¤šä½™çš„ä¸€å±‚ViewGroupå®¹å™¨ï¼Œå‡å°‘view hierarchyçš„ç»“æ„ï¼Œæå‡UIæ¸²æŸ“çš„æ€§èƒ½</p>\n</blockquote>\n<p>titlebar.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">merge</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">Button</span> </span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">&quot;match_parent&quot;</span>  </span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">&quot;wrap_content&quot;</span>  </span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_marginLeft</span>=<span class=\"string\">&quot;20dp&quot;</span>  </span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_marginRight</span>=<span class=\"string\">&quot;20dp&quot;</span>  </span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">&quot;æ ‡é¢˜&quot;</span> /&gt;</span>  </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">merge</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>å› ä¸ºmergeæ ‡ç­¾å¹¶ä¸æ˜¯View,æ‰€ä»¥åœ¨é€šè¿‡LayoutInflate.inflate()æ–¹æ³•æ¸²æŸ“çš„æ—¶å€™,ç¬¬äºŒä¸ªå‚æ•°å¿…é¡»æŒ‡å®šä¸€ä¸ªçˆ¶å®¹å™¨(parent),ä¸”ç¬¬ä¸‰ä¸ªå‚æ•°(attachToRoot)å¿…é¡»ä¸ºtrue</li>\n<li>mergeæ ‡ç­¾å¿…é¡»ä½¿ç”¨åœ¨æ ¹å¸ƒå±€ï¼Œå¹¶ä¸”ViewStubæ ‡ç­¾ä¸­çš„layoutå¸ƒå±€ä¸èƒ½ä½¿ç”¨mergeæ ‡ç­¾</li>\n</ul>\n<h4 id=\"viewstub\">ViewStub<a title=\"#viewstub\" href=\"#viewstub\"></a></h4>\n<blockquote>\n<p>å»¶è¿Ÿç»˜åˆ¶View</p>\n</blockquote>\n<p>layout.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ViewStub</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:id</span>=<span class=\"string\">&quot;@+id/viewstub&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">&quot;match_parent&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">&quot;wrap_content&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout</span>=<span class=\"string\">&quot;@layout/info&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<p>activity.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ViewStub stub = ((ViewStub) findViewById(R.id.viewstub));</span><br><span class=\"line\"><span class=\"keyword\">if</span>(stub!=<span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">    View stubView = stub.inflate();</span><br><span class=\"line\">    EditText editText = (EditText) stubView.findViewById(R.id.edit_password);  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>ViewStubæ ‡ç­¾ä¸æ”¯æŒmergeæ ‡ç­¾</li>\n<li>ViewStubçš„inflateåªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡,ç¬¬äºŒæ¬¡è°ƒç”¨ä¼šæŠ›å‡ºå¼‚å¸¸</li>\n<li>è™½ç„¶ViewStubæ˜¯ä¸å ç”¨ä»»ä½•ç©ºé—´çš„ï¼Œä½†æ˜¯æ¯ä¸ªå¸ƒå±€éƒ½å¿…é¡»è¦æŒ‡å®šlayout_widthå’Œlayout_heightå±æ€§ï¼Œå¦åˆ™è¿è¡Œå°±ä¼šæŠ¥é”™</li>\n</ul>\n",
            "tags": [
                "æ€§èƒ½ä¼˜åŒ–"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/01/6JN9JxpnRSjVeWry/",
            "url": "https://onion99.github.io/2021/11/01/6JN9JxpnRSjVeWry/",
            "title": "å®‰å“ä¼˜åŒ–-çº¿ç¨‹ä¼˜åŒ–",
            "date_published": "2021-10-31T20:48:51.000Z",
            "content_html": "<h3 id=\"çº¿ç¨‹è°ƒåº¦\">çº¿ç¨‹è°ƒåº¦<a title=\"#çº¿ç¨‹è°ƒåº¦\" href=\"#çº¿ç¨‹è°ƒåº¦\"></a></h3>\n<blockquote>\n<p>ä»»æ„æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å ç”¨CPUï¼Œå¤„äºè¿è¡ŒçŠ¶æ€</p>\n</blockquote>\n<p>å¤šçº¿ç¨‹å¹¶å‘ï¼šè½®æµè·å–cpuä½¿ç”¨æƒ<br>\nJVMè´Ÿè´£çº¿ç¨‹è°ƒåº¦ï¼šæŒ‰ç…§ç‰¹å®šè°ƒåº¦æ¨¡å‹åˆ†é…CPUä½¿ç”¨æƒ</p>\n<h4 id=\"è°ƒåº¦æ¨¡å‹\">è°ƒåº¦æ¨¡å‹<a title=\"#è°ƒåº¦æ¨¡å‹\" href=\"#è°ƒåº¦æ¨¡å‹\"></a></h4>\n<ul>\n<li>åˆ†æ—¶è°ƒåº¦æ¨¡å‹: è½®æµè·å–,å‡åŒ€åˆ†é…cpuæ—¶é—´</li>\n<li>æŠ¢å å¼è°ƒåº¦æ¨¡å‹:  æŒ‰ç…§ä¼˜å…ˆçº§æ¥</li>\n</ul>\n<span id=\"more\"></span>\n<h3 id=\"androidå¼‚æ­¥æ–¹å¼\">Androidå¼‚æ­¥æ–¹å¼<a title=\"#androidå¼‚æ­¥æ–¹å¼\" href=\"#androidå¼‚æ­¥æ–¹å¼\"></a></h3>\n<ul>\n<li>Thread\n<ul>\n<li>æœ€ç®€å•ã€å¸¸è§çš„æ–¹å¼</li>\n<li>ä¸æ˜“å¤ç”¨ï¼Œé¢‘ç¹åˆ›å»ºé”€æ¯å¼€é”€å¤§</li>\n</ul>\n</li>\n<li>HandlerThread\n<ul>\n<li>è‡ªå¸¦æ¶ˆæ¯å¾ªç¯çš„çº¿ç¨‹</li>\n<li>ä¸²è¡Œæ‰§è¡Œ,é•¿æ—¶é—´è¿è¡Œï¼Œä¸æ–­ä»é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡</li>\n</ul>\n</li>\n<li>IntentService\n<ul>\n<li>ç»§æ‰¿è‡ªServiceåœ¨å†…éƒ¨åˆ›å»ºHandlerThread</li>\n<li>å¼‚æ­¥ã€ä¸å ç”¨ä¸»çº¿ç¨‹</li>\n<li>ä¼˜å…ˆçº§é«˜ï¼Œä¸æ˜“è¢«ç³»ç»Ÿkil</li>\n</ul>\n</li>\n<li>AsyncTask\n<ul>\n<li>Androidæä¾›çš„å·¥å…·ç±»</li>\n<li>æ— éœ€è‡ªå·±å¤„ç†çº¿ç¨‹åˆ‡æ¢</li>\n</ul>\n</li>\n<li>çº¿ç¨‹æ± \n<ul>\n<li>jdkæä¾›çš„çº¿ç¨‹æ± </li>\n<li>æ˜“å¤ç”¨ï¼Œå‡å°‘é¢‘ç¹åˆ›å»ºã€é”€æ¯çš„æ—¶é—´</li>\n<li>åŠŸèƒ½å¼ºå¤§ï¼šå®šæ—¶ã€ä»»åŠ¡åˆ—é˜Ÿã€å¹¶å‘æ•°æ§åˆ¶ç­‰</li>\n</ul>\n</li>\n<li>RxJava\n<ul>\n<li>ç”±å¼ºå¤§çš„Scheduleré›†åˆæä¾›</li>\n<li>ä¸åŒç±»å‹çš„åŒºåˆ†ï¼šIOå¯†é›†å‹ã€CPUå¯†é›†å‹</li>\n</ul>\n</li>\n<li>åç¨‹</li>\n</ul>\n<h3 id=\"çº¿ç¨‹ä½¿ç”¨å‡†åˆ™\">çº¿ç¨‹ä½¿ç”¨å‡†åˆ™<a title=\"#çº¿ç¨‹ä½¿ç”¨å‡†åˆ™\" href=\"#çº¿ç¨‹ä½¿ç”¨å‡†åˆ™\"></a></h3>\n<p>1ã€ä¸¥ç¦ä½¿ç”¨new Thread,å› ä¸ºè¿™æ ·ä¸ä¾¿æ§åˆ¶,å¯èƒ½äº§ç”Ÿé¢„æœŸä¹‹å¤–çš„äº‹æƒ…<br>\n2ã€æä¾›åŸºç¡€çº¿ç¨‹æ± ä¾›å„ä¸ªä¸šåŠ¡æ ˆä½¿ç”¨ï¼ˆé¿å…å„ä¸ªä¸šåŠ¡æ ˆå„è‡ªç»´æŠ¤ä¸€å¥—çº¿ç¨‹æ± ï¼Œå¯¼è‡´çº¿ç¨‹æ•°è¿‡å¤šï¼‰<br>\n3ã€æ ¹æ®ä»»åŠ¡ç±»å‹é€‰æ‹©åˆé€‚çš„å¼‚æ­¥æ–¹å¼ï¼ˆä¼˜å…ˆçº§ä½é•¿æ—¶é—´æ‰§è¡Œ-HandlerThreadï¼Œå®šæ—¶æ‰§è¡Œ-çº¿ç¨‹æ± ï¼‰<br>\n4ã€åˆ›å»ºçº¿ç¨‹å¿…é¡»å‘½åï¼ˆæ–¹ä¾¿å®šä½çº¿ç¨‹å½’å±ï¼Œè¿è¡ŒæœŸThread.currentThread().setNameä¿®æ”¹åå­—ï¼‰<br>\n5ã€å…³é”®å¼‚æ­¥ä»»åŠ¡ç›‘æ§ï¼ˆå¼‚æ­¥ä¸ç­‰äºä¸è€—æ—¶ï¼ŒAOPçš„æ–¹å¼æ¥åšç›‘æ§ï¼‰<br>\n6ã€é‡è§†ä¼˜å…ˆçº§çš„è®¾ç½®ï¼ˆProcess.setThreadPriority(),å¯ä»¥è®¾ç½®å¤šæ¬¡ï¼‰</p>\n",
            "tags": [
                "æ€§èƒ½ä¼˜åŒ–"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/01/9LsQhIFgDkllFt0Q/",
            "url": "https://onion99.github.io/2021/11/01/9LsQhIFgDkllFt0Q/",
            "title": "å®‰å“ä¼˜åŒ–-åŒ…ä½“ç§¯",
            "date_published": "2021-10-31T20:48:08.000Z",
            "content_html": "<p><a href=\"https://cloud.tencent.com/developer/article/1425318\" target=\"_blank\">Android APP ç»ˆæç˜¦èº«æŒ‡å—</a></p>\n<ul>\n<li>å›¾ç‰‡è½¬WebP</li>\n<li>å»æ‰ä¸å¿…è¦çš„soåº“</li>\n<li>å¼€å¯shrinkResourceså»é™¤æ— ç”¨èµ„æº</li>\n<li>å¼€å¯minifyEnabledæ··æ·†ä»£ç </li>\n<li>åˆ é™¤æ— ç”¨çš„è¯­è¨€èµ„æº</li>\n<li>ä½¿ç”¨å¾®ä¿¡èµ„æºå‹ç¼©æ‰“åŒ…å·¥å…·</li>\n<li>é¿å…é‡å¤åº“,ä»¥åŠé¿å…ä¸åŒç‰ˆæœ¬çš„åº“</li>\n<li>AndroidManifestä¸­ -&gt; android:extractNativeLibs=â€œtrueâ€</li>\n</ul>\n",
            "tags": [
                "æ€§èƒ½ä¼˜åŒ–"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/01/UYa5EEntsM9sKTYz/",
            "url": "https://onion99.github.io/2021/11/01/UYa5EEntsM9sKTYz/",
            "title": "å®‰å“ä¼˜åŒ–-å¡é¡¿ä¼˜åŒ–",
            "date_published": "2021-10-31T20:47:12.000Z",
            "content_html": "<blockquote>\n<p>å¡é¡¿äº§ç”Ÿçš„æ ¹æœ¬åŸå› å°±æ˜¯CPUå’ŒGPUæ²¡æœ‰åŠæ—¶å¤„ç†å¥½æ•°æ®ï¼Œé’ˆå¯¹å¡é¡¿çš„ä¼˜åŒ–å°±æœ‰æ€è·¯äº†ï¼šå°½å¯èƒ½å‡å°‘ CPU å’Œ GPU èµ„æºçš„æ¶ˆè€—</p>\n</blockquote>\n<ul>\n<li>CPUï¼šä¸­å¤®å¤„ç†å™¨ï¼ˆCPUï¼Œcentral processing unitï¼‰ä½œä¸ºè®¡ç®—æœºç³»ç»Ÿçš„è¿ç®—å’Œæ§åˆ¶æ ¸å¿ƒï¼Œæ˜¯ä¿¡æ¯å¤„ç†ã€ç¨‹åºè¿è¡Œçš„æœ€ç»ˆæ‰§è¡Œå•å…ƒ</li>\n<li>GPUï¼šå›¾å½¢å¤„ç†å™¨ï¼ˆè‹±è¯­ï¼šGraphics Processing Unitï¼Œç¼©å†™ï¼šGPUï¼‰ï¼Œåˆç§°æ˜¾ç¤ºæ ¸å¿ƒ,åšå›¾åƒå’Œå›¾å½¢ç›¸å…³è¿ç®—å·¥ä½œçš„å¾®å¤„ç†å™¨</li>\n</ul>\n<h3 id=\"å¡é¡¿æ£€æµ‹\">å¡é¡¿æ£€æµ‹<a title=\"#å¡é¡¿æ£€æµ‹\" href=\"#å¡é¡¿æ£€æµ‹\"></a></h3>\n<p><a href=\"https://blog.csdn.net/lmj623565791/article/details/58626355\" target=\"_blank\">Android UIæ€§èƒ½ä¼˜åŒ– æ£€æµ‹åº”ç”¨ä¸­çš„UIå¡é¡¿</a></p>\n<p><a href=\"https://www.jianshu.com/p/9e8f88eac490\" target=\"_blank\">Androidæ€§èƒ½ä¼˜åŒ–-æ£€æµ‹Appå¡é¡¿ - ç®€ä¹¦ (jianshu.com)</a></p>\n<span id=\"more\"></span>\n<h4 id=\"ç”¨uiçº¿ç¨‹looperæ‰“å°çš„æ—¥å¿—\">ç”¨UIçº¿ç¨‹Looperæ‰“å°çš„æ—¥å¿—<a title=\"#ç”¨uiçº¿ç¨‹looperæ‰“å°çš„æ—¥å¿—\" href=\"#ç”¨uiçº¿ç¨‹looperæ‰“å°çš„æ—¥å¿—\"></a></h4>\n<p>å¼€æºå·¥å…·:<br>\n<a href=\"https://github.com/Kyson/AndroidGodEye\" target=\"_blank\">Kyson/AndroidGodEye: An app performance monitor(APM) , like â€œAndroid Studio profilerâ€, you can easily monitor the performance of your app real time in browser (github.com)</a></p>\n<p><a href=\"https://github.com/markzhai/AndroidPerformanceMonitor\" target=\"_blank\">markzhai/AndroidPerformanceMonitor: A transparent ui-block detection library for Android. (known as BlockCanary) </a></p>\n<p><a href=\"https://github.com/BzCoder/BlockCanaryCompat\" target=\"_blank\">BzCoder/BlockCanaryCompat: å¡é¡¿ç›‘æ§ï¼ŒBlockCanary é€‚é…Android O ä»¥ä¸Šç³»ç»Ÿ (github.com)</a></p>\n<h4 id=\"choreographer\">Choreographer<a title=\"#choreographer\" href=\"#choreographer\"></a></h4>\n<p>Androidç³»ç»Ÿæ¯éš”16mså‘å‡ºVSYNCä¿¡å·ï¼Œè§¦å‘å¯¹UIè¿›è¡Œæ¸²æŸ“ã€‚å¼€å‘è€…å¯ä»¥ä½¿ç”¨Choreographer#postFrameCallbackè®¾ç½®è‡ªå·±çš„callbackä¸Choreographeräº¤äº’ï¼Œä½ è®¾ç½®çš„FrameCallCackï¼ˆdoFrameæ–¹æ³•ï¼‰ä¼šåœ¨ä¸‹ä¸€ä¸ªframeè¢«æ¸²æŸ“æ—¶è§¦å‘ã€‚ç†è®ºä¸Šæ¥è¯´ä¸¤æ¬¡å›è°ƒçš„æ—¶é—´å‘¨æœŸåº”è¯¥åœ¨16msï¼Œå¦‚æœè¶…è¿‡äº†16msæˆ‘ä»¬åˆ™è®¤ä¸ºå‘ç”Ÿäº†å¡é¡¿ï¼Œæˆ‘ä»¬ä¸»è¦å°±æ˜¯åˆ©ç”¨ä¸¤æ¬¡å›è°ƒé—´çš„æ—¶é—´å‘¨æœŸæ¥åˆ¤æ–­</p>\n<p>å¼€æºå·¥å…·:<br>\n<a href=\"https://github.com/wasabeef/Takt\" target=\"_blank\">wasabeef/Takt: Takt is Android library for measuring the FPS using Choreographer</a></p>\n<p><a href=\"https://github.com/friendlyrobotnyc/TinyDancer\" target=\"_blank\">friendlyrobotnyc/TinyDancer: An android library for displaying fps from the choreographer and percentage of time with two or more frames dropped </a></p>\n<h3 id=\"anråˆ†æ\">ANRåˆ†æ<a title=\"#anråˆ†æ\" href=\"#anråˆ†æ\"></a></h3>\n<blockquote>\n<p>Application Not Respondingï¼Œä¹Ÿå°±æ˜¯åº”ç”¨ç¨‹åºæ— å“åº”</p>\n</blockquote>\n<h4 id=\"äº§ç”ŸåŸå› \">äº§ç”ŸåŸå› <a title=\"#äº§ç”ŸåŸå› \" href=\"#äº§ç”ŸåŸå› \"></a></h4>\n<ul>\n<li>InputDispatching Timeoutï¼š5ç§’å†…æ— æ³•å“åº”å±å¹•è§¦æ‘¸äº‹ä»¶æˆ–é”®ç›˜è¾“å…¥äº‹ä»¶</li>\n<li>BroadcastQueue Timeout ï¼šåœ¨æ‰§è¡Œå‰å°å¹¿æ’­ï¼ˆBroadcastReceiverï¼‰çš„<code>onReceive()</code>å‡½æ•°æ—¶10ç§’æ²¡æœ‰å¤„ç†å®Œæˆï¼Œåå°ä¸º60ç§’</li>\n<li>Service Timeoutï¼šå‰å°æœåŠ¡20ç§’å†…ï¼Œåå°æœåŠ¡åœ¨200ç§’å†…æ²¡æœ‰æ‰§è¡Œå®Œæ¯•</li>\n<li>ContentProvider Timeoutï¼šContentProviderçš„publishåœ¨10så†…æ²¡è¿›è¡Œå®Œ</li>\n<li>å…¶ä»–\n<ul>\n<li>ä¸»çº¿ç¨‹é˜»å¡æˆ–ä¸»çº¿ç¨‹æ•°æ®è¯»å–</li>\n<li>CPUæ»¡è´Ÿè·ï¼ŒI/Oé˜»å¡</li>\n<li>å†…å­˜ä¸è¶³</li>\n</ul>\n</li>\n</ul>\n<p>åˆ†æ:</p>\n<ul>\n<li>logä¸Šçš„anr reason</li>\n<li>adb å¯¼å‡ºANRæ—¥å¿—\n<ul>\n<li><code>adb pull /data/anr/traces.txt</code></li>\n</ul>\n</li>\n</ul>\n",
            "tags": [
                "æ€§èƒ½ä¼˜åŒ–"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/01/T8ghe13OAeLx6NBP/",
            "url": "https://onion99.github.io/2021/11/01/T8ghe13OAeLx6NBP/",
            "title": "å®‰å“ä¼˜åŒ–-å†…å­˜ä¼˜åŒ–",
            "date_published": "2021-10-31T20:46:21.000Z",
            "content_html": "<h3 id=\"å†…å­˜ä¿¡æ¯æŸ¥çœ‹\">å†…å­˜ä¿¡æ¯æŸ¥çœ‹<a title=\"#å†…å­˜ä¿¡æ¯æŸ¥çœ‹\" href=\"#å†…å­˜ä¿¡æ¯æŸ¥çœ‹\"></a></h3>\n<p><a href=\"https://www.jianshu.com/p/28b9cd87e667\" target=\"_blank\">Appå†…å­˜ä¼˜åŒ–å®è·µï¼šä¸€æ­¥ä¸€æ­¥åšå†…å­˜åˆ†æä¸ä¼˜åŒ–</a></p>\n<p>æŸ¥çœ‹æ¯ä¸ªAppè¿›ç¨‹å¯ä»¥åˆ†é…åˆ°çš„æœ€å¤§å†…å­˜</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">adb shell getprop | grep dalvik.vm.heapsize</span><br></pre></td></tr></table></figure>\n<p>Appçš„å†…å­˜ä½¿ç”¨æƒ…å†µæ¦‚è§ˆ</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">adb shell dumpsys meminfo åŒ…å</span><br></pre></td></tr></table></figure>\n<h3 id=\"ä¼˜åŒ–å·¥å…·\">ä¼˜åŒ–å·¥å…·<a title=\"#ä¼˜åŒ–å·¥å…·\" href=\"#ä¼˜åŒ–å·¥å…·\"></a></h3>\n<ul>\n<li>CPU Profiler</li>\n<li>Memory Analyzerï¼ˆMATï¼‰</li>\n<li>LeakCannary</li>\n</ul>\n<span id=\"more\"></span>\n<h3 id=\"ä¼˜åŒ–æ–¹å‘\">ä¼˜åŒ–æ–¹å‘<a title=\"#ä¼˜åŒ–æ–¹å‘\" href=\"#ä¼˜åŒ–æ–¹å‘\"></a></h3>\n<p><a href=\"https://www.cnblogs.com/wangjie1990/p/11327112.html\" target=\"_blank\">Android å¦‚ä½•ä¼˜åŒ–APPå†…å­˜ </a></p>\n<ul>\n<li>è°¨æ…ä½¿ç”¨Services\n<ul>\n<li>å¯åŠ¨ä¸€ä¸ªServiceæ—¶ï¼Œ ç³»ç»Ÿéœ€è¦å§‹ç»ˆä¿æŒè¿è¡Œè¯¥Serviceçš„è¿›ç¨‹,è¯¥Serviceå ç”¨çš„RAMå¯¹å…¶ä»–è¿›ç¨‹ä¸å…±äº«</li>\n<li>é¿å…ä½¿ç”¨æŒä¹…æ€§æœåŠ¡,å¦‚<code>JobScheduler</code>ä¹‹ç±»</li>\n</ul>\n</li>\n<li>ä½¿ç”¨ç»è¿‡ä¼˜åŒ–çš„å¤šæ•°æ®å®¹å™¨\n<ul>\n<li>å¦‚SparseArrayï¼ŒSparseBooleanArrayå’ŒLongSparseArray</li>\n<li>å¦‚æœ‰å¿…è¦ï¼Œæ‚¨å¯ä»¥éšæ—¶åˆ‡æ¢åˆ°åŸå§‹æ•°ç»„ä»¥è·å¾—ç²¾ç®€çš„æ•°æ®ç»“æ„</li>\n</ul>\n</li>\n<li>ä½¿ç”¨nano protobufsè¿›è¡Œåºåˆ—åŒ–æ•°æ®</li>\n<li>é¿å…å†…å­˜æ³„æ¼\n<ul>\n<li>å†…å­˜æ³„éœ²ä¼šå¯¼è‡´å¤§é‡çš„åƒåœ¾æ”¶é›†äº‹ä»¶å‘ç”Ÿ,ä»è€Œå¯¼è‡´ç³»ç»Ÿæ‰§è¡Œå…¶ä»–å†…å®¹(å¦‚æ¸²æŸ“æˆ–è€…ä¼ è¾“)çš„æ—¶é—´å˜å°‘</li>\n</ul>\n</li>\n<li>ç§»é™¤å†…å­˜å¯†é›†å‹èµ„æºï¼Œä»¥åŠlibåº“\n<ul>\n<li>å‡å°APKçš„å¤§å°</li>\n<li>è¯·ä½¿ç”¨ä¸è¿›è¡Œåå°„æ‰«æçš„ä¾èµ–æ³¨å…¥åº“(Dagger2),é¢‘ç¹çš„åå°„éœ€è¦æ›´å¤šçš„CPUå’Œå†…å­˜æ¶ˆè€—</li>\n<li>è°¨æ…ä½¿ç”¨å¤–éƒ¨åº“,å¤–éƒ¨åº“å¯èƒ½å¯¹åŒä¸€ä¸ªåŠŸèƒ½æœ‰ä¸ä¸€æ ·çš„å®ç°,è¿™å¯èƒ½å¯¼è‡´é¢„æœŸä¹‹å¤–çš„äº‹æƒ…</li>\n</ul>\n</li>\n</ul>\n",
            "tags": [
                "æ€§èƒ½ä¼˜åŒ–"
            ]
        },
        {
            "id": "https://onion99.github.io/2021/11/01/4LlbPfdOOCp58LMK/",
            "url": "https://onion99.github.io/2021/11/01/4LlbPfdOOCp58LMK/",
            "title": "å®‰å“ä¼˜åŒ–-å¯åŠ¨ä¼˜åŒ–",
            "date_published": "2021-10-31T20:43:04.000Z",
            "content_html": "<h3 id=\"å¯åŠ¨æµç¨‹\">å¯åŠ¨æµç¨‹<a title=\"#å¯åŠ¨æµç¨‹\" href=\"#å¯åŠ¨æµç¨‹\"></a></h3>\n<h4 id=\"ç›¸å…³\">ç›¸å…³<a title=\"#ç›¸å…³\" href=\"#ç›¸å…³\"></a></h4>\n<blockquote>\n<p>å¯åŠ¨çš„æµç¨‹å°±æ˜¯é€šè¿‡è¿™å…­ä¸ªå¤§ç±»åœ¨è¿™ä¸‰ä¸ªè¿›ç¨‹ä¹‹é—´ä¸æ–­é€šä¿¡çš„è¿‡ç¨‹</p>\n</blockquote>\n<h5 id=\"ä¸‰ä¸ªè¿›ç¨‹\">ä¸‰ä¸ªè¿›ç¨‹<a title=\"#ä¸‰ä¸ªè¿›ç¨‹\" href=\"#ä¸‰ä¸ªè¿›ç¨‹\"></a></h5>\n<ul>\n<li>Launcherè¿›ç¨‹: æ•´ä¸ªAppå¯åŠ¨æµç¨‹çš„èµ·ç‚¹,è´Ÿè´£å¤„ç†æ¡Œé¢ä¸ç”¨æˆ·ä¹‹é—´çš„äº¤äº’äº‹ä»¶,å¯ä»¥æƒ³è±¡ä¸ºä¸€ä¸ªæ¡Œé¢å¯åŠ¨å™¨</li>\n<li>SystemServerè¿›ç¨‹: Androidä¸­çš„æ‰€æœ‰SystemServeréƒ½ç”±å…¶å­µåŒ–(Fork)å‡ºæ¥,ä¾‹å¦‚AMS,WindowsMannager,PackageManagerServiceç­‰</li>\n<li>Appè¿›ç¨‹: å¯åŠ¨çš„Appæ‰€åœ¨çš„è¿›ç¨‹</li>\n</ul>\n<span id=\"more\"></span>\n<h5 id=\"å…­ä¸ªå¤§ç±»\">å…­ä¸ªå¤§ç±»<a title=\"#å…­ä¸ªå¤§ç±»\" href=\"#å…­ä¸ªå¤§ç±»\"></a></h5>\n<ul>\n<li>ActivityManagerService:  å³AMS,è´Ÿè´£ç®¡ç†ç³»ç»Ÿä¸­å››å¤§ç»„ä»¶çš„å¯åŠ¨,åˆ‡æ¢,è°ƒåº¦ä»¥åŠåº”ç”¨è¿›ç¨‹çš„ç®¡ç†</li>\n<li>Instrumentation: ç›‘æ§åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿçš„äº¤äº’</li>\n<li>ActivityThread: åº”ç”¨çš„å…¥å£ç±»ï¼Œé€šè¿‡è°ƒç”¨mainæ–¹æ³•ï¼Œå¼€å¯æ¶ˆæ¯å¾ªç¯é˜Ÿåˆ—ã€‚ActivityThreadæ‰€åœ¨çš„çº¿ç¨‹è¢«ç§°ä¸ºä¸»çº¿ç¨‹</li>\n<li>ApplicationThread: æä¾›Binderé€šè®¯æ¥å£ï¼ŒAMSåˆ™é€šè¿‡ä»£ç†è°ƒç”¨æ­¤Appè¿›ç¨‹çš„æœ¬åœ°æ–¹æ³•</li>\n<li>ActivityManagerProxyï¼šAMSæœåŠ¡åœ¨å½“å‰è¿›ç¨‹çš„ä»£ç†ç±»ï¼Œè´Ÿè´£ä¸AMSé€šä¿¡</li>\n<li>ApplicationThreadProxyï¼šApplicationThreadåœ¨AMSæœåŠ¡ä¸­çš„ä»£ç†ç±»ï¼Œè´Ÿè´£ä¸ApplicationThreadé€šä¿¡</li>\n</ul>\n<h4 id=\"é¡ºåº\">é¡ºåº<a title=\"#é¡ºåº\" href=\"#é¡ºåº\"></a></h4>\n<p><a href=\"https://blog.csdn.net/huangliniqng/article/details/89364064\" target=\"_blank\">APPå¯åŠ¨æµç¨‹è§£æ,å¢™è£‚æ¨è</a><br>\n<a href=\"https://www.cnblogs.com/not2/p/14326090.html\" target=\"_blank\">Appå¯åŠ¨é€Ÿåº¦ä¼˜åŒ– T2</a><br>\n<a href=\"https://blog.csdn.net/huangliniqng/article/details/89364064\" target=\"_blank\">å…·ä½“ä»£ç æµç¨‹</a></p>\n<ol>\n<li>Launcheré€šçŸ¥AMS, è¦å¯åŠ¨æŸä¸€åº”ç”¨,å¹¶è¯´æ˜å¯¹åº”çš„LauncherActivity</li>\n<li>AMSè¡¨ç¤ºæ”¶åˆ°, ç­‰å¾…Launcherè¿›å…¥PauseçŠ¶æ€</li>\n<li>Launcherè¿›å…¥PauseçŠ¶æ€, é€šçŸ¥AMSå¯ä»¥å¯åŠ¨æŸä¸€åº”ç”¨äº†</li>\n<li>AMSå¼€å§‹æ£€æŸ¥æŸä¸€åº”ç”¨æ˜¯å¦å¯åŠ¨\n<ul>\n<li>æ˜¯,åˆ™ç›´æ¥å¯åŠ¨,æµç¨‹ç»ˆæ­¢</li>\n<li>å¦,AMSåˆ™åœ¨çš„è¿›ç¨‹ä¸­åˆ›å»ºActivityThreadå¯¹è±¡,å¹¶å¯åŠ¨mainå‡½æ•°</li>\n</ul>\n</li>\n<li>æŸä¸€åº”ç”¨é€šçŸ¥AMSå¯åŠ¨å‡†å¤‡å°±ç»ª</li>\n<li>AMSé€šçŸ¥æŸä¸€åº”ç”¨è¦å¯åŠ¨çš„é¡µé¢,æŸä¸€åº”ç”¨å¯åŠ¨å¯¹åº”é¡µé¢</li>\n</ol>\n<p><img src=\"https://z3.ax1x.com/2021/10/27/57Z1PJ.png\" alt=\"57Z1PJ.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h3 id=\"å¯åŠ¨åˆ†ç±»\">å¯åŠ¨åˆ†ç±»<a title=\"#å¯åŠ¨åˆ†ç±»\" href=\"#å¯åŠ¨åˆ†ç±»\"></a></h3>\n<ul>\n<li>å†·å¯åŠ¨\n<ul>\n<li>è€—æ—¶æœ€å¤š,ä¼˜åŒ–é‡ç‚¹</li>\n<li><img src=\"https://z3.ax1x.com/2021/10/27/57ZxJJ.png\" alt=\"57ZxJJ.png\" loading=\"lazy\" class=\"Ï†bp\"></li>\n</ul>\n</li>\n<li>çƒ­å¯åŠ¨\n<ul>\n<li>æœ€å¿«.å³åå°åˆ°å‰å°çš„åˆ‡æ¢</li>\n</ul>\n</li>\n<li>æ¸©å¯åŠ¨\n<ul>\n<li>è¾ƒå¿«,åªé‡èµ°Activityçš„ç”Ÿå‘½å‘¨æœŸ,å³é”€æ¯åé‡å»º</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"è€—æ—¶ç»Ÿè®¡\">è€—æ—¶ç»Ÿè®¡<a title=\"#è€—æ—¶ç»Ÿè®¡\" href=\"#è€—æ—¶ç»Ÿè®¡\"></a></h3>\n<h4 id=\"systrace\">Systrace<a title=\"#systrace\" href=\"#systrace\"></a></h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TraceCompat.beginSection(<span class=\"string\">&quot;sectionName&quot;</span>)</span><br><span class=\"line\">TraceCompat.endSection();</span><br></pre></td></tr></table></figure>\n<p><code>python systrace.py -t 10 [other-options] [categories]</code></p>\n<h4 id=\"traceview\">Traceview<a title=\"#traceview\" href=\"#traceview\"></a></h4>\n<p><img src=\"https://z3.ax1x.com/2021/10/27/57llge.png\" alt=\"57llge.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>ä½¿ç”¨æ–¹å¼</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Debug.startMethodTracing(<span class=\"string\">&quot;fileName&quot;</span>)</span><br><span class=\"line\">Debug.stopMethodTracing()</span><br></pre></td></tr></table></figure>\n<p>è¿è¡Œä¹‹åå¯ä»¥åœ¨ç›®å½•ä¸‹ç”Ÿæˆæ–‡ä»¶ï¼šå†…éƒ¨å­˜å‚¨/android/data/${application}/files/fileName.traceï¼Œæ­¤æ–‡ä»¶å¯ä»¥ä½¿ç”¨Android Studio Profileæ‰“å¼€</p>\n<ul>\n<li>Wall Clock time : æ˜¯çº¿ç¨‹çœŸæ­£æ‰§è¡Œçš„æ—¶é—´</li>\n<li>Thread time : CPUæ‰§è¡Œçš„æ—¶é—´,æ¯”Wall Clock Timeå°‘,ä¸åŒ…å«é”æ—¶é—´,ç­‰å¾…æ—¶é—´</li>\n<li>Top Down:å°±æ˜¯å‡½æ•°çš„è°ƒç”¨åˆ—è¡¨</li>\n<li>Call Chart: ç³»ç»ŸApié»„è‰²ï¼Œåº”ç”¨è°ƒç”¨çš„æ–¹æ³•ç»¿è‰²ï¼Œç¬¬ä¸‰æ–¹Api(java sdkä¹Ÿå±äºç¬¬ä¸‰æ–¹)è“è‰²</li>\n<li>Flame Chart:  ä¸»è¦çš„ä½œç”¨æ˜¯æ”¶é›†è°ƒç”¨æ–¹æ³•çš„æ—¶é—´ï¼Œæ¯”å¦‚å¤šæ¬¡è°ƒç”¨LayoutInflate.inflateï¼ŒFlame Chartä¼šæŠŠä»–ä»¬éƒ½æ”¶é›†åˆ°ä¸€èµ·ã€‚</li>\n<li>Bottom Up: å’ŒTop Downæ˜¯ç›¸åçš„</li>\n</ul>\n<h4 id=\"adb-å‘½ä»¤ç»Ÿè®¡\">Adb å‘½ä»¤ç»Ÿè®¡<a title=\"#adb-å‘½ä»¤ç»Ÿè®¡\" href=\"#adb-å‘½ä»¤ç»Ÿè®¡\"></a></h4>\n<p><code>adb shell am start -S -W åŒ…å/å¯åŠ¨ç±»çš„å…¨é™å®šå</code></p>\n<p>ThisTime : æœ€åä¸€ä¸ª Activity çš„å¯åŠ¨è€—æ—¶<br>\nTotalTime : å¯åŠ¨ä¸€è¿ä¸²çš„ Activity æ€»è€—æ—¶<br>\nWaitTime : åº”ç”¨è¿›ç¨‹çš„åˆ›å»ºè¿‡ç¨‹ + TotalTime</p>\n<h4 id=\"ç³»ç»Ÿæ—¥å¿—ç»Ÿè®¡\">ç³»ç»Ÿæ—¥å¿—ç»Ÿè®¡<a title=\"#ç³»ç»Ÿæ—¥å¿—ç»Ÿè®¡\" href=\"#ç³»ç»Ÿæ—¥å¿—ç»Ÿè®¡\"></a></h4>\n<p>è¿‡æ»¤<code>displayed</code>è¾“å‡ºçš„å¯åŠ¨æ—¥å¿—</p>\n<p><img src=\"https://z3.ax1x.com/2021/10/27/57mU4e.png\" alt=\"57mU4e.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h3 id=\"å†·å¯åŠ¨ä¼˜åŒ–\">å†·å¯åŠ¨ä¼˜åŒ–<a title=\"#å†·å¯åŠ¨ä¼˜åŒ–\" href=\"#å†·å¯åŠ¨ä¼˜åŒ–\"></a></h3>\n<p><a href=\"https://jishuin.proginn.com/p/763bfbd345f0\" target=\"_blank\"> App å¯åŠ¨æ—¶é—´ä¼˜åŒ–è¯¦è§£</a></p>\n<p>ä¼˜åŒ–æ–¹å‘:</p>\n<ul>\n<li>å»¶è¿ŸåŠ è½½ / æ‡’åŠ è½½</li>\n<li>å¼‚æ­¥çº¿ç¨‹æ‰§è¡Œè€—æ—¶æ“ä½œï¼Œå¦‚å›¾ç‰‡åŠ è½½ã€ç½‘ç»œè®¿é—®ã€IOæ“ä½œç­‰</li>\n<li>ViewStubçš„ä½¿ç”¨</li>\n<li>å‡å°‘å¸ƒå±€å±‚æ¬¡å’ŒåµŒå¥—å¸ƒå±€</li>\n</ul>\n",
            "tags": [
                "æ€§èƒ½ä¼˜åŒ–"
            ]
        }
    ]
}