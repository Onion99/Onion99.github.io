{"title":"自定义View(4) - Canvas相关","date":"2021-11-03T21:58:53.000Z","date_formatted":{"ll":"2021年11月3日","L":"2021/11/03","MM-DD":"11-03"},"link":"2021/11/03/ZOnr24kULe7cQgsc","comments":true,"tags":["图形绘制"],"categories":["Android"],"updated":"2021-11-03T13:58:13.000Z","content":"<h3 id=\"范围裁切\">范围裁切<a title=\"#范围裁切\" href=\"#范围裁切\"></a></h3>\n<h4 id=\"cliprect\">clipRect<a title=\"#cliprect\" href=\"#cliprect\"></a></h4>\n<p><img src=\"https://z3.ax1x.com/2021/11/02/IFKTER.png\" alt=\"IFKTER.png\" loading=\"lazy\" class=\"φbp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">canvas.clipRect(left, top, right, bottom);</span><br><span class=\"line\">canvas.drawBitmap(bitmap, x, y, paint);</span><br><span class=\"line\"><span class=\"comment\">// 加上 Canvas.save() 和 Canvas.restore() 来及时恢复绘制范围</span></span><br><span class=\"line\">canvas.save();</span><br><span class=\"line\">canvas.clipRect(left, top, right, bottom);</span><br><span class=\"line\">canvas.drawBitmap(bitmap, x, y, paint);</span><br><span class=\"line\">canvas.restore();</span><br></pre></td></tr></table></figure>\n<span id=\"more\"></span>\n<h4 id=\"clippath\">clipPath<a title=\"#clippath\" href=\"#clippath\"></a></h4>\n<p><img src=\"https://z3.ax1x.com/2021/11/02/IFM9UI.md.png\" alt=\"IFM9UI.md.png\" loading=\"lazy\" class=\"φbp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">canvas.save();</span><br><span class=\"line\">canvas.clipPath(path1);</span><br><span class=\"line\">canvas.drawBitmap(bitmap, point1.x, point1.y, paint);</span><br><span class=\"line\">canvas.restore();</span><br><span class=\"line\"></span><br><span class=\"line\">canvas.save();</span><br><span class=\"line\">canvas.clipPath(path2);</span><br><span class=\"line\">canvas.drawBitmap(bitmap, point2.x, point2.y, paint);</span><br><span class=\"line\">canvas.restore();</span><br></pre></td></tr></table></figure>\n<h3 id=\"几何变换\">几何变换<a title=\"#几何变换\" href=\"#几何变换\"></a></h3>\n<h4 id=\"二维变换\">二维变换<a title=\"#二维变换\" href=\"#二维变换\"></a></h4>\n<blockquote>\n<p>处理常见的二维变换</p>\n</blockquote>\n<ul>\n<li><code>Canvas.translate()</code> 平移</li>\n<li><code>Canvas.rotate()</code> 旋转</li>\n<li><code>Canvas.scale()</code> 缩放</li>\n<li><code>Canvas.skew()</code> 错切</li>\n</ul>\n<h4 id=\"matrix变换\">Matrix变换<a title=\"#matrix变换\" href=\"#matrix变换\"></a></h4>\n<blockquote>\n<p>用来处理不常见的二维变换</p>\n</blockquote>\n<p><img src=\"https://z3.ax1x.com/2021/11/02/IFn6qs.png\" alt=\"IFn6qs.png\" loading=\"lazy\" class=\"φbp\"></p>\n<ul>\n<li><code>Canvas.setMatrix(matrix)</code>\n<ul>\n<li>用 <code>Matrix</code> 直接替换 <code>Canvas</code> 当前的变换矩阵，即抛弃 <code>Canvas</code> 当前的变换</li>\n</ul>\n</li>\n<li><code>Canvas.concat(matrix)</code>\n<ul>\n<li>用 <code>Canvas</code> 当前的变换矩阵和 <code>Matrix</code> 相乘，即基于 <code>Canvas</code> 当前的变换，叠加上 <code>Matrix</code> 中的变换</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Matrix matrix = <span class=\"keyword\">new</span> Matrix();</span><br><span class=\"line\"><span class=\"keyword\">float</span> pointsSrc = &#123;left, top, right, top, left, bottom, right, bottom&#125;;</span><br><span class=\"line\"><span class=\"keyword\">float</span> pointsDst = &#123;left - <span class=\"number\">10</span>, top + <span class=\"number\">50</span>, right + <span class=\"number\">120</span>, top - <span class=\"number\">90</span>, left + <span class=\"number\">20</span>, bottom + <span class=\"number\">30</span>, right + <span class=\"number\">20</span>, bottom + <span class=\"number\">60</span>&#125;;</span><br><span class=\"line\">...</span><br><span class=\"line\">matrix.reset();</span><br><span class=\"line\">matrix.setPolyToPoly(pointsSrc, <span class=\"number\">0</span>, pointsDst, <span class=\"number\">0</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\">canvas.save();</span><br><span class=\"line\">canvas.concat(matrix);</span><br><span class=\"line\">canvas.drawBitmap(bitmap, x, y, paint);</span><br><span class=\"line\">canvas.restore();</span><br></pre></td></tr></table></figure>\n<h4 id=\"camera\">Camera<a title=\"#camera\" href=\"#camera\"></a></h4>\n<blockquote>\n<p>处理三维旋转</p>\n</blockquote>\n<h5 id=\"camera.rotate*\">Camera.rotate*<a title=\"#camera.rotate*\" href=\"#camera.rotate*\"></a></h5>\n<p><img src=\"https://z3.ax1x.com/2021/11/02/IFZoMd.md.png\" alt=\"IFZoMd.md.png\" loading=\"lazy\" class=\"φbp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Camera camera =  <span class=\"keyword\">new</span>  Camera();</span><br><span class=\"line\">Point point1 = <span class=\"keyword\">new</span> Point(<span class=\"number\">200</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\">Point point2 = <span class=\"keyword\">new</span> Point(<span class=\"number\">600</span>, <span class=\"number\">200</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onDraw</span><span class=\"params\">(Canvas canvas)</span> </span>&#123;</span><br><span class=\"line\">   canvas.save();</span><br><span class=\"line\">   camera.save(); <span class=\"comment\">// 保存 Camera 的状态</span></span><br><span class=\"line\">   camera.rotateX(<span class=\"number\">30</span>); <span class=\"comment\">// 旋转 Camera 的三维空间</span></span><br><span class=\"line\">   camera.applyToCanvas(canvas); <span class=\"comment\">// 把旋转投影到 Canvas</span></span><br><span class=\"line\">   camera.restore(); <span class=\"comment\">// 恢复 Camera 的状态</span></span><br><span class=\"line\">   canvas.drawBitmap(bitmap, point1.x, point1.y, paint);</span><br><span class=\"line\">   canvas.restore();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>居中处理:<br>\n<img src=\"https://z3.ax1x.com/2021/11/02/IFesfS.png\" alt=\"IFesfS.png\" loading=\"lazy\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">int</span> bitmapWidth = bitmap.getWidth();</span><br><span class=\"line\"><span class=\"keyword\">int</span> bitmapHeight = bitmap.getHeight();</span><br><span class=\"line\"><span class=\"keyword\">int</span> center1X = point1.x + bitmapWidth / <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> center1Y = point1.y + bitmapHeight / <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> center2X = point2.x + bitmapWidth / <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> center2Y = point2.y + bitmapHeight / <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">camera.save();</span><br><span class=\"line\">matrix.reset();</span><br><span class=\"line\">camera.rotateX(<span class=\"number\">30</span>);</span><br><span class=\"line\">camera.getMatrix(matrix);</span><br><span class=\"line\">camera.restore();</span><br><span class=\"line\">matrix.preTranslate(-center1X, -center1Y);</span><br><span class=\"line\">matrix.postTranslate(center1X, center1Y);</span><br><span class=\"line\">canvas.save();</span><br><span class=\"line\">canvas.concat(matrix);</span><br><span class=\"line\">canvas.drawBitmap(bitmap, point1.x, point1.y, paint);</span><br><span class=\"line\">canvas.restore();</span><br></pre></td></tr></table></figure>\n<h5 id=\"camera.translate\">Camera.translate<a title=\"#camera.translate\" href=\"#camera.translate\"></a></h5>\n<h5 id=\"camera.setlocation\">Camera.setLocation<a title=\"#camera.setlocation\" href=\"#camera.setlocation\"></a></h5>\n<blockquote>\n<p>设置虚拟相机的位置</p>\n</blockquote>\n","prev":{"title":"自定义View(5) - 动画","link":"2021/11/03/SA664RldODNgeCrz"},"next":{"title":"自定义View(3) - Text相关","link":"2021/11/03/VjI1fQxy8MSFqUqm"},"plink":"https://onion99.github.io/2021/11/03/ZOnr24kULe7cQgsc/","reward":true,"copyright":{"custom":"Copyright:自由转载-非商用-禁止演绎-保持署名（CC BY-NC-ND 4.0）"}}